---
layout: post
title: "自动化运维工具Ansible"
date: 2024-05-09 16:14:40 +0800
description: "2种状态。_自动化部署运维工具"
keywords: "自动化部署运维工具"
categories: ['未分类']
tags: ['运维', '自动化', 'Ansible']
artid: "138492881"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=138492881
  alt: "自动化运维工具Ansible"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     自动化运维工具——Ansible
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、Ansible的概念：
    </h2>
    <h3>
     1.Ansible的介绍：
    </h3>
    <p>
     Ansible是一个基于
     <strong>
      Python开发
     </strong>
     的配置管理和应用部署工具，现在也在自动化管理领域大放异彩。它融合了众多老牌运维工具的优点，Pubbet和Saltstack能实现的功能，Ansible基本上都可以实现。
    </p>
    <p>
     <strong>
      Ansible能
      <span style="color:#fe2c24;">
       批量配置、部署、管理上千台主机
      </span>
      。
     </strong>
     比如以前需要切换到每个主机上执行的一或多个操作，使用Ansible只需在固定的一台Ansible控制节点上去完成所有主机的操作。
    </p>
    <p>
     <strong>
      Ansible是基于模块工作的
     </strong>
     ，它只是提供了一种运行框架，它本身没有完成任务的能力，
     <strong>
      真正执行操作的是Ansible的模块，
     </strong>
     比如copy模块用于拷贝文件到远程主机上，service模块用于管理服务的启动、停止、重启等。
    </p>
    <p>
     Ansible其中一个比较鲜明的特性是Agentless，即无Agent的存在，它就像普通命令一样，并非C/S软件，也只需在某个作为控制节点的主机上安装一次Ansible即可，通常它基于ssh连接来控制远程主机，远程主机上不需要安装Ansible或其它额外的服务。
    </p>
    <p>
     使用者在使用时，在服务器终端输入命令或者playbooks，会通过预定好的规则将playbook拆解为play，再组织成ansible可以识别的任务，调用模块和插件，根据主机清单通过SSH将临时文件发给远程的客户端执行并返回结果，执行结束后自动删除
    </p>
    <p>
     Ansible的另一个比较鲜明的特性是它的绝大多数模块都具备
     <strong>
      幂等性
     </strong>
     (idempotence)。所谓幂等性，指的是
     <strong>
      多次操作或多次执行对系统资源的影响是一致的
     </strong>
     。比如执行 systemctl stop xxx 命令来停止服务，
     <strong>
      当发现要停止的目标服务已经处于停止状态， 它什么也不会做
     </strong>
     ，所以多次停止的结果仍然是停止，不会改变结果，它是幂等的，而 systemctl restart xxx 是非幂等的。
    </p>
    <blockquote>
     <p>
      Ansible的很多模块在执行时都会先判断目标节点是否要执行任务，所以，可以放心大胆地让Ansible去执行任务，重复执行某个任务绝大多数时候不会产生任何副作用。
     </p>
    </blockquote>
    <h3>
     2.Ansible的特点：
    </h3>
    <p>
     1、部署简单
     <strong>
      ，只需在主控端部署Ansible环境
     </strong>
     ， 被控端无需做任何操作
    </p>
    <p>
     2、
     <strong>
      默认使用SSH协议
     </strong>
     设备进行管理；
    </p>
    <p>
     3、主从集中化管理
    </p>
    <p>
     4、配置简单、功能强大、扩张性强；
    </p>
    <p>
     5、支持API及自定义模块,可以通过Pyhton轻松扩展
    </p>
    <p>
     6、通过playbooks 来定制强大的配置、状态管理
    </p>
    <p>
     7、对云计算平台、大数据都有很好的支持
    </p>
    <h3>
     3.Ansible工作原理及流程：
    </h3>
    <p>
     <img alt="" height="591" src="https://i-blog.csdnimg.cn/blog_migrate/4306603215c62d9f8056fdbe2ce2f827.png" width="997"/>
    </p>
    <p>
     ①加载自己的配置文件，默认/etc/ansible/ansible.cfg
    </p>
    <p>
     ②查找对应的主机的配置文件，找到要执行的主机或组/etc/ansible/hosts文件
    </p>
    <p>
     ③加载自己对应的模块文件，如command、yum、ping、
    </p>
    <p>
     ④通过ansible将模块命令生成对应的临时py文件(类似python脚本)，并将该文件传输至被管理端
    </p>
    <p>
     ⑤传输到在被控制端的对应用户的家目录下.ansible/tmp/xxx/xxx.py
    </p>
    <p>
     ⑥被控制端给传输过来的py文件加执行权限
    </p>
    <p>
     ⑦执行并返回结果，执行完成后删除py文件并sleep 0退出
    </p>
    <h3>
     4.Ansible的构成：
    </h3>
    <p>
     <img alt="" height="567" src="https://i-blog.csdnimg.cn/blog_migrate/bc6daae1d12555cb4d6535bac284e7c7.png" width="1194"/>
    </p>
    <ul>
     <li>
      <p>
       NVENTORY：Ansible管理主机的清单 /etc/anaible/hosts 需要管理的服务清单
      </p>
     </li>
     <li>
      <p>
       MODULES：Ansible执行命令的功能模块，多数为内置核心模块，也可自定义
      </p>
     </li>
     <li>
      <p>
       PLUGINS：模块功能的补充，如连接类型插件、循环插件、变量插件、过滤插件等，该功能不常用
      </p>
     </li>
     <li>
      <p>
       API：供第三方程序调用的应用程序编程接口
      </p>
     </li>
    </ul>
    <h2>
     二、 ansible 环境安装部署：
    </h2>
    <table border="1" cellpadding="1" cellspacing="1" style="width:500px;">
     <tbody>
      <tr>
       <td style="width:235px;">
        管理端 —— 部署 ansible
       </td>
       <td style="width:263px;">
        192.168.91.10
       </td>
      </tr>
      <tr>
       <td style="width:235px;">
        被管理端
       </td>
       <td style="width:263px;">
        192.168.91.11
       </td>
      </tr>
      <tr>
       <td style="width:235px;">
        被管理端
       </td>
       <td style="width:263px;">
        192.168.91.12
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     1.管理端安装 ansible：
    </h3>
    <pre><code class="language-bash">yum install -y epel-release			//先安装 epel 源
yum install -y ansible</code></pre>
    <p>
     <img alt="" height="406" src="https://i-blog.csdnimg.cn/blog_migrate/5dfc01755edeedabc5399cb9729f7cbb.png" width="881"/>
    </p>
    <p>
     <img alt="" height="362" src="https://i-blog.csdnimg.cn/blog_migrate/c7ec7493e139bcd2c360a26786ba1bde.png" width="862"/>
    </p>
    <pre><code class="language-bash">//ansible 目录结构
tree /etc/ansible/
├── ansible.cfg			#ansible的配置文件，一般无需修改
├── hosts				#ansible的主机清单，用于存储需要管理的远程主机的相关信息
└── roles/				#公共角色目录</code></pre>
    <h3>
     <img alt="" height="179" src="https://i-blog.csdnimg.cn/blog_migrate/d347985ab706a5ed933645537c2bf693.png" width="864"/>
    </h3>
    <h3>
     2.配置主机清单 ：
    </h3>
    <pre><code class="language-bash">#配置文件位置:/etc/ansible/ansible
#hosts文件位置:/etc/ansible/hosts
</code></pre>
    <p>
     <img alt="" height="291" src="https://i-blog.csdnimg.cn/blog_migrate/71fb1f96d23123c755cc90c81cf6677b.png" width="836"/>
    </p>
    <pre><code class="language-bash">ssh-keygen
#生成公钥，输入命令输入4个回车即可
cd ~/.ssh
ssh-copy-id -i   192.168.91.11
ssh-copy-id -i   192.168.91.20
或
//配置密钥对验证
ssh-keygen -t rsa		#一路回车，使用免密登录
sshpass -p 'abc1234' ssh-copy-id root@192.168.91.11
sshpass -p 'abc1234' ssh-copy-id root@192.168.91.20</code></pre>
    <p>
     <img alt="" height="355" src="https://i-blog.csdnimg.cn/blog_migrate/ab16a46b645b85710665c895b28a3518.png" width="865"/>
    </p>
    <p>
     <img alt="" height="130" src="https://i-blog.csdnimg.cn/blog_migrate/5ff5f952c32c8a4aafedf5b87c7abe63.png" width="851"/>
    </p>
    <h3>
     3.测试：
    </h3>
    <pre><code class="language-bash">
ansible  webservers  -m command  -a 'pwd'
#安装完成尝试管理webservers组输入pwd命令
ansible  all   -a 'ls'
#安装完成尝试管理所有hosts中主机输入ls命令，不指定模块默认为command模块</code></pre>
    <p>
     <img alt="" height="126" src="https://i-blog.csdnimg.cn/blog_migrate/e29ac143c66d24cc698a8d4093608dcb.png" width="861"/>
    </p>
    <p>
     <img alt="" height="636" src="https://i-blog.csdnimg.cn/blog_migrate/04dd293ea8163527c2467bf11e6ec6fb.png" width="1200"/>
    </p>
    <h2>
     三、Ansible常用模块：
    </h2>
    <p id="(1)%20ansible%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E5%9D%97">
     <strong>
      ansible命令行模块：
     </strong>
    </p>
    <blockquote>
     <p>
      命令格式：ansible &lt;组名&gt;/ip -m &lt;模块&gt; -a&lt;参数列表&gt;
     </p>
    </blockquote>
    <p>
     #  ansible-doc -s 列出指定模块的描述信息和操作动作
    </p>
    <p>
     # ansible-doc -l 列出所有已安装的模块，按q退出
    </p>
    <h3>
     1.command模块：
    </h3>
    <p>
     #此模块
     <strong>
      不能使用管道符和重定向
     </strong>
     ，指定模块默认为commend模块
    </p>
    <blockquote>
     <p>
      //常用的参数： chdir：在远程主机上运行命令前提前进入目录
     </p>
     <p>
      creates：判断指定文件是否存在，如果存在，不执行后面的操作
     </p>
     <p>
      removes：判断指定文件是否存在，如果存在，执行后面的操作
     </p>
    </blockquote>
    <pre><code class="language-bash">ansible 192.168.91.11 -m command -a 'date'		#指定 ip 执行 date</code></pre>
    <p>
     <img alt="" height="84" src="https://i-blog.csdnimg.cn/blog_migrate/c9b543e80b17c5229707a7a8cbf58b7e.png" width="867"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m command -a 'date'			#指定组执行 date</code></pre>
    <p>
     <img alt="" height="130" src="https://i-blog.csdnimg.cn/blog_migrate/fcc5e6215679d63a54ea5407991cdb19.png" width="781"/>
    </p>
    <pre><code class="language-bash">ansible all -m command -a 'date'				#all 代表所有 hosts 主机</code></pre>
    <p>
     <img alt="" height="132" src="https://i-blog.csdnimg.cn/blog_migrate/f03d83b6cc5ea05cd12731b1028495d5.png" width="731"/>
    </p>
    <pre><code class="language-bash">ansible all -a 'ls /'							#如省略 -m 模块，则默认运行 command 模块</code></pre>
    <p>
     <img alt="" height="339" src="https://i-blog.csdnimg.cn/blog_migrate/a71a602364b140252d9c5072d6584310.png" width="744"/>
    </p>
    <h3 id="(3)%20shell%E6%A8%A1%E5%9D%97">
     2.shell模块：
    </h3>
    <p>
     #用远程主机的shell进程，
     <strong>
      打开一个子shell进行命令操作
     </strong>
     ，
     <strong>
      支持管道符和重定向
     </strong>
    </p>
    <pre><code class="language-bash">ansible webservers -m shell -a 'ifconfig ens33 |awk "NR==2{print \$2}"'
#提取webservers组中的所有ip地址，注意双引号不识别变量所以要加转义符\</code></pre>
    <p>
     <img alt="" height="164" src="https://i-blog.csdnimg.cn/blog_migrate/76ea3371cf467f38f4c506ba75dd5cb3.png" width="864"/>
    </p>
    <h3>
     3.cron模块 ：
    </h3>
    <p>
     #
     <strong>
      远程主机定义计划任务
     </strong>
     ，2种状态
     <strong>
      present(添加)
     </strong>
     和
     <strong>
      absent(移除)
     </strong>
     ，默认为
     <strong>
      present
     </strong>
     。
    </p>
    <blockquote>
     <p>
      //常用的参数：
     </p>
     <p>
      minute/hour/day/month/weekday：分/时/日/月/周
     </p>
     <p>
      job：任务计划要执行的命令
     </p>
     <p>
      name：任务计划的名称
     </p>
    </blockquote>
    <pre><code class="language-bash">ansible  webservers -m cron  -a 'name=crontest hour="*/12"  day="*/1" job="/usr/bin/echo   cron test "   ' 
#每周一12点，输出"cron test"</code></pre>
    <p>
     <img alt="" height="557" src="https://i-blog.csdnimg.cn/blog_migrate/ec718e3afda6354e2e69999f8293db32.png" width="1136"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m cron -a "name=crontest  state=absent"
#删除名为"crontest"的定时任务</code></pre>
    <p>
     <img alt="" height="436" src="https://i-blog.csdnimg.cn/blog_migrate/207166f8dd4223cca4666b180fc7fa1f.png" width="1111"/>
    </p>
    <h3>
     4.user模块：
    </h3>
    <p>
     //用户管理的模块
    </p>
    <p>
     ansible-doc -s user
    </p>
    <p>
     常用参数：
    </p>
    <ul>
     <li>
      name：用户名；
     </li>
     <li>
      shell：用户默认shell；
     </li>
     <li>
      uid：指定用户uid；
     </li>
     <li>
      group：指定用户基本组
     </li>
     <li>
      state：账户状态present增加/absent删除；
     </li>
     <li>
      system：是否为系统用户yes/no；
     </li>
     <li>
      move_home：yes/no若创建用户的家目录存在是否移动；
     </li>
     <li>
      remove：yes/no当state=absent时是否删除家目录；
     </li>
     <li>
      passwd：指定用户的密码；comment：用户的注释信息
     </li>
    </ul>
    <pre><code class="language-bash">ansible webservers -m user -a 'name="test01"'				#创建用户test01</code></pre>
    <p>
     <img alt="" height="754" src="https://i-blog.csdnimg.cn/blog_migrate/cbf598c49fd90c72b9ccb02de1a721b5.png" width="1200"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m user -a 'name="test01" state=absent'	#删除用户test01</code></pre>
    <p>
     <img alt="" height="551" src="https://i-blog.csdnimg.cn/blog_migrate/2d4b15e9e81b1b62b028c0dc8b1013a0.png" width="1200"/>
    </p>
    <h3>
     5.group 模块:
    </h3>
    <p>
     //用户组管理的模块
    </p>
    <p>
     ansible-doc -s group
    </p>
    <pre><code class="language-bash">ansible webservers -m group -a 'name=mysql gid=306 system=yes'	#创建mysql组</code></pre>
    <p>
     <img alt="" height="530" src="https://i-blog.csdnimg.cn/blog_migrate/5758b45038c46c6bbf13d55f3f45c762.png" width="1200"/>
    </p>
    <pre><code class="language-bash">ansible  webservers -m user -a 'name=test01 uid=306 system=yes group=mysql'
#将test01用户添加到mysql组中</code></pre>
    <p>
     <img alt="" height="789" src="https://i-blog.csdnimg.cn/blog_migrate/4f7e0e4fca422638577f6fd5a25d733b.png" width="1200"/>
    </p>
    <h3>
     6.copy 模块:
    </h3>
    <p>
     //用于复制指定主机文件到远程主机的
    </p>
    <p>
     ansible-doc -s copy
    </p>
    <p>
     常用参数：
    </p>
    <ul>
     <li>
      mode：指出复制时，目标文件的权限
     </li>
     <li>
      owner：指出复制时，目标文件的属主(对面无此组或此主会报错)
     </li>
     <li>
      group：指出复制时，目标文件的属组
     </li>
     <li>
      dest=‘路径’：目标文件路径
     </li>
     <li>
      src=‘路径’：源文件路径
     </li>
     <li>
      content=‘字符串内容’：将字符串内容复制到到目标文件中，等于重定向即覆盖，不能与src同用
     </li>
    </ul>
    <pre><code class="language-bash">ansible webservers -m copy -a 'content="helloworld" dest=/opt/hello.txt'
#将helloworld写入/opt/hello.txt文件中</code></pre>
    <p>
     <img alt="" height="806" src="https://i-blog.csdnimg.cn/blog_migrate/05d82b18ab7c8e97bf900b9f70bf2975.png" width="1200"/>
    </p>
    <h3>
     7.file 模块:
    </h3>
    <p>
     //设置文件属性
    </p>
    <p>
     ansible-doc -s file
    </p>
    <pre><code class="language-bash">ansible webservers -m file -a 'owner=test01 group=mysql mode=644 path=/opt/fstab.bak'
#修改文件的属主属组权限等</code></pre>
    <p>
     <img alt="" height="630" src="https://i-blog.csdnimg.cn/blog_migrate/cc0582a014cd1df128ce750e45c6d30d.png" width="1200"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m file -a "path=/opt/abc.txt state=touch"			
#创建一个文件</code></pre>
    <p>
     <img alt="" height="741" src="https://i-blog.csdnimg.cn/blog_migrate/06108cc8a0aa5a065b768e4f7289009f.png" width="1196"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m file -a "path=/opt/abc.txt state=absent"			
#删除一个文件</code></pre>
    <p>
     <img alt="" height="441" src="https://i-blog.csdnimg.cn/blog_migrate/0a6dba3da4b05e821358005280943e87.png" width="1109"/>
    </p>
    <h3>
     8.hostname 模块：
    </h3>
    <p>
     //用于管理远程主机上的主机名
    </p>
    <pre><code class="language-bash">ansible webservers -m hostname -a "name=mysql01"
#更改主机名为mysql01</code></pre>
    <p>
     <img alt="" height="584" src="https://i-blog.csdnimg.cn/blog_migrate/3a8955bf8fc1a6419d980fd84c954016.png" width="1200"/>
    </p>
    <h3>
     9.ping 模块：
    </h3>
    <p>
     //检测远程主机的连通性
    </p>
    <pre><code class="language-bash">ansible all -m ping</code></pre>
    <p>
     <img alt="" height="389" src="https://i-blog.csdnimg.cn/blog_migrate/855cab815492246017bceac37d70f08e.png" width="1122"/>
    </p>
    <h3>
     10.yum 模块：
    </h3>
    <p>
     //在远程主机上安装与卸载软件包
    </p>
    <p>
     ansible-doc -s yum
    </p>
    <pre><code class="language-bash">ansible webservers -m yum -a 'name=httpd'					#安装服务</code></pre>
    <p>
     <img alt="" height="625" src="https://i-blog.csdnimg.cn/blog_migrate/11e380c25ca19d88ff8c6c3a8c929cfc.png" width="1200"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m yum -a 'name=httpd state=absent'		#卸载服务</code></pre>
    <p>
     <img alt="" height="564" src="https://i-blog.csdnimg.cn/blog_migrate/f3d60ece8cc91e29d51e5dd453d10a35.png" width="1200"/>
    </p>
    <h3>
     11.service/systemd 模块：
    </h3>
    <p>
     //用于管理远程主机上的管理服务的运行状态
    </p>
    <p>
     ansible-doc -s service
    </p>
    <p>
     //常用的参数：
    </p>
    <ul>
     <li>
      name：被管理的服务名称
     </li>
     <li>
      state=started|stopped|restarted：动作包含启动关闭或者重启
     </li>
     <li>
      enabled=yes|no：表示是否设置该服务开机自启 ；runlevel：如果设定了enabled开机自启去，则要定义在哪些运行目标下自启动
     </li>
    </ul>
    <pre><code class="language-bash">ansible webservers -a 'systemctl status httpd'			
#查看web服务器httpd运行状态</code></pre>
    <p>
     <img alt="" height="351" src="https://i-blog.csdnimg.cn/blog_migrate/d43261f314e05aae525fa3e90925710d.png" width="1200"/>
    </p>
    <pre><code class="language-bash">ansible webservers -m service -a 'enabled=true name=httpd state=started'			
#启动httpd服务</code></pre>
    <p>
     <img alt="" height="652" src="https://i-blog.csdnimg.cn/blog_migrate/228b9fdfde4c3f782d02a234f43048b4.png" width="1200"/>
    </p>
    <h3>
     12.script 模块：
    </h3>
    <p>
     //实现远程批量运行本地的 shell 脚本
    </p>
    <p>
     ansible-doc -s script
    </p>
    <pre><code class="language-bash">ansible服务器：
vim  /test.sh
#编写/下的test.sh脚本内容如下
#!/bin/bash
echo  "this is test"

chmod +x /test.sh
ansible webservers -m script -a "/test.sh"</code></pre>
<p>
<img alt="" height="704" src="https://i-blog.csdnimg.cn/blog_migrate/fe3b3d8f2e74404b4d2168501150aeeb.png" width="971"/>
</p>
<h3>
13.setup 模块:
</h3>
<p>
//facts 组件是用来收集被管理节点信息的，使用 setup 模块可以获取这些信息
</p>
<p>
ansible-doc -s setup
</p>
<pre><code class="language-bash">ansible webservers -m setup #获取 mysql 组主机的 facts 信息

ansible dbservers -m setup -a 'filter=\*ipv4'  
#使用 filter 可以筛选指定的 facts 信息</code></pre>
<p>
<img alt="" height="479" src="https://i-blog.csdnimg.cn/blog_migrate/e8f7c3d5a48ac0db988e83355f858f3f.png" width="1126"/>
</p>
<h2>
四、inventory 清单：
</h2>
<p>
hosts 配置文件位置：
<strong>
/etc/ansible/hosts
</strong>
；
</p>
<p>
Inventory 支持
<strong>
对主机进行分组
</strong>
，
<strong>
每个组内可以定义多个主机
</strong>
，每个主机都可以
<strong>
定义在任何一个或多个主机组内。
</strong>
</p>
<h3>
<strong> 1.
</strong>
inventory 中的变量含义：
</h3>
<p>
ansible*host                                    ansible 连接节点时的 IP 地址
<br/>
ansible_port                                      连接对方的端口号，ssh 连接时默认为 22
<br/>
ansible_user                                    连接对方主机时使用的主机名。不指定时，将使用执行                                                                     ansible 或 ansible-playbook 命令的用户
<br/>
ansible_password                           连接时的用户的 ssh 密码，仅在未使用密钥对验证的情况下有效
<br/>
ansible_ssh* private*key_file         指定密钥认证 ssh 连接时的私钥文件
<br/>
ansible_ssh_common_args             提供给 ssh、sftp、 scp 命令的额外参数
<br/>
ansible become                               允许进行权限提升
<br/>
ansible become* method                 指定提升权限的方式，例如可使用 sudo/ su/runas 等方式
<br/>
ansible become_user                       提升为哪个用户的权限，默认提升为 root
<br/>
ansible_become_password             提升为指定用户权限时的密码
</p>
<h3> 2.主机变量使用：
</h3>
<pre><code class="language-bash">写法 1：
[webservers]
192.168.30.11 ansible_port=22 ansible_user=root ansible_password=abc123
192.168.30.12 ansible_port=22 ansible_user=root ansible_password=abc123
#webservers 组中被控制端 192.168.30.11 的端口号为 22 登录时用户是 root 密码为 abc123
写法 2：
[webservers]
192.168.30.1[1:2] ansible_port=22 ansible_user=root ansible_password=abc123 #如果是名称类似的主机，可以使用列表的方式标识各个主机
写法 3：
[webservers]
192.168.30.11:22
192.168.30.12:22 #默认 ssh 管理时的端口为 22，若不是 22 则直接在被管理 ip 后加冒号和对应端口号</code></pre>
<h3> 3.组变量使用：
</h3>
<pre><code class="language-bash">[webservers:vars]  
ansible_user=root
ansible_password=abc123 #表示 webservers 组内所有主机定义变量控制时使用 root 账户密码为 abc123

[all:vars]  
ansible_port=22 #表示为所有组的所有主机定义变量使用 ssh 远程管理时都是 22 端口</code></pre>
<h3> 4.组嵌套使用：
</h3>
<pre><code class="language-bash">#nginx 组
[nginx]
192.168.30.11
192.168.30.12

#httpd 组
[httpd]
192.168.30.13
192.168.30.14

#组内嵌为 web
[web:children]
nginx
httpd #表示 web 组的成员即 children 的直译‘孩子’包括 nginx 和 httpd 组</code></pre>
<h2>
五、playbooks 剧本：
</h2>
<h3>
1.playbooks 简述：
</h3>
<p>
<strong>
定义一种任务方式，在编写 playbook 时可以使用变量来传数据。
</strong>
</p>
<p>
playbooks 是 ansible
<strong>
用于配置，部署，和管理被控节点的剧本
</strong>
。通过 playbooks 的详细描述，执行其中的 tasks，可以让远端主机达到预期的状态。
<strong>
playbooks 是由一个或多个”play”组成的列表。
</strong>
当对一台机器做环境初始化的时候往往需要不止做一件事情，这时使用 playbooks 会更加适合。通过 playbooks 你可以一次在多台机器执行多个指令。通过这种预先设计的配置保持了机器的配置统一，并很简单的执行日常任务。
</p>
<p>
ansible 通过不同的模块实现相应的管理，管理的方式通过定义的清单文件(hosts)所管理的主机包括认证的方式连接的端口等。所有的功能都是通过调用不同的模块(modules)来完成不同的功能的。不管是执行单条命令还是 play-book 都是基于清单文件。
</p>
<h3 id="2%E3%80%81playbook%E5%89%A7%E6%9C%AC%E6%A0%BC%E5%BC%8F">
2.playbooks 剧本格式:
</h3>
<p>
playbooks 由
<strong>
YMAL 语言编写
</strong>
，YMAL 格式是类似于 JSON 的文件格式，
<strong>
一个文件中有
<span style="color:#fe2c24;">
多个 play
</span>
，一个 play 中只能有
<span style="color:#fe2c24;">
一个 tasks
</span>
，一个 tasks 中可以有
<span style="color:#fe2c24;">
多个 name 任务
</span>
。
</strong>
</p>
<p>
注意事项：
</p>
<p>
① 大小写明了
</p>
<p>
②
<strong>
通过缩进表示层级关系
</strong>
</p>
<p>
③
<strong>
不支持制表符 tab 键缩进，只能使用空格缩进
</strong>
</p>
<p>
④ 缩进的空格数目不重要，只要相同层级左右对齐，通常
<strong>
开头缩进 2 个空格
</strong>
</p>
<p>
⑤#号注释
</p>
<p>
⑥
<strong>
符号字符后缩进 1 个空格
</strong>
，如冒号：逗号，横杠-后面空一个格
</p>
<p>
⑦ 如果包含特殊字符用单引号和双引号引起来会作为字符串处理，单引号不识别变量，双引号识别变量。
</p>
<h3>
3.playbooks 组成部分：
</h3>
<p>
playbooks 本身由以下各部分组成：
</p>
<table border="1" cellspacing="0">
<tbody>
<tr>
<td style="width:99px;">
<strong>
模块名
</strong>
</td>
<td style="width:590px;">
<strong>
作用
</strong>
</td>
</tr>
<tr>
<td style="width:99px;">
tasks
</td>
<td style="width:590px;">
<strong>
任务
</strong>
，即通过 task 调用 ansible 的模块将多个操作组织在一个 playbooks 中运行
</td>
</tr>
<tr>
<td style="width:99px;">
variables
</td>
<td style="width:590px;">
<strong>
变量
</strong>
，使用{
<!-- -->
{}}调用，可简写 vars
</td>
</tr>
<tr>
<td style="width:99px;">
templates
</td>
<td style="width:590px;">
<strong>
模板
</strong>
</td>
</tr>
<tr>
<td style="width:99px;">
handlers
</td>
<td style="width:590px;">
<strong>
处理器
</strong>
，当 changed 状态条带满足时，notify 触发执行的操作，不会立即执行 notify，要等 playbooks 中的所有任务完成才会执行 notify，好处是可以多次触发 notify 单最后只执行一次对应的 handlers。
</td>
</tr>
<tr>
<td style="width:99px;">
roles
</td>
<td style="width:590px;">
<strong>
角色
</strong>
</td>
</tr>
<tr>
<td style="width:99px;">
ignore_errors
</td>
<td style="width:590px;">
<strong>
如果执行命令的返回值不为 0 则报错 tasks 停止默认
</strong>
，如果需要忽略报错则设置为 false
</td>
</tr>
<tr>
<td style="width:99px;">
notify
</td>
<td style="width:590px;">
<strong>
如果上面的条件成立则执行 handlers 模块的内容
</strong>
</td>
</tr>
<tr>
<td style="width:99px;">
whit_item
</td>
<td style="width:590px;">
<strong>
定义循环的内容即列表
</strong>
，使用{
<!-- -->
{item}}调用每一次的值，即名称为 item。遍历内容直到结束
</td>
</tr>
<tr>
<td style="width:99px;">
when
</td>
<td style="width:590px;">
<strong>
条件判断
</strong>
，提供唯一通用的条件判断，true 时执行，否则不执行
</td>
</tr>
<tr>
<td style="width:99px;">
become
</td>
<td style="width:590px;">
2.6 版本以后的参数，之前是 sudo，意思为
<strong>
切换用户运行
</strong>
</td>
</tr>
<tr>
<td style="width:99px;">
tags
</td>
<td style="width:590px;">
<strong>
为某个或某些任务定义标签
</strong>
，playbooks 执行时可以指定只执行某个标签，若标签为 always 则无论执行此 playbooks 的那个标签都会将有 always 标签的 name 一起执行
</td>
</tr>
</tbody>
</table>
<h3>
4.playbooks 启动及检测：
</h3>
<pre><code class="language-bash">ansible-playbook 文件名.yaml
ansible-playbook 文件.yaml --start-at-task='任务名/标签' #从某个 task 开始执行或只执行某个标签的 name #启动此文件
补充参数：-k(-ask-pass)：用来交互式输入 ssh 密码

​ -K(-ask-become-pass)：用来交互式输入 sudo 密码

​ -U：指定用户

         -C：测试

ansible-playbook 文件.yaml --list-task #检查 yml 文件

ansible-playbook 文件.yaml --list-hosts #检测主机

ansible-playbook 文件.yaml --syntax-check #检测语法
</code></pre>
<h3 id="5%E3%80%81playbook%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98%E5%AE%9E%E4%BE%8B1">
5.playbooks 模块部署 httpd：
</h3>
<pre><code class="language-bash">vim test1.yaml #新建编辑 yaml 文件,内容如下

---

#ymal 文件开头，可不写

- name: test #定义 play 名称，可不写
  gather_facts: false #设置不进行 facts 信息收集，这可以加快执行速度，可省略默认开启
  hosts: webservers #要执行的组或者主机，webservers 为组名需要在/etc/ansible/hosts 中配置
  remote_user: root #执行时所使用的用户
  tasks: #定义任务列表，列表中任务按顺序执行
  - name: test ping #自定义 name 的任务名称
    ping: #第一个任务执行内容为使用 ping 模块 ping，webservers 组的主机
  - name: test selinux
    command: /sbin/setenforce 0 #第二个任务执行内容为使用 command 模块关闭 selinux
    ignore_errors: false #若出现错误，忽略继续运行下面的任务，默认为 true 出错立即停止 playbooks
  - name: test stop firewalld
    service: name=firewalld state=stopped #第三个任务执行内容为使用 service 模块关闭 firewalld 防火墙
  - name: test yum
    yum: name=httpd state=latest #第四个任务执行内容为使用 yum 模块安装 httpd 服务状态为 latest
  - name: test copy
    copy: src=/opt/httpd.conf dest=/etc/httpd/conf/httpd.conf #第五个任务为使用 copy 模块将 ansible 上的/etc/httpd.conf 文件拷贝到指定组的主配置文件下替换，注意此处需要在 ansible 的/opt 目录上有一个 httpd.conf 的模版否则会报错
    notify: "restart httpd" #如果上面的 copy 任务成功，则调用 handlers 模块的 restart httpd，注意要与下面 handlers 的 name 名称相同
  - name: test start httpd
    service: enabled=yes name=httpd state=started #第六个任务执行内容为使用 service 模块启动 httpd 服务并设置开机自启
    handlers:
  - name: restart httpd
    service: name=httpd state=restarted
    #handlers 模块，若 notify 成立则执行此模块内容调用 service 模块重启 httpd 服务。注意使用 name 名称调用</code></pre>
    <p>
    <img alt="" height="85" src="https://i-blog.csdnimg.cn/blog_migrate/69cb47010ca986445fa9ebf8bb1c357e.png" width="579"/>
    </p>
    <p>
    <img alt="" height="644" src="https://i-blog.csdnimg.cn/blog_migrate/d888f5eab0bb2b22374bad441c9c1fb9.png" width="1200"/>
    </p>
    <p>
    执行剧本：
    </p>
    <p>
    <img alt="" height="599" src="https://i-blog.csdnimg.cn/blog_migrate/5294c2ad42e39357166a54451c42d141.png" width="1161"/>
    </p>
    <p>
    <img alt="" height="575" src="https://i-blog.csdnimg.cn/blog_migrate/e024f1cf4973cd433d3fb07058895095.png" width="1200"/>
    </p>
    <p>
    网页端查看：
    </p>
    <p>
    <img alt="" height="761" src="https://i-blog.csdnimg.cn/blog_migrate/9ce974f80875c5c494d5cabf7305513d.png" width="1200"/>
    </p>
    <h3> 6.
    <a href="https://so.csdn.net/so/search?q=vars&amp;spm=1001.2101.3001.7020" title="vars">
    vars
    </a>
    模块部署：
    </h3>
    <pre><code class="language-bash">vim test2.yaml

---

- name:
  hosts: webservers
  remote_user: root
  ignore_errors: false
  vars: #使用变量模块
  - groupname: testgroup #定义变量 groupname 的值为 testgroup
  - username: testuser #定义变量 username 的值为 testuser
    tasks:
  - name: create group
    group: name={<!-- -->{groupname}} gid=111 #第一个任务使用 group 模块调用定义的 groupname 变量创建组
  - name: create user
    user: name={<!-- -->{username}} uid=10086 group={<!-- -->{groupname}} #第二个任务使用 user 模块调用定义的 username 变量创建用户指定 uid 和组</code></pre>
    <p>
    <img alt="" height="356" src="https://i-blog.csdnimg.cn/blog_migrate/8332ee48d1a823912bc0dac50742f900.png" width="1162"/>
    </p>
    <p>
    <img alt="" height="544" src="https://i-blog.csdnimg.cn/blog_migrate/46d71ef2aca73ba7afe0cda3699b3b79.png" width="1194"/>
    </p>
    <h3 id="7%E3%80%81when%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98%E5%AE%9E%E4%BE%8B3">
    7.when 模块部署：
    </h3>
    <p>
    用来进行条件判断的关键字，其作用只在你指定条件下会执行下面的任务，当条件为真时，任务就会被执行，否则任务将被跳过。
    </p>
    <pre><code class="language-bash">vim test3.yaml

---

- hosts: webservers
  remote_user: root
  tasks: - name: test when
  service: name=httpd state=stopped
  when: ansible_default_ipv4.address == "192.168.91.11" #当内置的变量 ipv4.address 等于 192.168.91.11 时调用 service 模块关闭 httpd 服务</code></pre>
  <p>
  <img alt="" height="294" src="https://i-blog.csdnimg.cn/blog_migrate/da56f2d7608c29c644cc59d3e101840e.png" width="951"/>
  </p>
  <p>
  <img alt="" height="550" src="https://i-blog.csdnimg.cn/blog_migrate/e59ea086b0a84fa213c542ccaae0b343.png" width="1200"/>
  </p>
  <p>
  主机查看：
  </p>
  <p>
  <img alt="" height="174" src="https://i-blog.csdnimg.cn/blog_migrate/f7951cca1575e8d38c39ac83acbe6d2f.png" width="1089"/>
  </p>
  <h3>
  8.with_items 循环模块部署(迭代)：
  </h3>
  <blockquote>
  <p>
  迭代——通常指持续地对 ansible playbook 进行修改、更改和改进的过程
  </p>
  </blockquote>
  <pre><code class="language-bash">vim test4.yaml

---

- name: test1
  hosts: webservers
  gather_facts: false
  tasks: - name: create directories
  file:
  path: "{<!-- -->{item}}"
  state: directory #路径调用变量 item，变量值为下面的 with_items 的内容，一次执行一个有几个值执行几次，state 为创建类型为目录
  with_items: - /tmp/test1 - /tmp/test2 - name: create file
  file:
  path: "{<!-- -->{item}}"
  state: touch #路径调用变量 item，变量值为下面的 with_items 的内容，一次执行一个有几个值执行几次，state 为创建类型为文件
  with_items: - /tmp/test1/a.txt - /tmp/test2/b.txt</code></pre>
  <p>
  <img alt="" height="569" src="https://i-blog.csdnimg.cn/blog_migrate/e069353c419bfb7ee572361c044e9407.png" width="965"/>
  </p>
  <p>
  <img alt="" height="549" src="https://i-blog.csdnimg.cn/blog_migrate/021e0496d96a370f8f2e6b2f10d3930b.png" width="1200"/>
  </p>
  <p>
  被管理端查看：
  </p>
  <p>
  <img alt="" height="161" src="https://i-blog.csdnimg.cn/blog_migrate/7efbf03bbc785d57ae4b7a1760913693.png" width="1067"/>
  </p>
  <p>
  <img alt="" height="176" src="https://i-blog.csdnimg.cn/blog_migrate/1aa7ed7b8bb92a58798fe29c6e8a1c3b.png" width="691"/>
  </p>
  <h3 id="9%E3%80%81template%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98%E5%AE%9E%E4%BE%8B5">
  9.template 模块部署：
  </h3>
  <p>
  一种可以创建配置文件的工具，在配置文件中，会有一些数据等回动态的改变，如 ip 地址、主机名、端口号、用户名、页面路径等需要使用变量来表示
  </p>
  <p>
  就是
  <strong>
  将变量和动态文件，结合起来
  </strong>
  ，最终会生成一个配置文件（你需要动态改变的），它的文件配置一定使用 jinjia2 模板语言来去编写，结尾后缀一定是 j2（xxx.j2）
  </p>
  <pre><code class="language-bash">1.先准备一个以 .j2 为后缀的 template 模板文件，设置引用的变量
  cp /etc/httpd/conf/httpd.conf /opt/httpd.conf.j2 #注意 ansible 本身要安装 httpd，其他 2 台被控制的不能安装 httpd
  vim /opt/httpd.conf.j2
  Listen {<!-- -->{http_port}} #42 行，修改
  ServerName {<!-- -->{server_name}} #95 行，修改
  DocumentRoot "{<!-- -->{root_dir}}" #119 行，修改 #修改 template 配置文件模块的端口和主机名、根目录为变量

2.修改主机清单文件，使用主机变量定义一个变量名相同，而值不同的变量
vim /etc/ansible/hosts
[webservers1]
192.168.91.11 http_port=192.168.91.11:8080 server_name=www.gg.com:8080
[webservers2]
192.168.91.20 http_port=192.168.91.20:8081 server_name=www.ggg.com:8081 3.主机添加 hosts
vim /etc/hosts
192.168.91.11 www.gg.com
192.168.91.20 www.ggg.com 4.编写 playbook 文件
vim httpd.yaml

---

- hosts: all
  remote_user: root
  gather_facts: false
  vars:
  - package: httpd
  - service: httpd
    tasks: - name: install httpd
    yum: name={<!-- -->{package}} state=latest - name: con test
    template: src=/opt/httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf #配置文件模板拷贝到 httpd 的子配置文件中
    notify: - restart httpd - name: start httpd
    service: name={<!-- -->{service}} state=started
    handlers: - name: restart httpd
    service: name={<!-- -->{service}} state=restarted 5.最后在 ansible 上 curl 访问 2 个域名验证</code></pre>
    <p>
    <img alt="" height="136" src="https://i-blog.csdnimg.cn/blog_migrate/c6589842308366f4a512bff43a890e65.png" width="975"/>
    </p>
    <p>
    <img alt="" height="131" src="https://i-blog.csdnimg.cn/blog_migrate/c06ad90529622e3f3243667a317cbd26.png" width="1009"/>
    </p>
    <p>
    <img alt="" height="226" src="https://i-blog.csdnimg.cn/blog_migrate/c62cd3e85416f9b1650cf85484642fdc.png" width="944"/>
    </p>
    <p>
    </p>
    <p>
    <img alt="" height="475" src="https://i-blog.csdnimg.cn/blog_migrate/315f9c66a8370090d8e5730701b0cb1a.png" width="1200"/>
    </p>
    <p>
    <img alt="" height="805" src="https://i-blog.csdnimg.cn/blog_migrate/83be6320c30920c06b402d2e139654d9.png" width="1200"/>
    </p>
    <p>
    <img alt="" height="650" src="https://i-blog.csdnimg.cn/blog_migrate/d89bdfcd6d0a32fbf4c44e94e38844b5.png" width="1200"/>
    </p>
    <p>
    网页端查看：
    </p>
    <p>
    <img alt="" height="764" src="https://i-blog.csdnimg.cn/blog_migrate/79194163cae416e5be6a636724fa6788.png" width="1200"/>
    </p>
    <p>
    <img alt="" height="764" src="https://i-blog.csdnimg.cn/blog_migrate/8590552fe285561bdc05d08af570c543.png" width="1200"/>
    </p>
    <h3 id="10%E3%80%81tags%E6%A8%A1%E5%9D%97%E5%AE%9E%E6%88%98%E5%AE%9E%E4%BE%8B6">
    10.tags 模块部署：
    </h3>
    <p>
    是一种标记任务或是一系列任务的功能，通过任务或一个命名的任务列表上自定义标记可以在运行 playbook 时去选择你需要执行的任务或者列表.
    </p>
    <pre><code class="language-bash">vim test6.yaml

---

- hosts: webservers
  remote_user: root
  gather_facts: false
  tasks: - name: copy hosts
  copy: src=/etc/hosts dest=/opt/hosts
  tags: - tags1 #自定义标签名，可以在执行 yaml 文件时使用 --tag="tags1"只执行此任务，always 标签任务除外 - name: touch file
  file: path=/opt/testhost state=touch
  tags: - always
  #always 标签，无论执行那个标签都会将此标签的任务内容执行</code></pre>
  <p>
  <img alt="" height="406" src="https://i-blog.csdnimg.cn/blog_migrate/0c0f26206a5ebe4e3b25c96990c1c29d.png" width="750"/>
  </p>
  <p>
  <img alt="" height="426" src="https://i-blog.csdnimg.cn/blog_migrate/6a355188135ebc079ec5c336438e3cdb.png" width="1200"/>
  </p>
  <p>
  被管理端查看：
  </p>
  <p>
  <img alt="" height="105" src="https://i-blog.csdnimg.cn/blog_migrate/9c77d95f5b43e0630176e25b59bb737a.png" width="469"/>
  </p>
  <h3>
  11.Roles 模块部署：
  </h3>
  <p>
  Ansible 为了层次化、结构化地组织 Playbook，使用了角色（roles），roles 可以根据层次型结构自动装载变量文件、task 以及 handlers 等。简单来讲，
  <strong>
  roles 就是通过分别将变量、文件、任务、模块及处理器放置于单独的目录中，并可以便捷地 include 它们
  </strong>
  。roles 一般用于基于主机构建服务的场景中，但也可以用于构建守护进程等场景中。
  </p>
  <p>
  <img alt="" height="459" src="https://i-blog.csdnimg.cn/blog_migrate/7467b2d5428e65e85f7f664bc6cedce1.png" width="819"/>
  </p>
  <p>
  //roles 内各目录含义解释
  </p>
  <p>
  ●files 用来存放由 copy 模块或 script 模块调用的文件。
  </p>
  <p>
  ●templates 用来存放 jinjia2 模板，template 模块会自动在此目录中寻找 jinjia2 模板文件。
  </p>
  <p>
  ●tasks 此目录应当包含一个 main.yml 文件，用于定义此角色的任务列表，此文件可以使用 include 包含其它的位于此目录的 task 文件。
  </p>
  <p>
  ●handlers 此目录应当包含一个 main.yml 文件，用于定义此角色中触发条件时执行的动作。
  </p>
  <p>
  ●vars 此目录应当包含一个 main.yml 文件，用于定义此角色用到的变量。
  </p>
  <p>
  ●defaults 此目录应当包含一个 main.yml 文件，用于为当前角色设定默认变量。
  </p>
  <p>
  ●meta 此目录应当包含一个 main.yml 文件，用于定义此角色的特殊设定及其依赖关系。
  </p>
  <h4>
  11.1.部署 lnmp：
  </h4>
  <pre><code class="language-bash">#创建文件夹和目录

mkdir /etc/ansible/roles/httpd/{files,templates,tasks,handlers,vars,defaults,meta} -p
mkdir /etc/ansible/roles/mysql/{files,templates,tasks,handlers,vars,defaults,meta} -p
mkdir /etc/ansible/roles/php/{files,templates,tasks,handlers,vars,defaults,meta} -p

touch /etc/ansible/roles/httpd/{defaults,vars,tasks,meta,handlers}/main.yml
touch /etc/ansible/roles/mysql/{defaults,vars,tasks,meta,handlers}/main.yml
touch /etc/ansible/roles/php/{defaults,vars,tasks,meta,handlers}/main.yml

------编写 httpd 模块------
写一个简单的 tasks/main.yml
vim /etc/ansible/roles/httpd/tasks/main.yml

- name: install apache
  yum: name={<!-- -->{pkg}} state=latest
- name: start apache
  service: enabled=true name={<!-- -->{svc}} state=started

//定义变量：可以定义在全局变量中，也可以定义在 roles 角色变量中，一般定义在角色变量中
vim /etc/ansible/roles/httpd/vars/main.yml
pkg: httpd
svc: httpd

-------编写 mysql 模块-------
vim /etc/ansible/roles/mysql/tasks/main.yml

- name: install mysql
  yum: name={<!-- -->{pkg}} state=latest
- :name: start mysql
  service: enabled=true name={<!-- -->{svc}} state=started

vim /etc/ansible/roles/mysql/vars/main.yml
pkg:

- mariadb
- mariadb-server
  svc: mariadb

-------编写 php 模块-----
vim /etc/ansible/roles/php/tasks/main.yml

- name: install php
  yum: name={<!-- -->{pkg}} state=latest
- name: start php-fpm
  service: enabled=true name={<!-- -->{svc}} state=started

vim /etc/ansible/roles/php/vars/main.yml
pkg:

- php
- php-fpm
  svc: php-fpm

-----编写 roles 示例-----

## vim /etc/ansible/site.yml

- hosts: webservers
  remote_user: root
  roles:
  - httpd
  - mysql
  - php

cd /etc/ansible
ansible-playbook site.yml

</code></pre>
<p>
<strong>
创建文件夹：
</strong>
</p>
<p>
<img alt="" height="209" src="https://i-blog.csdnimg.cn/blog_migrate/ea4c75b333c34b883979e870bf670f40.png" width="1200"/>
</p>
<p>
<img alt="" height="131" src="https://i-blog.csdnimg.cn/blog_migrate/27b682adca9c598830477074e8567a84.png" width="605"/>
</p>
<p>
<strong>
编写 httpd 模块：
</strong>
</p>
<p>
<img alt="" height="166" src="https://i-blog.csdnimg.cn/blog_migrate/3915ea084b3555c1de6915bf814d73d3.png" width="862"/>
</p>
<p>
<img alt="" height="137" src="https://i-blog.csdnimg.cn/blog_migrate/fb719e8630af87d67eaf55096023edbf.png" width="904"/>
</p>
<p>
<strong>
编写 mysql 模块：
</strong>
</p>
<p>
<img alt="" height="402" src="https://i-blog.csdnimg.cn/blog_migrate/ff4157f80ff96775caca130b8ccf9283.png" width="975"/>
</p>
<p>
<img alt="" height="159" src="https://i-blog.csdnimg.cn/blog_migrate/12899bccaaa466e6b8ca3ddf2044ad5e.png" width="922"/>
</p>
<p>
<strong>
编写 php 模块：
</strong>
</p>
<p>
<img alt="" height="402" src="https://i-blog.csdnimg.cn/blog_migrate/bf988a93393709ac54d7884ef0ab2927.png" width="975"/>
</p>
<p>
<img alt="" height="170" src="https://i-blog.csdnimg.cn/blog_migrate/7a2e5eebb4a75a67fe72389b79bb5f8d.png" width="985"/>
</p>
<p>
<strong>
编写 roles：
</strong>
</p>
<p>
<img alt="" height="246" src="https://i-blog.csdnimg.cn/blog_migrate/0474b8caa1a79662a57175883b39bc2d.png" width="815"/>
</p>
<p>
<strong>
在/etc/ansible 下执行剧本：
</strong>
</p>
<p>
<img alt="" height="726" src="https://i-blog.csdnimg.cn/blog_migrate/38a9cca3f47c593d07f3fc163895aef5.png" width="1200"/>
</p>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37353036373033302f:61727469636c652f64657461696c732f313338343932383831" class_="artid" style="display:none">
 </p>
</div>
