---
layout: post
title: 数学建模预测模型实例一-大学生体测数据模型
date: 2024-12-23 11:09:52 +0800
categories: [python数学建模]
tags: [机器学习,数据挖掘,数据分析,python]
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=110267691
    alt: 数学建模预测模型实例一-大学生体测数据模型
artid: 110267691
render_with_liquid: false
---
<p class="artid" style="display:none">$url</p>
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     数学建模预测模型实例（一）---大学生体测数据模型
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     数学建模预测模型实例–大学生体测数据模型
    </h3>
    <p>
     <a href="https://blog.csdn.net/weixin_46263718/article/details/110267691">
      数学建模预测模型实例（一）—大学生体测数据模型
     </a>
     <br/>
     <a href="https://blog.csdn.net/weixin_46263718/article/details/112006720">
      数学建模预测模型实例（二）—表白墙影响力量化模型
     </a>
     <br/>
     <a href="https://blog.csdn.net/weixin_46263718/article/details/110710412">
      python预测算法—线性回归
     </a>
    </p>
    <h4>
     <a id="_4">
     </a>
     建立模型的目的
    </h4>
    <p>
     本篇文章中，假设
     <strong>
      获取到了某大学两个年级共1000人的大学生体质健康测试的每项测试成绩及总分，测试项目包括：身高，体重，肺活量，50m，1000/800，引体向上/仰卧起坐，坐位体前屈
     </strong>
     。目的是通过前期数据挖掘探索性数据分析等建立
     <mark>
      大学生体测成绩预测模型
     </mark>
     ，进而在模型里添加天气（温度、湿度、风速）影响因子，
     <mark>
      模拟得出天气因素对于体测成绩的具体影响程度
     </mark>
     。
    </p>
    <p>
     <strong>
      数据分析基本过程包括：获取数据、数据清洗、构建模型、数据可视化以及天气影响下的体测成绩的变化趋势的分析。
     </strong>
    </p>
    <h4>
     <a id="_9">
     </a>
     数据准备
    </h4>
    <p>
     数据是存在Excel中的，可以使用pandas的Excel文件读取函数将数据读取到内存中
     <br/>
     获取数据：
     <a href="https://pan.baidu.com/s/12fSEGaexq44QHrv5Sx0M2w" rel="nofollow">
      预处理data无缺失值
     </a>
     提取密码：rkti
    </p>
    <h4>
     <a id="_12">
     </a>
     导入原始数据
    </h4>
    <pre><code class="prism language-java">#导入原始数据
<span class="token keyword">import</span> numpy as np
<span class="token keyword">import</span> pandas as pd
x_pre<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
excel_path <span class="token operator">=</span> r<span class="token string">'C:\Users\15643\Desktop\公众号\体测-大学之殇\预处理data无缺失值.xlsx'</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">read_excel</span><span class="token punctuation">(</span>excel_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
# 把年级信息换成年龄 <span class="token number">2018</span><span class="token operator">=</span><span class="token number">20</span> <span class="token number">2019</span><span class="token operator">=</span><span class="token number">19</span>
df<span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lambda x <span class="token operator">:</span><span class="token number">20</span> <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">2018</span> <span class="token keyword">else</span> <span class="token number">19</span><span class="token punctuation">)</span>
# 把性别信息换成 男<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span>女<span class="token operator">=</span><span class="token number">2</span> 
df<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">=</span>df<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lambda x<span class="token operator">:</span><span class="token number">1</span> <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">'男'</span> <span class="token keyword">else</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fdcee5552e74aba2c7904709be91870c.jpeg"/>
    </p>
    <h4>
     <a id="_27">
     </a>
     缺失值处理
    </h4>
    <p>
     由于此次原始数据是没有缺失值的，所以这里就大概介绍一种缺失值填补算法：
     <strong>
      使用KNN算法进行缺失值的填补
     </strong>
     。
    </p>
    <p>
     <strong>
      作为一种机器学习算法，KNN使用k个最近的观察值（根据某种距离度量的方法计算出来的）来预测缺失值。通俗来说就是根据其他特征找到与缺失值最相近的k个特征点，再进行平均求值
     </strong>
     。
    </p>
    <p>
     <mark>
      在像本案例这样的小数据集中KNN算法是非常有用的，因为计算量较小
     </mark>
     ；因此大数据集一般不建议采用KNN算法填补缺失值。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cc7f03e89227127878a56328622b8e1a.jpeg#pic_center"/>
    </p>
    <p>
     我们引入了一个带有一些缺失值的数据集，并且运用knn算法预测缺失值
    </p>
    <pre><code class="prism language-java">#数据表中的缺失值用KNN算法来预测<span class="token punctuation">,</span>男女分开进行预测
<span class="token keyword">import</span> numpy as np
from fancyimpute <span class="token keyword">import</span> KNN
#回归问题，往往预测的是某种属性的值。则统计这k个样本点的该属性值，并对其求平均值。然后将得到的平均值赋予为目标点的属性取值。
from sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
scaler <span class="token operator">=</span> <span class="token function">StandardScaler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>#z<span class="token operator">-</span>score 标准化 标准差标准化的方法使得把特征值映射到均值为<span class="token number">0</span>，标准差为<span class="token number">1</span>的正态分布
#male
std_df_male <span class="token operator">=</span> scaler<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
filled_knn_male <span class="token operator">=</span> <span class="token function">KNN</span><span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>std_df_male<span class="token punctuation">)</span>#利用knn填补缺失值
data_complete_male <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>filled_knn_male<span class="token punctuation">)</span>#保存结果 
#female
std_df_female <span class="token operator">=</span> scaler<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
filled_knn_female <span class="token operator">=</span> <span class="token function">KNN</span><span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>std_df_female<span class="token punctuation">)</span>#利用knn填补缺失值
data_complete_female <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>filled_knn_female<span class="token punctuation">)</span>#保存结果    
#concat将男女数据表连接成一个表
data_complete<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data_complete_female<span class="token punctuation">,</span>data_complete_male<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/817b653adde15b43a0cb27bfaf1b2805.jpeg#pic_center"/>
    </p>
    <h4>
     <a id="_57">
     </a>
     探索性数据分析–数据分布直方图
    </h4>
    <p>
     首先做出每一项特征的分布直方图
    </p>
    <pre><code class="prism language-java">from sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
scaler <span class="token operator">=</span> <span class="token function">StandardScaler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
std_df <span class="token operator">=</span> scaler<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
std_df <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>std_df<span class="token punctuation">)</span>
std_df<span class="token punctuation">.</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'年龄'</span><span class="token punctuation">,</span><span class="token string">'性别'</span><span class="token punctuation">,</span><span class="token string">'身高'</span><span class="token punctuation">,</span><span class="token string">'体重'</span><span class="token punctuation">,</span><span class="token string">'肺活量'</span><span class="token punctuation">,</span><span class="token string">'50m'</span><span class="token punctuation">,</span><span class="token string">'1000/800'</span><span class="token punctuation">,</span><span class="token string">'坐位体前屈'</span><span class="token punctuation">,</span><span class="token string">'立定跳远'</span><span class="token punctuation">,</span><span class="token string">'引仰'</span><span class="token punctuation">,</span><span class="token string">'总分'</span><span class="token punctuation">]</span>
std_df_male <span class="token operator">=</span> std_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>std_df<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">]</span>
std_df_female <span class="token operator">=</span> std_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>std_df<span class="token punctuation">[</span><span class="token string">'性别'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot as plt# 可视化
from pylab <span class="token keyword">import</span> mpl
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span> # 指定默认字体
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> False # 解决保存图像是负号<span class="token string">'-'</span>显示为方块的问题
<span class="token operator">%</span>pylab inline
def <span class="token function">draw</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">:</span>
    data<span class="token punctuation">.</span><span class="token function">hist</span><span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>grid<span class="token operator">=</span>False<span class="token punctuation">,</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span><span class="token function">savefig</span><span class="token punctuation">(</span>r<span class="token string">'C:\Users\15643\Desktop\公众号\体测-大学之殇\data.jpg'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">draw</span><span class="token punctuation">(</span>std_df<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b6007662b15f2ef4b696ebacdf0c2787.jpeg">
      <br/>
      从这里我们可以大致观察一下所获取到的数据是一个性别分布不均衡的数据集，这可能就会对我们之后分性别的体测数据模型的构建造成一定的影响。
     </img>
    </p>
    <p>
     除此之外，我们还可以发现，引体向上/仰卧起坐、坐位体前屈、肺活量、身高等的分布较为离散，我们可以进一步假设他们对于总分的影响因素可能较大。
    </p>
    <h4>
     <a id="_84">
     </a>
     探索性数据分析–相关性热力图的绘制
    </h4>
    <p>
     为了进一步证实我们在直方图中的发现，我们绘制了各特征之间皮尔逊系数的相关性热力图（代表两辆特征之间的相关程度）
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot as plt# 可视化
from pylab <span class="token keyword">import</span> mpl
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span> # 指定默认字体
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> False # 解决保存图像是负号<span class="token string">'-'</span>显示为方块的问题
<span class="token keyword">import</span> seaborn as sns
<span class="token operator">%</span>pylab inline
def <span class="token function">draw_heatmap</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">:</span>
    ylabels <span class="token operator">=</span> data<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">tolist</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    dfData <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">corr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>#相似度由皮尔逊相关系数度量
    #皮尔逊相关系数——Pearson correlation coefficient，用于度量两个变量之间的相关性，其值介于<span class="token operator">-</span><span class="token number">1</span>与<span class="token number">1</span>之间，值越大则说明相关性越强。
    <span class="token string">''</span>'
    <span class="token number">0.8</span><span class="token operator">-</span><span class="token number">1.0</span>     极强相关
    <span class="token number">0.6</span><span class="token operator">-</span><span class="token number">0.8</span>     强相关
    <span class="token number">0.4</span><span class="token operator">-</span><span class="token number">0.6</span>     中等程度相关
    <span class="token number">0.2</span><span class="token operator">-</span><span class="token number">0.4</span>     弱相关
    <span class="token number">0.0</span><span class="token operator">-</span><span class="token number">0.2</span>     极弱相关或无相关
    <span class="token string">''</span>'
    plt<span class="token punctuation">.</span><span class="token function">subplots</span><span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> # 设置画面大小
    sns<span class="token punctuation">.</span><span class="token function">heatmap</span><span class="token punctuation">(</span>dfData<span class="token punctuation">,</span> annot<span class="token operator">=</span>True<span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> square<span class="token operator">=</span>True<span class="token punctuation">,</span>yticklabels<span class="token operator">=</span>ylabels<span class="token punctuation">,</span>xticklabels<span class="token operator">=</span>ylabels<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">"RdBu"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">draw_heatmap</span><span class="token punctuation">(</span>std_df_male<span class="token punctuation">)</span>

</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/da4425813b9b8438046a179c0ee7a562.jpeg">
      <br/>
      上图为男生体测数据的相关性热力图，从中我们可以很轻易的发现，引体向上，1000m，50m这些普遍意义上比较令人痛苦的项目的确与体测能拿多少分挂钩；而我们基于直方图的观察则是过于片面了。
     </img>
    </p>
    <p>
     女生的情况也相差无几，以下可以看出这一点。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/48cab53c83d719cd2968affcf4c33e67.png"/>
    </p>
    <h4>
     <a id="_118">
     </a>
     构建大学生体测成绩预测模型
    </h4>
    <p>
     <strong>
      基于刚刚的探索性数据分析，我们决定以1000/800m、50m、立定跳远、引体向上/仰卧起坐这四个较强相关性的测试项目的成绩去预测体测总分的成绩。
     </strong>
    </p>
    <p>
     以上四项测试包含了弹跳力，爆发力，身体协调性，耐力，并且也有手部，腿部，腰腹背部力量的训练过程。可以说是基本囊括了所有的体育测试训练的方面。所以我们确信我们选择的这四项测试可以很好的代表体测。
    </p>
    <h5>
     <a id="_123">
     </a>
     模型的确定
    </h5>
    <p>
     由于我们的模型为预测模型，因此我们考虑机器学习中最简单的有监督学习算法–线性回归。而我们选取的用来拟合总分数据的特征有四个，所以我们就考虑一个非线性关系的建模。
    </p>
    <p>
     为了将这一个非线性模型转换为线性模型，我们就需要在模型中纳入多项式特征，以创建多项式回归模型。
    </p>
    <p>
     简单来说就是在阶数=k的情况下将每一个特征转换为一个k阶的多项式，这些多项式共同构成了一个矩阵，将这个矩阵看作一个特征，由此多项式回归模型就转变成了简单的线性回归。
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         x 
         
        
          − 
         
        
          &gt; 
         
        
          [ 
         
        
          1 
         
        
          , 
         
        
          x 
         
        
          , 
         
         
         
           x 
          
         
           2 
          
         
        
          , 
         
         
         
           x 
          
         
           3 
          
         
        
          . 
         
        
          . 
         
        
          . 
         
         
         
           x 
          
         
           k 
          
         
        
          ] 
         
        
       
         x-&gt;[1,x,x^2,x^3... x^k]
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;">
          </span>
          <span class="mord mathdefault">
           x
          </span>
          <span class="mord">
           −
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
          <span class="mrel">
           &gt;
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.14911em; vertical-align: -0.25em;">
          </span>
          <span class="mopen">
           [
          </span>
          <span class="mord">
           1
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.166667em;">
          </span>
          <span class="mord mathdefault">
           x
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.166667em;">
          </span>
          <span class="mord">
           <span class="mord mathdefault">
            x
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.864108em;">
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.166667em;">
          </span>
          <span class="mord">
           <span class="mord mathdefault">
            x
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.864108em;">
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  3
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mord">
           .
          </span>
          <span class="mord">
           .
          </span>
          <span class="mord">
           .
          </span>
          <span class="mord">
           <span class="mord mathdefault">
            x
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.899108em;">
               <span class="" style="top: -3.113em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathdefault mtight" style="margin-right: 0.03148em;">
                  k
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           ]
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <h5>
     <a id="_134">
     </a>
     确定多项式回归的阶数
    </h5>
    <pre><code class="prism language-java">#确定多项式回归的阶数
<span class="token keyword">import</span> numpy as np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot as plt
from sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures
from sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LinearRegression<span class="token punctuation">,</span>Perceptron
from sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error<span class="token punctuation">,</span>r2_score
from sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
target <span class="token operator">=</span> std_df_female<span class="token punctuation">[</span><span class="token string">'总分'</span><span class="token punctuation">]</span>
data_complete_ <span class="token operator">=</span> std_df_female<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'50m'</span><span class="token punctuation">,</span><span class="token string">'1000/800'</span><span class="token punctuation">,</span><span class="token string">'立定跳远'</span><span class="token punctuation">,</span><span class="token string">'引仰'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
x_train<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> <span class="token function">train_test_split</span><span class="token punctuation">(</span>data_complete_<span class="token punctuation">,</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
rmses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
degrees <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">arange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
min_rmse<span class="token punctuation">,</span> min_deg<span class="token punctuation">,</span>score <span class="token operator">=</span> <span class="token number">1e10</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span>
 
<span class="token keyword">for</span> deg in degrees<span class="token operator">:</span>
	# 生成多项式特征集<span class="token punctuation">(</span>如根据degree<span class="token operator">=</span><span class="token number">3</span> <span class="token punctuation">,</span>生成 <span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span>x<span class="token operator">*</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span>x<span class="token operator">*</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
	poly <span class="token operator">=</span> <span class="token function">PolynomialFeatures</span><span class="token punctuation">(</span>degree<span class="token operator">=</span>deg<span class="token punctuation">,</span> include_bias<span class="token operator">=</span>False<span class="token punctuation">)</span>
	x_train_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
 
	# 多项式拟合
	poly_reg <span class="token operator">=</span> <span class="token function">LinearRegression</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	poly_reg<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>x_train_poly<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
	#<span class="token function">print</span><span class="token punctuation">(</span>poly_reg<span class="token punctuation">.</span>coef_<span class="token punctuation">,</span>poly_reg<span class="token punctuation">.</span>intercept_<span class="token punctuation">)</span> #系数及常数
	
	# 测试集比较
	x_test_poly <span class="token operator">=</span> poly<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
	y_test_pred <span class="token operator">=</span> poly_reg<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>x_test_poly<span class="token punctuation">)</span>
	
	#<span class="token function">mean_squared_error</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span> #均方误差回归损失<span class="token punctuation">,</span>越小越好。
	poly_rmse <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">mean_squared_error</span><span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
	rmses<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>poly_rmse<span class="token punctuation">)</span>
	# r2 范围<span class="token punctuation">[</span><span class="token number">0</span>，<span class="token number">1</span><span class="token punctuation">]</span>，R2越接近<span class="token number">1</span>拟合越好。
	r2score <span class="token operator">=</span> <span class="token function">r2_score</span><span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_pred<span class="token punctuation">)</span>
	
	# degree交叉验证
	<span class="token keyword">if</span> min_rmse <span class="token operator">&gt;</span> poly_rmse<span class="token operator">:</span>
		min_rmse <span class="token operator">=</span> poly_rmse
		min_deg <span class="token operator">=</span> deg
		score <span class="token operator">=</span> r2score
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'degree = %s, RMSE = %.2f ,r2_score = %.2f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>deg<span class="token punctuation">,</span> poly_rmse<span class="token punctuation">,</span>r2score<span class="token punctuation">)</span><span class="token punctuation">)</span>
		
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span><span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span><span class="token function">add_subplot</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>degrees<span class="token punctuation">,</span> rmses<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token function">set_yscale</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token function">set_xlabel</span><span class="token punctuation">(</span><span class="token string">'Degree'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token function">set_ylabel</span><span class="token punctuation">(</span><span class="token string">'RMSE'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token function">set_title</span><span class="token punctuation">(</span><span class="token string">'Best degree = %s, RMSE = %.2f, r2_score = %.2f'</span> <span class="token operator">%</span><span class="token punctuation">(</span>min_deg<span class="token punctuation">,</span> min_rmse<span class="token punctuation">,</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span>  
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3b88aceb6e06947fc9fc5c0b2adfec5c.jpeg#pic_center">
      <br/>
      这里同样是以男生体测数据作为例子，我们可以得出二阶多项式回归模型是最佳的模型。
     </img>
    </p>
    <h5>
     <a id="_190">
     </a>
     构建二阶多项式回归模型
    </h5>
    <p>
     我们以二阶构建多项式回归模型
    </p>
    <pre><code class="prism language-java">#scikit<span class="token operator">-</span>learn 多项式拟合<span class="token punctuation">(</span>多元多项式回归<span class="token punctuation">)</span>
#PolynomialFeatures和linear_model的组合 <span class="token punctuation">(</span>线性拟合非线性<span class="token punctuation">)</span>
#<span class="token punctuation">[</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>x3<span class="token punctuation">]</span><span class="token operator">==</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>x1<span class="token punctuation">,</span>x1<span class="token operator">*</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>x2<span class="token punctuation">,</span>x2<span class="token operator">*</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>x3<span class="token punctuation">,</span>x3<span class="token operator">*</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
########
#male
########
<span class="token keyword">import</span> numpy as np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot as plt
from sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> PolynomialFeatures
from sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LinearRegression<span class="token punctuation">,</span>Perceptron
from sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> mean_squared_error<span class="token punctuation">,</span>r2_score
from sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
target <span class="token operator">=</span> std_df_female<span class="token punctuation">[</span><span class="token string">'总分'</span><span class="token punctuation">]</span>
data_complete_ <span class="token operator">=</span> std_df_female<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'1000/800'</span><span class="token punctuation">,</span><span class="token string">'50m'</span><span class="token punctuation">,</span><span class="token string">'立定跳远'</span><span class="token punctuation">,</span><span class="token string">'引仰'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
x_train<span class="token punctuation">,</span> x_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> <span class="token function">train_test_split</span><span class="token punctuation">(</span>data_complete_<span class="token punctuation">,</span>target<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>
# 多项式拟合
poly_reg  <span class="token operator">=</span><span class="token function">PolynomialFeatures</span><span class="token punctuation">(</span>degree<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
x_train_poly <span class="token operator">=</span> poly_reg<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>x_train<span class="token punctuation">)</span>
model <span class="token operator">=</span> <span class="token function">LinearRegression</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>x_train_poly<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
#<span class="token function">print</span><span class="token punctuation">(</span>poly_reg<span class="token punctuation">.</span>coef_<span class="token punctuation">,</span>poly_reg<span class="token punctuation">.</span>intercept_<span class="token punctuation">)</span> #系数及常数
# 测试集比较
x_test_poly <span class="token operator">=</span> poly_reg<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>x_test<span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>x_test_poly<span class="token punctuation">)</span>
#<span class="token function">mean_squared_error</span><span class="token punctuation">(</span>y_true<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span> #均方误差回归损失<span class="token punctuation">,</span>越小越好。
mse <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">mean_squared_error</span><span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
# r2 范围<span class="token punctuation">[</span><span class="token number">0</span>，<span class="token number">1</span><span class="token punctuation">]</span>，R2越接近<span class="token number">1</span>拟合越好。
r2 <span class="token operator">=</span> <span class="token function">r2_score</span><span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_test_pred<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span>
</code></pre>
    <p>
     以下为分别构建的男女体测成绩预测模型的解释率
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a13ffeee013cd0f0d96c374ac11c37ce.png#pic_center"/>
    </p>
    <h4>
     <a id="_227">
     </a>
     构建天气因素对于体测成绩的具体影响程度模型
    </h4>
    <p>
     在完成构建体测成绩预测模型之后，我们便着手于探索天气因素对于长跑成绩乃至于对于整个体测成绩的影响。
    </p>
    <h5>
     <a id="_229">
     </a>
     确定模型思路
    </h5>
    <p>
     由于我们有的数据集中不存在天气影响因素这一特征，也就是说这一次的模型构建是在没有数据的基础上进行的。因此首先我们进行了文献查阅。
    </p>
    <p>
     <strong>
      根据以下文献我们得知了人的冷热感取决于多种因素的共同影响，而气象学中的风冷指数以及不适指数可以很好的量化这些影响，因此我们选定了这两个气象学指标作为长跑时的影响因素。这两个指标是由
      <mark>
       风速，湿度，温度
      </mark>
      来进行表示的，也符合大众对于天气影响因素的认知。
     </strong>
    </p>
    <blockquote>
     <p>
      武雪莲.气象条件对马拉松成绩影响的研究[J].中国体育科技,2012,48(05):16-20.
     </p>
    </blockquote>
    <h5>
     <a id="_235">
     </a>
     建立数学模型
    </h5>
    <p>
     根据普适的观念我们姑且认为风冷指数和不适指数都是会给长跑带来一定不利影响的（风大跑不快，太冷跑不快），而大风天带来的影响是要多于温度带来的影响的，所以我们在这里设置权重，风冷指数的权重为0.7，不适指数的权重为0.3，而且由于两个指数带来的影响是两方面的，所以我们选择把这种影响进行加和，得到以下方程。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3ee8b6aefd109ea865756e65d4c3343c.png#pic_center"/>
     <br/>
     （Ko为风冷指数，Ic为不适指数，ta为温度，RH为湿度，v为风速，t为未受干扰的跑步时间）
    </p>
    <h5>
     <a id="_240">
     </a>
     拟合真实数据
    </h5>
    <p>
     在建立好数学模型之后，为模拟出真实情况下长跑成绩可能受到的影响，我们选择用采用蒙特卡洛模拟来连接真实数据与理论模型。
    </p>
    <p>
     <mark>
      蒙特卡洛模拟是一种输入一系列随机数反复评估确定性模型的方法。简单来说就是通过一系列随机试验得出结果。
     </mark>
    </p>
    <p>
     在此次案例中我们分别选取了一位平均水平的男生和女生，让他们在不同的天气下分别进行一千次随机测试，再进行数据统计。
    </p>
    <p>
     <strong>
      我们设定的随机试验的条件是风速介于0级到6级大风（6级大风就是我们生活中遇到的较强的风力了），湿度介于0到100%，温度是0到20度（模拟体测那段时间北京的温度）
     </strong>
    </p>
    <pre><code class="prism language-java">###蒙特卡洛模拟
###准备阶段
#####
#male
#####
<span class="token keyword">import</span> numpy as np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot as plt
<span class="token keyword">import</span> seaborn as sns
#找出一个均值男生
df_800 <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'1000/800'</span><span class="token punctuation">]</span>
df_800_mean <span class="token operator">=</span> df_800<span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df_50 <span class="token operator">=</span> std_df_male<span class="token punctuation">[</span><span class="token string">'50m'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df_tiaoyuan <span class="token operator">=</span> std_df_male<span class="token punctuation">[</span><span class="token string">'立定跳远'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df_yinyang <span class="token operator">=</span> std_df_male<span class="token punctuation">[</span><span class="token string">'引仰'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
df_1000_male <span class="token operator">=</span>  std_df_male<span class="token punctuation">[</span><span class="token string">'1000/800'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
#ta 空气温度 RH相对湿度 v风速
##ta<span class="token operator">:</span><span class="token number">0</span><span class="token operator">~</span><span class="token number">20</span> RH：<span class="token number">0</span><span class="token operator">~</span><span class="token number">1</span> 风速<span class="token number">0</span><span class="token operator">~</span><span class="token number">13.8</span>（<span class="token number">6</span>级大风）
ta_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
RH_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
v_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
y<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
#数学模型建立
def <span class="token function">generateequ</span><span class="token punctuation">(</span>ta<span class="token punctuation">,</span>RH<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token operator">:</span>
    ko <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token operator">*</span><span class="token number">50</span><span class="token operator">+</span><span class="token number">10.45</span><span class="token operator">-</span>v<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token operator">-</span>ta<span class="token punctuation">)</span>#风冷指数
    ic <span class="token operator">=</span> ta<span class="token operator">*</span><span class="token number">1.8</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">0.55</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>RH<span class="token operator">*</span><span class="token number">0.01</span><span class="token punctuation">)</span>#不适指数
    equ <span class="token operator">=</span> ko<span class="token operator">*</span><span class="token number">0.001</span><span class="token operator">*</span><span class="token number">0.7</span><span class="token operator">+</span>ic<span class="token operator">*</span><span class="token number">0.001</span><span class="token operator">*</span><span class="token number">0.3</span> #将两个指数同除以<span class="token number">1000</span>将其对于长跑的影响范围限定为<span class="token number">0</span><span class="token operator">-</span><span class="token number">20</span>秒
    <span class="token keyword">if</span> equ <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword">return</span> df_800_mean
    <span class="token keyword">else</span><span class="token operator">:</span>
        <span class="token keyword">return</span> equ <span class="token operator">+</span>  df_800_mean
#蒙特卡洛模拟开始，<span class="token number">1000</span>次随机模拟   
<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">:</span>
    ta<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">uniform</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span>
    RH<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">uniform</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    v<span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">uniform</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">13.8</span><span class="token punctuation">)</span>
    equs <span class="token operator">=</span> <span class="token function">generateequ</span><span class="token punctuation">(</span>ta<span class="token punctuation">,</span>RH<span class="token punctuation">,</span>v<span class="token punctuation">)</span>
    y<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>equs<span class="token punctuation">)</span>
    ta_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ta<span class="token punctuation">)</span>
    RH_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>RH<span class="token punctuation">)</span>
    v_list<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
y_ <span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
#将模拟后的长跑成绩进行标准化处理，方便之后模型拟合
from sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler
scaler <span class="token operator">=</span> <span class="token function">StandardScaler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
yd_df <span class="token operator">=</span> scaler<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>y_<span class="token punctuation">)</span>
yd_df_ <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>yd_df<span class="token punctuation">)</span>
#<span class="token number">1000</span>次蒙特卡洛模拟后的长跑成绩并入平均男生的数据中
df1 <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>yd_df_<span class="token punctuation">)</span><span class="token punctuation">)</span>
yd_df_<span class="token punctuation">[</span><span class="token string">'50m'</span><span class="token punctuation">]</span><span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>df1<span class="token punctuation">)</span>
yd_df_<span class="token punctuation">[</span><span class="token string">'50m'</span><span class="token punctuation">]</span> <span class="token operator">=</span>yd_df_<span class="token punctuation">[</span><span class="token string">'50m'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lambda x <span class="token operator">:</span>df_50 <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">)</span>
df2 <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>yd_df_<span class="token punctuation">)</span><span class="token punctuation">)</span>
yd_df_<span class="token punctuation">[</span><span class="token string">'立定跳远'</span><span class="token punctuation">]</span><span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>df2<span class="token punctuation">)</span>
yd_df_<span class="token punctuation">[</span><span class="token string">'立定跳远'</span><span class="token punctuation">]</span> <span class="token operator">=</span>yd_df_<span class="token punctuation">[</span><span class="token string">'立定跳远'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lambda x <span class="token operator">:</span>df_tiaoyuan <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">)</span>
df3 <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>yd_df_<span class="token punctuation">)</span><span class="token punctuation">)</span>
yd_df_<span class="token punctuation">[</span><span class="token string">'引仰'</span><span class="token punctuation">]</span><span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>df3<span class="token punctuation">)</span>
yd_df_<span class="token punctuation">[</span><span class="token string">'引仰'</span><span class="token punctuation">]</span> <span class="token operator">=</span>yd_df_<span class="token punctuation">[</span><span class="token string">'引仰'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>lambda x <span class="token operator">:</span>df_yinyang <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span><span class="token punctuation">)</span> 
</code></pre>
    <h5>
     <a id="_308">
     </a>
     可视化结果
    </h5>
    <p>
     在建立了完整的天气影响模型之后我们首先找到了男女生体测的最适天气因素（总成绩最高的）
    </p>
    <pre><code class="prism language-java">
#得到最适三个参数（对总成绩影响最小）
#ta 空气温度 RH相对湿度 v风速
x_poly <span class="token operator">=</span> poly_reg<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>yd_df_<span class="token punctuation">)</span>
y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>x_poly<span class="token punctuation">)</span>
par_best<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
y_best<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">if</span> y_pred<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>y_pred<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
        x_v_i<span class="token operator">=</span>v_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        x_RH_i<span class="token operator">=</span>RH_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        x_ta_i<span class="token operator">=</span>ta_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        par_best<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x_v_i<span class="token punctuation">,</span>x_RH_i<span class="token punctuation">,</span>x_ta_i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        y_best<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
par_best#得到最适三个参数（对<span class="token number">800</span>成绩影响最小）
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/51aed60eb155ebe9ae2a1088c66e395c.jpeg#pic_center"/>
     <br/>
     从这里我们看出最适天气因素是无风，凉爽的天气，这也符合我们的普适认知。
    </p>
    <p>
     随后我们统计了在0~3级微风，4-5级和风，5-6级劲风的天气条件下在这1000次随机试验中长跑平均多花的时间。通过调整蒙特卡洛模拟中温度、湿度，风速等随机取样的范围实现。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/be2acf89c602bc41f36a0a7e87481135.png#pic_center"/>
    </p>
    <p>
     <strong>
      结论：我们发现和大多数人想的一样，适宜跑步的天气是凉爽湿润且无风的好天气，在这种天气体测身心愉悦，可以发挥得更好。
     </strong>
    </p>
    <p>
     <strong>
      而相比较而言的大风天也是真的很夺命，大风给长跑带来的不仅仅是在跑步的我们的生理上的痛苦，还有成绩上的下滑！
     </strong>
    </p>
    <p>
     <strong>
      但是大家可以松一口气的是，基于我们的模型而言，大风对于长跑的影响是在6s以内的，所以大风并不能阻挡任何人奔向体测的及格线，只不过就是会比平常更加的难受罢了。
     </strong>
    </p>
    <p>
     <mark>
      喜欢这篇数学建模案例的话，欢迎关注我们和我们一起交流！
      <br/>
      奇趣多多，数模多多！
     </mark>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/46ee3b440d0a9fb3733dec7b0ea1ee75.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
</div>


