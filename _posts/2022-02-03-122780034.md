---
layout: post
title: "C连接MySQL数据库"
date: 2022-02-03 23:29:26 +0800
description: "本文详细介绍了如何使用C++通过MySQL Connector/C++连接和操作MySQL数据库，包"
keywords: "c++连接mysql数据库"
categories: ['环境编程', '数据库必知必会']
tags: ['Mysql', 'C']
artid: "122780034"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122780034
    alt: "C连接MySQL数据库"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C++连接MySQL数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        前言&amp;摘要
       </a>
      </li>
      <li>
       <a href="#ConnectorCMySQL_45" rel="nofollow">
        使用Connector/C++连接MySQL数据库
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#ConnectorC_and_JDBC_57" rel="nofollow">
          Connector/C++ and JDBC
         </a>
        </li>
        <li>
         <a href="#ConnectorC_and_X_DevAPI_72" rel="nofollow">
          Connector/C++ and X DevAPI
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#ODBCMySQL_118" rel="nofollow">
        使用ODBC连接MySQL数据库-略
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     前言&amp;摘要
    </h2>
    <p>
     使用C++连接MySQL数据库，根据
     <a href="https://dev.mysql.com/doc/connectors/en/" rel="nofollow">
      官方手册
     </a>
     ,可以使用
     <a href="https://dev.mysql.com/doc/connectors/en/connector-cpp.html" rel="nofollow">
      Connector/C++
     </a>
     或者
     <a href="https://dev.mysql.com/doc/connectors/en/connector-odbc.html" rel="nofollow">
      Connector/ODBC
     </a>
     。
    </p>
    <p>
     关于Connector/C++，本文使用示例代码演示如何使用。
     <br/>
     关于Connector/ODBC，暂未使用。
    </p>
    <p>
     关于数据库的安装和表的创建准备工作，参见：
     <a href="https://da1234cao.blog.csdn.net/article/details/105478479" rel="nofollow">
      mysql环境准备
     </a>
    </p>
    <p>
     使用API编程有三个阶段：了解API对应事物的概念，了解API的使用，了解API的实现原理。数据库这部分内容，我还有所欠缺，待提升。本文只涉及C++连接MySQL数据库API的使用。
    </p>
    <p>
     本文示例代码见
     <a href="https://github.com/da1234cao/progmming_exercise/tree/master/CPPmysql">
      仓库
     </a>
     。
    </p>
    <p>
     数据库内容，准备如下：
    </p>
    <pre><code class="prism language-sql"><span class="token comment">--  创建数据库</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> library<span class="token punctuation">;</span>     
<span class="token keyword">use</span> library<span class="token punctuation">;</span>
 
<span class="token comment">--  创建图书表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> books <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	title <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    author <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    price <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>
    quantity <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span><span class="token operator">=</span>UTF8<span class="token punctuation">;</span>
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
<span class="token comment">-- drop table books;</span>
<span class="token comment">-- truncate table books;</span>

<span class="token comment">-- 向表格中插入内容</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> books<span class="token punctuation">(</span>title<span class="token punctuation">,</span>author<span class="token punctuation">,</span>price<span class="token punctuation">,</span>quantity<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"Linux多线程服务器编程"</span><span class="token punctuation">,</span><span class="token string">"陈硕"</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> books<span class="token punctuation">(</span>title<span class="token punctuation">,</span>author<span class="token punctuation">,</span>price<span class="token punctuation">,</span>quantity<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"C++ primer 中文版"</span><span class="token punctuation">,</span><span class="token string">"Lippman"</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询表中内容</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> books<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h2>
     <a id="ConnectorCMySQL_45">
     </a>
     使用Connector/C++连接MySQL数据库
    </h2>
    <p>
     <a href="https://dev.mysql.com/doc/connectors/en/connector-cpp-introduction.html" rel="nofollow">
      Introduction to Connector/C++
     </a>
     ：MySQL Connector/C++ 8.0 是一个 MySQL 数据库连接器，用于连接到 MySQL 服务器的 C++ 应用程序。Connector/C++ 可用于访问实现文档存储的 MySQL 服务器，或以传统方式使用 SQL 语句。
     <mark>
      Connector/C++ 8.0 的首选开发环境是支持使用 X DevAPI 开发 C++ 应用程序，或使用 X DevAPI for C 开发普通 C 应用程序，但 Connector/C++ 8.0 还支持开发使用旧版基于 JDBC 的 API 的 C++ 应用程序。Connector/C++ 1.1
     </mark>
     。
    </p>
    <p>
     <a href="https://dev.mysql.com/doc/connectors/en/connector-cpp-installation-binary.html#connector-cpp-installation-binary-linux" rel="nofollow">
      Installing Connector/C++ from a Binary Distribution
     </a>
     ：使用包管理器进行安装。
    </p>
    <pre><code class="prism language-shell"> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libmysqlcppconn-dev
</code></pre>
    <p>
     另外，
     <a href="https://dev.mysql.com/doc/connectors/en/connector-cpp-apps-general-considerations.html" rel="nofollow">
      编译Connector/C++程序
     </a>
     需要指定动态库。
    </p>
    <h3>
     <a id="ConnectorC_and_JDBC_57">
     </a>
     Connector/C++ and JDBC
    </h3>
    <p>
     <a href="https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-introduction.html" rel="nofollow">
      Connector/C++ and JDBC Compatibility
     </a>
     ：Connector/C++ 与 JDBC 4.0 API 兼容。Connector/C++ 没有实现整个 JDBC 4.0 API，但具有以下类：Connection, DatabaseMetaData, Driver, PreparedStatement, ResultSet, ResultSetMetaData, Savepoint, Statement。JDBC 4.0 API 为刚才提到的类定义了大约 450 个方法。Connector/C++ 实现了其中的大约 80%。
    </p>
    <p>
     API文档：
     <a href="https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-getting-started-examples.html" rel="nofollow">
      doc
     </a>
     |
     <a href="https://github.com/mysql/mysql-connector-cpp/tree/33f2a7271a062dc5476984a712c4b2b9f53f05df">
      code
     </a>
    </p>
    <p>
     官方文档的演示过程并不是一个完整的应用示例。这里有一个使用Connector/C++的JDBC API，用单例模式连接MySQL数据库，
     <mark>
      图书管理系统demon
     </mark>
     ：
     <a href="https://blog.csdn.net/fuyuande/article/details/104160311">
      Linux MySQL Connector/C++ 编程实例
     </a>
    </p>
    <p>
     基本过程如下：
    </p>
    <ul>
     <li>
      <a href="https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-examples-connecting.html" rel="nofollow">
       与数据库建立连接
      </a>
      。
     </li>
     <li>
      <a href="https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-examples-query.html" rel="nofollow">
       执行查询语句
      </a>
     </li>
     <li>
      <a href="https://dev.mysql.com/doc/connector-cpp/1.1/en/connector-cpp-examples-results.html" rel="nofollow">
       获取结果
      </a>
     </li>
    </ul>
    <h3>
     <a id="ConnectorC_and_X_DevAPI_72">
     </a>
     Connector/C++ and X DevAPI
    </h3>
    <p>
     <a href="https://dev.mysql.com/doc/x-devapi-userguide/en/devapi-users-introduction.html" rel="nofollow">
      X DevAPI Overview
     </a>
     ：X DevAPI 由支持 X 协议的 MySQL Shell 和 MySQL 连接器实现。
    </p>
    <p>
     首先是确保服务器端的MySQL安装了
     <a href="https://dev.mysql.com/doc/refman/8.0/en/x-plugin.html" rel="nofollow">
      X Plugin
     </a>
     。
    </p>
    <pre><code class="prism language-shell"><span class="token comment"># 默认是安装的，我们检查下</span>
mysql -u user -p -e <span class="token string">"SHOW plugins"</span>

+----------------------------+----------+--------------------+---------+---------+
<span class="token operator">|</span> Name                       <span class="token operator">|</span> Status   <span class="token operator">|</span> Type               <span class="token operator">|</span> Library <span class="token operator">|</span> License <span class="token operator">|</span>
+----------------------------+----------+--------------------+---------+---------+
<span class="token punctuation">..</span>.
<span class="token operator">|</span> mysqlx                     <span class="token operator">|</span> ACTIVE   <span class="token operator">|</span> DAEMON             <span class="token operator">|</span> NULL    <span class="token operator">|</span> GPL     <span class="token operator">|</span>
</code></pre>
    <p>
     接着，确保远程应用程序可以与运行 X 插件的 MySQL 服务器实例
     <a href="https://dev.mysql.com/doc/x-devapi-userguide/en/database-connection-example.html" rel="nofollow">
      建立逻辑会话
     </a>
     ，将/etc/mysql/mysql.conf.d/mysqld.cnf中mysqlx-bind-address = 127.0.0.1注销掉。
    </p>
    <p>
     X DevAPI的文档，我目前仅阅读了：
     <a href="https://dev.mysql.com/doc/x-devapi-userguide/en/connecting-to-a-single-mysqld-node-setup.html" rel="nofollow">
      连接单个 MySQL 服务器
     </a>
     、
     <a href="https://dev.mysql.com/doc/x-devapi-userguide/en/devapi-users-working-with-relational-tables.html" rel="nofollow">
      使用关系表
     </a>
    </p>
    <pre><code class="prism language-c++">#include &lt;iostream&gt;
#include &lt;iomanip&gt;
#include &lt;list&gt;
#include &lt;mysql-cppconn-8/mysqlx/xdevapi.h&gt;

using namespace std;

// Scope controls life-time of objects such as session or schema

int main(void) {
    mysqlx::Session sess("192.168.122.34",33060,"dacao","111111");
    mysqlx::Schema db = sess.getSchema("library");
    mysqlx::Table tb = db.getTable("books");
    mysqlx::RowResult result = tb.select("*").execute();
    list&lt;mysqlx::Row&gt; rows = result.fetchAll();

    cout&lt;&lt;"id "&lt;&lt;"title "&lt;&lt;"author "&lt;&lt;"price "&lt;&lt;"quantity "&lt;&lt;endl;
    for(auto row : rows)
        cout&lt;&lt;row[0]&lt;&lt;" "&lt;&lt;row[1]&lt;&lt;" "&lt;&lt;row[2]&lt;&lt;" "&lt;&lt;row[3]&lt;&lt;" "&lt;&lt;row[4]&lt;&lt;endl;
}

</code></pre>
    <hr/>
    <h2>
     <a id="ODBCMySQL_118">
     </a>
     使用ODBC连接MySQL数据库-略
    </h2>
    <p>
     <a href="https://dev.mysql.com/doc/connectors/en/connector-odbc-introduction.html" rel="nofollow">
      Introduction to MySQL Connector/ODBC
     </a>
     |
     <a href="https://www.mysqlzh.com/doc/205/511.html" rel="nofollow">
      MyODBC介绍
     </a>
     ：ODBC（开放式数据库连接性）为客户端程序提供了访问众多数据库或数据源的一种方式。ODBC是标准化的API，允许与SQL数据库服务器进行连接。它是根据SQL Access Group的规范开发的，它定义了一套函数调用、错误代码和数据类型，可将其用于开发独立于数据库的应用程序。通常情况下，当需要数据库独立或需要同时访问不同的数据源时，将用到ODBC。
    </p>
    <p>
     这里有个windows环境下使用ODBC连接操作数据库的演示视频：
     <a href="https://www.bilibili.com/video/BV1uf4y1Y7Kf" rel="nofollow">
      C/C++使用ODBC连接操作数据库
     </a>
    </p>
    <p>
     配置有点麻烦，我还没使用过。
    </p>
    <pre><code class="prism language-shell"> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mysql-connector-odbc
 
 ➜  ~ dpkg -L mysql-connector-odbc:amd64 
/.
/usr
/usr/bin
/usr/bin/myodbc-installer
/usr/lib
/usr/lib/x86_64-linux-gnu
/usr/lib/x86_64-linux-gnu/odbc
/usr/lib/x86_64-linux-gnu/odbc/libmyodbc8a.so
/usr/lib/x86_64-linux-gnu/odbc/libmyodbc8w.so
/usr/share
/usr/share/doc
/usr/share/doc/mysql-connector-odbc
/usr/share/doc/mysql-connector-odbc/ChangeLog
/usr/share/doc/mysql-connector-odbc/INFO_BIN
/usr/share/doc/mysql-connector-odbc/INFO_SRC
/usr/share/doc/mysql-connector-odbc/LICENSE.txt.gz
/usr/share/doc/mysql-connector-odbc/README.txt
/usr/share/doc/mysql-connector-odbc/changelog.Debian.gz
/usr/share/doc/mysql-connector-odbc/copyright

➜  ~ odbcinst -j
unixODBC <span class="token number">2.3</span>.6
DRIVERS<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: /etc/odbcinst.ini
SYSTEM DATA SOURCES: /etc/odbc.ini
FILE DATA SOURCES<span class="token punctuation">..</span>: /etc/ODBCDataSources
<span class="token environment constant">USER</span> DATA SOURCES<span class="token punctuation">..</span>: /home/dacao/.odbc.ini
SQLULEN Size<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.: <span class="token number">8</span>
SQLLEN Size<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>: <span class="token number">8</span>
SQLSETPOSIROW Size.: <span class="token number">8</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f73696e61745f33383831363932342f:61727469636c652f64657461696c732f313232373830303334" class_="artid" style="display:none">
 </p>
</div>


