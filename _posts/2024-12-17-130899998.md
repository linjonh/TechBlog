---
layout: post
title: "Jetpack使用-Room-中的-Migration-升级数据库-修改-Entity-实体类-更改数据模型-创建-Migration-迁移类-修改数据库版本-代码示例-"
date: 2024-12-17 02:34:48 +0800
description: "文章介绍了AndroidRoom库中的Migration工具，详"
keywords: "room migration"
categories: ['Jetpack']
tags: ['数据库', 'Sqlite', 'Room', 'Migration', 'Android']
artid: "130899998"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=130899998
    alt: "Jetpack使用-Room-中的-Migration-升级数据库-修改-Entity-实体类-更改数据模型-创建-Migration-迁移类-修改数据库版本-代码示例-"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Jetpack】使用 Room 中的 Migration 升级数据库 ( 修改 Entity 实体类 - 更改数据模型 | 创建 Migration 迁移类 | 修改数据库版本 | 代码示例 )
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#RoomMigration__8" rel="nofollow">
        一、Room#Migration 迁移工具简介
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1Room__Migration__16" rel="nofollow">
          1、Room 中的迁移工具 Migration 简介
         </a>
        </li>
        <li>
         <a href="#2Migration__38" rel="nofollow">
          2、Migration 迁移工具使用步骤
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#RoomMigration__63" rel="nofollow">
        二、Room#Migration 迁移工具使用要点
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_Entity____73" rel="nofollow">
          1、修改 Entity 实体类 - 更改数据模型
         </a>
        </li>
        <li>
         <a href="#2_Migration__94" rel="nofollow">
          2、创建 Migration 迁移类
         </a>
        </li>
        <li>
         <a href="#3_138" rel="nofollow">
          3、修改数据库版本
         </a>
        </li>
        <li>
         <a href="#4_166" rel="nofollow">
          4、数据库更新的情况
         </a>
        </li>
        <li>
         <a href="#5_226" rel="nofollow">
          5、直接安装最新数据库的情况
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#RoomMigration__257" rel="nofollow">
        三、Room#Migration 迁移工具完整代码示例
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1Entity__269" rel="nofollow">
          1、Entity 实体类修改后的完整代码
         </a>
        </li>
        <li>
         <a href="#2Migration__371" rel="nofollow">
          2、Migration 迁移类创建以及数据库版本修改代码示例
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <br/>
    <br/>
    <br/>
    <br/>
    <h2>
     <a id="RoomMigration__8">
     </a>
     一、Room#Migration 迁移工具简介
    </h2>
    <hr/>
    <br/>
    <br/>
    <h3>
     <a id="1Room__Migration__16">
     </a>
     1、Room 中的迁移工具 Migration 简介
    </h3>
    <br/>
    <p>
     <font color="blue">
      使用 Room 访问数据库时 ,
      <font color="red">
       应用程序 的 数据模型 发生 改变 ,
       <font color="purple">
        数据库版本进行升级 ,
        <font color="orange">
         数据库表的字段 , 数据结构 ,
         <font color="brown">
          发生了变化 ,
          <font color="green">
           需要进行更新 ,
           <font color="black">
            可以使用
            <font color="magenta">
             Migration 迁移工具
            </font>
            升级数据库 ;
           </font>
          </font>
         </font>
        </font>
       </font>
      </font>
     </font>
    </p>
    <p>
     <font color="blue">
      迁移
     </font>
     是指
     <font color="red">
      将 数据库的结构
     </font>
     <font color="purple">
      从一个版本 更改为 另一个版本 ,
      <font color="orange">
       以适应新的数据模型 ;
      </font>
     </font>
    </p>
    <p>
     Room 提供了强大的
     <font color="green">
      迁移工具 Migration
     </font>
     , 使开发人员能够
     <font color="magenta">
      管理和执行 数据库迁移 操作 ;
     </font>
    </p>
    <p>
     使用 Room 操作数据库升级 ,
    </p>
    <ul>
     <li>
      从 数据库版本 1 升级为 数据库版本 2 , 只需要
      <font color="blue">
       执行 Migration(1, 2) 即可 ;
      </font>
     </li>
     <li>
      从 数据库版本 1 升级为 数据库版本 3 ,
      <font color="red">
       先执行 Migration(1, 2) ,
       <font color="purple">
        再执行 Migration(2, 3) ;
       </font>
      </font>
     </li>
    </ul>
    <br/>
    <p>
     <font color="blue">
      Room
     </font>
     提供了简便的方式来
     <font color="red">
      处理 Android 应用程序中的本地数据库，
     </font>
     并且
     <font color="purple">
      在数据模型发生变化时，
     </font>
     提供了强大的
     <font color="orange">
      迁移工具 Migration
     </font>
     ，使开发人员能够
     <font color="green">
      有效地管理数据库结构的更改。
     </font>
    </p>
    <br/>
    <h3>
     <a id="2Migration__38">
     </a>
     2、Migration 迁移工具使用步骤
    </h3>
    <br/>
    <p>
     <strong>
      在 Room 中使用 Migration 迁移工具 升级数据库步骤 :
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       更新数据模型 :
      </strong>
      如果要
      <font color="blue">
       更改数据库的结构 ,
      </font>
      <ul>
       <li>
        <font color="red">
         更新 Entity 实体类
        </font>
        , 修改实体类就是修改数据库表结构 ;
       </li>
       <li>
        <font color="purple">
         修改 Dao 数据库访问接口对象
        </font>
        , 包括添加 / 删除 / 修改 表 / 列 / 索引 ;
       </li>
      </ul>
     </li>
     <li>
      <strong>
       创建迁移类 :
      </strong>
      创建一个用于执行数据库迁移的
      <font color="blue">
       迁移类 Migration
      </font>
      , Migration 迁移类应
      <font color="red">
       实现 Room 的 Migration 接口 ,
      </font>
      并
      <font color="purple">
       定义数据库从旧版本迁移到新版本的操作 ;
      </font>
     </li>
     <li>
      <strong>
       指定迁移规则 :
      </strong>
      在 Room 数据库的构建器中 ,
      <font color="orange">
       使用 addMigrations 方法指定迁移规则
      </font>
      ,
      <font color="green">
       该方法接受一组 Migration 迁移对象 ,
       <font color="magenta">
        每个 Migration 迁移对象
        <font color="blue">
         代表一个数据库版本之间的迁移操作 ;
        </font>
       </font>
      </font>
     </li>
     <li>
      <strong>
       执行迁移 :
      </strong>
      <font color="red">
       当应用程序启动并访问数据库时，
       <font color="purple">
        Room 将自动检测数据库版本并执行适当的迁移操作 ,
        <font color="orange">
         应用程序可以无缝地将旧版本的数据库迁移到新版本，
         <font color="green">
          而不会丢失现有的数据。
         </font>
        </font>
       </font>
      </font>
     </li>
    </ul>
    <br/>
    <p>
     <strong>
      注意 :
     </strong>
     <font color="blue">
      执行迁移 有风险，
     </font>
     特别是在
     <font color="red">
      修改表结构
     </font>
     或
     <font color="purple">
      删除数据
     </font>
     时。
    </p>
    <p>
     <strong>
      在进行迁移之前，强烈建议先备份数据库，以防出现意外情况。
     </strong>
    </p>
    <br/>
    <br/>
    <br/>
    <br/>
    <h2>
     <a id="RoomMigration__63">
     </a>
     二、Room#Migration 迁移工具使用要点
    </h2>
    <hr/>
    <br/>
    <p>
     本章节中以新增一个数据库表字段为例 , 在
     <a href="https://blog.csdn.net/shulianghan/article/details/130816155">
      【Jetpack】Room + ViewModel + LiveData 综合使用 ( 核心要点说明 | 组合方式 | 代码示例 )
     </a>
     博客的代码示例基础上 , 为 student 数据库表 , 新增 性别 sex 字段 ;
    </p>
    <br/>
    <h3>
     <a id="1_Entity____73">
     </a>
     1、修改 Entity 实体类 - 更改数据模型
    </h3>
    <br/>
    <p>
     首先 , 要在 Entity 实体类中加入新的数据库字段 .
    </p>
    <pre><code class="prism language-kotlin">    <span class="token comment">/**
     * 性别字段
     * 数据库表中的列名为 sex
     * 数据库表中的类型为 INTEGER 文本类型
     */</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"sex"</span></span><span class="token punctuation">,</span> typeAffinity <span class="token operator">=</span> ColumnInfo<span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
    <span class="token keyword">var</span> sex<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
    <p>
     修改了该 Entity 实体类 , 就意味着 修改了 数据库中的数据库表 ;
    </p>
    <br/>
    <h3>
     <a id="2_Migration__94">
     </a>
     2、创建 Migration 迁移类
    </h3>
    <br/>
    <p>
     然后 , 在 RoomDatabase 中 , 定义 final 静态的 Migration 类 , 如果是 Kotlin 中 , 则定义在 伴生对象 companion object 中 ;
    </p>
    <p>
     这里使用 匿名内部类 的方式 定义 Migration 迁移类 ;
    </p>
    <pre><code class="prism language-kotlin">    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * 数据库版本 1 升级到 版本 2 的迁移类实例对象
         */</span>
        <span class="token keyword">val</span> MIGRATION_1_2<span class="token operator">:</span> Migration <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">Migration</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">migrate</span><span class="token punctuation">(</span>database<span class="token operator">:</span> SupportSQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"StudentDatabase"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"数据库版本 1 升级到 版本 2"</span></span><span class="token punctuation">)</span>
                database<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"alter table student add column sex integer not null default 1"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     上述 Migration 迁移类中 , 使用了 SQL 语句 :
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">add</span> <span class="token keyword">column</span> sex <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">1</span>
</code></pre>
    <p>
     该 SQL 语句的作用是 向 “student” 表中添加一个名为 “sex” 的整数类型列 , 该列不允许为空 , 并且默认值为 1 ; 可以使用类似的 ALTER TABLE 语句来修改表结构，添加、修改或删除列等操作 ;
    </p>
    <p>
     alter table student 表示对 student 数据库表 进行修改 ;
    </p>
    <p>
     add column sex integer 表示 要添加的新列名为 “sex” , 数据类型为 integer , 即整数类型 ;
    </p>
    <p>
     not null 表示该新列不允许为空值，即在插入或更新数据时，必须为该列提供非空值。
    </p>
    <p>
     default 1 表示新列的默认值为 1 ; 当插入新行时 , 如果没有显式提供 “sex” 列的值 , 将使用默认值 1 ;
    </p>
    <br/>
    <h3>
     <a id="3_138">
     </a>
     3、修改数据库版本
    </h3>
    <br/>
    <p>
     数据库的版本 在 RoomDatabase 的抽象实现类 中的 @Database 注解上修改 ,
    </p>
    <pre><code class="prism language-kotlin"><span class="token annotation builtin">@Database</span><span class="token punctuation">(</span>entities <span class="token operator">=</span> <span class="token punctuation">[</span>Student<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> exportSchema <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> StudentDatabase<span class="token operator">:</span> <span class="token function">RoomDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
</code></pre>
    <p>
     修饰 RoomDatabase 抽象类的 @Database 注解中的 version 参数 , 就是数据库的版本号 ;
    </p>
    <p>
     上面定义的 Migration(1, 2) 迁移类 , 就是从 @Database 注解 的 version = 1 版本 , 迁移到 version = 2 版本 ;
    </p>
    <pre><code class="prism language-kotlin">        <span class="token comment">/**
         * 数据库版本 1 升级到 版本 2 的迁移类实例对象
         */</span>
        <span class="token keyword">val</span> MIGRATION_1_2<span class="token operator">:</span> Migration <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">Migration</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
    <br/>
    <h3>
     <a id="4_166">
     </a>
     4、数据库更新的情况
    </h3>
    <br/>
    <p>
     如果之前运行了
     <a href="https://blog.csdn.net/shulianghan/article/details/130816155">
      【Jetpack】Room + ViewModel + LiveData 综合使用 ( 核心要点说明 | 组合方式 | 代码示例 )
     </a>
     博客的代码示例 ;
    </p>
    <p>
     然后再 修改 Entity 实体类 , 即更改数据模型 , 创建 Migration 迁移类 并 修改数据库版本 ,
    </p>
    <p>
     此时运行 , 手机应用中已经创建了 版本 1 的数据库 , 在该数据库的基础上 , 运行 带 Migration(1, 2) 的应用 ;
    </p>
    <p>
     如果检测到了 版本 1 数据库 , 就会在最开始 , 先更新数据库 , 然后再运行后续 Room 操作数据库代码 ;
    </p>
    <br/>
    <p>
     首次执行 版本 1 数据库代码 , 也就是
     <a href="https://blog.csdn.net/shulianghan/article/details/130816155">
      【Jetpack】Room + ViewModel + LiveData 综合使用 ( 核心要点说明 | 组合方式 | 代码示例 )
     </a>
     博客的代码 ;
    </p>
    <p>
     <strong>
      执行结果如下 :
     </strong>
    </p>
    <pre><code class="prism language-kotlin"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">56.981</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">57.416</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 插入数据 S1 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">57.425</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">57.920</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 插入数据 S2 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">57.922</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">58.422</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 更新数据 S2 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">58.424</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">58.930</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 删除数据 id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">58.931</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">59.432</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 主动查询 <span class="token operator">:</span> LiveData <span class="token operator">:</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span><span class="token label symbol">RoomTrackingLiveData@</span><span class="token number">8726677</span> <span class="token punctuation">,</span> 实际数据 <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">:</span><span class="token number">59.437</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 主动查询<span class="token number">2</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/652bd4849f977aa45e8046ca0648e0e9.png">
      <br/>
      此时 , 手机中已经运行了 数据库版本 1 的程序 , 手机中该应用的存储区域已经有一个数据库了 ;
     </img>
    </p>
    <p>
     修改 Entity 实体类 , 即更改数据模型 , 创建 Migration 迁移类 并 修改数据库版本 version = 2 , 不卸载原来的应用 , 直接再次运行新程序 ;
    </p>
    <pre><code class="prism language-kotlin"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">09.745</span> I<span class="token operator">/</span>Room_StudentDatabase<span class="token operator">:</span> 数据库版本 <span class="token number">1</span> 升级到 版本 <span class="token number">2</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">09.834</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">10.216</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 插入数据 S1 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">10.233</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">10.723</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 插入数据 S2 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">10.733</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">11.241</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 更新数据 S2 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">11.253</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">11.744</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 删除数据 id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">12.250</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 主动查询 <span class="token operator">:</span> LiveData <span class="token operator">:</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span><span class="token label symbol">RoomTrackingLiveData@</span>b23c326 <span class="token punctuation">,</span> 实际数据 <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">12.274</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 主动查询<span class="token number">2</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f7a98c245883435c8d78d49c19167c5d.png"/>
    </p>
    <br/>
    <h3>
     <a id="5_226">
     </a>
     5、直接安装最新数据库的情况
    </h3>
    <br/>
    <p>
     卸载原来的应用 , 直接安装 数据库版本 2 的新应用 ;
    </p>
    <p>
     数据库直接创建最新版本的数据库 , 不涉及 版本 1 的老数据库 ;
    </p>
    <pre><code class="prism language-kotlin"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">15.946</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">16.248</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 插入数据 S1 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">16.252</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">16.756</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 插入数据 S2 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">16.758</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jerry'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">17.258</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 更新数据 S2 <span class="token operator">:</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">17.260</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Tom'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">17.760</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 删除数据 id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">17.762</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> Observer#onChanged 回调<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>Student<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">18.261</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 主动查询 <span class="token operator">:</span> LiveData <span class="token operator">:</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span><span class="token label symbol">RoomTrackingLiveData@</span><span class="token number">8726677</span> <span class="token punctuation">,</span> 实际数据 <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">18.264</span> I<span class="token operator">/</span>Room_MainActivity<span class="token operator">:</span> 主动查询<span class="token number">2</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Student</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span>'Jack'<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0f8a3b9c194955015f898d4bfd8afccd.png"/>
    </p>
    <br/>
    <br/>
    <br/>
    <br/>
    <h2>
     <a id="RoomMigration__257">
     </a>
     三、Room#Migration 迁移工具完整代码示例
    </h2>
    <hr/>
    <br/>
    <p>
     本章节完整代码示例在
     <a href="https://blog.csdn.net/shulianghan/article/details/130816155">
      【Jetpack】Room + ViewModel + LiveData 综合使用 ( 核心要点说明 | 组合方式 | 代码示例 )
     </a>
     博客的代码示例基础上进行修改 ;
    </p>
    <p>
     <strong>
      代码地址 :
     </strong>
     <a href="https://github.com/han1202012/Room_ViewModel_LiveData">
      https://github.com/han1202012/Room_ViewModel_LiveData
     </a>
    </p>
    <br/>
    <h3>
     <a id="1Entity__269">
     </a>
     1、Entity 实体类修改后的完整代码
    </h3>
    <br/>
    <p>
     Entity 实体类中加入新的数据库字段 sex 字段 ;
    </p>
    <p>
     <strong>
      完整代码 :
     </strong>
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">package</span> kim<span class="token punctuation">.</span>hsl<span class="token punctuation">.</span>rvl

<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>ColumnInfo
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Entity
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Ignore
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>PrimaryKey

<span class="token comment">/**
 * 定义数据库表 Entity 实体 / 同时定义数据库表 和 对鹰的实体类
 * 设置该数据类对应数据库中的一张数据表, 表名为 student
 * 该数据库表中的数据对应一个 Student 类实例对象
 */</span>
<span class="token annotation builtin">@Entity</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"student"</span></span><span class="token punctuation">)</span>
<span class="token keyword">class</span> Student <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * @PrimaryKey 设置主键 autoGenerate 为自增
     * @ColumnInfo name 设置列名称 / typeAffinity 设置列类型
     */</span>
    <span class="token annotation builtin">@PrimaryKey</span><span class="token punctuation">(</span>autoGenerate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"id"</span></span><span class="token punctuation">,</span> typeAffinity <span class="token operator">=</span> ColumnInfo<span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
    <span class="token keyword">var</span> id<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment">/**
     * 姓名字段
     * 数据库表中的列名为 name
     * 数据库表中的类型为 TEXT 文本类型
     */</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"name"</span></span><span class="token punctuation">,</span> typeAffinity <span class="token operator">=</span> ColumnInfo<span class="token punctuation">.</span>TEXT<span class="token punctuation">)</span>
    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> name<span class="token operator">:</span> String

    <span class="token comment">/**
     * 年龄字段
     * 数据库表中的列名为 age
     * 数据库表中的类型为 INTEGER 文本类型
     */</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"age"</span></span><span class="token punctuation">,</span> typeAffinity <span class="token operator">=</span> ColumnInfo<span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
    <span class="token keyword">var</span> age<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment">/**
     * 性别字段
     * 数据库表中的列名为 sex
     * 数据库表中的类型为 INTEGER 文本类型
     */</span>
    <span class="token annotation builtin">@ColumnInfo</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"sex"</span></span><span class="token punctuation">,</span> typeAffinity <span class="token operator">=</span> ColumnInfo<span class="token punctuation">.</span>INTEGER<span class="token punctuation">)</span>
    <span class="token keyword">var</span> sex<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment">/**
     * 有些属性用于做业务逻辑
     * 不需要插入到数据库中
     * 使用 @Ignore 注解修饰该属性字段
     */</span>
    <span class="token annotation builtin">@Ignore</span>
    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> studentInfo<span class="token operator">:</span> String

    <span class="token comment">/**
     * 默认的构造方法给 Room 框架使用
     */</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">,</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 使用 @Ignore 标签标注后
     * Room 就不会使用该构造方法了
     * 这个构造方法是给开发者使用的
     */</span>
    <span class="token annotation builtin">@Ignore</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 使用 @Ignore 标签标注后
     * Room 就不会使用该构造方法了
     * 这个构造方法是给开发者使用的
     */</span>
    <span class="token annotation builtin">@Ignore</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string-literal singleline"><span class="token string">"Student(id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">, name='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">', age=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">age</span></span><span class="token string">)"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <br/>
    <h3>
     <a id="2Migration__371">
     </a>
     2、Migration 迁移类创建以及数据库版本修改代码示例
    </h3>
    <br/>
    <p>
     在 RoomDatabase 中 , 定义 final 静态的 Migration 类 , 如果是 Kotlin 中 , 则定义在 伴生对象 companion object 中 ;
    </p>
    <p>
     这里使用 匿名内部类 的方式 定义 Migration 迁移类 ;
    </p>
    <p>
     修饰 RoomDatabase 抽象类的 @Database 注解中的 version 参数 , 就是数据库的版本号 ;
    </p>
    <br/>
    <p>
     <strong>
      完整代码示例 :
     </strong>
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">package</span> kim<span class="token punctuation">.</span>hsl<span class="token punctuation">.</span>rvl

<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword">import</span> android<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Log
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Database
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>Room
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>RoomDatabase
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>room<span class="token punctuation">.</span>migration<span class="token punctuation">.</span>Migration
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span>db<span class="token punctuation">.</span>SupportSQLiteDatabase

<span class="token annotation builtin">@Database</span><span class="token punctuation">(</span>entities <span class="token operator">=</span> <span class="token punctuation">[</span>Student<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">,</span> version <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> exportSchema <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> StudentDatabase<span class="token operator">:</span> <span class="token function">RoomDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 获取 数据库访问 对象
     * 这是必须要实现的函数
     */</span>
    <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">studentDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> StudentDao

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">lateinit</span> <span class="token keyword">var</span> instance<span class="token operator">:</span> StudentDatabase

        <span class="token comment">/**
         * 数据库版本 1 升级到 版本 2 的迁移类实例对象
         */</span>
        <span class="token keyword">val</span> MIGRATION_1_2<span class="token operator">:</span> Migration <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">Migration</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">migrate</span><span class="token punctuation">(</span>database<span class="token operator">:</span> SupportSQLiteDatabase<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Room_StudentDatabase"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"数据库版本 1 升级到 版本 2"</span></span><span class="token punctuation">)</span>
                database<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"alter table student add column sex integer not null default 1"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">fun</span> <span class="token function">inst</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span><span class="token operator">:</span> StudentDatabase <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">::</span>instance<span class="token punctuation">.</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">synchronized</span><span class="token punctuation">(</span>StudentDatabase<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 创建数据库</span>
                    instance <span class="token operator">=</span> Room<span class="token punctuation">.</span><span class="token function">databaseBuilder</span><span class="token punctuation">(</span>
                        context<span class="token punctuation">.</span>applicationContext<span class="token punctuation">,</span>
                        StudentDatabase<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">,</span>
                        <span class="token string-literal singleline"><span class="token string">"student_database.db"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">addMigrations</span><span class="token punctuation">(</span>MIGRATION_1_2<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">allowMainThreadQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Room 原则上不允许在主线程操作数据库</span>
                                                  <span class="token comment">// 如果要在主线程操作数据库需要调用该函数</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f68616e313230323031322f:61727469636c652f64657461696c732f313330383939393938" class_="artid" style="display:none">
 </p>
</div>


