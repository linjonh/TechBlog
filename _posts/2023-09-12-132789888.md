---
layout: post
title: "推荐100个unity插件之8实现多人在线联机游戏Mirror插件的使用介绍附项目源码"
date: 2023-09-12 20:15:58 +0800
description: "本文详细介绍了使用Unity游戏引擎和Mirror插件实现多人在"
keywords: "unity mirror"
categories: ['Unity']
tags: ['游戏引擎', '游戏', 'Unity']
artid: "132789888"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=132789888
    alt: "推荐100个unity插件之8实现多人在线联机游戏Mirror插件的使用介绍附项目源码"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【推荐100个unity插件之8】实现多人在线联机游戏——Mirror插件的使用介绍（附项目源码）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     最终效果
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/083118dc0a133dbe02ec8271d61b67c4.gif"/>
    </p>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_0" rel="nofollow">
        最终效果
       </a>
      </li>
      <li>
       <a href="#_4" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#Mirror_12" rel="nofollow">
          导入Mirror插件
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_15" rel="nofollow">
        简单介绍
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#RPC_16" rel="nofollow">
          一、RPC调用
         </a>
        </li>
        <li>
         <a href="#_65" rel="nofollow">
          二、错误注意
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_74" rel="nofollow">
        基本使用
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_75" rel="nofollow">
          一、创建场景的网络管理器
         </a>
        </li>
        <li>
         <a href="#_85" rel="nofollow">
          二、创建一个玩家
         </a>
        </li>
        <li>
         <a href="#_111" rel="nofollow">
          三、添加玩家初始生成位置
         </a>
        </li>
        <li>
         <a href="#_125" rel="nofollow">
          四、玩家控制
         </a>
        </li>
        <li>
         <a href="#_170" rel="nofollow">
          五、同步摄像机
         </a>
        </li>
        <li>
         <a href="#_187" rel="nofollow">
          六、同步不同角色的名字和颜色修改
         </a>
        </li>
        <li>
         <a href="#_257" rel="nofollow">
          七、同步动画
         </a>
        </li>
        <li>
         <a href="#_291" rel="nofollow">
          八、同步子弹
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#_295" rel="nofollow">
            方法一
           </a>
          </li>
          <li>
           <a href="#_329" rel="nofollow">
            方法二
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_369" rel="nofollow">
          九、聊天功能
         </a>
        </li>
        <li>
         <a href="#_442" rel="nofollow">
          十、场景同步切换
         </a>
        </li>
        <li>
         <a href="#HUD_503" rel="nofollow">
          十一、重新绘制一个HUD界面
         </a>
        </li>
        <li>
         <a href="#_579" rel="nofollow">
          十二、查找服务器
         </a>
        </li>
        <li>
         <a href="#_593" rel="nofollow">
          十四、角色死亡复活
         </a>
        </li>
        <li>
         <a href="#network_manager_648" rel="nofollow">
          十三、自己编一个network manager
         </a>
        </li>
        <li>
         <a href="#AOI_731" rel="nofollow">
          AOI迷雾效果实现
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_743" rel="nofollow">
        开房间的功能
       </a>
      </li>
      <li>
       <a href="#_748" rel="nofollow">
        连接线上服务器（待续）
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#linux_749" rel="nofollow">
          linux服务器
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_778" rel="nofollow">
        后续
       </a>
      </li>
      <li>
       <a href="#_780" rel="nofollow">
        源码
       </a>
      </li>
      <li>
       <a href="#_784" rel="nofollow">
        完结
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_4">
     </a>
     前言
    </h2>
    <p>
     终于来了，之前很多人私信我，想看关于如何实现多人游戏的流程，这不就来了。
    </p>
    <p>
     关于Mirror插件其实我已经关注很久了，最近才有时间把它整理出来。
    </p>
    <p>
     Mirror是一个简单高效的开源的unity多人游戏网络框架，Mirror在Unity商店中是免费的
    </p>
    <p>
     官方API地址：https://mirror-networking.gitbook.io/docs
    </p>
    <h3>
     <a id="Mirror_12">
     </a>
     导入Mirror插件
    </h3>
    <p>
     https://assetstore.unity.com/packages/tools/network/mirror-129321
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/69063d26e9e8e4d178e0d401118fc52f.png"/>
    </p>
    <h2>
     <a id="_15">
     </a>
     简单介绍
    </h2>
    <h3>
     <a id="RPC_16">
     </a>
     一、RPC调用
    </h3>
    <p>
     有三个关键字如果被用于修饰函数，则该函数不会在本地调用，而是在远程调用。[Command]、[ClientRpc]、[TargetRpc]。
    </p>
    <ul>
     <li>
      Command在客户端调用，在服务端执行，并且方法名称以"Cmd"开头。
     </li>
     <li>
      ClientRpc在服务端调用，在所有与服务端连接的客户端执行，并且方法名称以"Rpc"开头。
     </li>
     <li>
      TargetRpc在服务端调用，在指定的与服务端连接的客户端执行，该方法至少有一个，NetworkConnection的形参，用来确定是在哪一个客户端执行，并且方法名称以"Target"开头。
     </li>
     <li>
      ServerCallback：只能由服务器调用，在服务器上执行。并且方法名称以"Server"开头。用法和TargetRpc类似
     </li>
    </ul>
    <p>
     使用
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Mirror</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyNetworkBehaviour</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">NetworkBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Command</span></span><span class="token punctuation">]</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CmdFire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 在服务器上调用</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ClientRpc</span></span><span class="token punctuation">]</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RpcGetHit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 在客户端上调用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     比如某个客户端角色得分加分
    </p>
    <pre><code class="prism language-csharp"><span class="token preprocessor property"># TargetRpc</span>
<span class="token class-name">NetworkIdentity</span> netIdentity <span class="token operator">=</span> GetComponent<span class="token operator">&lt;</span><span class="token function">NetworkIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">TargetShowMessage</span><span class="token punctuation">(</span>netIdentity<span class="token punctuation">.</span>connectionToClient<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TargetRpc</span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TargetShowMessage</span><span class="token punctuation">(</span><span class="token class-name">NetworkConnection</span> target<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> count<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    sumCount <span class="token operator">+=</span> count<span class="token punctuation">;</span><span class="token comment">//加分</span>
<span class="token punctuation">}</span>

<span class="token preprocessor property"># ServerCallback</span>
<span class="token punctuation">[</span>ServerCallback<span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ServerPlayerReady</span><span class="token punctuation">(</span><span class="token class-name">NetworkConnection</span> connection<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 将指定客户端标记为已准备状态的逻辑</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_65">
     </a>
     二、错误注意
    </h3>
    <ul>
     <li>
      <p>
       1.场景内所有挂在了你的代码的物体都会默认添加network identity，但network manager组件与network identity组件放在一个物体上会报错
      </p>
     </li>
     <li>
      <p>
       2.如果物体内有network manager组件但是没有Kcp transport组件，会报错。
      </p>
     </li>
     <li>
      <p>
       3.如果场景内有多个network manager组件，会报错。
      </p>
     </li>
     <li>
      <p>
       4.如果角色预制体托不进player prefab栏，可能是没有挂在network identity组件。
      </p>
     </li>
     <li>
      <p>
       5.角色代码必须有if (!isLocalPlayer) return;否则。。。后果自己知道。
      </p>
     </li>
    </ul>
    <h2>
     <a id="_74">
     </a>
     基本使用
    </h2>
    <h3>
     <a id="_75">
     </a>
     一、创建场景的网络管理器
    </h3>
    <p>
     网络管理器是多人游戏的核心控制组件。网络管理器是多人游戏的核心控制组件。
    </p>
    <p>
     在起始场景中创建一个空游戏对象，然后添加新创建的网络管理器组件（networkManager，Kcp Transport，networkManagerHUD组件）。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ae39f3f9b2e14b083c7bf54cc031f6de.png">
      <br/>
      kcp transport组件挂载在networkManager的transport上
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/48b20061d7e9697f1b29408777184e47.png">
       <br/>
       并配置Scene场景，offline和online是离线界面和游戏界面，比如说我们新建一个offline场景，在里面放一个network manager的network managerHUD，然后再新建一个online场景，把他们都注册到build setting（生成设置）里的build里的场景栏中（拖进去），offline在上。然后我们进入offline场景，运行，点击host，便会进入online（在线场景）。
      </img>
     </img>
    </p>
    <h3>
     <a id="_85">
     </a>
     二、创建一个玩家
    </h3>
    <p>
     创建一个玩家物体Player，为玩家添加networkIdentity作为在网络同步的唯一标识。一般游戏内
     <code>
      除了
     </code>
     包含network manager组件的物体都要挂在此组件，包括即将孵化的。这东西只有俩选项，一个勾选框Server Only，意思是只有服务端能操作，大家根据自己的需要勾选。第二个是visible，里面有三个选项：默认（Default）、强制隐藏（Force Hidden）、强制显示（ForceShown），个人感觉没啥用，大家默认就行。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3898ea186d90c295eb0c240596e97d17.png">
      <br/>
      只有挂载了networkIdentity，网络中枢才能识别到这个物件，并对之进行同步。接下来将Player作为一个
      <code>
       预制体
      </code>
      保存，并在场景中删除，后拖拽预制体到网络中枢（networkManager）的Player Prefab插槽中，以后它的产生就完全依靠网络中枢在连接到主机后自动生成。
     </img>
    </p>
    <p>
     自动创建播放器(Auto Create Player)：默认勾选，勾选的话当连接服务器时会自动生成上面的“玩家预制件”。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c0bc634c02b84944f769df0a0f2fcfb6.png"/>
    </p>
    <p>
     注：如果角色预制体托不进player prefab栏，可能是没有挂在network identity组件
    </p>
    <p>
     为玩家添加Network Transform，同步网络中联网游戏对象的位置、旋转和缩放，并勾选networkTransport的Client Authority属性。
    </p>
    <p>
     Mirror 目前提供2种Network Transform：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/237ad8f24667511b415c91e57895f6ee.png"/>
    </p>
    <pre><code class="prism language-csharp">Reliable：低带宽，与Rpcs<span class="token operator">/</span>Cmds<span class="token operator">/</span>等相同的延迟。

Unreliable：高带宽，极低延迟

使用Reliable，除非需要超低延迟。
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4e8b4aa16ccb00cfe94da7071c3f8747.png">
      <br/>
      注：后面我们会利用玩家body的Scale进行翻转，这里给body也加上Network Transform代码，记勾选Sync Scale.
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/731f601e6e8be8f54c94ede95252df26.png"/>
     </img>
    </p>
    <h3>
     <a id="_111">
     </a>
     三、添加玩家初始生成位置
    </h3>
    <p>
     创建几个空物体作为玩家的初始生成位置，添加Network Start Position脚本，并将该物体拖动到合适的位置。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e54060efccc8108472138d4075888416.png"/>
     <br/>
     并在NetworkManager中选择随机（Random）或者轮询（Round Robin）的出生点选择方式。
    </p>
    <pre><code class="prism language-csharp"><span class="token number">1</span><span class="token punctuation">.</span>Random：生成为随机（可能相同的生成位置将被两个或更多玩家使用）

<span class="token number">2</span><span class="token punctuation">.</span>Round Robin：循环（使用每个可用位置，直到客户端数超过生成点数）。
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ad4cc760986ea13b36e215f35222c38d.png"/>
     <br/>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f1539f5f1b303c4e4492275b0590ab07.png"/>
    </p>
    <h3>
     <a id="_125">
     </a>
     四、玩家控制
    </h3>
    <blockquote>
     <p>
      网络同步需要注意的一些事情：
     </p>
     <p>
      1.需要用到联网功能的脚本中都要添加using Mirror来使用相应API，并且继承NetworkBehaviour而不是MonoBehaviour。
     </p>
     <p>
      2.涉及到玩家输入时，首先先要进行isLocalPlayer的判断，通过islocalplayer来判断是否具有当前对象的权限
     </p>
    </blockquote>
    <p>
     为控制游戏对象，添加一个简单的人物控制脚本为PlayerControl.cs，继承NetworkBehaviour。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Mirror</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerControl</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">NetworkBehaviour</span></span> <span class="token comment">//MonoBehaviour --&gt; NetworkBehaviour</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Rigidbody2D</span> rb<span class="token punctuation">;</span> <span class="token comment">// 刚体组件</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        rb <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取刚体组件</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//速度：每秒移动5个单位长度</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> moveSpeed <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLocalPlayer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//不应操作非本地玩家</span>
        <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//通过键盘获取水平轴的值，范围在-1到1</span>
        <span class="token class-name"><span class="token keyword">float</span></span> horizontal <span class="token operator">=</span> Input<span class="token punctuation">.</span><span class="token function">GetAxisRaw</span><span class="token punctuation">(</span><span class="token string">"Horizontal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rb<span class="token punctuation">.</span>velocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span>horizontal <span class="token operator">*</span> moveSpeed<span class="token punctuation">,</span> rb<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置刚体速度</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>horizontal <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            transform<span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>localScale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span>horizontal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 翻转角色</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/723fc756f8936bf8a364a8fb20f60bf8.gif"/>
    </p>
    <h3>
     <a id="_170">
     </a>
     五、同步摄像机
    </h3>
    <p>
     对于在每个客户端独立生成的对象（这里以每位玩家的camera为例），需要将start方法修改为OnStartLocalPlayer()，这样可以避免多个客户端的摄像机被修改为同一台。
    </p>
    <p>
     OnStartLocalPlayer：仅在client执行,当脚本所在物体为玩家角色时调用，用来设置跟踪相机，角色初始化等
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStartLocalPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	rb <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取刚体组件</span>
	
    <span class="token comment">//摄像机与角色绑定</span>
    Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">SetParent</span><span class="token punctuation">(</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>localPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>   
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6b31a4501c5b2e37750d3a2df168de5e.gif"/>
    </p>
    <h3>
     <a id="_187">
     </a>
     六、同步不同角色的名字和颜色修改
    </h3>
    <p>
     同步变量需要添加同步变量的标记
     <code>
      [SyncVar(hook=nameof(FunctionExecOnClient))]
     </code>
     ，当同步变量发生变化时就会调用后面的FunctionExecOnClient方法
    </p>
    <p>
     当服务器的场景中的一个SyncVar的值发生变化时，就同步给其它所有客户端。
    </p>
    <p>
     对于同步变量的修改，使用
     <code>
      [Command]
     </code>
     标记(针对方法的标记，方法名以
     <code>
      Cmd
     </code>
     开头)
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">TMPro</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">TMP_Text</span> nameText<span class="token punctuation">;</span>

<span class="token comment">//需要把name和颜色同步给其他玩家，添加同步变量的标记[SyncVar(hook=nameof(FunctionExecOnClient))]</span>
<span class="token punctuation">[</span><span class="token function">SyncVar</span><span class="token punctuation">(</span>hook <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>OnPlayerNameChanged<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> playerName<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SyncVar</span><span class="token attribute-arguments"><span class="token punctuation">(</span>hook <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>OnPlayerColorChanged<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token class-name">Color</span> playerColor<span class="token punctuation">;</span>

<span class="token comment">//申明OnPlayerNameChanged和OnPlayerColorChanged这两个方法</span>
<span class="token comment">//第一个变量(oldstr)是同步变量修改前的值，第二个(newstr)是同步变量修改后的值</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPlayerNameChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> oldstr<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> newstr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    nameText<span class="token punctuation">.</span>text <span class="token operator">=</span> newstr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPlayerColorChanged</span><span class="token punctuation">(</span><span class="token class-name">Color</span> oldCor<span class="token punctuation">,</span> <span class="token class-name">Color</span> newCor<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    nameText<span class="token punctuation">.</span>color <span class="token operator">=</span> newCor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLocalPlayer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//不应操作非本地玩家</span>
   
   <span class="token function">Move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Space<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">{<!-- --></span>
       <span class="token comment">//随机生成颜色和名字</span>
       <span class="token function">ChangedColorAndName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStartLocalPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//。。。</span>

    <span class="token comment">//开始就随机生成颜色和名字</span>
    <span class="token function">ChangedColorAndName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//player 的随机名称和颜色</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChangedColorAndName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//随机名称和颜色</span>
    <span class="token class-name"><span class="token keyword">var</span></span> tempName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"Player</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> tempColor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span>Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//同步变量进行修改</span>
    <span class="token function">CmdSetupPlayer</span><span class="token punctuation">(</span>tempName<span class="token punctuation">,</span> tempColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//对于同步变量的修改，使用[Command]标记(针对方法的标记，方法名以Cmd开头)</span>
<span class="token comment">//通过这个方法同时对name和颜色进行修改</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Command</span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CmdSetupPlayer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name">Color</span> color<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    playerName <span class="token operator">=</span> name<span class="token punctuation">;</span>
    playerColor <span class="token operator">=</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/03d0dffb75a34f909784f82c5cad04a7.gif"/>
    </p>
    <h3>
     <a id="_257">
     </a>
     七、同步动画
    </h3>
    <p>
     挂载Network Animator组件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9177977731b3c931d4094a01fb1a573f.png"/>
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token class-name">Animator</span> anim<span class="token punctuation">;</span> <span class="token comment">// 动画组件</span>
anim <span class="token operator">=</span> gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取动画组件</span>

<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStartLocalPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   <span class="token comment">//。。。</span>
   
   anim <span class="token operator">=</span> gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponentInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取动画组件</span>
<span class="token punctuation">}</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLocalPlayer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//不应操作非本地玩家</span>

    <span class="token comment">//。。。</span>
    
    <span class="token comment">//攻击动画控制</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetMouseButtonDown</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        anim<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"isAttack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        anim<span class="token punctuation">.</span><span class="token function">SetBool</span><span class="token punctuation">(</span><span class="token string">"isIdle"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        anim<span class="token punctuation">.</span><span class="token function">SetBool</span><span class="token punctuation">(</span><span class="token string">"isIdle"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/113dfbd5b3f3298d6bcdce9412f44a60.gif"/>
    </p>
    <h3>
     <a id="_291">
     </a>
     八、同步子弹
    </h3>
    <p>
     bomb就是普通的炸弹预制体
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ba5b6f06eccdebdb0da54d6f5c262bf3.png"/>
    </p>
    <h4>
     <a id="_295">
     </a>
     方法一
    </h4>
    <p>
     [ClientRpc]关键字，服务端可以向所有的连接的客户端发送同步指令，方法名也需要Rpc开头
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token class-name">GameObject</span> bomb<span class="token punctuation">;</span><span class="token comment">//炸弹预制体</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLocalPlayer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//不应操作非本地玩家</span>

    <span class="token comment">//。。。</span>
    
    <span class="token comment">//生成炸弹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetMouseButtonDown</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">Cmdshoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Command</span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Cmdshoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">RpcWeaponFire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ClientRpc</span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RpcWeaponFire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">GameObject</span> b <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>bomb<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> Quaternion<span class="token punctuation">.</span>identity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//防止子弹撞到角色</span>
    b<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddForce</span><span class="token punctuation">(</span>Vector2<span class="token punctuation">.</span>up <span class="token operator">*</span> <span class="token number">500f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0ccf949bede8c795969e5fc6425d1e7f.gif"/>
    </p>
    <h4>
     <a id="_329">
     </a>
     方法二
    </h4>
    <p>
     <code>
      NetworkManager
     </code>
     最下面有个列表(Registered Spawnable Prefab)，他是用来放游戏中需要孵化的物体的，比如说enemy（敌人），bullet（子弹）啊，都给它拖进去
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d53ed0fd7ac3a24e1120de61da979c50.png"/>
     <br/>
     ps：记得给炸弹添加Network Identity组件，不然拖不进去
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token class-name">GameObject</span> bomb<span class="token punctuation">;</span><span class="token comment">//炸弹预制体</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLocalPlayer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//不应操作非本地玩家</span>

    <span class="token comment">//。。。</span>
    
    <span class="token comment">//生成炸弹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetMouseButtonDown</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">Cmdshoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Command</span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Cmdshoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">GameObject</span> b <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>bomb<span class="token punctuation">,</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span> Quaternion<span class="token punctuation">.</span>identity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    b<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//防止子弹撞到角色</span>
    b<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody2D<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddForce</span><span class="token punctuation">(</span>Vector2<span class="token punctuation">.</span>up <span class="token operator">*</span> <span class="token number">500f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Destroy</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//两秒后删除</span>
    NetworkServer<span class="token punctuation">.</span><span class="token function">Spawn</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//服务器孵化，同步客户端</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3cf5daf7e9082c39d48bb7904f7a7e84.gif"/>
     <br/>
     问题
    </p>
    <p>
     你会发现客户端给炸弹施加的AddForce力并没有效果，原因是我们没有添加同步刚体的组件，给炸弹添加Network Rigidbody 2D组件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/aefb9130d881f06c45b5895bedd57526.png"/>
    </p>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/930cef4d30b10ba894d1008d8f3b7f3d.gif"/>
    </p>
    <h3>
     <a id="_369">
     </a>
     九、聊天功能
    </h3>
    <p>
     新增ChatController脚本
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Mirror</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">TMPro</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">NetworkBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">TMP_InputField</span> chatText<span class="token punctuation">;</span><span class="token comment">//输入框</span>
    <span class="token keyword">public</span> <span class="token class-name">Button</span> chatBtn<span class="token punctuation">;</span><span class="token comment">//发送按钮</span>
    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> chatInfo<span class="token punctuation">;</span><span class="token comment">//聊天框内容预制体</span>
    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> chatFrame<span class="token punctuation">;</span><span class="token comment">//聊天框</span>
    <span class="token keyword">public</span> <span class="token class-name">PlayerController</span> playerController <span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SyncVar</span><span class="token attribute-arguments"><span class="token punctuation">(</span>hook <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>OnChatTextStringChanged<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> chatTextString<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnChatTextStringChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> oldstr<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> newstr<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//添加聊天内容</span>
        <span class="token class-name">GameObject</span> ci <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>chatInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ci<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TMP_Text<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text <span class="token operator">=</span> newstr<span class="token punctuation">;</span>
        ci<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">SetParent</span><span class="token punctuation">(</span>chatFrame<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        chatBtn<span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>SendBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SendBtn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>player <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            playerController<span class="token punctuation">.</span><span class="token function">CmdSendPLayerMessage</span><span class="token punctuation">(</span>chatText<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     修改PlayerController,调用传送人物名字
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">private</span> <span class="token class-name">ChatController</span> chatController<span class="token punctuation">;</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    chatController <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ChatController<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStartLocalPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//。。。</span>
	
    chatController<span class="token punctuation">.</span>playerController <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Command</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CmdSendPLayerMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>chatController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        chatController<span class="token punctuation">.</span>chatTextString <span class="token operator">=</span> playerName <span class="token operator">+</span> <span class="token string">"说:"</span> <span class="token operator">+</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     绘制UI页面，记得添加Network Identity组件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3365096e2db04f95090f896ee96498b3.png"/>
     <br/>
     记得给聊天的UI canvas挂载Network Identity脚本
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9365f38c3b5c6247852fcfd5c96f1a70.png"/>
    </p>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ad334cbd4b6b695a159a8c7f6b088105.gif"/>
    </p>
    <h3>
     <a id="_442">
     </a>
     十、场景同步切换
    </h3>
    <p>
     新建三个场景NetworkManager对象上
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e84698b95ded222da9405e266cdff172.png"/>
     <br/>
     新增ScenceController 代码，控制NetworkManagerHUD的显隐
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Mirror</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>SceneManagement</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScenceController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Scene</span> scene <span class="token operator">=</span> SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//控制NetworkManagerHUD的显隐</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"Main"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NetworkManagerHUD<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NetworkManagerHUD<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//开始游戏，场景切换</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ButtonLoadScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        SceneManager<span class="token punctuation">.</span><span class="token function">LoadScene</span><span class="token punctuation">(</span><span class="token string">"SampleScene1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     Main场景为游戏开始页面，默认就放一个按钮，按钮调用ButtonLoadScene方法，Network Manager只需要在初始场景挂载即可（及Main场景），前面代码已经控制了NetworkManagerHUD的显隐，报错HUD视图你不在主场景显示
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/21390fede2b9a0fe12404fd43b454d2b.png"/>
     <br/>
     挂载对应的场景
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/81ee0d36a75ebd58472a7422bf37ac74.png"/>
    </p>
    <p>
     SampleScene1和SampleScene2场景基本没啥区别，更前面的游戏页面一样，删除原本的NetworkManager对象，防止与主界面Main场景的冲突
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f87129a198b01f7816dcd1814aba3b30.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d89872db97ad085240c5912958d74cb5.png"/>
     <br/>
     新增ButtonChangeScene方法，控制游戏内的场景切换，方法挂载在SampleScene1和SampleScene2场景的场景切换按钮上
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">//同步切换场景</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ButtonChangeScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isServer<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> scene <span class="token operator">=</span> SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        NetworkManager<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span>ServerChangeScene
        <span class="token punctuation">(</span>
            scene<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"SampleScene1"</span> <span class="token punctuation">?</span> <span class="token string">"SampleScene2"</span> <span class="token punctuation">:</span> <span class="token string">"SampleScene1"</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"你不是host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a99e019003e3a267a4807bd0bc8ebe08.gif"/>
    </p>
    <h3>
     <a id="HUD_503">
     </a>
     十一、重新绘制一个HUD界面
    </h3>
    <p>
     NetworkManagerHUD（需要配合Network Manager组件），他会自动绘制一个GUI：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/59349511c704d28482a40cfbbdbe5112.png"/>
     <br/>
     Host(主机):相当于又是服务器又是客户端。
    </p>
    <p>
     Client：连接服务端，后面是服务端IP地址，localhost为本地端口，相当于自己连接自己。
    </p>
    <p>
     Server Only：只当服务端。
    </p>
    <p>
     但是，这个UI界面不太好看，所以我们一般不用这个组件，都会自己制作GUI。
    </p>
    <p>
     在场景中新增三个按钮
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a9639c06964ba52f515e2d73e21d2ea6.png"/>
    </p>
    <p>
     新增MyNetworkManagerHUD 代码，挂载在游戏页面，实例代码
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Mirror</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyNetworkManagerHUD</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">NetworkManager</span> networkManager<span class="token punctuation">;</span> <span class="token comment">// 创建 NetworkManager 对象</span>
    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> btn<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">GUISkin</span> mySkin<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">GameObject</span> startHost<span class="token punctuation">;</span><span class="token comment">//启动网络主机按钮</span>
    <span class="token keyword">private</span> <span class="token class-name">GameObject</span> startClient<span class="token punctuation">;</span><span class="token comment">//启动网络客户端按钮</span>
    <span class="token keyword">private</span> <span class="token class-name">GameObject</span> stopHost<span class="token punctuation">;</span><span class="token comment">//停止网络主机或客户端按钮</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        networkManager <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NetworkManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        startHost <span class="token operator">=</span> GameObject<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"StartHost"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        startClient <span class="token operator">=</span> GameObject<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"StartClient"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopHost <span class="token operator">=</span> GameObject<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"StopHost"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        startHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>OnStartHost<span class="token punctuation">)</span><span class="token punctuation">;</span>
        startClient<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>StartClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>StopHost<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// GetComponent&lt;NetworkManagerHUD&gt;().enabled = true;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>NetworkClient<span class="token punctuation">.</span>isConnected <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>NetworkServer<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token comment">// 检查客户端和服务器的连接状态</span>
        <span class="token punctuation">{<!-- --></span>
            startHost<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            startClient<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stopHost<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            startHost<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            startClient<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stopHost<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStartHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        networkManager<span class="token punctuation">.</span><span class="token function">StartHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动网络主机</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StartClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        networkManager<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 启动网络客户端</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StopHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        networkManager<span class="token punctuation">.</span><span class="token function">StopHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 停止网络主机或客户端</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     当然，原来的NetworkManagerHUD组件就没用了，可以删除了，记得同步删除前面控制NetworkManagerHUD显隐的代码
    </p>
    <p>
     运行效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1b10e0803e7489f44bddfa6151362017.gif"/>
    </p>
    <h3>
     <a id="_579">
     </a>
     十二、查找服务器
    </h3>
    <p>
     使用network discoveryHUD+network discovery组件替换原来的NetworkManagerHUD
    </p>
    <p>
     这个network discovery组件也需要配合network manager使用，他可以列出局域网内所有的服务器，其中有个transport栏，我们需要把与network manager组件在一起的Kcp transport组件拖进去，不然无法运行。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/43af7f00fc062e3864b3fc0d23ae3405.png"/>
    </p>
    <p>
     network discoveryHUD，与networkmanagerHUD差不多，唯独少了一个Client，多了一个find server
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/11a53c97277974d0fd8023f4451fc05c.png"/>
     <br/>
     作用是点击find server就会 把局域网内的所有比赛（服务器）列出来，但仅限局域网。
    </p>
    <p>
     运行效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/083118dc0a133dbe02ec8271d61b67c4.gif"/>
    </p>
    <h3>
     <a id="_593">
     </a>
     十四、角色死亡复活
    </h3>
    <pre><code class="prism language-csharp"><span class="token comment">// 角色是否死亡的标志</span>
<span class="token punctuation">[</span><span class="token function">SyncVar</span><span class="token punctuation">(</span>hook <span class="token operator">=</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>OnIsDeadChanged<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> isDead <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

 <span class="token comment">// 当角色死亡状态改变时的回调方法</span>
 <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnIsDeadChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> oldValue<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> newValue<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">// 执行死亡逻辑，例如播放死亡动画、禁用角色控制等</span>
         Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"Player has died."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">Destroy</span><span class="token punctuation">(</span>gameObject<span class="token punctuation">,</span> <span class="token number">2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 延迟2秒后销毁角色对象</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	     <span class="token function">CmdDestroyPlayerServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	     
	     <span class="token comment">// 创建一个新的Camera对象</span>
	     <span class="token class-name">GameObject</span> cameraObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GameObject</span><span class="token punctuation">(</span><span class="token string">"Main Camera"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	     <span class="token comment">// 添加Camera组件到对象上</span>
	     <span class="token class-name">Camera</span> cameraComponent <span class="token operator">=</span> cameraObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Camera<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	     <span class="token comment">// 设置摄像机的位置和旋转</span>
	     cameraComponent<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	     cameraComponent<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation <span class="token operator">=</span> Quaternion<span class="token punctuation">.</span>identity<span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Command</span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CmdDestroyPlayerServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    isDead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其他地方书写复活方法（重新生成角色）
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>R<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
           <span class="token comment">//让当前客户端复活角色</span>
		    NetworkClient<span class="token punctuation">.</span><span class="token function">AddPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4235b29cb3e15308ccb6340e3a3bc0c9.gif"/>
    </p>
    <h3>
     <a id="network_manager_648">
     </a>
     十三、自己编一个network manager
    </h3>
    <p>
     这里简单实现一个创建角色的功能
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Mirror</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyNetworkManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">NetworkManager</span></span><span class="token comment">//继承network manager类</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">InputField</span> myname<span class="token punctuation">;</span> <span class="token comment">// 输入玩家名称的InputField</span>

    <span class="token comment">// 在服务器启动时调用</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStartServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"启动服务器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 启动服务器</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnStartServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 注册CreateMMOCharacterMessage消息的处理方法</span>
        NetworkServer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CreateMMOCharacterMessage<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>OnCreateCharacter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStopServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"关闭服务器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关闭服务器</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnStopServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnServerConnect</span><span class="token punctuation">(</span><span class="token class-name">NetworkConnectionToClient</span> conn<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"处理连接事件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理连接事件</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnServerConnect</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnServerDisconnect</span><span class="token punctuation">(</span><span class="token class-name">NetworkConnectionToClient</span> conn<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"处理断开事件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理断开事件</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnServerDisconnect</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// CreateMMOCharacterMessage消息结构体</span>
    <span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token class-name">CreateMMOCharacterMessage</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">NetworkMessage</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> playername<span class="token punctuation">;</span> <span class="token comment">// 玩家名称</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 在客户端连接到服务器时调用</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClientConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnClientConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 在这里发送消息，或者您想要的任何其他地方</span>
        <span class="token class-name">CreateMMOCharacterMessage</span> characterMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CreateMMOCharacterMessage</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// playername = myname.text // 设置玩家名称为InputField中的文本</span>
            playername <span class="token operator">=</span> <span class="token string">"测试"</span> <span class="token comment">// 设置玩家名称为InputField中的文本</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        NetworkClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>characterMessage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送消息给服务器</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建角色的方法，在收到CreateMMOCharacterMessage消息时调用</span>
    <span class="token comment">// 参数conn：与服务器的连接；参数message：接收到的消息</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCreateCharacter</span><span class="token punctuation">(</span><span class="token class-name">NetworkConnectionToClient</span> conn<span class="token punctuation">,</span> <span class="token class-name">CreateMMOCharacterMessage</span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//PlayerPrefab是在Network Manager的Inspector中指定的，</span>
        <span class="token comment">//但您可以在每个比赛中使用不同的预制体，例如：</span>
        <span class="token class-name">GameObject</span> gameobject <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>playerPrefab<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例化玩家预制体</span>

        <span class="token comment">//根据游戏的需要，应用消息中的数据</span>
        <span class="token class-name">Player</span> player <span class="token operator">=</span> gameobject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Player<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        player<span class="token punctuation">.</span>playerName <span class="token operator">=</span> message<span class="token punctuation">.</span>playername<span class="token punctuation">;</span> <span class="token comment">// 将玩家名称赋值给Playercode组件中的playername变量</span>

        <span class="token comment">//将此游戏对象添加为连接上的玩家的控制对象</span>
        NetworkServer<span class="token punctuation">.</span><span class="token function">AddPlayerForConnection</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> gameobject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     去除原来的NetworkManager，挂载自己写的代码，去除自动的创建角色的勾选，不然开始会创建两个主角
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d03c03860ac866556f9eadde0e75bcef.png"/>
     <br/>
     运行效果，正常
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f1675e5cf65a1220eecf4da296e4b991.png"/>
    </p>
    <h3>
     <a id="AOI_731">
     </a>
     AOI迷雾效果实现
    </h3>
    <p>
     将Spatial Hashing Interest Management组件与您的网络管理器相同的对象中
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/42e642555bdce3db76709d9fe94ca97b.png"/>
    </p>
    <blockquote>
     <p>
      参数：
      <br/>
      可见距离
      <br/>
      多久显示出来
      <br/>
      3d 2d切换
      <br/>
      调试滑块
     </p>
    </blockquote>
    <p>
     走近才显示物品
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0a87f108bc33ef34793ff98e06113824.png"/>
    </p>
    <h2>
     <a id="_743">
     </a>
     开房间的功能
    </h2>
    <p>
     官方其实已经有个demo，在Mirror/Examples/MultipleMatches/Scenes/Main，我们可以先看看效果，
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/785f4f7a01e15dcd6d0cd04b2275b6ea.gif"/>
    </p>
    <h2>
     <a id="_748">
     </a>
     连接线上服务器（待续）
    </h2>
    <h3>
     <a id="linux_749">
     </a>
     linux服务器
    </h3>
    <p>
     修改线上服务器ip和端口号
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/37cde2c72067cc9cdcb25d2342727ee2.png"/>
    </p>
    <p>
     对应端口记得去服务器加安全组白名单
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cd4580921513f3831d4fc254c2a76d68.png"/>
    </p>
    <p>
     去除HUD脚本组件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/785bdc740d99c7039cd9d1924aefd1df.png"/>
     <br/>
     书写代码，控制是服务器还是客户端
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4958e4c5e331459afd743b79d322d966.png"/>
     <br/>
     先打包一个服务器，所以先勾选是服务器
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8994781ca3fbf11c4f4a14867a051096.png"/>
    </p>
    <p>
     然后打包一个Linux服务器端程序
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dffdc966fd4f3de6e36d798920b17dfe.png"/>
     <br/>
     ps：没有的记得先去安装unity模块
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7cac33425c85373122b058201c4ee93e.png"/>
     <br/>
     把服务器端程序全部上传到服务器上
     <br/>
     先把可执行文件添加权限
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b11c0de899e1629321545a7c436be5a8.png"/>
     <br/>
     运行可执行程序
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/09f3c4b4c4cdcdc1cf992a238d2e9e91.png"/>
    </p>
    <p>
     然后就可正常打包客户端，连接服务器游玩了
     <br/>
     打包记得去除AppIsServer的勾选和修改Target Platfom为windows
    </p>
    <p>
     连接成功
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9730449351874380f82d320bffe26e73.png"/>
    </p>
    <h2>
     <a id="_778">
     </a>
     后续
    </h2>
    <p>
     Mirror的研究就暂且研究到这里，个人开发者可能没那么多金额购买好的服务器，本地局域网联机成为一种不错选择，后续我再补充这方面的知识，可以关注期待一下
    </p>
    <h2>
     <a id="_780">
     </a>
     源码
    </h2>
    <blockquote>
     <p>
      很遗憾源码我并不想
      <code>
       免费
      </code>
      分享，我也建议大家能
      <code>
       自己手动去敲代码
      </code>
      ，逐步实现和理解每一块功能。项目实现所涉及的主要功能思路和代码我也已经
      <code>
       毫无保留
      </code>
      的分享在文章中了，当然，如果你真的需要的话，源码我也放出来了，收个辛苦费，就当作你对我不断创作的支持。力量随微，心暖人。您的每一次支持都是我创作的最大动力！！！
     </p>
    </blockquote>
    <p>
     https://gf.bilibili.com/item/detail/1107096120
    </p>
    <h2>
     <a id="_784">
     </a>
     完结
    </h2>
    <p>
     赠人玫瑰，手有余香！如果文章内容对你有所帮助，请不要吝啬你的
     <code>
      点赞评论和关注
     </code>
     ，以便我第一时间收到反馈，你的每一次
     <code>
      支持
     </code>
     都是我不断创作的最大动力。当然如果你发现了文章中
     <code>
      存在错误
     </code>
     或者有
     <code>
      更好的解决方法
     </code>
     ，也欢迎评论私信告诉我哦！
    </p>
    <p>
     好了，我是
     <code>
      向宇
     </code>
     ，
     <a href="https://xiangyu.blog.csdn.net" rel="nofollow">
      https://xiangyu.blog.csdn.net
     </a>
    </p>
    <p>
     一位在小公司默默奋斗的开发者，出于兴趣爱好，最近开始自学unity，闲暇之余，边学习边记录分享，站在巨人的肩膀上，通过学习前辈们的经验总是会给我很多帮助和启发！php是工作，unity是生活！如果你遇到任何问题，也欢迎你评论私信找我， 虽然有些问题我也不一定会，但是我会查阅各方资料，争取给出最好的建议，希望可以帮助更多想学编程的人，共勉~
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8822d9e233799b5466cef6acf734aa90.gif#pic_center"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363330333835332f:61727469636c652f64657461696c732f313332373839383838" class_="artid" style="display:none">
 </p>
</div>


