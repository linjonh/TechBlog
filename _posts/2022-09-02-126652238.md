---
layout: post
title: "教程应用侧连接华为云IoT平台"
date: 2022-09-02 02:45:21 +0800
description: "这一篇教程是应用侧与华为云IoT平台的连接的教程，包含了数据流转、命令下发等内容。_华为云iot的应"
keywords: "华为云iot的应用侧开发接口"
categories: ['未分类']
tags: ['设备接入', '数据转发', '命令下发', '华为云Iot平台', 'Nodejs']
artid: "126652238"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=126652238
  alt: "教程应用侧连接华为云IoT平台"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【教程】应用侧连接华为云IoT平台
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <a href="#1_1" rel="nofollow">
          1、写在前面
         </a>
        </li>
        <li>
         <a href="#2IoT_6" rel="nofollow">
          2、关于设备侧与华为云IoT平台的连接
         </a>
        </li>
        <li>
         <a href="#3IoT_14" rel="nofollow">
          3、进入华为云IoT平台
         </a>
        </li>
        <li>
         <a href="#4_18" rel="nofollow">
          4、接收属性上报，实现数据转发至服务器
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#41_19" rel="nofollow">
            4.1、数据转发的总体实现思路
           </a>
          </li>
          <li>
           <a href="#42_36" rel="nofollow">
            4.2、创建规则触发条件
           </a>
          </li>
          <li>
           <a href="#43URL_57" rel="nofollow">
            4.3、创建规则动作和指定URL
           </a>
          </li>
          <li>
           <a href="#44_66" rel="nofollow">
            4.4、应用侧路由配置后端代码
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#5_152" rel="nofollow">
          5、命令下发
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#51_158" rel="nofollow">
            5.1、创建命令
           </a>
          </li>
          <li>
           <a href="#52_176" rel="nofollow">
            5.2、复制代码示例
           </a>
          </li>
          <li>
           <a href="#53_185" rel="nofollow">
            5.3、编写后端代码
           </a>
          </li>
          <li>
           <a href="#54_251" rel="nofollow">
            5.4、编写前端代码
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#6_274" rel="nofollow">
          6、写在最后
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h3>
     <a id="1_1">
     </a>
     1、写在前面
    </h3>
    <p>
     在学校的比赛中，很多赛道都要求要用到华为云IoT平台。但是，全网关于应用侧接入华为云IoT平台的教程极少，且官网上的教程不够清晰明了。因此，在自己的一番摸索下，实现了基于Nodejs的应用侧通过华为云IoT平台双向联通（当然python、java等后端语言也是没有问题的），可以完成数据转发，命令下发等功能，并写下了这一篇教程，希望可以帮助到热爱物联网的大家。
     <br/>
    </p>
    <h3>
     <a id="2IoT_6">
     </a>
     2、关于设备侧与华为云IoT平台的连接
    </h3>
    <p>
     当然，在应用侧接入华为云IoT平台之前，
     <code>
      设备侧
     </code>
     应首先完成接入。
    </p>
    <p>
     如果还没有接入的话，可以
     <code>
      参考
     </code>
     一下这篇文章：
     <a href="https://blog.csdn.net/Beihai_Van/article/details/126634891?spm=1001.2014.3001.5501">
      【教程】ESP32连接华为云IoT平台
     </a>
    </p>
    <p>
     文章已经说得非常详细，希望可以对大家有所启发。
     <br/>
    </p>
    <h3>
     <a id="3IoT_14">
     </a>
     3、进入华为云IoT平台
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d6611915215cd46d895cf1fa840daa42.png#pic_center">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f2d6d218552c35997c7a342c265f3fe4.png#pic_center">
       <br/>
      </img>
     </img>
    </p>
    <h3>
     <a id="4_18">
     </a>
     4、接收属性上报，实现数据转发至服务器
    </h3>
    <h4>
     <a id="41_19">
     </a>
     4.1、数据转发的总体实现思路
    </h4>
    <p>
     当设备属性上报时，我们通过以下步骤在
     <code>
      华为云IoT平台
     </code>
     上看到相关属性信息
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dfd9a1b82ba571090a83f0bfb6a9f18c.png#pic_center">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c035d245da9b7249f7b172592b6e9030.png#pic_center">
       <br/>
       但是，我们要怎么样把华为云IoT平台上的数据
       <code>
        转发到服务器上
       </code>
       ，并最终展现在网页端或小程序端呢？
      </img>
     </img>
    </p>
    <p>
     这时候，我们就要用到华为云的
     <code>
      数据转发
     </code>
     功能，查看官方文档请点此链接：
     <a href="https://support.huaweicloud.com/usermanual-iothub/iot_01_0024.html" rel="nofollow">
      数据转发
     </a>
    </p>
    <p>
     简单来说，我们可以通过
     <strong>
      第三方应用服务-HTTP推送
     </strong>
     的方式实现，我们只需要通过：
    </p>
    <ul>
     <li>
      <strong>
       创建规则触发条件
      </strong>
     </li>
     <li>
      <strong>
       创建规则动作
      </strong>
     </li>
     <li>
      <strong>
       指定应用服务器的URL
      </strong>
     </li>
    </ul>
    <p>
     就可以在设备发生属性上报、消息上报时，平台通过http推送的方式将相关信息推送给指定的URL。
    </p>
    <h4>
     <a id="42_36">
     </a>
     4.2、创建规则触发条件
    </h4>
    <p>
     一开始，当然是要创建规则触发条件了。
    </p>
    <ul>
     <li>
      点击此链接进入相关界面：
      <a href="https://support.huaweicloud.com/api-iothub/iot_06_v5_01302.html" rel="nofollow">
       创建规则触发条件
      </a>
     </li>
     <li>
      点击
      <code>
       API Explore
      </code>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/760ad2fda107e6c9f67d56961ee97fc0.png#pic_center"/>
    </p>
    <ul>
     <li>
      进入API Explore界面并根据下图
      <code>
       填写相关信息
      </code>
      ，填写时可以把鼠标放在
      <code>
       '?'
      </code>
      上查看应填写的内容。
     </li>
     <li>
      我这次填写的接收
      <code>
       属性上报
      </code>
      ，当然消息上报呀、状态变更呀也可以hhh，看个人需求填写就行
     </li>
     <li>
      填写完后点击
      <code>
       调试
      </code>
      ,就可以在最右边的界面看到调试成功的信息
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a5fa966a56b53b49893753537dec28f7.png#pic_center"/>
    </p>
    <ul>
     <li>
      可以在如下界面
      <code>
       查看
      </code>
      创建的规则触发条件
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/aea33021e73db61103fd13ae58507aad.png#pic_center"/>
    </p>
    <p>
    </p>
    <h4>
     <a id="43URL_57">
     </a>
     4.3、创建规则动作和指定URL
    </h4>
    <p>
     接下来就是
     <code>
      创建规则动作
     </code>
     了，通过图示方式填写有关信息，采用
     <code>
      http推送
     </code>
     的方式并指定
     <code>
      URL
     </code>
     ,最后点击
     <code>
      调试
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f26572df2c449bd90834783cceea1f50.png#pic_center"/>
     <br/>
     调试成功后，设备进行属性上报时就会主动向你填写的URL发送信息啦！
    </p>
    <p>
     我们可以通过以下方法
     <code>
      查看
     </code>
     创建的规则动作：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d791d4100ff1c3ee29f9001d078b2fce.png#pic_center"/>
     <br/>
    </p>
    <h4>
     <a id="44_66">
     </a>
     4.4、应用侧路由配置后端代码
    </h4>
    <p>
     通过以上操作后，设备发送属性变化时就会向你填写的
     <code>
      URL
     </code>
     发送信息了。发送的消息是一个
     <code>
      json
     </code>
     对象，格式如下：
    </p>
    <blockquote>
     <p>
      {
      <!-- -->
      <br/>
      “resource” : “device.property”,
      <br/>
      “event” : “report”,
      <br/>
      “event_time” : “20151212T121212Z”, “notify_data” : {
      <!-- -->
      <br/>
      “header” : {
      <!-- -->
      <br/>
      “device_id” : “d4922d8a-6c8e-4396-852c-164aefa6638f”,
      <br/>
      “product_id” : “ABC123456789”,
      <br/>
      “app_id” : “d4922d8a-6c8e-4396-852c-164aefa6638f”,
      <br/>
      “gateway_id” : “d4922d8a-6c8e-4396-852c-164aefa6638f”,
      <br/>
      “node_id” : “ABC123456789”,
      <br/>
      “tags” : [ {
      <!-- -->
      <br/>
      “tag_value” : “testTagValue”,
      <br/>
      “tag_key” : “testTagName”
      <br/>
      } ]
      <br/>
      },
      <br/>
      “body” : {
      <!-- -->
      <br/>
      “services” : [ {
      <!-- -->
      <br/>
      “service_id” : “Battery”,
      <br/>
      “properties” : {
      <!-- -->
      <br/>
      “batteryLevel” : 80
      <br/>
      },
      <br/>
      “event_time” : “20151212T121212Z”
      <br/>
      } ]
      <br/>
      }
      <br/>
      }
      <br/>
      }
     </p>
    </blockquote>
    <ul>
     <li>
      对应的关系如下图所示
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6b57038f6b61d971858b48accfdc53d6.png#pic_center"/>
    </p>
    <ul>
     <li>
      在后端定义相关路由，并在路由中处理发送过来的
      <code>
       json
      </code>
      对象的数据
     </li>
     <li>
      以下给出基于
      <code>
       Nodejs
      </code>
      的代码参考，详细信息可以看注释，读者可以根据自己的需求修改相关参数
     </li>
    </ul>
    <pre><code class="prism language-cpp">var db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'../modules/helper/mydb'</span><span class="token punctuation">)</span>
var express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token char">'/iot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
var namesource <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>notify_data<span class="token punctuation">.</span>header<span class="token punctuation">.</span>product_id<span class="token punctuation">;</span> <span class="token comment">//获得产品 id</span>
var datasource <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>notify_data<span class="token punctuation">.</span>body<span class="token punctuation">.</span>services<span class="token punctuation">;</span> <span class="token comment">//获得服务列表</span>
var mydata <span class="token operator">=</span> datasource<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">;</span> <span class="token comment">//获得服务列表第一项的属性值</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>datasource<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>service_id <span class="token operator">==</span> <span class="token string">"ash_bin_Service"</span><span class="token punctuation">)</span>   <span class="token comment">//判断服务id是垃圾桶的相关服务</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//更改垃圾桶信息并写入数据库</span>
        <span class="token keyword">const</span> sqlStr7 <span class="token operator">=</span> 'UPDATE new_notice SET state<span class="token operator">=</span><span class="token operator">?</span> WHERE name<span class="token operator">=</span><span class="token operator">?</span> <span class="token operator">and</span> number <span class="token operator">=</span> <span class="token operator">?</span>'
        db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlStr7<span class="token punctuation">,</span> <span class="token punctuation">[</span>mydata<span class="token punctuation">.</span>ash_bin_capacity<span class="token punctuation">,</span> <span class="token string">"垃圾桶"</span><span class="token punctuation">,</span>namesource<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">cc</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"Status Code"</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            message<span class="token operator">:</span> <span class="token char">'更改信息成功！'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> results<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>datasource<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>service_id <span class="token operator">==</span> <span class="token string">"Trip_Monitor"</span><span class="token punctuation">)</span> <span class="token comment">//判断服务id是卡片的相关服务</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//更改卡片信息并写入数据库</span>
        <span class="token keyword">const</span> sqlStr8 <span class="token operator">=</span> 'UPDATE card SET state<span class="token operator">=</span><span class="token operator">?</span> WHERE name<span class="token operator">=</span><span class="token operator">?</span> <span class="token operator">and</span> number <span class="token operator">=</span> <span class="token operator">?</span>'
        db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlStr8<span class="token punctuation">,</span> <span class="token punctuation">[</span>mydata<span class="token punctuation">.</span>Is_Trip<span class="token punctuation">,</span> <span class="token string">"智慧卡片"</span><span class="token punctuation">,</span><span class="token string">"0"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">cc</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">"Status Code"</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            message<span class="token operator">:</span> <span class="token char">'更改信息成功！'</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> results<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">module</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre>
<ul>
<li>
最后通过前端代码向后端发送相关请求就可以展现出相关信息，前端代码可以根据需求编写，此处不详细说明，如有需要可以私下交流讨论
</li>
</ul>
<p>
</p>
<h3>
<a id="5_152">
</a>
5、命令下发
</h3>
<p>
通过命令下发，可以在网页端或小程序端向设备发送指定命令信息
</p>
<p>
可以点击此链接查看命令下发的
<code>
官方文档
</code>
：
<a href="https://support.huaweicloud.com/api-iothub/iot_06_v5_0038.html" rel="nofollow">
下发设备命令
</a>
</p>
<p>
然后进行如下操作:
</p>
<h4>
<a id="51_158">
</a>
5.1、创建命令
</h4>
<ul>
<li>
<code>
产品 - 查看
</code>
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b6415ae720f875e1e08a26bdae878608.png#pic_center"/>
</p>
<ul>
<li>
<code>
添加命令
</code>
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bbd53f3d993b8ddd77f629eeef6e3afc.png#pic_center"/>
</p>
<ul>
<li>
根据需要填写
<code>
命令名称
</code>
、
<code>
下发参数
</code>
、
<code>
相应参数
</code>
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/376775def7805b89d142572a5ba40ba4.png#pic_center"/>
</li>
<li>
<code>
命令名称
</code>
随便写一个就行，
<code>
下发参数
</code>
是应用侧想要给设备发送的命令信息，
<code>
响应参数
</code>
是设备接收到命令后相应给用户的信息。
</li>
<li>
以下是我设置的其中一个命令，大家根据自己的需求填写就行
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4afe19fdfce869265a934c54af49a42d.png#pic_center"/>
</p>
<h4>
<a id="52_176">
</a>
5.2、复制代码示例
</h4>
<ul>
<li>
点击红框中的
<code>
API Explore
</code>
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/579a8580bbccc24b8bd8591a1a9cd690.png#pic_center"/>
</p>
<ul>
<li>
按照下图步骤进行操作
</li>
</ul>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b2e336a23a3994b386f5c2e3011eeea3.png#pic_center"/>
</p>
<h4>
<a id="53_185">
</a>
5.3、编写后端代码
</h4>
<p>
通过复制的代码示例，我们就可以根据它进行后端代码编写，以下给出我的代码示例，详细信息可以参考注释，大家可以根据自己的需求修改参数。
</p>
<pre><code class="prism language-cpp">var db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'../modules/helper/mydb'</span><span class="token punctuation">)</span>
var express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> core <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'@huaweicloud<span class="token operator">/</span>huaweicloud<span class="token operator">-</span>sdk<span class="token operator">-</span>core<span class="token number">'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> iotda <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@huaweicloud/huaweicloud-sdk-iotda"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ak <span class="token operator">=</span> <span class="token string">"&lt;YOUR AK&gt;"</span><span class="token punctuation">;</span> <span class="token comment">//你的 AK 值</span>
<span class="token keyword">const</span> sk <span class="token operator">=</span> <span class="token string">"&lt;YOUR SK&gt;"</span><span class="token punctuation">;</span> <span class="token comment">//你的 SK 值</span>
<span class="token keyword">const</span> endpoint <span class="token operator">=</span> <span class="token string">"https://iotda.cn-north-4.myhuaweicloud.com"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> project_id <span class="token operator">=</span> <span class="token string">"f93ce35781b648099bf5ba620daeebf8"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> core<span class="token punctuation">.</span><span class="token function">BasicCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//创建验证信息对象</span>
<span class="token punctuation">.</span><span class="token function">withAk</span><span class="token punctuation">(</span>ak<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">withSk</span><span class="token punctuation">(</span>sk<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">withProjectId</span><span class="token punctuation">(</span>project_id<span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> iotda<span class="token punctuation">.</span>IoTDAClient<span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个客户端对象 </span>
<span class="token punctuation">.</span><span class="token function">withCredential</span><span class="token punctuation">(</span>credentials<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">withEndpoint</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">new</span> iotda<span class="token punctuation">.</span><span class="token function">CreateCommandRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建一个 request 请求</span>
request<span class="token punctuation">.</span>deviceId <span class="token operator">=</span> <span class="token string">"Doge1_1"</span><span class="token punctuation">;</span> <span class="token comment">//填写你的设备 id 值</span>
<span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">new</span> iotda<span class="token punctuation">.</span><span class="token function">DeviceCommandRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建 body 对象</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token char">'/command'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">const</span> mydata <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>    <span class="token comment">//接收从前端前端传过来的数据</span>
    body<span class="token punctuation">.</span><span class="token function">withParas</span><span class="token punctuation">(</span>mydata<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//将数据添加到body</span>
    body<span class="token punctuation">.</span><span class="token function">withCommandName</span><span class="token punctuation">(</span><span class="token string">"user_order"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将命令名称添加到body</span>
    body<span class="token punctuation">.</span><span class="token function">withServiceId</span><span class="token punctuation">(</span><span class="token string">"Users_Delivery_Order"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将服务的ID添加到body</span>
    request<span class="token punctuation">.</span><span class="token function">withBody</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将body的信息放入request请求中</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">createCommand</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//客户端发送请求并返回结果</span>
    result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>response<span class="token punctuation">.</span>paras<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//规定设备返回的状态码为200时发送信息成功</span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">"Status Code"</span> <span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                message<span class="token operator">:</span> <span class="token char">'发送信息成功！'</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span> result<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>	<span class="token comment">//否则发送信息失败</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">"Status Code"</span> <span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
                message<span class="token operator">:</span> <span class="token char">'发送信息失败！'</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span> result<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>ex <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">module</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre>
<h4>
<a id="54_251">
</a>
5.4、编写前端代码
</h4>
<ul>
<li>
前端只需要通过
<code>
ajax
</code>
请求向定义的
<code>
/command
</code>
路由发送信息和接收信息就可以啦
</li>
<li>
以下给出
<code>
ajax
</code>
请求的模板，大家根据需要自己编写
</li>
</ul>
<pre><code class="prism language-cpp"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span>
function <span class="token function">sendCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
dataType<span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>
method<span class="token operator">:</span> <span class="token char">'post'</span><span class="token punctuation">,</span>
url<span class="token operator">:</span> <span class="token string">"/command"</span><span class="token punctuation">,</span> <span class="token comment">//指定路由</span>
data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//发送的数据</span>
success<span class="token operator">:</span> <span class="token function">function</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印服务端返回的数据(调试用)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
error<span class="token operator">:</span> <span class="token function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"异常！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre>
<h3>
<a id="6_274">
</a>
6、写在最后
</h3>
<p>
以上便是应用侧与华为云 IoT 平台的连接过程，希望对你有所帮助。如果有任何问题都可以在评论区探讨,看到了都会回 hhh~
</p>
<p>
<strong>
原创不易，点个赞或者点个关注激励笔者分享更多优质原创内容吧！
</strong>
</p>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36323331333533352f:61727469636c652f64657461696c732f313236363532323338" class_="artid" style="display:none">
 </p>
</div>
