---
layout: post
title: "微信小程序自动化实战appiumpython"
date: 2022-11-14 19:14:15 +0800
description: "本文详细阐述了如何配置和使用Appium来操作微信小程序。首先，配置desired_capabili"
keywords: "微信小程序自动化"
categories: ['']
tags: ['自动化', '微信小程序', 'Python']
artid: "127845229"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=127845229
    alt: "微信小程序自动化实战appiumpython"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序自动化实战（appium+python）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <em>
      本文主要讲解一下使用appium操作微信小程序的流程
     </em>
     <br/>
     要使用appium进行自动化第一步当然是配置好appium环境，这块我就不在这里细讲了，直接开始吧；
     <br/>
     ps：新版微信不再需要手动开启X5内核了
    </p>
    <h2>
     <a id="1desired_capabilities_3">
     </a>
     1、配置desired_capabilities
    </h2>
    <ul>
     <li>
      注意点：
      <ol>
       <li>
        要操作微信小程序，则需要先进入到微信小程序
       </li>
       <li>
        要先查看微信webview使用谷歌驱动版本然后进行配置
        <br/>
        谷歌驱动版本可以利用edge浏览器的工具（edge://inspect/#devices）进行查看
        <br/>
        只要使用adb工具连上手机后，打开对应的小程序页面就能在浏览器中查看到如下信息
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a716e860bfbfc14a49e20ab832d0dd56.png">
         <br/>
         具体配置如下，可根据个人需要进行修改
        </img>
       </li>
      </ol>
      <pre><code class="prism language-python">capability<span class="token punctuation">:</span>
    <span class="token comment"># 设备操作系统</span>
    <span class="token string">"platformName"</span><span class="token punctuation">:</span> <span class="token string">"Android"</span>
    <span class="token comment"># 设备名称(随意填写)</span>
    <span class="token string">"deviceName"</span><span class="token punctuation">:</span> <span class="token string">"HuaWeiP30"</span>
    <span class="token comment"># 应用程序的包名  </span>
    <span class="token string">"appPackage"</span><span class="token punctuation">:</span> <span class="token string">"com.tencent.mm"</span>
    <span class="token comment"># 应用程序的启动页面</span>
    <span class="token string">"appActivity"</span><span class="token punctuation">:</span> <span class="token string">".ui.LauncherUI"</span>
    <span class="token comment"># 不重置app</span>
    <span class="token string">"noReset"</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
    <span class="token comment"># 设置谷歌驱动地址</span>
    <span class="token string">"chromedriverExecutable"</span><span class="token punctuation">:</span> <span class="token string">"G:\\chromedriver\\chromedriver_86\\chromedriver.exe"</span>
</code></pre>
     </li>
    </ul>
    <h2>
     <a id="2_26">
     </a>
     2、启动微信并进入小程序页面
    </h2>
    <p>
     <em>
      前提： appium服务已启动、手机或模拟器已连接上（adb devices 中能查看到）
     </em>
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> appium <span class="token keyword">import</span> webdriver
	<span class="token keyword">def</span> <span class="token function">init_app</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token triple-quoted-string string">"""初始化appium驱动"""</span>
		<span class="token comment"># capability是第一步定义好的</span>
	   caps <span class="token operator">=</span> cap_conf<span class="token punctuation">[</span><span class="token string">'capability'</span><span class="token punctuation">]</span>
	   driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Remote<span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:4723/wd/hub"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>caps<span class="token punctuation">)</span>
	   driver<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">into_mini_main_page</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token triple-quoted-string string">"""
       进入小程序首页
       """</span>
       <span class="token comment"># 进入小程序的方式很多，可以根据自己的需要进行操作  find_and_click是我自己封装的方法</span>
       self<span class="token punctuation">.</span>find_and_click<span class="token punctuation">(</span>MobileBy<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">"//*[@text='发现']"</span><span class="token punctuation">)</span> \
           <span class="token punctuation">.</span>find_and_click<span class="token punctuation">(</span>MobileBy<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">"//*[@text='小程序']"</span><span class="token punctuation">)</span> \
           <span class="token punctuation">.</span>find_and_click<span class="token punctuation">(</span>MobileBy<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">"//*[@text='京东购物']"</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     操作到以上步骤后再查看edge浏览器inspect工具应该就能看到如下图的页面
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/03915d879c866d80908d1984008e98f0.png">
      <br/>
      说明微信已经切到小程序页面了，我们程序也要切到对应webview页面：
     </img>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 切到对应的context    driver.contexts可以拿到所有context</span>
  self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>context<span class="token punctuation">(</span><span class="token string">'WEBVIEW_com.tencent.mm:appbrand0'</span><span class="token punctuation">)</span>
  <span class="token comment"># 在上面页面可以看到有多个页面 我们还需要切到对应的页面中</span>
  <span class="token keyword">for</span> window <span class="token keyword">in</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>window_handles<span class="token punctuation">:</span>
       self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>window<span class="token punctuation">)</span>
       <span class="token keyword">if</span>  <span class="token string">':VISIBLE'</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">:</span>
           <span class="token keyword">break</span>
</code></pre>
    <p>
     执行完以上步骤就已经进入到了微信小程序页面了
    </p>
    <h2>
     <a id="3_59">
     </a>
     3、进行小程序页面定位
    </h2>
    <p>
     在inspect工具中点击对应页面的inspect的按钮，就可以进入到对应的页面进行定位
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/680dac100d3aff6a04729796e2e3ee12.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/70e6b1698bf955f5723c3253fa2b112c.png"/>
     </img>
    </p>
    <pre><code class="prism language-python">	ele <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">"//*[text()='京东超市']"</span><span class="token punctuation">)</span>
	ele<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 这里要注意一定要且换到当前展示的页面！！</span>
    <span class="token keyword">for</span> window <span class="token keyword">in</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>window_handles<span class="token punctuation">:</span>
         self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>window<span class="token punctuation">(</span>window<span class="token punctuation">)</span>
         <span class="token keyword">if</span>  <span class="token string">'https://h5.m.jd.com'</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>title<span class="token punctuation">:</span>
             <span class="token keyword">break</span>
    <span class="token comment"># 切换进来后就可以对京东超市页面进行定位 </span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5c0ce7286082388bb9812c86770c75b4.png"/>
    </p>
    <p>
     <em>
      <strong>
       以上就是小程序的一些关键步骤，剩下的就和正常的UI自动化类似了，这里就不再介绍了；接下来大家就可以根据PO思想封装一套框架，最好是web、app、小程序能共用。
      </strong>
     </em>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6368656e6a786a3132332f:61727469636c652f64657461696c732f313237383435323239" class_="artid" style="display:none">
 </p>
</div>


