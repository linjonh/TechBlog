---
layout: post
title: "VSCode插件开发三-调试及其他"
date: 2024-10-10 08:20:43 +0800
description: "系列文章目录VSCode插件开发(一) —— 第一个插件VSCode插件开发(二) —— 常用贡献点"
keywords: "vscode 怎么么打开 开发人员: 打开 webview 开发人员t具"
categories: ['Vscode']
tags: ['插件', 'Vscode']
artid: "108239013"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=108239013
    alt: "VSCode插件开发三-调试及其他"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [VSCode插件开发(三) —— 调试及其他
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     系列文章目录
    </h2>
    <font color="#999AAA">
    </font>
    <p>
     <a href="https://blog.csdn.net/kukudelaomao/article/details/108220483">
      VSCode插件开发(一) —— 第一个插件
     </a>
     <br/>
     <a href="https://blog.csdn.net/kukudelaomao/article/details/108234267">
      VSCode插件开发(二) —— 常用贡献点
     </a>
     <br/>
     <a href="https://blog.csdn.net/kukudelaomao/article/details/108239013">
      VSCode插件开发(三) —— 调试及其他
     </a>
    </p>
    <hr color="#000000" size='1"'/>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_0" rel="nofollow">
        系列文章目录
       </a>
      </li>
      <li>
       <a href="#_11" rel="nofollow">
        调试方法
       </a>
      </li>
      <li>
       <a href="#_29" rel="nofollow">
        插件存放目录
       </a>
      </li>
      <li>
       <a href="#_36" rel="nofollow">
        其他注意事项
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr color="#000000" size='1"'/>
    <h2>
     <a id="_11">
     </a>
     调试方法
    </h2>
    <ul>
     <li>
      <p>
       扩展里的
       <code>
        console.log()
       </code>
       日志一般输出在旧窗口的
       <strong>
        调试控制台
       </strong>
       。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e1e96b2355c6ea7e72283f71a89f99e0.png"/>
      </p>
     </li>
     <li>
      <p>
       但结构较深的对象在旧窗口调试控制台无法显示，目前发现的唯一比较好的方法就是在想输出的地方打一个
       <strong>
        断点
       </strong>
       ，然后运行的时候会自动卡在这里，鼠标悬停在旧窗口的代码上就可以查看对象的内容。
      </p>
      <ul>
       <li>
        <code>
         F5
        </code>
        运行/继续
       </li>
       <li>
        <code>
         Shift+F5
        </code>
        停止运行
       </li>
       <li>
        <code>
         F10
        </code>
        单步跳过
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/49fdf8092f636fd16b571bec3753a623.png"/>
    </p>
    <ul>
     <li>
      <p>
       新窗口可以通过快捷键
       <code>
        Ctrl+Shift+I
       </code>
       打开
       <strong>
        开发者控制台
       </strong>
       （或从
       <code>
        帮助
       </code>
       -&gt;
       <code>
        切换开发人员工具
       </code>
       打开）
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/783a9496bd866a554d7a68b2e1c5c06e.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        Webview
       </strong>
       的控制台比较特殊，需要特殊的命令才能打开，按下
       <code>
        Ctrl+Shift+P
       </code>
       然后执行打开
       <code>
        Webview开发工具
       </code>
       ，英文版应该是
       <code>
        Open Webview Developer Tools
       </code>
       。详情参见
       <a href="https://code.visualstudio.com/api/extension-guides/webview" rel="nofollow">
        官方文档
       </a>
       。
      </p>
     </li>
    </ul>
    <h2>
     <a id="_29">
     </a>
     插件存放目录
    </h2>
    <p>
     插件安装后根据操作系统不同会放在如下目录，可以学习查看其他插件的代码：
    </p>
    <p>
     Windows系统：
     <code>
      %USERPROFILE%\.vscode\extensions
     </code>
     <br/>
     Mac/Linux：
     <code>
      ~/.vscode/extensions
     </code>
    </p>
    <h2>
     <a id="_36">
     </a>
     其他注意事项
    </h2>
    <ul>
     <li>
      调试控制台日志并不都可靠，如：当require一个function进来并打印输出时，虽然打印在控制台显示为null，但其实是有值的
     </li>
     <li>
      代码为什么没生效：
      <ul>
       <li>
        <code>
         activationEvents
        </code>
        里面添加了吗？开发的时候如果老是忘记可以直接设置成*；
       </li>
       <li>
        代码是不是报错了？如前文所说，很多错误是不会暴露出来的，需要手动打开控制台查看；
       </li>
       <li>
        代码是不是忘记引入了？有时候拆分多个文件之后可能忘了引入；
       </li>
       <li>
        版本冲突。调试前最好卸载之前所有版本。
       </li>
      </ul>
     </li>
     <li>
      打开文件是
      <code>
       vscode.window.showTextDocument
      </code>
      而不是
      <code>
       vscode.workspace.openTextDocument
      </code>
      。
      <ul>
       <li>
        <code>
         vscode.workspace.openTextDocument
        </code>
        仅仅是加载文档并返回一个TextDocument对象，但是并不在vscode中打开；
       </li>
       <li>
        <code>
         vscode.window.showTextDocument
        </code>
        则是在vscode中打开一个文档；
       </li>
      </ul>
     </li>
     <li>
      工程根目录的获取方法：
      <code>
       vscode.workspace.workspaceFolders
      </code>
      可以获取当前工作区所有根文件夹数组，下面是一个简单粗暴的方法
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token comment">/**
 * 获取当前所在工程根目录，有3种使用方法：&lt;br&gt;
 * getProjectPath(uri) uri 表示工程内某个文件的路径&lt;br&gt;
 * getProjectPath(document) document 表示当前被打开的文件document对象&lt;br&gt;
 * getProjectPath() 会自动从 activeTextEditor 拿document对象，如果没有拿到则报错
 * @param {*} document 
 */</span>
<span class="token function">getProjectPath</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>document<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		document <span class="token operator">=</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span>activeTextEditor <span class="token operator">?</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span>activeTextEditor<span class="token punctuation">.</span>document <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>document<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span><span class="token string">'当前激活的编辑器不是文件或者没有文件被打开！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">const</span> currentFile <span class="token operator">=</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>uri <span class="token operator">?</span> document<span class="token punctuation">.</span>uri <span class="token punctuation">:</span> document<span class="token punctuation">)</span><span class="token punctuation">.</span>fsPath<span class="token punctuation">;</span>
	<span class="token keyword">let</span> projectPath <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token keyword">let</span> workspaceFolders <span class="token operator">=</span> vscode<span class="token punctuation">.</span>workspace<span class="token punctuation">.</span>workspaceFolders<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 由于存在Multi-root工作区，暂时没有特别好的判断方法，先这样粗暴判断</span>
	<span class="token comment">// 如果发现只有一个根文件夹，读取其子文件夹作为 workspaceFolders</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>workspaceFolders<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> workspaceFolders<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> vscode<span class="token punctuation">.</span>workspace<span class="token punctuation">.</span>rootPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> rootPath <span class="token operator">=</span> workspaceFolders<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>rootPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		workspaceFolders <span class="token operator">=</span> files<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>name <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token regex">/^\./g</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>name <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>rootPath<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// vscode.workspace.rootPath会不准确，且已过时</span>
		<span class="token comment">// return vscode.workspace.rootPath + '/' + this._getProjectName(vscode, document);</span>
	<span class="token punctuation">}</span>
	workspaceFolders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>folder <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>currentFile<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			projectPath <span class="token operator">=</span> folder<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>projectPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span><span class="token string">'获取工程根路径异常！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> projectPath<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     更多细节可阅读
     <a href="https://code.visualstudio.com/docs/getstarted/keybindings" rel="nofollow">
      官方文档
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6b756b7564656c616f6d616f2f:61727469636c652f64657461696c732f313038323339303133" class_="artid" style="display:none">
 </p>
</div>


