---
layout: post
title: "获取音视频文件AVMetadata数据"
date: 2024-09-30 15:01:18 +0800
description: "获取音视频文件AVMetadata数据获取音视频文件AVMetadata数据问题来源:http://"
keywords: "获取音视频文件AVMetadata数据"
categories: ["未分类"]
tags: ["无标签"]
artid: "27085621"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=27085621
  alt: "获取音视频文件AVMetadata数据"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     获取音视频文件AVMetadata数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="posthead" style="background-color:rgb(238,238,238); border-bottom-width:1px; border-bottom-style:solid; border-bottom-color:rgb(204,204,204); padding:4px; color:rgb(68,68,68); font-size:9px; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif">
     <h3 style="margin:0px; font-size:13px">
      <a class="singleposttitle" href="http://www.cnblogs.com/YouXianMing/p/3681170.html" id="cb_post_title_url" rel="nofollow noopener noreferrer" style="color:rgb(34,51,85); text-decoration:none" target="_blank">
       获取音视频文件AVMetadata数据
      </a>
     </h3>
    </div>
    <div class="postbody" style="padding:4px; margin-bottom:14px; font-size:13px; line-height:1.5; font-family:Verdana,Geneva,Arial,Helvetica,sans-serif">
     <div id="cnblogs_post_body" style="margin-bottom:20px">
      <p style="margin:10px auto">
       <span style="font-size:18pt">
        获取音视频文件AVMetadata数据
       </span>
      </p>
      <p style="margin:10px auto">
       <span style="color:rgb(136,136,136)">
        <img alt="" src="http://images.cnitblog.com/i/607542/201404/230920537959279.gif" style="border:0px"/>
       </span>
      </p>
      <p style="margin:10px auto">
       <span style="color:rgb(136,136,136)">
        问题来源:
       </span>
      </p>
      <p style="margin:10px auto">
       <span style="text-decoration:underline">
        <span style="font-size:12px; color:rgb(136,136,136)">
         <a href="http://stackoverflow.com/questions/16318821/extracting-mp3-album-artwork-in-ios" rel="nofollow noopener noreferrer" style="color:rgb(29,88,209); text-decoration:none" target="_blank">
          <span style="font-size:13px; color:rgb(136,136,136)">
           http://stackoverflow.com/questions/16318821/extracting-mp3-album-artwork-in-ios
          </span>
         </a>
        </span>
       </span>
      </p>
      <p style="margin:10px auto">
       <span style="text-decoration:underline">
        <span style="font-size:12px; color:rgb(136,136,136)">
         <a href="http://stackoverflow.com/questions/14030746/ios-avfoundation-how-do-i-fetch-artwork-from-an-mp3-file" rel="nofollow noopener noreferrer" style="color:rgb(29,88,209); text-decoration:none" target="_blank">
          <span style="font-size:13px; color:rgb(136,136,136)">
           http://stackoverflow.com/questions/14030746/ios-avfoundation-how-do-i-fetch-artwork-from-an-mp3-file
          </span>
         </a>
        </span>
       </span>
      </p>
      <p style="margin:10px auto">
      </p>
      <p style="margin:10px auto">
       做音乐播放器应用有时候需要获取音乐文件的一些数据信息,比如该音乐文件中的封面图片,艺人名,专辑名等,如何获取呢?本人抛砖引玉,写一个获取封面图片的类供大家参考.
      </p>
      <div class="cnblogs_code" style="background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:'Courier New'!important; font-size:12px!important">
       <div class="cnblogs_code_toolbar" style="margin-top:5px">
        <span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important">
         <a style="color:rgb(29,88,209); border:none!important" target="_blank" title="复制代码">
          <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="border:none!important"/>
         </a>
        </span>
       </div>
       <pre style="margin-top:0px; margin-bottom:0px; margin-left:22px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,128,0); line-height:1.5!important">//</span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">  AVMetadataInfo.h
</span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span>  <span style="color:rgb(0,128,0); line-height:1.5!important"><u>http://home.cnblogs.com/u/YouXianMing/</u></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important">  Copyright (c) 2014年 Y.X. All rights reserved.
</span><span style="color:rgb(0,128,0); line-height:1.5!important">//
</span>
<span style="color:rgb(0,0,255); line-height:1.5!important">#import</span> &lt;Foundation/Foundation.h&gt;

<span style="color:rgb(0,0,255); line-height:1.5!important">#warning</span> 需要引入 AVFoundation.framework

<span style="color:rgb(0,0,255); line-height:1.5!important">@interface</span><span style="line-height:1.5!important"> AVMetadataInfo : NSObject

</span><span style="color:rgb(0,128,0); line-height:1.5!important">/_</span><span style="color:rgb(0,128,0); line-height:1.5!important">_
获取音视频文件的 Metadata 信息(可以获取到 mp3 以及 m4a 的相关信息)

\*AVMetadataCommonKeyArtwork 这个参数是可以换的,换不同的参数可以取得不同的值

\*[注意]此方法中用到了信号量将异步操作转换成了同步操作,尽量在主线程中使用

@param fileURL 文件的 URL 地址
@return 一个包含了相关内容的字典
</span><span style="color:rgb(0,128,0); line-height:1.5!important">\*/</span>

- (NSDictionary _)dataInfoFromFileURL:(NSURL _<span style="line-height:1.5!important">)fileURL;

</span><span style="color:rgb(0,0,255); line-height:1.5!important">@end</span></pre>
<div class="cnblogs_code_toolbar" style="margin-top:5px">
<span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important">
<a style="color:rgb(29,88,209); border:none!important" target="_blank" title="复制代码">
<img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="border:none!important"/>
</a>
</span>
</div>
</div>
<div class="cnblogs_code" style="background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:'Courier New'!important; font-size:12px!important">
<div class="cnblogs_code_toolbar" style="margin-top:5px">
<span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important">
<a style="color:rgb(29,88,209); border:none!important" target="_blank" title="复制代码">
<img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="border:none!important"/>
</a>
</span>
</div>
<pre style="margin-top:0px; margin-bottom:0px; margin-left:22px; white-space:pre-wrap; word-wrap:break-word; font-family:'Courier New'!important"><span style="color:rgb(0,128,0); line-height:1.5!important">//</span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> AVMetadataInfo.m
</span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span> <span style="color:rgb(0,128,0); line-height:1.5!important"><u>http://home.cnblogs.com/u/YouXianMing/</u></span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span>
<span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> Copyright (c) 2014 年 Y.X. All rights reserved.
</span><span style="color:rgb(0,128,0); line-height:1.5!important">//
</span>

<span style="color:rgb(0,0,255); line-height:1.5!important">#import</span> <span style="color:rgb(128,0,0); line-height:1.5!important">"</span><span style="color:rgb(128,0,0); line-height:1.5!important">AVMetadataInfo.h</span><span style="color:rgb(128,0,0); line-height:1.5!important">"</span>
<span style="color:rgb(0,0,255); line-height:1.5!important">#import</span> &lt;AVFoundation/AVFoundation.h&gt;

<span style="color:rgb(0,0,255); line-height:1.5!important">@implementation</span><span style="line-height:1.5!important"> AVMetadataInfo

</span>+ (NSDictionary _)dataInfoFromFileURL:(NSURL _<span style="line-height:1.5!important">)fileURL
{
</span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 创建字典</span>
NSMutableDictionary \*dic =<span style="line-height:1.5!important"> [NSMutableDictionary dictionary];

    </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 创建信号量(将异步变成同步)</span>
    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span style="color:rgb(128,0,128); line-height:1.5!important">0</span><span style="line-height:1.5!important">);

    AVAsset </span>*asset =<span style="line-height:1.5!important"> [AVURLAsset URLAssetWithURL:fileURL options:nil];
    [asset loadValuesAsynchronouslyForKeys:@[</span><span style="color:rgb(128,0,0); line-height:1.5!important">@"</span><span style="color:rgb(128,0,0); line-height:1.5!important">commonMetadata</span><span style="color:rgb(128,0,0); line-height:1.5!important">"</span><span style="line-height:1.5!important">]
                         completionHandler:</span>^<span style="line-height:1.5!important">{
                             </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 发送信号量</span>

<span style="line-height:1.5!important"> dispatch_semaphore_signal(semaphore);
}];

    </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 无限等待</span>

<span style="line-height:1.5!important"> dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);

    </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 获取数据</span>
    NSArray *artworks =<span style="line-height:1.5!important"> [AVMetadataItem metadataItemsFromArray:asset.commonMetadata
                                                       withKey:AVMetadataCommonKeyArtwork
                                                      keySpace:AVMetadataKeySpaceCommon];
    </span><span style="color:rgb(0,0,255); line-height:1.5!important">for</span> (AVMetadataItem *item <span style="color:rgb(0,0,255); line-height:1.5!important">in</span><span style="line-height:1.5!important"> artworks)
    {
        </span><span style="color:rgb(0,0,255); line-height:1.5!important">if</span><span style="line-height:1.5!important"> ([item.keySpace isEqualToString:AVMetadataKeySpaceID3])
        {
            NSDictionary </span>*dict =<span style="line-height:1.5!important"> [item.value copyWithZone:nil];

            </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 获取图片</span>
            UIImage  *image = [UIImage imageWithData:[dict objectForKey:<span style="color:rgb(128,0,0); line-height:1.5!important">@"</span><span style="color:rgb(128,0,0); line-height:1.5!important">data</span><span style="color:rgb(128,0,0); line-height:1.5!important">"</span><span style="line-height:1.5!important">]];
            [dic setObject:image forKey:</span><span style="color:rgb(128,0,0); line-height:1.5!important">@"</span><span style="color:rgb(128,0,0); line-height:1.5!important">Artwork</span><span style="color:rgb(128,0,0); line-height:1.5!important">"</span><span style="line-height:1.5!important">];
        }
        </span><span style="color:rgb(0,0,255); line-height:1.5!important">if</span><span style="line-height:1.5!important"> ([item.keySpace isEqualToString:AVMetadataKeySpaceiTunes])
        {
            </span><span style="color:rgb(0,128,0); line-height:1.5!important">//</span><span style="color:rgb(0,128,0); line-height:1.5!important"> 获取图片</span>
            UIImage *image =<span style="line-height:1.5!important"> [UIImage imageWithData:[item.value copyWithZone:nil]];
            [dic setObject:image forKey:</span><span style="color:rgb(128,0,0); line-height:1.5!important">@"</span><span style="color:rgb(128,0,0); line-height:1.5!important">Artwork</span><span style="color:rgb(128,0,0); line-height:1.5!important">"</span><span style="line-height:1.5!important">];
        }
    }

    </span><span style="color:rgb(0,0,255); line-height:1.5!important">return</span><span style="line-height:1.5!important"> [NSDictionary dictionaryWithDictionary:dic];

}

</span><span style="color:rgb(0,0,255); line-height:1.5!important">@end</span></pre>
<div class="cnblogs_code_toolbar" style="margin-top:5px">
<span class="cnblogs_code_copy" style="padding-right:5px; line-height:1.5!important">
<a style="color:rgb(29,88,209); border:none!important" target="_blank" title="复制代码">
<img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="border:none!important"/>
</a>
</span>
</div>
</div>
<p style="margin:10px auto">
引入头文件,然后
</p>
<p style="margin:10px auto">
<img alt="" src="http://images.cnitblog.com/i/607542/201404/230919273883144.png" style="border:0px"/>
</p>
<p style="margin:10px auto">
没有然后了,就是这么简单.想要获取其他信息,请读者自行修改,很简单的.
</p>
</div>
</div>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303133353338373332:2f61727469636c652f64657461696c732f3237303835363231" class_="artid" style="display:none">
 </p>
</div>
