---
layout: post
title: "基于概率分析的智能AI扫雷程序秒破雷界世界纪录"
date: 2021-08-09 00:59:26 +0800
description: "大家好，我是小小明，上次的我带大家玩了数独：《让程序自动玩数独游戏让你秒变骨灰级数独玩家》《Pyth"
keywords: "扫雷概率算法"
categories: ['Python']
tags: ['无标签']
artid: "119525026"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=119525026
    alt: "基于概率分析的智能AI扫雷程序秒破雷界世界纪录"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     基于概率分析的智能AI扫雷程序秒破雷界世界纪录
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     大家好，我是小小明，上次的我带大家玩了数独：
    </p>
    <ul>
     <li>
      《
      <a href="https://blog.csdn.net/as604049322/article/details/118583461">
       让程序自动玩数独游戏让你秒变骨灰级数独玩家
      </a>
      》
     </li>
     <li>
      《
      <a href="https://blog.csdn.net/as604049322/article/details/119040450">
       Python调用C语言实现数独计算逻辑提速100倍
      </a>
      》
     </li>
    </ul>
    <p>
     今天我将带你用非常高端的姿势玩扫雷。本文涉及的技术点非常多，非常硬核，万字长文，高能预警。
    </p>
    <p>
     本文从图像识别到windows消息处理，最终到直接的内存修改。中间写了一套基于概率分析的扫雷AI算法，模拟雷界的高阶玩家的操作，轻松拿下高级的世界纪录。
    </p>
    <p>
     据说扫雷的世界记录是：
    </p>
    <p>
     <img alt="image-20210808001553811" src="https://i-blog.csdnimg.cn/blog_migrate/7a8b8c76c28ac37bb116cefe5631bd03.png"/>
    </p>
    <p>
     对于中级我玩的大概就是这情况，直接超过世界纪录的7秒：
    </p>
    <p>
     <img alt="录制_2021_08_08_00_20_44_891" src="https://i-blog.csdnimg.cn/blog_migrate/a2e02af56171999880184ca90b66a551.gif"/>
    </p>
    <p>
     对于高级也轻松超过世界纪录：
    </p>
    <p>
     <img alt="录制_2021_08_08_22_42_56_24" src="https://i-blog.csdnimg.cn/blog_migrate/0a092f1257f946c002e475d80e6db58f.gif"/>
    </p>
    <p>
     初级世界记录居然是0.49秒，虽然有点难，但我们还是可以超越（0.4秒和0.37秒）：
    </p>
    <p>
     <img alt="录制_2021_08_09_18_38_11_832" src="https://i-blog.csdnimg.cn/blog_migrate/4c296f6ee2ee3d2e7c1a131307f7a80b.gif"/>
    </p>
    <p>
     <img alt="录制_2021_08_09_19_01_27_219" src="https://i-blog.csdnimg.cn/blog_migrate/a94d0dab23a81cb7b4ae5a5258e8667f.gif"/>
    </p>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_31" rel="nofollow">
        扫雷游戏的介绍
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_33" rel="nofollow">
          简介
         </a>
        </li>
        <li>
         <a href="#_41" rel="nofollow">
          扫雷程序下载
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_53" rel="nofollow">
        基于图像分析的桌面前端交互程序
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_55" rel="nofollow">
          获取扫雷程序的窗口位置
         </a>
        </li>
        <li>
         <a href="#_110" rel="nofollow">
          根据窗口坐标抓取雷区图像
         </a>
        </li>
        <li>
         <a href="#_153" rel="nofollow">
          读取剩余地雷数量
         </a>
        </li>
        <li>
         <a href="#_252" rel="nofollow">
          读取雷区数据
         </a>
        </li>
        <li>
         <a href="#_356" rel="nofollow">
          自动操作扫雷程序
         </a>
        </li>
        <li>
         <a href="#_444" rel="nofollow">
          前端交互程序整体封装
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_662" rel="nofollow">
        自动扫雷算法
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#Monkey_664" rel="nofollow">
          Monkey随机算法玩中级扫雷
         </a>
        </li>
        <li>
         <a href="#_782" rel="nofollow">
          基于概率分析的扫雷算法
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#_788" rel="nofollow">
            算法的总体思想
           </a>
          </li>
          <li>
           <a href="#_798" rel="nofollow">
            搜索连通区域
           </a>
          </li>
          <li>
           <a href="#_873" rel="nofollow">
            统计每个连通块中的每个格子在多少种解中是有雷的
           </a>
          </li>
          <li>
           <a href="#_1009" rel="nofollow">
            考虑剩余雷数，计算精确概率
           </a>
          </li>
          <li>
           <a href="#_1082" rel="nofollow">
            基于概率的贪心算法
           </a>
          </li>
          <li>
           <a href="#_1143" rel="nofollow">
            概率分析算法代码的整体封装
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_1388" rel="nofollow">
          引入概率分析算法进行测试
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_1896" rel="nofollow">
        能不能更快更高的胜率？
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_1906" rel="nofollow">
          内存外挂原理
         </a>
        </li>
        <li>
         <a href="#_1930" rel="nofollow">
          实现过程
         </a>
        </li>
        <li>
         <a href="#_2045" rel="nofollow">
          内存外挂的完整代码
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#049_2127" rel="nofollow">
        能超越初级的0.49秒的世界记录吗？
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_31">
     </a>
     扫雷游戏的介绍
    </h2>
    <h3>
     <a id="_33">
     </a>
     简介
    </h3>
    <p>
     《扫雷》是一款大众类的益智小游戏，游戏的基本操作包括左键单击（Left Click）、右键单击（Right Click）、双击（Chording）三种。其中左键用于打开安全的格子；右键用于标记地雷；双击在一个数字周围的地雷标记完时，相当于对数字周围未打开的方块均进行一次左键单击操作。
    </p>
    <p>
     基本游戏步骤：开局后，首先要用鼠标在灰色区域点一下，会出现一些数字，1代表在这个数字周围有1个地雷，2表示在它周围有2个雷，3表示在它周围有3个雷；在确信是雷的地方，点一下右键，用右键标识出该出的地雷；确信不是雷的地方，按一下鼠标左键，打开相应的数字。
    </p>
    <h3>
     <a id="_41">
     </a>
     扫雷程序下载
    </h3>
    <p>
     <strong>
      OD和win98扫雷下载
     </strong>
    </p>
    <p>
     链接：
     <a href="http://pan.baidu.com/s/1gfA10K7" rel="nofollow">
      http://pan.baidu.com/s/1gfA10K7
     </a>
     密码：eiqp
    </p>
    <p>
     <strong>
      Arbiter版扫雷下载
     </strong>
    </p>
    <p>
     <a href="http://saolei.wang/BBS/" rel="nofollow">
      http://saolei.wang/BBS/
     </a>
    </p>
    <p>
     <img alt="image-20210807203150231" src="https://i-blog.csdnimg.cn/blog_migrate/e7b0be3e2b9d375f4b30a26a3b3a0b5e.png"/>
    </p>
    <h2>
     <a id="_53">
     </a>
     基于图像分析的桌面前端交互程序
    </h2>
    <h3>
     <a id="_55">
     </a>
     获取扫雷程序的窗口位置
    </h3>
    <p>
     这步需要调用windows API查找扫雷游戏的窗口，需要传入扫雷游戏得标题和类名，这个可以通过
     <code>
      inspect.exe
     </code>
     工具进行获取。
    </p>
    <p>
     <code>
      inspect.exe
     </code>
     工具是系统自带工具，我通过everything获取到路径为：
    </p>
    <p>
     C:\Program Files (x86)\Windows Kits\8.1\bin\x64\inspect.exe
    </p>
    <p>
     <img alt="image-20210807204248838" src="https://i-blog.csdnimg.cn/blog_migrate/a8e5dddc21635e535f56cd8cb4d16d53.png"/>
    </p>
    <p>
     打开扫雷游戏后，就可以通过以下代码获取扫雷游戏的窗口对象：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32gui

<span class="token comment"># 扫雷游戏窗口</span>
<span class="token comment"># class_name, title_name = "TMain", "Minesweeper Arbiter "</span>
class_name<span class="token punctuation">,</span> title_name <span class="token operator">=</span> <span class="token string">"扫雷"</span><span class="token punctuation">,</span> <span class="token string">"扫雷"</span>
hwnd <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span>

<span class="token keyword">if</span> hwnd<span class="token punctuation">:</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"窗口坐标，左上角：(</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>left<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>top<span class="token punctuation">}</span></span><span class="token string">),右下角：(</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>right<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>bottom<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
    w<span class="token punctuation">,</span> h <span class="token operator">=</span> right<span class="token operator">-</span>left<span class="token punctuation">,</span> bottom<span class="token operator">-</span>top
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"窗口宽度：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">，高度：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"未找到窗口"</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>窗口坐标，左上角：(86,86),右下角：(592,454)
窗口宽度：506，高度：368
</code></pre>
    <p>
     可以通过代码激活并前置窗口：
    </p>
    <p>
     <a href="https://docs.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setforegroundwindow" rel="nofollow">
      https://docs.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-setforegroundwindow
     </a>
    </p>
    <p>
     不过有时SetForegroundWindow调用有一些限制导致失败，我们可以再调用之前输入一个键盘事件：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32com<span class="token punctuation">.</span>client <span class="token keyword">as</span> win32


<span class="token keyword">def</span> <span class="token function">activateWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># SetForegroundWindow调用有一些限制，我们可以再调用之前输入一个键盘事件</span>
    shell <span class="token operator">=</span> win32<span class="token punctuation">.</span>Dispatch<span class="token punctuation">(</span><span class="token string">"WScript.Shell"</span><span class="token punctuation">)</span>
    shell<span class="token punctuation">.</span>SendKeys<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">)</span>
    win32gui<span class="token punctuation">.</span>SetForegroundWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    
activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_110">
     </a>
     根据窗口坐标抓取雷区图像
    </h3>
    <p>
     前面我们获取到了扫雷程序的窗口坐标，下面我就可以获取雷区的图像：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageGrab

<span class="token comment"># 根据窗口坐标抓取雷区图像</span>
rect <span class="token operator">=</span> <span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">101</span><span class="token punctuation">,</span> right<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> bottom<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
img
</code></pre>
    <p>
     <img alt="image-20210807205708705" src="https://i-blog.csdnimg.cn/blog_migrate/698c9b4d5579e07eff9e2b4715ca8c25.png"/>
    </p>
    <blockquote>
     <p>
      注意：15，101等偏移量是我对98版扫雷反复测试得到的坐标，若你使用扫雷网下载的Arbiter可能坐标会发生变化。
     </p>
    </blockquote>
    <p>
     基于雷区图像可以计算出雷盘大小：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 每个方块16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>


<span class="token keyword">def</span> <span class="token function">get_board_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 横向有w个方块</span>
    l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">101</span><span class="token punctuation">,</span> right<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> bottom<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l<span class="token punctuation">)</span> <span class="token operator">//</span> bw
    <span class="token comment"># 纵向有h个方块</span>
    h <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">//</span> bh
    <span class="token keyword">return</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b<span class="token punctuation">)</span>


<span class="token comment"># 获取雷盘大小和位置</span>
<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">,高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">，雷盘位置：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>rect<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>宽：30,高：16，雷盘位置：(1425, 108, 1905, 364)
</code></pre>
    <h3>
     <a id="_153">
     </a>
     读取剩余地雷数量
    </h3>
    <p>
     先截图显示地雷数量的图片：
    </p>
    <pre><code class="prism language-python">num_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">62</span><span class="token punctuation">,</span> left<span class="token operator">+</span><span class="token number">20</span><span class="token operator">+</span><span class="token number">39</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">62</span><span class="token operator">+</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
num_img
</code></pre>
    <p>
     <img alt="image-20210807210432831" src="https://i-blog.csdnimg.cn/blog_migrate/7d36581f18f83fcf924c759d20d6fb07.png"/>
    </p>
    <p>
     然后拆分出每个数字图像并灰度处理：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    num_i <span class="token operator">=</span> num_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>num_i<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
    display<span class="token punctuation">(</span>num_i<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20210807210712152" src="https://i-blog.csdnimg.cn/blog_migrate/8b2202f7c46b66ffc81686e120290210.png"/>
    </p>
    <p>
     把雷数设置成8后重新运行上面的代码，在执行以下代码，则可以看到各个像素点的演示值：
    </p>
    <pre><code class="prism language-python">pixels <span class="token operator">=</span> num_i<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"yx"</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>pixels<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>yx:00,01,02,03,04,05,06,07,08,09,10,
00:00,76,76,76,76,76,76,76,76,76,00,
01:76,00,76,76,76,76,76,76,76,00,76,
02:76,76,00,76,76,76,76,76,00,76,76,
03:76,76,76,00,00,00,00,00,76,76,76,
04:76,76,76,00,00,00,00,00,76,76,76,
05:76,76,76,00,00,00,00,00,76,76,76,
06:76,76,76,00,00,00,00,00,76,76,76,
07:76,76,76,00,00,00,00,00,76,76,76,
08:76,76,00,00,00,00,00,00,00,76,76,
09:76,00,76,76,76,76,76,76,76,00,76,
10:00,76,76,76,76,76,76,76,76,76,00,
11:76,00,76,76,76,76,76,76,76,00,76,
12:76,76,00,00,00,00,00,00,00,76,76,
13:76,76,76,00,00,00,00,00,76,76,76,
14:76,76,76,00,00,00,00,00,76,76,76,
15:76,76,76,00,00,00,00,00,76,76,76,
16:76,76,76,00,00,00,00,00,76,76,76,
17:76,76,76,00,00,00,00,00,76,76,76,
18:76,76,00,76,76,76,76,76,00,76,76,
19:76,00,76,76,76,76,76,76,76,00,76,
20:00,76,76,76,76,76,76,76,76,76,00,
</code></pre>
    <p>
     于是可以很清楚知道，每个数字都由7个小块组成，我们可以对这7块每块任取一个像素点获取颜色值。将这7块的颜色值是否等于76来表示一个二进制，最终转成一个整数：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_pixel_code</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    key_points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
        pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">76</span>
    code <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>key_points<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"int8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> code
</code></pre>
    <p>
     经过逐个测试，最终得到每个数字对应的特征码，最终封装成如下方法：
    </p>
    <pre><code class="prism language-python">code2num <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token number">247</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">187</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">207</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">:</span> <span class="token number">9</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">get_mine_num</span><span class="token punctuation">(</span>full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    num_img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">62</span><span class="token punctuation">,</span> left<span class="token operator">+</span><span class="token number">20</span><span class="token operator">+</span><span class="token number">39</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">62</span><span class="token operator">+</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mine_num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        num_i <span class="token operator">=</span> num_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
        code <span class="token operator">=</span> get_pixel_code<span class="token punctuation">(</span>num_i<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mine_num <span class="token operator">=</span> mine_num<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>code2num<span class="token punctuation">[</span>code<span class="token punctuation">]</span>
    <span class="token keyword">return</span> mine_num

get_mine_num<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     经测试可以准确读取，左上角雷区的数量。
    </p>
    <h3>
     <a id="_252">
     </a>
     读取雷区数据
    </h3>
    <p>
     通过以下代码可以拆分出雷区每个格子的图像：
    </p>
    <pre><code class="prism language-python">img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_block <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> bw<span class="token punctuation">,</span> y <span class="token operator">*</span> bh<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bw<span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     可以获取每个格子的灰度图片的颜色列表：
    </p>
    <pre><code class="prism language-python">colors <span class="token operator">=</span> img_block<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getcolors<span class="token punctuation">(</span><span class="token punctuation">)</span>
colors
</code></pre>
    <pre><code>[(54, 128), (148, 192), (54, 255)]
</code></pre>
    <p>
     结果表示了(出现次数，颜色值)组成的列表。
    </p>
    <p>
     为了方便匹配，将其转换为16进制并文本拼接：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">colors2signature</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> colors <span class="token keyword">for</span> b <span class="token keyword">in</span> c<span class="token punctuation">)</span>
</code></pre>
    <p>
     然后就可以得到整个雷区的每个单元格组成的特征码的分布：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter

counter <span class="token operator">=</span> Counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_block <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> bw<span class="token punctuation">,</span> y <span class="token operator">*</span> bh<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bw<span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span>
        colors <span class="token operator">=</span> img_block<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getcolors<span class="token punctuation">(</span><span class="token punctuation">)</span>
        signature <span class="token operator">=</span> colors2signature<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>
        counter<span class="token punctuation">[</span>signature<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
counter<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>[('368094c036ff', 388),
 ('4d001f8090c004ff', 87),
 ('281d1f80b9c0', 2),
 ('414b1f80a0c0', 1),
 ('3e4c1f80a3c0', 1),
 ('4d00904c1f8004ff', 1)]
</code></pre>
    <p>
     经过反复测试终于得到各种情况的特征码：
    </p>
    <pre><code class="prism language-python">rgb_unknown <span class="token operator">=</span> <span class="token string">'368094c036ff'</span>
rgb_1 <span class="token operator">=</span> <span class="token string">'281d1f80b9c0'</span>
rgb_2 <span class="token operator">=</span> <span class="token string">'414b1f80a0c0'</span>
rgb_3 <span class="token operator">=</span> <span class="token string">'3e4c1f80a3c0'</span>
rgb_4 <span class="token operator">=</span> <span class="token string">'380f1f80a9c0'</span>
rgb_5 <span class="token operator">=</span> <span class="token string">'46261f809bc0'</span>
rgb_6 <span class="token operator">=</span> <span class="token string">'485a1f8099c0'</span>
rgb_7 <span class="token operator">=</span> <span class="token string">'2c001f80b5c0'</span>
rgb_8 <span class="token operator">=</span> <span class="token string">'6b8095c0'</span>
rgb_nothing <span class="token operator">=</span> <span class="token string">'1f80e1c0'</span>
rgb_red <span class="token operator">=</span> <span class="token string">'1600114c36806dc036ff'</span>
rgb_boom <span class="token operator">=</span> <span class="token string">'4d001f8090c004ff'</span>
rgb_boom_red <span class="token operator">=</span> <span class="token string">'4d00904c1f8004ff'</span>
rgb_boom_error <span class="token operator">=</span> <span class="token string">'34002e4c1f807ec001ff'</span>
<span class="token comment"># 数字1-8表示周围有几个雷</span>
<span class="token comment">#  0 表示已经点开是空白的格子</span>
<span class="token comment"># -1 表示还没有点开的格子</span>
<span class="token comment"># -2 表示红旗所在格子</span>
<span class="token comment"># -3 表示踩到雷了已经失败</span>
img_match <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>rgb_1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> rgb_2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> rgb_3<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> rgb_4<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
             rgb_5<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> rgb_6<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> rgb_7<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> rgb_8<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> rgb_nothing<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
             rgb_unknown<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> rgb_red<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> rgb_boom<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> rgb_boom_red<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> rgb_boom_error<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">}</span>
</code></pre>
    <p>
     尝试匹配雷区数据：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
board <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int8"</span><span class="token punctuation">)</span>
board<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_block <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> bw<span class="token punctuation">,</span> y <span class="token operator">*</span> bh<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bw<span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span>
        colors <span class="token operator">=</span> img_block<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getcolors<span class="token punctuation">(</span><span class="token punctuation">)</span>
        signature <span class="token operator">=</span> colors2signature<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>
        board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> img_match<span class="token punctuation">[</span>signature<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="image-20210807220843540" src="https://i-blog.csdnimg.cn/blog_migrate/b023c4db3c9d677c76657bf6b4a14fe4.png"/>
    </p>
    <p>
     <img alt="image-20210807221133191" src="https://i-blog.csdnimg.cn/blog_migrate/6a2554890cd47b035f3995f0e944c2ff.png"/>
    </p>
    <p>
     可以看到雷区的数据都能正确匹配并获取。
    </p>
    <h3>
     <a id="_356">
     </a>
     自动操作扫雷程序
    </h3>
    <p>
     下面我们封装一个控制鼠标点击的方法：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32api
<span class="token keyword">import</span> win32con


<span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> l<span class="token operator">+</span>px<span class="token operator">*</span>bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> t<span class="token operator">+</span>py<span class="token operator">*</span>bh <span class="token operator">+</span> <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>
</code></pre>
    <p>
     调用示例：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> win32con

activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>
click_mine_area<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre>
    <blockquote>
     <p>
      注意：第一次操作程序，需要点击激活窗口，激活需要等待几毫秒生效后开始操作。
     </p>
    </blockquote>
    <p>
     <strong>
      更快的操作方法：
     </strong>
    </p>
    <p>
     可以直接发生windows消息，来模拟鼠标操作，这样组件直接在底层消息级别接收到鼠标点击的事件，缺点是看不到鼠标的移动。封装一下：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">message_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 雷区格子在窗体上的起始坐标</span>
offest_x<span class="token punctuation">,</span> offest_y <span class="token operator">=</span> <span class="token number">0xC</span><span class="token punctuation">,</span> <span class="token number">0x37</span>
<span class="token comment"># 每个格子方块的宽度和高度 16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>

<span class="token keyword">def</span> <span class="token function">message_click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> offest_x<span class="token operator">+</span>px<span class="token operator">*</span>bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> offest_y<span class="token operator">+</span>py<span class="token operator">*</span>bh <span class="token operator">+</span> <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    message_click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>
</code></pre>
    <p>
     调用示例：
    </p>
    <pre><code class="prism language-python">message_click_mine_area<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
    <blockquote>
     <p>
      注意：windows消息级的鼠标操作不需要激活窗口就可以直接操作。
     </p>
    </blockquote>
    <h3>
     <a id="_444">
     </a>
     前端交互程序整体封装
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32api
<span class="token keyword">import</span> win32con
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> win32com<span class="token punctuation">.</span>client <span class="token keyword">as</span> win32
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageGrab
<span class="token keyword">import</span> win32gui


<span class="token comment"># 每个方块16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>
<span class="token comment"># 剩余雷数图像特征码</span>
code2num <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token number">247</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">187</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">207</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">:</span> <span class="token number">9</span>
<span class="token punctuation">}</span>
<span class="token comment"># 雷区图像特征码</span>
rgb_unknown <span class="token operator">=</span> <span class="token string">'368094c036ff'</span>
rgb_1 <span class="token operator">=</span> <span class="token string">'281d1f80b9c0'</span>
rgb_2 <span class="token operator">=</span> <span class="token string">'414b1f80a0c0'</span>
rgb_3 <span class="token operator">=</span> <span class="token string">'3e4c1f80a3c0'</span>
rgb_4 <span class="token operator">=</span> <span class="token string">'380f1f80a9c0'</span>
rgb_5 <span class="token operator">=</span> <span class="token string">'46261f809bc0'</span>
rgb_6 <span class="token operator">=</span> <span class="token string">'485a1f8099c0'</span>
rgb_7 <span class="token operator">=</span> <span class="token string">'2c001f80b5c0'</span>
rgb_8 <span class="token operator">=</span> <span class="token string">'6b8095c0'</span>
rgb_nothing <span class="token operator">=</span> <span class="token string">'1f80e1c0'</span>
rgb_red <span class="token operator">=</span> <span class="token string">'1600114c36806dc036ff'</span>
rgb_boom <span class="token operator">=</span> <span class="token string">'4d001f8090c004ff'</span>
rgb_boom_red <span class="token operator">=</span> <span class="token string">'4d00904c1f8004ff'</span>
rgb_boom_error <span class="token operator">=</span> <span class="token string">'34002e4c1f807ec001ff'</span>
rgb_question <span class="token operator">=</span> <span class="token string">'180036807cc036ff'</span>
<span class="token comment"># 数字1-8表示周围有几个雷</span>
<span class="token comment">#  0 表示已经点开是空白的格子</span>
<span class="token comment"># -1 表示还没有点开的格子</span>
<span class="token comment"># -2 表示红旗所在格子</span>
<span class="token comment"># -3 表示踩到雷了已经失败</span>
<span class="token comment"># -4 表示被玩家自己标记为问号</span>
img_match <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>rgb_1<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> rgb_2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> rgb_3<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> rgb_4<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
             rgb_5<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> rgb_6<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> rgb_7<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> rgb_8<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> rgb_nothing<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
             rgb_unknown<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> rgb_red<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> rgb_boom<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> rgb_boom_red<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>
             rgb_boom_error<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> rgb_question<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">}</span>
<span class="token comment"># 雷区格子在窗体上的起始坐标</span>
offest_x<span class="token punctuation">,</span> offest_y <span class="token operator">=</span> <span class="token number">0xC</span><span class="token punctuation">,</span> <span class="token number">0x37</span>


<span class="token keyword">def</span> <span class="token function">get_board_size</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    <span class="token comment"># 横向有w个方块</span>
    l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">101</span><span class="token punctuation">,</span> right<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> bottom<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l<span class="token punctuation">)</span> <span class="token operator">//</span> bw
    <span class="token comment"># 纵向有h个方块</span>
    h <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">//</span> bh
    <span class="token keyword">return</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_pixel_code</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    key_points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
        pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">76</span>
    code <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>key_points<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"int8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> code


<span class="token keyword">def</span> <span class="token function">get_mine_num</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> full_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    num_img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">62</span><span class="token punctuation">,</span> left<span class="token operator">+</span><span class="token number">20</span><span class="token operator">+</span><span class="token number">39</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">62</span><span class="token operator">+</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mine_num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        num_i <span class="token operator">=</span> num_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
        code <span class="token operator">=</span> get_pixel_code<span class="token punctuation">(</span>num_i<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mine_num <span class="token operator">=</span> mine_num<span class="token operator">*</span><span class="token number">10</span><span class="token operator">+</span>code2num<span class="token punctuation">[</span>code<span class="token punctuation">]</span>
    <span class="token keyword">return</span> mine_num


<span class="token keyword">def</span> <span class="token function">colors2signature</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> colors <span class="token keyword">for</span> b <span class="token keyword">in</span> c<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">update_board</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> full_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    rect <span class="token operator">=</span> <span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">,</span> top<span class="token operator">+</span><span class="token number">101</span><span class="token punctuation">,</span> right<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> bottom<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
            img_block <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> bw<span class="token punctuation">,</span> y <span class="token operator">*</span> bh<span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bw<span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bh<span class="token punctuation">)</span><span class="token punctuation">)</span>
            colors <span class="token operator">=</span> img_block<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getcolors<span class="token punctuation">(</span><span class="token punctuation">)</span>
            signature <span class="token operator">=</span> colors2signature<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>
            board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> img_match<span class="token punctuation">[</span>signature<span class="token punctuation">]</span>
    <span class="token keyword">return</span> board


<span class="token keyword">def</span> <span class="token function">get_hwnd</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"扫雷"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">"扫雷"</span><span class="token punctuation">:</span>
        class_name<span class="token punctuation">,</span> title_name <span class="token operator">=</span> <span class="token string">"扫雷"</span><span class="token punctuation">,</span> <span class="token string">"扫雷"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        class_name<span class="token punctuation">,</span> title_name <span class="token operator">=</span> <span class="token string">"TMain"</span><span class="token punctuation">,</span> <span class="token string">"Minesweeper Arbiter "</span>
    <span class="token keyword">return</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">activateWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># SetForegroundWindow调用有一些限制，我们可以再调用之前输入一个键盘事件</span>
    shell <span class="token operator">=</span> win32<span class="token punctuation">.</span>Dispatch<span class="token punctuation">(</span><span class="token string">"WScript.Shell"</span><span class="token punctuation">)</span>
    shell<span class="token punctuation">.</span>SendKeys<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">)</span>
    win32gui<span class="token punctuation">.</span>SetForegroundWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">new_board</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    board <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int8"</span><span class="token punctuation">)</span>
    board<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> board


<span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> l<span class="token operator">+</span>px<span class="token operator">*</span>bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> t<span class="token operator">+</span>py<span class="token operator">*</span>bh <span class="token operator">+</span> <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">message_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">message_click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> offest_x<span class="token operator">+</span>px<span class="token operator">*</span>bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> offest_y<span class="token operator">+</span>py<span class="token operator">*</span>bh <span class="token operator">+</span> <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    message_click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>


hwnd <span class="token operator">=</span> get_hwnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token comment"># 获取雷盘大小和位置</span>
<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">,高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">，雷盘位置：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>rect<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
mine_num <span class="token operator">=</span> get_mine_num<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"剩余雷数："</span><span class="token punctuation">,</span> mine_num<span class="token punctuation">)</span>
board <span class="token operator">=</span> new_board<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token comment"># message_click_mine_area(5, 5)</span>
update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span>
</code></pre>
    <p>
     新开中级后，测试一下：
    </p>
    <pre><code class="prism language-python">hwnd <span class="token operator">=</span> get_hwnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token comment"># 获取雷盘大小和位置</span>
<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">,高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">，雷盘位置：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>rect<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
mine_num <span class="token operator">=</span> get_mine_num<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"剩余雷数："</span><span class="token punctuation">,</span> mine_num<span class="token punctuation">)</span>
board <span class="token operator">=</span> new_board<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
message_click_mine_area<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span>
</code></pre>
    <pre><code>宽：16,高：16，雷盘位置：(230, 240, 486, 496)
剩余雷数： 40
[[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1  1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
 [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]]
</code></pre>
    <h2>
     <a id="_662">
     </a>
     自动扫雷算法
    </h2>
    <h3>
     <a id="Monkey_664">
     </a>
     Monkey随机算法玩中级扫雷
    </h3>
    <p>
     在完成了前面的前端交互程序后，我们就可以开始开发自动扫雷的算法逻辑了。首先用一个最基础的规则玩中级。
    </p>
    <p>
     基础规则：
    </p>
    <ul>
     <li>
      如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗
     </li>
     <li>
      如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开
     </li>
     <li>
      遍历完所有位置后，未发现能够点开或标记为雷的点，则随机选一个点
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">from</span> itertools <span class="token keyword">import</span> product
<span class="token keyword">import</span> time
<span class="token keyword">import</span> random
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter


<span class="token keyword">def</span> <span class="token function">get_bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标周围4*4-9*9的边界范围"</span>
    x1<span class="token punctuation">,</span> x2 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span>
    y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span>
    <span class="token keyword">return</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2


<span class="token keyword">def</span> <span class="token function">getItemNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围已经点开、没有点开和已确定有雷的格子的数量"</span>
    <span class="token comment">#  0 表示已经点开是空白的格子</span>
    <span class="token comment"># -1 表示还没有点开的格子</span>
    <span class="token comment"># -2 表示红旗所在格子</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    count <span class="token operator">=</span> Counter<span class="token punctuation">(</span>board<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> count<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> count<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">getUnknownPointList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围还没有点开的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


hwnd <span class="token operator">=</span> get_hwnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token comment"># 获取雷盘大小和位置</span>
<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">,高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">，雷盘位置：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>rect<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
mine_num <span class="token operator">=</span> get_mine_num<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"剩余雷数："</span><span class="token punctuation">,</span> mine_num<span class="token punctuation">)</span>
board <span class="token operator">=</span> new_board<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
<span class="token comment"># 点击剩余雷数位置激活窗口</span>
l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> rect
click<span class="token punctuation">(</span>l<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">,</span> t<span class="token operator">-</span><span class="token number">30</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token comment"># 标记周围已经完全确定的数字位置</span>
flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 筛选出所有未确定的数字位置   坐标</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>board <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        boom_number <span class="token operator">=</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span>
        <span class="token comment"># 统计当前点周围4*4-9*9范围各类点的数量</span>
        openNum<span class="token punctuation">,</span> unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 周围没有未点过的点可以直接忽略</span>
            flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">continue</span>
        <span class="token comment"># 获取周围的点的位置</span>
        points <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> boom_number <span class="token operator">==</span> unknownNum<span class="token operator">+</span>redNum<span class="token punctuation">:</span>
            <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
            flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> points<span class="token punctuation">:</span>
                res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> boom_number <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
            flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> points<span class="token punctuation">:</span>
                res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> left <span class="token keyword">in</span> res<span class="token punctuation">:</span>
        click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> left<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 本轮循环没有进行任何操作，说明没有任何可以确定点击的地方，只能随机点击</span>
        py<span class="token punctuation">,</span> px <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"顺利！！！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"踩到雷了，游戏结束！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
</code></pre>
    <p>
     然后就可以体验一把中级了：
    </p>
    <p>
     <img alt="录制_2021_08_08_00_10_30_147" src="https://i-blog.csdnimg.cn/blog_migrate/097cded91264fcf4bf62a7a812b2ed2e.gif"/>
    </p>
    <p>
     不过据说中级世界纪录仅7秒：
    </p>
    <p>
     啧啧，程序会比人玩的还慢？那我缩小一下延迟，再玩一下：
    </p>
    <p>
     <img alt="录制_2021_08_08_00_20_44_891" src="https://i-blog.csdnimg.cn/blog_migrate/a2e02af56171999880184ca90b66a551.gif"/>
    </p>
    <p>
     不过咱们要是用这种取随机的方法来玩高级，胜率简直会惨不忍睹：
    </p>
    <p>
     <img alt="录制_2021_08_08_00_25_17_67" src="https://i-blog.csdnimg.cn/blog_migrate/85e654776c29a5aabf33640adc654cf9.gif"/>
    </p>
    <h3>
     <a id="_782">
     </a>
     基于概率分析的扫雷算法
    </h3>
    <p>
     前面的基本规则在高级下，胜率过于低下，下面我们完善我们的扫描算法。
    </p>
    <p>
     熟悉扫雷的高玩们都非常清楚扫雷的减法公式，21定式和变形等。不过对于程序而言不见得一定要记录这些固定规则，经过实测基于概率模型已经能够包含所有的定式结果。
    </p>
    <h4>
     <a id="_788">
     </a>
     算法的总体思想
    </h4>
    <p>
     对于一个雷区，是否有雷会存在多个互相制约的联通块区域，不同联通块之间不存在互相制约。例如下面的雷区存在两个联通块区域：
    </p>
    <p>
     <img alt="image-20210808205114187" src="https://i-blog.csdnimg.cn/blog_migrate/9b1d6110bf8cd861dbc6d26c5c7f539a.png"/>
    </p>
    <p>
     对于每一个连通块共有n个格子没有打开，每个格子都存在有雷和没有雷两种情况，那么至多存在
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        2 
          
         
           n 
          
         
        
       
      
        \large 2^n
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.780048em; vertical-align: 0em;">
         </span>
         <span class="mord sizing reset-size6 size7">
          <span class="mord">
           2
          </span>
          <span class="msupsub">
           <span class="vlist-t">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.65004em;">
              <span class="" style="top: -3.163em; margin-right: 0.0416667em;">
               <span class="pstrut" style="height: 2.8em;">
               </span>
               <span class="sizing reset-size7 size4 mtight">
                <span class="mord mathdefault mtight">
                 n
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     种可能的解，除与已知格子矛盾的解后一共有m种可能的解。我们统计出每一个格子在多少种解中是有雷的，除以m就得到这一格是雷的概率。显然当概率百分比等于0时，一定不是雷；当概率百分比等于100时，一定是雷。
    </p>
    <p>
     如果没有概率等于0或100的格子，则需要根据概率取有雷概率最低的格子，多个格子概率最低时取周围未点开格子数最多的格子。
    </p>
    <h4>
     <a id="_798">
     </a>
     搜索连通区域
    </h4>
    <p>
     首先第一步，我们需要找出这些连通区域的坐标：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getOpenNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子的数量"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            num <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num


<span class="token keyword">def</span> <span class="token function">srhAdjBlock</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"搜索与数字位置相邻的未打开块，,使用flags标记已经访问过的位置"</span>
    stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    block <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> stack<span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> flags<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        flags<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        block<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> flags<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token keyword">or</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> block

update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>

flags <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
<span class="token comment"># 联通块列表</span>
block_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># 孤立位置列表</span>
single_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flags<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">if</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>srhAdjBlock<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        single_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     为了查看我们找到的连通块是否准确，我定义了如下方法进行测试：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">show_dest_area</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> area<span class="token punctuation">:</span>
        message_click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        message_click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> area<span class="token punctuation">:</span>
        message_click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> img

activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"single:"</span><span class="token punctuation">)</span>
display<span class="token punctuation">(</span>show_dest_area<span class="token punctuation">(</span>single_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"block:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> block <span class="token keyword">in</span> block_list<span class="token punctuation">:</span>
    display<span class="token punctuation">(</span>show_dest_area<span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     通过二次右击得到的问号知道每个连通块区域的位置（运行完会自动清除问号，只留下图像）：
    </p>
    <p>
     <img alt="image-20210808211543786" src="https://i-blog.csdnimg.cn/blog_migrate/f2fe63e96d4f2f3daafc87b2a8b02722.png"/>
    </p>
    <h4>
     <a id="_873">
     </a>
     统计每个连通块中的每个格子在多少种解中是有雷的
    </h4>
    <p>
     在拆分出连通块区域后，我们就可以开始统计统计每个连通块中的每个格子在多少种解中是有雷的。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getOpenNumList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


<span class="token keyword">def</span> <span class="token function">update_block</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 根据随机算法的基础规则更新board周边块</span>
    result<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getOpenNumList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 实际雷数 小于 标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token comment"># 实际雷数 大于 未点开的格子数量+标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&gt;</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        unknownPoints <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
        <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 9表示临时无雷标记</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">updateNm2schemeCnt</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据搜索得到的方案更新 nm2schemeCnt"</span>
    nm <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>mine_flag<span class="token punctuation">)</span>
    <span class="token keyword">if</span> nm <span class="token keyword">not</span> <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>  <span class="token comment"># 新增一种方案</span>
        nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> mine_flag<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 更新</span>
        v <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
        v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> mine_flag


<span class="token keyword">def</span> <span class="token function">srhScheme</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param block: 连通块中的格子列表
    :param mine_flag: 是否有雷标记列表
    :param k: 从位置k开始搜索所有可行方案，结果存储于 nm2schemeCnt
    :param nm2schemeCnt: nm:(t,lstcellCnt)，
    代表这个联通块中,假设有nm颗雷的情况下共有t种方案，
    lstcellCnt表示各个格子中共有其中几种方案有雷
    :return: 
    """</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 两种可能：有雷、无雷</span>
        <span class="token comment"># 9作为作为临时无雷标记，-2作为临时有雷标记</span>
        <span class="token keyword">for</span> m<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># m和n 对应了无雷和有雷两种情况下的标记</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> m
            board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> n
            <span class="token comment"># 根据基础规则更新周围点的标记，返回更新格子列表和成功标记</span>
            <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                    updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token comment"># 恢复</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
                board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token comment"># 恢复</span>
        board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 有雷</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 无雷</span>
        <span class="token comment"># 根据规则1判断并更新周边块board标记，返回更新格子列表和成功标记</span>
        <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        <span class="token comment"># 恢复</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
</code></pre>
    <p>
     调用：
    </p>
    <pre><code class="prism language-python">nm2schemeCnt_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
nmin <span class="token operator">=</span> <span class="token number">0</span>
nmax <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> block <span class="token keyword">in</span> block_list<span class="token punctuation">:</span>
    <span class="token comment"># 搜索联通块k的可行方案</span>
    <span class="token comment"># 当前连通块中，每个可能的总雷数对应的方案数和每个格子在其中几种方案下有雷</span>
    nm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    mine_flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int16'</span><span class="token punctuation">)</span>
    srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
    nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
    nmin <span class="token operator">+=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
    nmax <span class="token operator">+=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
nm2schemeCnt_list
</code></pre>
    <pre><code>[{10: [28,
   array([ 4,  4,  4,  4,  4,  4,  0,  0,  0,  0,  0,  0,  0,  0, 14,  0,  0,
           0,  0,  0, 14, 14,  0, 28,  0,  0,  0, 14,  4, 14, 14, 24,  0, 28,
          24,  4,  4, 24, 16, 12,  4], dtype=int16)],
  11: [136,
   array([ 20,  20,  20,  20,  20,  16,  24,   0,   0,   0,   0,   0,   0,
            0,  68,   0,   0,   0,  14,  14,  54,  54, 112,  52,  28,  28,
           28,  68,  40,  54,  82,  96,   0, 136,  96,  40,  40,  96,  80,
           56,  20], dtype=int16)],
  12: [96,
   array([16, 16, 16, 16, 16,  0, 96,  0,  0,  0,  0,  0,  0,  0, 48,  0,  0,
           0, 12, 12, 36, 36, 96, 24, 24, 24, 24, 48, 96, 36, 60,  0,  0, 96,
           0, 96, 96,  0, 64, 32, 16], dtype=int16)]},
 {1: [3, array([1, 1, 1], dtype=int16)]}]
</code></pre>
    <h4>
     <a id="_1009">
     </a>
     考虑剩余雷数，计算精确概率
    </h4>
    <p>
     因为有剩余雷数的限制，联通块内部的概率并不准确。
    </p>
    <p>
     在枚举过程中，对每个联通块我们可以统计出
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        b 
         
        
          l 
         
        
          o 
         
        
          c 
         
        
          k 
         
        
          C 
         
        
          n 
         
         
         
           t 
          
         
           s 
          
         
        
       
      
        \Large blockCnt_{s}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.21599em; vertical-align: -0.216em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          b
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.01968em;">
          l
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          o
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          c
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.03148em;">
          k
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.07153em;">
          C
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          n
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault">
           t
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.149em;">
              <span class="" style="top: -2.85em; margin-left: 0em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     ，代表这个联通块的未知格中一共有 s 颗雷的方案数。 对每个格子 x 可以统计出:
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        c 
         
        
          e 
         
        
          l 
         
        
          l 
         
        
          C 
         
        
          n 
         
         
         
           t 
          
          
          
            x 
           
          
            , 
           
          
            s 
           
          
         
        
       
      
        \Large cellCnt_{x,s}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.41043em; vertical-align: -0.41044em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          c
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          e
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.01968em;">
          l
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.01968em;">
          l
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.07153em;">
          C
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          n
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault">
           t
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.149em;">
              <span class="" style="top: -2.85em; margin-left: 0em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  x
                 </span>
                 <span class="mpunct mtight">
                  ,
                 </span>
                 <span class="mord mathdefault mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.285028em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     代表当格子所在的联通块中一共有 s 颗雷时，多少种方案中这个 x 格子是雷。
    </p>
    <p>
     那么我们依次考虑每个格子的胜率。除开格子本身所在的联通块不看，考虑其它所有联通块（假设一共有
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        n 
        
       
      
        n
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.43056em; vertical-align: 0em;">
         </span>
         <span class="mord mathdefault">
          n
         </span>
        </span>
       </span>
      </span>
     </span>
     个连通块），我们可以计算出计算
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        D 
         
         
         
           P 
          
          
          
            i 
           
          
            , 
           
          
            j 
           
          
         
        
       
      
        \Large DP_{i,j}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.39444em; vertical-align: -0.41044em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.02778em;">
          D
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault" style="margin-right: 0.13889em;">
           P
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.308em;">
              <span class="" style="top: -2.85em; margin-left: -0.13889em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  i
                 </span>
                 <span class="mpunct mtight">
                  ,
                 </span>
                 <span class="mord mathdefault mtight" style="margin-right: 0.05724em;">
                  j
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.285028em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     代表前
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        i 
        
       
      
        i
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.65952em; vertical-align: 0em;">
         </span>
         <span class="mord mathdefault">
          i
         </span>
        </span>
       </span>
      </span>
     </span>
     个连通块共
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        j 
        
       
      
        j
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;">
         </span>
         <span class="mord mathdefault" style="margin-right: 0.05724em;">
          j
         </span>
        </span>
       </span>
      </span>
     </span>
     个雷的方案数，这里是一个背包问题，转移方程：
    </p>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         D 
          
          
          
            P 
           
           
           
             i 
            
           
             , 
            
           
             j 
            
           
          
         
           = 
          
          
          
            ∑ 
           
           
           
             s 
            
           
             = 
            
           
             0 
            
           
           
           
             m 
            
           
             a 
            
           
             x 
            
           
          
          
          
            D 
           
           
           
             P 
            
            
            
              i 
             
            
              − 
             
            
              1 
             
            
              , 
             
            
              j 
             
            
              − 
             
            
              s 
             
            
           
          
            ∗ 
           
          
            b 
           
          
            l 
           
          
            o 
           
          
            c 
           
          
            k 
           
          
            C 
           
          
            n 
           
           
           
             t 
            
           
             s 
            
           
          
         
        
       
         \Large DP_{i,j} = \sum_{s = 0}^{max}{DP_{i-1, j-s} * blockCnt_s}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.39444em; vertical-align: -0.41044em;">
          </span>
          <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.02778em;">
           D
          </span>
          <span class="mord sizing reset-size6 size8">
           <span class="mord mathdefault" style="margin-right: 0.13889em;">
            P
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.308em;">
               <span class="" style="top: -2.85em; margin-left: -0.13889em; margin-right: 0.0347222em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size8 size6 mtight">
                 <span class="mord mtight">
                  <span class="mord mathdefault mtight">
                   i
                  </span>
                  <span class="mpunct mtight">
                   ,
                  </span>
                  <span class="mord mathdefault mtight" style="margin-right: 0.05724em;">
                   j
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.285028em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
          <span class="mrel sizing reset-size6 size8">
           =
          </span>
          <span class="mspace" style="margin-right: 0.277778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 4.19405em; vertical-align: -1.81949em;">
          </span>
          <span class="mop op-limits sizing reset-size6 size8">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 1.64901em;">
              <span class="" style="top: -2.27647em; margin-left: 0em;">
               <span class="pstrut" style="height: 3.44em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  s
                 </span>
                 <span class="mrel mtight">
                  =
                 </span>
                 <span class="mord mtight">
                  0
                 </span>
                </span>
               </span>
              </span>
              <span class="" style="top: -3.44001em;">
               <span class="pstrut" style="height: 3.44em;">
               </span>
               <span class="">
                <span class="mop op-symbol large-op">
                 ∑
                </span>
               </span>
              </span>
              <span class="" style="top: -4.69001em; margin-left: 0em;">
               <span class="pstrut" style="height: 3.44em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  m
                 </span>
                 <span class="mord mathdefault mtight">
                  a
                 </span>
                 <span class="mord mathdefault mtight">
                  x
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 1.26353em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.166667em;">
          </span>
          <span class="mord sizing reset-size6 size8">
           <span class="mord mathdefault" style="margin-right: 0.02778em;">
            D
           </span>
           <span class="mord">
            <span class="mord mathdefault" style="margin-right: 0.13889em;">
             P
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.308em;">
                <span class="" style="top: -2.85em; margin-left: -0.13889em; margin-right: 0.0347222em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="sizing reset-size8 size6 mtight">
                  <span class="mord mtight">
                   <span class="mord mathdefault mtight">
                    i
                   </span>
                   <span class="mbin mtight">
                    −
                   </span>
                   <span class="mord mtight">
                    1
                   </span>
                   <span class="mpunct mtight">
                    ,
                   </span>
                   <span class="mord mathdefault mtight" style="margin-right: 0.05724em;">
                    j
                   </span>
                   <span class="mbin mtight">
                    −
                   </span>
                   <span class="mord mathdefault mtight">
                    s
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.285028em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.222222em;">
           </span>
           <span class="mbin">
            ∗
           </span>
           <span class="mspace" style="margin-right: 0.222222em;">
           </span>
           <span class="mord mathdefault">
            b
           </span>
           <span class="mord mathdefault" style="margin-right: 0.01968em;">
            l
           </span>
           <span class="mord mathdefault">
            o
           </span>
           <span class="mord mathdefault">
            c
           </span>
           <span class="mord mathdefault" style="margin-right: 0.03148em;">
            k
           </span>
           <span class="mord mathdefault" style="margin-right: 0.07153em;">
            C
           </span>
           <span class="mord mathdefault">
            n
           </span>
           <span class="mord">
            <span class="mord mathdefault">
             t
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.149em;">
                <span class="" style="top: -2.85em; margin-left: 0em; margin-right: 0.0347222em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="sizing reset-size8 size6 mtight">
                  <span class="mord mathdefault mtight">
                   s
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     假设当前剩下
     <strong>
      mine
     </strong>
     个雷，枚举当前格子所在联通块的雷数
     <strong>
      s
     </strong>
     ，有
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        b 
         
        
          l 
         
        
          o 
         
        
          c 
         
        
          k 
         
        
          C 
         
        
          n 
         
         
         
           t 
          
         
           s 
          
         
        
          ∗ 
         
        
          D 
         
         
         
           P 
          
          
          
            n 
           
          
            − 
           
          
            1 
           
          
            , 
           
          
            m 
           
          
            i 
           
          
            n 
           
          
            e 
           
          
            − 
           
          
            s 
           
          
         
        
       
      
        \Large blockCnt_s * DP_{n-1,mine - s}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.21599em; vertical-align: -0.216em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          b
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.01968em;">
          l
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          o
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          c
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.03148em;">
          k
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.07153em;">
          C
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          n
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault">
           t
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.149em;">
              <span class="" style="top: -2.85em; margin-left: 0em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mathdefault mtight">
                 s
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.222222em;">
         </span>
         <span class="mbin sizing reset-size6 size8">
          ∗
         </span>
         <span class="mspace" style="margin-right: 0.222222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1.39444em; vertical-align: -0.41044em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.02778em;">
          D
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault" style="margin-right: 0.13889em;">
           P
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.308em;">
              <span class="" style="top: -2.85em; margin-left: -0.13889em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  n
                 </span>
                 <span class="mbin mtight">
                  −
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                 <span class="mpunct mtight">
                  ,
                 </span>
                 <span class="mord mathdefault mtight">
                  m
                 </span>
                 <span class="mord mathdefault mtight">
                  i
                 </span>
                 <span class="mord mathdefault mtight">
                  n
                 </span>
                 <span class="mord mathdefault mtight">
                  e
                 </span>
                 <span class="mbin mtight">
                  −
                 </span>
                 <span class="mord mathdefault mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.285028em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     种可行方案，其中
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        c 
         
        
          e 
         
        
          l 
         
        
          l 
         
        
          C 
         
        
          n 
         
         
         
           t 
          
          
          
            x 
           
          
            , 
           
          
            s 
           
          
         
        
          ∗ 
         
        
          D 
         
         
         
           P 
          
          
          
            n 
           
          
            − 
           
          
            1 
           
          
            , 
           
          
            m 
           
          
            i 
           
          
            n 
           
          
            e 
           
          
            − 
           
          
            s 
           
          
         
        
       
      
        \Large cellCnt_{x, s} * DP_{n - 1, mine - s}
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.41043em; vertical-align: -0.41044em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          c
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          e
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.01968em;">
          l
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.01968em;">
          l
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.07153em;">
          C
         </span>
         <span class="mord mathdefault sizing reset-size6 size8">
          n
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault">
           t
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.149em;">
              <span class="" style="top: -2.85em; margin-left: 0em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  x
                 </span>
                 <span class="mpunct mtight">
                  ,
                 </span>
                 <span class="mord mathdefault mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.285028em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mspace" style="margin-right: 0.222222em;">
         </span>
         <span class="mbin sizing reset-size6 size8">
          ∗
         </span>
         <span class="mspace" style="margin-right: 0.222222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 1.39444em; vertical-align: -0.41044em;">
         </span>
         <span class="mord mathdefault sizing reset-size6 size8" style="margin-right: 0.02778em;">
          D
         </span>
         <span class="mord sizing reset-size6 size8">
          <span class="mord mathdefault" style="margin-right: 0.13889em;">
           P
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.308em;">
              <span class="" style="top: -2.85em; margin-left: -0.13889em; margin-right: 0.0347222em;">
               <span class="pstrut" style="height: 3em;">
               </span>
               <span class="sizing reset-size8 size6 mtight">
                <span class="mord mtight">
                 <span class="mord mathdefault mtight">
                  n
                 </span>
                 <span class="mbin mtight">
                  −
                 </span>
                 <span class="mord mtight">
                  1
                 </span>
                 <span class="mpunct mtight">
                  ,
                 </span>
                 <span class="mord mathdefault mtight">
                  m
                 </span>
                 <span class="mord mathdefault mtight">
                  i
                 </span>
                 <span class="mord mathdefault mtight">
                  n
                 </span>
                 <span class="mord mathdefault mtight">
                  e
                 </span>
                 <span class="mbin mtight">
                  −
                 </span>
                 <span class="mord mathdefault mtight">
                  s
                 </span>
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.285028em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     种方案中当前格有雷，对这两个值分别求和，就可以得到当前格有雷的精确概率。
    </p>
    <p>
     首先向前面的方案列表加入孤立位置列表，使剩余格子参与概率计算：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 如果非联通块中包含的雷数大于0，考虑剩余雷数对概率影响</span>
<span class="token keyword">if</span> single_list<span class="token punctuation">:</span>
    block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
    rnm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment"># 剩余格子概率计算</span>
    n2 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nmin<span class="token punctuation">,</span> nmax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        n1 <span class="token operator">=</span> mine_num <span class="token operator">-</span> i
        mine_flag <span class="token operator">=</span> <span class="token punctuation">[</span>n1 <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">]</span>
        rnm2schemeCnt<span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>n2<span class="token punctuation">,</span> mine_flag<span class="token punctuation">]</span>
    nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rnm2schemeCnt<span class="token punctuation">)</span>
</code></pre>
    <p>
     然后进行计算：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 考虑剩余雷数的可能方案数计算</span>
<span class="token keyword">def</span> <span class="token function">calDP</span><span class="token punctuation">(</span>lk<span class="token punctuation">,</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ndp <span class="token operator">=</span> <span class="token number">0</span>
    k <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    nm2schemeCnt <span class="token operator">=</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> nm <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
            ndp <span class="token operator">=</span> cnt
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> k1 <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            lk1 <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            n1 <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk1<span class="token punctuation">,</span> nm <span class="token operator">-</span> k1<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>k1<span class="token punctuation">]</span>
            ndp <span class="token operator">+=</span> n1 <span class="token operator">*</span> cnt
    <span class="token keyword">return</span> ndp


pboard <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int8"</span><span class="token punctuation">)</span>
<span class="token comment"># 基准有雷概率百分比</span>
pboard<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>mine_num<span class="token operator">*</span><span class="token number">100</span><span class="token operator">//</span>nb<span class="token punctuation">)</span>

<span class="token comment"># 计算概率</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    lk <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> t <span class="token operator">!=</span> k<span class="token punctuation">]</span>
    <span class="token comment"># 考虑剩余雷数的可能方案数计算</span>
    NBcnt <span class="token operator">=</span> <span class="token number">0</span>
    block <span class="token operator">=</span> block_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    Ncnt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
    <span class="token keyword">for</span> nm<span class="token punctuation">,</span> <span class="token punctuation">(</span>cnt<span class="token punctuation">,</span> cnt_list<span class="token punctuation">)</span> <span class="token keyword">in</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            ndp <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk<span class="token punctuation">,</span> mine_num <span class="token operator">-</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            ndp <span class="token operator">=</span> <span class="token number">1</span>
        NBcnt <span class="token operator">+=</span> cnt <span class="token operator">*</span> ndp
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> cnt_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> ndp
    <span class="token comment"># print("k,NBcnt,Ncnt=",k,NBcnt,Ncnt)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> NBcnt
</code></pre>
    <h4>
     <a id="_1082">
     </a>
     基于概率的贪心算法
    </h4>
    <p>
     思想：如果没有确定有雷或无雷的格子，那么点击概率最小的格子，概率相同时点附近5*5的地图里未点开格子数最少的格子。
    </p>
    <p>
     首先筛选出筛选出有雷概率为100和0的位置，用于后续点击和标记：
    </p>
    <pre><code class="prism language-python">pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">:</span>
        <span class="token comment"># 有雷概率为100说明必定有雷，插旗</span>
        res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 有雷概率为0说明必定没有雷，点开</span>
        res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
res
</code></pre>
    <pre><code>{(8, 10, True),
 (9, 10, True),
 (10, 10, True),
 (12, 9, True),
 (13, 7, True),
 (13, 9, True),
 (14, 9, True),
 (15, 7, False),
 (15, 9, True),
 (16, 7, True),
 (16, 8, True),
 (16, 9, True)}
</code></pre>
    <p>
     一下子就找出了这么多确定有雷和无雷的格子。
    </p>
    <p>
     通过以下代码全部点击掉：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">for</span> r <span class="token keyword">in</span> res<span class="token punctuation">:</span>
    message_click_mine_area<span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span>
</code></pre>
    <p>
     假如没有必定有雷和无雷的位置就只能基于概率进行选取：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token comment"># 计算最小比例列表</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>pboard <span class="token operator">==</span> pboard<span class="token punctuation">[</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
        <span class="token comment"># 超过10个以上这样的点则随机选一个</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 否则取周围未点开格子最少的格子</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> key<span class="token operator">=</span>getFiveMapNum<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> res
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_1143">
     </a>
     概率分析算法代码的整体封装
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">getOpenNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子的数量"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            num <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num


<span class="token keyword">def</span> <span class="token function">srhAdjBlock</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"搜索与数字位置相邻的未打开块，,使用flags标记已经访问过的位置"</span>
    stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    block <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> stack<span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> flags<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        flags<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        block<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> flags<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token keyword">or</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> block


<span class="token keyword">def</span> <span class="token function">getOpenNumList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


<span class="token keyword">def</span> <span class="token function">update_block</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据随机算法的基础规则更新board周边块"</span>
    result<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getOpenNumList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 实际雷数 小于 标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token comment"># 实际雷数 大于 未点开的格子数量+标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&gt;</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        unknownPoints <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
        <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 9表示临时无雷标记</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">updateNm2schemeCnt</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据搜索得到的方案更新 nm2schemeCnt"</span>
    nm <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>mine_flag<span class="token punctuation">)</span>
    <span class="token keyword">if</span> nm <span class="token keyword">not</span> <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>  <span class="token comment"># 新增一种方案</span>
        nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> mine_flag<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 更新</span>
        v <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
        v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> mine_flag


<span class="token keyword">def</span> <span class="token function">srhScheme</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param block: 连通块中的格子列表
    :param mine_flag: 是否有雷标记列表
    :param k: 从位置k开始搜索所有可行方案，结果存储于 nm2schemeCnt
    :param nm2schemeCnt: nm:(t,lstcellCnt)，
    代表这个联通块中,假设有nm颗雷的情况下共有t种方案，
    lstcellCnt表示各个格子中共有其中几种方案有雷
    :return: 
    """</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 两种可能：有雷、无雷</span>
        <span class="token comment"># 9作为作为临时无雷标记，-2作为临时有雷标记</span>
        <span class="token keyword">for</span> m<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># m和n 对应了无雷和有雷两种情况下的标记</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> m
            board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> n
            <span class="token comment"># 根据基础规则更新周围点的标记，返回更新格子列表和成功标记</span>
            <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                    updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token comment"># 恢复</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
                board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token comment"># 恢复</span>
        board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 有雷</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 无雷</span>
        <span class="token comment"># 根据规则1判断并更新周边块board标记，返回更新格子列表和成功标记</span>
        <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        <span class="token comment"># 恢复</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">calDP</span><span class="token punctuation">(</span>lk<span class="token punctuation">,</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"考虑剩余雷数的可能方案数计算"</span>
    ndp <span class="token operator">=</span> <span class="token number">0</span>
    k <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    nm2schemeCnt <span class="token operator">=</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> nm <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
            ndp <span class="token operator">=</span> cnt
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> k1 <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            lk1 <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            n1 <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk1<span class="token punctuation">,</span> nm <span class="token operator">-</span> k1<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>k1<span class="token punctuation">]</span>
            ndp <span class="token operator">+=</span> n1 <span class="token operator">*</span> cnt
    <span class="token keyword">return</span> ndp


<span class="token keyword">def</span> <span class="token function">getCLKPoints</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取节点列表"</span>
    flags<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># 联通块列表</span>
    block_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 孤立位置列表</span>
    single_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> flags<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>srhAdjBlock<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            single_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>

    nm2schemeCnt_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    nmin <span class="token operator">=</span> <span class="token number">0</span>
    nmax <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> block <span class="token keyword">in</span> block_list<span class="token punctuation">:</span>
        <span class="token comment"># 搜索联通块k的可行方案</span>
        <span class="token comment"># 当前连通块中，每个可能的总雷数对应的方案数和每个格子在其中几种方案下有雷</span>
        nm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        mine_flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int16'</span><span class="token punctuation">)</span>
        srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
        nmin <span class="token operator">+=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
        nmax <span class="token operator">+=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>

    <span class="token comment"># 如果非联通块中包含的雷数大于0，考虑剩余雷数对概率影响</span>
    <span class="token keyword">if</span> single_list<span class="token punctuation">:</span>
        block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
        rnm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment"># 剩余格子概率计算</span>
        n2 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nmin<span class="token punctuation">,</span> nmax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            n1 <span class="token operator">=</span> mine_num <span class="token operator">-</span> i
            mine_flag <span class="token operator">=</span> <span class="token punctuation">[</span>n1 <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">]</span>
            rnm2schemeCnt<span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>n2<span class="token punctuation">,</span> mine_flag<span class="token punctuation">]</span>
        nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rnm2schemeCnt<span class="token punctuation">)</span>

    pboard <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int8"</span><span class="token punctuation">)</span>
    <span class="token comment"># 基准有雷概率百分比</span>
    pboard<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>mine_num<span class="token operator">*</span><span class="token number">100</span><span class="token operator">//</span>nb<span class="token punctuation">)</span>

    <span class="token comment"># 计算概率</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        lk <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> t <span class="token operator">!=</span> k<span class="token punctuation">]</span>
        <span class="token comment"># 考虑剩余雷数的可能方案数计算</span>
        NBcnt <span class="token operator">=</span> <span class="token number">0</span>
        block <span class="token operator">=</span> block_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        Ncnt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        <span class="token keyword">for</span> nm<span class="token punctuation">,</span> <span class="token punctuation">(</span>cnt<span class="token punctuation">,</span> cnt_list<span class="token punctuation">)</span> <span class="token keyword">in</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                ndp <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk<span class="token punctuation">,</span> mine_num <span class="token operator">-</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                ndp <span class="token operator">=</span> <span class="token number">1</span>
            NBcnt <span class="token operator">+=</span> cnt <span class="token operator">*</span> ndp
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> cnt_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> ndp
        <span class="token comment"># print("k,NBcnt,Ncnt=",k,NBcnt,Ncnt)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> NBcnt

    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">:</span>
            <span class="token comment"># 有雷概率为100说明必定有雷，插旗</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 有雷概率为0说明必定没有雷，点开</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 计算最小比例列表</span>
        pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>pboard <span class="token operator">==</span> pboard<span class="token punctuation">[</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            <span class="token comment"># 超过10个以上这样的点则随机选一个</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 否则取周围未点开格子最少的格子</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> key<span class="token operator">=</span>getFiveMapNum<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> res
        res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
</code></pre>
    <p>
     调用示例：
    </p>
    <pre><code class="prism language-python">update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
flags <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
getCLKPoints<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_1388">
     </a>
     引入概率分析算法进行测试
    </h3>
    <pre><code class="prism language-python"><span class="token triple-quoted-string string">"""
小小明的代码
CSDN主页：https://blog.csdn.net/as604049322
"""</span>
__author__ <span class="token operator">=</span> <span class="token string">'小小明'</span>
__time__ <span class="token operator">=</span> <span class="token string">'2021/8/8'</span>

<span class="token keyword">import</span> functools
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
<span class="token keyword">from</span> concurrent <span class="token keyword">import</span> futures

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> win32api
<span class="token keyword">import</span> win32com<span class="token punctuation">.</span>client <span class="token keyword">as</span> win32
<span class="token keyword">import</span> win32con
<span class="token keyword">import</span> win32gui
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageGrab

<span class="token comment"># 每个方块16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>
<span class="token comment"># 剩余雷数图像特征码</span>
code2num <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token number">247</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">187</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">207</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">:</span> <span class="token number">9</span>
<span class="token punctuation">}</span>
<span class="token comment"># 雷区图像特征码</span>
<span class="token comment"># 数字1-8表示周围有几个雷</span>
<span class="token comment">#  0 表示已经点开是空白的格子</span>
<span class="token comment"># -1 表示还没有点开的格子</span>
<span class="token comment"># -2 表示红旗所在格子</span>
<span class="token comment"># -3 表示踩到雷了已经失败</span>
<span class="token comment"># -4 表示被玩家自己标记为问号</span>
rgb_signs <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'281d9cc0'</span><span class="token punctuation">,</span> <span class="token string">'414b83c0'</span><span class="token punctuation">,</span> <span class="token string">'3e4c86c0'</span><span class="token punctuation">,</span> <span class="token string">'380f8cc0'</span><span class="token punctuation">,</span>
    <span class="token string">'46267ec0'</span><span class="token punctuation">,</span> <span class="token string">'485a7cc0'</span><span class="token punctuation">,</span> <span class="token string">'2c0098c0'</span><span class="token punctuation">,</span> <span class="token string">'4c8078c0'</span><span class="token punctuation">,</span> <span class="token string">'c4c0'</span><span class="token punctuation">,</span>
    <span class="token string">'198092c019ff'</span><span class="token punctuation">,</span> <span class="token string">'1600114c19806bc019ff'</span><span class="token punctuation">,</span> <span class="token string">'4d0073c004ff'</span><span class="token punctuation">,</span>
    <span class="token string">'4d00734c04ff'</span><span class="token punctuation">,</span> <span class="token string">'34002e4c61c001ff'</span><span class="token punctuation">,</span> <span class="token string">'180019807ac019ff'</span>
<span class="token punctuation">]</span>
values <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span>
<span class="token punctuation">]</span>
img_match <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>rgb_signs<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 雷区格子在窗体上的起始坐标</span>
offest_x<span class="token punctuation">,</span> offest_y <span class="token operator">=</span> <span class="token number">0xC</span><span class="token punctuation">,</span> <span class="token number">0x37</span>


<span class="token keyword">def</span> <span class="token function">get_board_size</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    <span class="token comment"># 横向有w个方块</span>
    l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">101</span><span class="token punctuation">,</span> right <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">,</span> bottom <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l<span class="token punctuation">)</span> <span class="token operator">//</span> bw
    <span class="token comment"># 纵向有h个方块</span>
    h <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">//</span> bh
    <span class="token keyword">return</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_pixel_code</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    key_points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
        pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">76</span>
    code <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>key_points<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"int8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> code


<span class="token keyword">def</span> <span class="token function">get_mine_num</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> full_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    num_img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">62</span><span class="token punctuation">,</span> left <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">+</span> <span class="token number">39</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">62</span> <span class="token operator">+</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mine_num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        num_i <span class="token operator">=</span> num_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
        code <span class="token operator">=</span> get_pixel_code<span class="token punctuation">(</span>num_i<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mine_num <span class="token operator">=</span> mine_num <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> code2num<span class="token punctuation">[</span>code<span class="token punctuation">]</span>
    <span class="token keyword">return</span> mine_num


<span class="token keyword">def</span> <span class="token function">colors2signature</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> colors <span class="token keyword">for</span> b <span class="token keyword">in</span> c<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">update_board</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span> full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> full_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    rect <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">101</span><span class="token punctuation">,</span> right <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">,</span> bottom <span class="token operator">-</span> <span class="token number">11</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
            img_block <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> bw <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">*</span> bh <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bw <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bh <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            colors <span class="token operator">=</span> img_block<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getcolors<span class="token punctuation">(</span><span class="token punctuation">)</span>
            signature <span class="token operator">=</span> colors2signature<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>
            board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> img_match<span class="token punctuation">[</span>signature<span class="token punctuation">]</span>
    <span class="token keyword">return</span> board


<span class="token keyword">def</span> <span class="token function">get_hwnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    class_name<span class="token punctuation">,</span> title_name <span class="token operator">=</span> <span class="token string">"扫雷"</span><span class="token punctuation">,</span> <span class="token string">"扫雷"</span>
    <span class="token keyword">return</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">activateWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># SetForegroundWindow调用有一些限制，我们可以再调用之前输入一个键盘事件</span>
    shell <span class="token operator">=</span> win32<span class="token punctuation">.</span>Dispatch<span class="token punctuation">(</span><span class="token string">"WScript.Shell"</span><span class="token punctuation">)</span>
    shell<span class="token punctuation">.</span>SendKeys<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">)</span>
    win32gui<span class="token punctuation">.</span>SetForegroundWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">new_board</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    board <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int8"</span><span class="token punctuation">)</span>
    board<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> board


<span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> l <span class="token operator">+</span> px <span class="token operator">*</span> bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> t <span class="token operator">+</span> py <span class="token operator">*</span> bh <span class="token operator">+</span> <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标周围4*4-9*9的边界范围"</span>
    x1<span class="token punctuation">,</span> x2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2


<span class="token keyword">def</span> <span class="token function">getItemNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围没有点开和已确定有雷的格子的数量"</span>
    <span class="token comment"># -1 表示还没有点开的格子</span>
    <span class="token comment"># -2 表示红旗所在格子</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    count <span class="token operator">=</span> Counter<span class="token punctuation">(</span>board<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> count<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> count<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">getUnknownPointList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围还没有点开的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


<span class="token keyword">def</span> <span class="token function">getOpenNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子的数量"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            num <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num


<span class="token keyword">def</span> <span class="token function">srhAdjBlock</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"搜索与数字位置相邻的未打开块，,使用flags标记已经访问过的位置"</span>
    stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    block <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> stack<span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> block_flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        block_flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        block<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> block_flag<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token keyword">or</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> block


<span class="token keyword">def</span> <span class="token function">getOpenNumList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


<span class="token keyword">def</span> <span class="token function">update_block</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据随机算法的基础规则更新board周边块"</span>
    result<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getOpenNumList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 实际雷数 小于 标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token comment"># 实际雷数 大于 未点开的格子数量+标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&gt;</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        unknownPoints <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
        <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 9表示临时无雷标记</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">updateNm2schemeCnt</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据搜索得到的方案更新 nm2schemeCnt"</span>
    nm <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>mine_flag<span class="token punctuation">)</span>
    <span class="token keyword">if</span> nm <span class="token keyword">not</span> <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>  <span class="token comment"># 新增一种方案</span>
        nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> mine_flag<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 更新</span>
        v <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
        v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> mine_flag


<span class="token keyword">def</span> <span class="token function">srhScheme</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param block: 连通块中的格子列表
    :param mine_flag: 是否有雷标记列表
    :param k: 从位置k开始搜索所有可行方案，结果存储于 nm2schemeCnt
    :param nm2schemeCnt: nm:(t,lstcellCnt)，
    代表这个联通块中,假设有nm颗雷的情况下共有t种方案，
    lstcellCnt表示各个格子中共有其中几种方案有雷
    :return:
    """</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 两种可能：有雷、无雷</span>
        <span class="token comment"># 9作为作为临时无雷标记，-2作为临时有雷标记</span>
        <span class="token keyword">for</span> m<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># m和n 对应了无雷和有雷两种情况下的标记</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> m
            board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> n
            <span class="token comment"># 根据基础规则更新周围点的标记，返回更新格子列表和成功标记</span>
            <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                    updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token comment"># 恢复</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
                board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token comment"># 恢复</span>
        board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 有雷</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 无雷</span>
        <span class="token comment"># 根据规则1判断并更新周边块board标记，返回更新格子列表和成功标记</span>
        <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        <span class="token comment"># 恢复</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">calDP</span><span class="token punctuation">(</span>lk<span class="token punctuation">,</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"考虑剩余雷数的可能方案数计算"</span>
    ndp <span class="token operator">=</span> <span class="token number">0</span>
    k <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    nm2schemeCnt <span class="token operator">=</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> nm <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
            ndp <span class="token operator">=</span> cnt
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> k1 <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            lk1 <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            n1 <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk1<span class="token punctuation">,</span> nm <span class="token operator">-</span> k1<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>k1<span class="token punctuation">]</span>
            ndp <span class="token operator">+=</span> n1 <span class="token operator">*</span> cnt
    <span class="token keyword">return</span> ndp


<span class="token keyword">class</span> <span class="token class-name">TimeOut</span><span class="token punctuation">:</span>
    __executor <span class="token operator">=</span> futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>seconds <span class="token operator">=</span> seconds

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
            future <span class="token operator">=</span> TimeOut<span class="token punctuation">.</span>__executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
            <span class="token keyword">return</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span>timeout<span class="token operator">=</span>self<span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>

        <span class="token keyword">return</span> wrapper


<span class="token decorator annotation punctuation">@TimeOut</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getCLKPoints</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取节点列表"</span>
    block_flag<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># 联通块列表</span>
    block_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 孤立位置列表</span>
    single_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> block_flag<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>srhAdjBlock<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            single_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>

    nm2schemeCnt_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    nmin <span class="token operator">=</span> <span class="token number">0</span>
    nmax <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> block <span class="token keyword">in</span> block_list<span class="token punctuation">:</span>
        <span class="token comment"># 搜索联通块k的可行方案</span>
        <span class="token comment"># 当前连通块中，每个可能的总雷数对应的方案数和每个格子在其中几种方案下有雷</span>
        nm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        mine_flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int16'</span><span class="token punctuation">)</span>
        srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
        nmin <span class="token operator">+=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
        nmax <span class="token operator">+=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>

    <span class="token comment"># 如果非联通块中包含的雷数大于0，考虑剩余雷数对概率影响</span>
    <span class="token keyword">if</span> single_list<span class="token punctuation">:</span>
        block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
        rnm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment"># 剩余格子概率计算</span>
        n2 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nmin<span class="token punctuation">,</span> nmax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            n1 <span class="token operator">=</span> mine_num <span class="token operator">-</span> i
            mine_flag <span class="token operator">=</span> <span class="token punctuation">[</span>n1 <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">]</span>
            rnm2schemeCnt<span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>n2<span class="token punctuation">,</span> mine_flag<span class="token punctuation">]</span>
        nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rnm2schemeCnt<span class="token punctuation">)</span>

    pboard <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"uint8"</span><span class="token punctuation">)</span>
    <span class="token comment"># 基准有雷概率百分比</span>
    nb <span class="token operator">=</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    pboard<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>mine_num <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> nb<span class="token punctuation">)</span>

    <span class="token comment"># 计算概率</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        lk <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> t <span class="token operator">!=</span> k<span class="token punctuation">]</span>
        <span class="token comment"># 考虑剩余雷数的可能方案数计算</span>
        NBcnt <span class="token operator">=</span> <span class="token number">0</span>
        block <span class="token operator">=</span> block_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        Ncnt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        <span class="token keyword">for</span> nm<span class="token punctuation">,</span> <span class="token punctuation">(</span>cnt<span class="token punctuation">,</span> cnt_list<span class="token punctuation">)</span> <span class="token keyword">in</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                ndp <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk<span class="token punctuation">,</span> mine_num <span class="token operator">-</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                ndp <span class="token operator">=</span> <span class="token number">1</span>
            NBcnt <span class="token operator">+=</span> cnt <span class="token operator">*</span> ndp
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> cnt_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> ndp
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> NBcnt<span class="token punctuation">)</span>

    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">:</span>
            <span class="token comment"># 有雷概率为100说明必定有雷，插旗</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 有雷概率为0说明必定没有雷，点开</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">getFiveMapNum</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"获取指定坐标点5*5地图内还没有点开格子的数量"</span>
        <span class="token comment"># -1 表示还没有点开的格子</span>
        <span class="token comment"># 获取指定坐标周围4*4-9*9的边界范围</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> p
        x1<span class="token punctuation">,</span> x2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>board<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 计算最小比例列表</span>
        pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>pboard <span class="token operator">==</span> pboard<span class="token punctuation">[</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            <span class="token comment"># 超过10个以上这样的点则随机选一个</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 否则取周围未点开格子最少的格子</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> key<span class="token operator">=</span>getFiveMapNum<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> res
        res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res


<span class="token keyword">def</span> <span class="token function">base_op</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 筛选出所有未确定的数字位置 坐标</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>board <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        boom_number <span class="token operator">=</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span>
        <span class="token comment"># 统计当前点周围 4*4-9*9 范围各类点的数量</span>
        unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 周围没有未点过的点可以直接忽略</span>
            flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">continue</span>
        <span class="token comment"># 获取周围的点的位置</span>
        points <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> boom_number <span class="token operator">==</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
            flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> points<span class="token punctuation">:</span>
                res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> boom_number <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
            flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> points<span class="token punctuation">:</span>
                res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res


hwnd <span class="token operator">=</span> get_hwnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token comment"># 获取雷盘大小和位置</span>
<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
mine_num <span class="token operator">=</span> get_mine_num<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">,高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">,雷数：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mine_num<span class="token punctuation">}</span></span><span class="token string">，雷盘位置：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>rect<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
board <span class="token operator">=</span> new_board<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> rect
<span class="token comment"># 点击任意位置激活窗口</span>
click<span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">,</span> t <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token comment"># 标记周围已经完全确定的数字位置</span>
flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
<span class="token comment"># 标记已经访问过的连通块</span>
block_flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> base_op<span class="token punctuation">(</span><span class="token punctuation">)</span>
    nb <span class="token operator">=</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> nb <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> board<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> getCLKPoints<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
        <span class="token keyword">except</span> futures<span class="token punctuation">.</span>_base<span class="token punctuation">.</span>TimeoutError<span class="token punctuation">:</span>
            board <span class="token operator">=</span> tmp
            py<span class="token punctuation">,</span> px <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> left <span class="token keyword">in</span> res<span class="token punctuation">:</span>
        click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> left<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> left<span class="token punctuation">:</span>
            mine_num <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"剩余雷数："</span><span class="token punctuation">,</span> mine_num<span class="token punctuation">)</span>

    <span class="token keyword">if</span> nb <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"顺利！！！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"踩到雷了，游戏结束！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token comment"># 操作完毕后，更新最新的雷盘数据</span>
    update_board<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
</code></pre>
    <p>
     现在这就是引入概率分析的完整代码，现在我们玩下高级试一下：
    </p>
    <p>
     <img alt="录制_2021_08_08_22_42_56_24" src="https://i-blog.csdnimg.cn/blog_migrate/0a092f1257f946c002e475d80e6db58f.gif"/>
    </p>
    <p>
     可以看到5秒内就解决了高级。
    </p>
    <h2>
     <a id="_1896">
     </a>
     能不能更快更高的胜率？
    </h2>
    <p>
     上次的玩数独一文中，有读者在公众号留言实锤开挂，我只想呵呵一笑。今天就让你们见识一下什么叫真正的开挂。
    </p>
    <p>
     最终能达到什么效果呢？任何级别耗时在1秒以内，胜率为100%。
    </p>
    <p>
     看下效果：
    </p>
    <p>
     <img alt="录制_2021_08_08_23_07_17_777" src="https://i-blog.csdnimg.cn/blog_migrate/b4be8437b20ed6c4b3e23bf8d5b64149.gif"/>
    </p>
    <h3>
     <a id="_1906">
     </a>
     内存外挂原理
    </h3>
    <p>
     分析出雷盘数据的内存位置，调用
     <code>
      kernel32.dll
     </code>
     的API读取内存。
    </p>
    <p>
     windowsAPI文档可查看：
    </p>
    <ul>
     <li>
      <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-readprocessmemory" rel="nofollow">
       https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-readprocessmemory
      </a>
     </li>
     <li>
      <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getwindowthreadprocessid" rel="nofollow">
       https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getwindowthreadprocessid
      </a>
     </li>
     <li>
      <a href="https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess" rel="nofollow">
       https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess
      </a>
     </li>
    </ul>
    <p>
     打开HawkOD后，把winmine.exe拖入HawkOD
    </p>
    <p>
     在WM_LBUTTONUP上设置断点后，运行，然后单步步过到地址01001FE1后跟随：
    </p>
    <p>
     <img alt="image-20210808233244299" src="https://i-blog.csdnimg.cn/blog_migrate/79ea4906adaf6423e9ba1eaa27b28f89.png"/>
    </p>
    <p>
     跟随后我们在此处可以找到棋盘数据：
    </p>
    <p>
     <img alt="image-20210808234332258" src="https://i-blog.csdnimg.cn/blog_migrate/5e5aba3f877d319f6223b6960c8189eb.png"/>
    </p>
    <p>
     可以看到地址010055330前双字为0x28(十进制为40)这表示雷数，后面双字分别是宽度和高度，0x10表示棋盘的边，0x8F表示雷。
    </p>
    <p>
     所以我们的外挂想做的极端点，只需要将此段内存的0x8F全部改成0x8E，就直接胜利了，但是没有必要。我们只需要能读取雷区数据就行。
    </p>
    <h3>
     <a id="_1930">
     </a>
     实现过程
    </h3>
    <p>
     首先，我们获取扫雷程序的窗口对象，并从系统动态链接库中获取读写内存的方法：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> win32gui

<span class="token comment"># 扫雷游戏窗口</span>
class_name<span class="token punctuation">,</span> title_name <span class="token operator">=</span> <span class="token string">"扫雷"</span><span class="token punctuation">,</span> <span class="token string">"扫雷"</span>
hwnd <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span>

kernel32 <span class="token operator">=</span> cdll<span class="token punctuation">.</span>LoadLibrary<span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span>
ReadProcessMemory <span class="token operator">=</span> kernel32<span class="token punctuation">.</span>ReadProcessMemory
WriteProcessMemory <span class="token operator">=</span> kernel32<span class="token punctuation">.</span>WriteProcessMemory
OpenProcess <span class="token operator">=</span> kernel32<span class="token punctuation">.</span>OpenProcess
</code></pre>
    <p>
     连接到指定进程，用于直接读取其内存数据：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32process
<span class="token keyword">import</span> win32con

hreadID<span class="token punctuation">,</span> processID <span class="token operator">=</span> win32process<span class="token punctuation">.</span>GetWindowThreadProcessId<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
process <span class="token operator">=</span> OpenProcess<span class="token punctuation">(</span>win32con<span class="token punctuation">.</span>PROCESS_ALL_ACCESS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> processID<span class="token punctuation">)</span>
</code></pre>
    <p>
     读取剩余雷数和宽高：
    </p>
    <pre><code class="prism language-python">mine_num<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> c_ulong<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c_ulong<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c_ulong<span class="token punctuation">(</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005330</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>mine_num<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005334</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005338</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
mine_num<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> mine_num<span class="token punctuation">.</span>value<span class="token punctuation">,</span> w<span class="token punctuation">.</span>value<span class="token punctuation">,</span> h<span class="token punctuation">.</span>value
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">，高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">，剩余雷数：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mine_num<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>宽：9，高：9，剩余雷数：10
</code></pre>
    <p>
     读取并打印棋盘数据：
    </p>
    <pre><code class="prism language-python">max_w<span class="token punctuation">,</span> max_h <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">24</span>
<span class="token comment"># 外围有一个值为 0x10 的边界，所以长宽均+2</span>
data_type <span class="token operator">=</span> <span class="token punctuation">(</span>c_byte <span class="token operator">*</span> <span class="token punctuation">(</span>max_w <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max_h <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
board <span class="token operator">=</span> data_type<span class="token punctuation">(</span><span class="token punctuation">)</span>
bytesRead <span class="token operator">=</span> c_ulong<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005340</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> h<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> w<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sign <span class="token operator">=</span> board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>sign<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code>15,15,-113,15,15,15,15,15,15,
15,15,15,15,15,15,15,15,15,
15,-113,15,15,15,-113,-113,15,15,
15,15,15,15,15,15,15,15,15,
15,15,15,15,-113,15,-113,15,15,
15,15,15,15,15,15,-113,15,15,
15,15,15,15,-113,15,-113,15,15,
15,15,15,15,15,15,-113,15,15,
15,15,15,15,15,15,15,15,15,
</code></pre>
    <blockquote>
     <p>
      注意：由于需要读取的棋盘数据，数据范围较大，所以需要申明了一个
      <code>
       bytesRead
      </code>
      作为缓冲区，否则可能出现无法读取数据的情况。
     </p>
    </blockquote>
    <p>
     然后就可以迅速解开全部位置：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32api


<span class="token keyword">def</span> <span class="token function">message_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 雷区格子在窗体上的起始坐标</span>
offest_x<span class="token punctuation">,</span> offest_y <span class="token operator">=</span> <span class="token number">0xC</span><span class="token punctuation">,</span> <span class="token number">0x37</span>
<span class="token comment"># 每个格子方块的宽度和高度 16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>
<span class="token keyword">def</span> <span class="token function">message_click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> offest_x<span class="token operator">+</span>px<span class="token operator">*</span>bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> offest_y<span class="token operator">+</span>py<span class="token operator">*</span>bh <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    message_click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>


<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">15</span><span class="token punctuation">:</span>
            message_click_mine_area<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_2045">
     </a>
     内存外挂的完整代码
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">import</span> win32api
<span class="token keyword">import</span> win32con
<span class="token keyword">import</span> win32process
<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> win32gui

<span class="token comment"># 扫雷游戏窗口</span>
class_name<span class="token punctuation">,</span> title_name <span class="token operator">=</span> <span class="token string">"扫雷"</span><span class="token punctuation">,</span> <span class="token string">"扫雷"</span>
hwnd <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span>

kernel32 <span class="token operator">=</span> cdll<span class="token punctuation">.</span>LoadLibrary<span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span>
ReadProcessMemory <span class="token operator">=</span> kernel32<span class="token punctuation">.</span>ReadProcessMemory
WriteProcessMemory <span class="token operator">=</span> kernel32<span class="token punctuation">.</span>WriteProcessMemory
OpenProcess <span class="token operator">=</span> kernel32<span class="token punctuation">.</span>OpenProcess


hreadID<span class="token punctuation">,</span> processID <span class="token operator">=</span> win32process<span class="token punctuation">.</span>GetWindowThreadProcessId<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
process <span class="token operator">=</span> OpenProcess<span class="token punctuation">(</span>win32con<span class="token punctuation">.</span>PROCESS_ALL_ACCESS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> processID<span class="token punctuation">)</span>
bytesRead <span class="token operator">=</span> c_ulong<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
mine_num<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> c_ulong<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c_ulong<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c_ulong<span class="token punctuation">(</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005330</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>mine_num<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005334</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">)</span>
ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005338</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">)</span>
mine_num<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> mine_num<span class="token punctuation">.</span>value<span class="token punctuation">,</span> w<span class="token punctuation">.</span>value<span class="token punctuation">,</span> h<span class="token punctuation">.</span>value
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">，高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">，剩余雷数：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mine_num<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

max_w<span class="token punctuation">,</span> max_h <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">24</span>
<span class="token comment"># 外围有一个值为 0x10 的边界，所以长宽均+2</span>
data_type <span class="token operator">=</span> <span class="token punctuation">(</span>c_byte <span class="token operator">*</span> <span class="token punctuation">(</span>max_w <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max_h <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
board <span class="token operator">=</span> data_type<span class="token punctuation">(</span><span class="token punctuation">)</span>

ReadProcessMemory<span class="token punctuation">(</span>process<span class="token punctuation">,</span> <span class="token number">0x1005340</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>
    board<span class="token punctuation">)</span><span class="token punctuation">,</span> sizeof<span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">,</span> byref<span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">message_click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_LBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_LBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONDOWN<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>SendMessage<span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>WM_RBUTTONUP<span class="token punctuation">,</span>
                             win32con<span class="token punctuation">.</span>MK_RBUTTON<span class="token punctuation">,</span>
                             win32api<span class="token punctuation">.</span>MAKELONG<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 雷区格子在窗体上的起始坐标</span>
offest_x<span class="token punctuation">,</span> offest_y <span class="token operator">=</span> <span class="token number">0xC</span><span class="token punctuation">,</span> <span class="token number">0x37</span>
<span class="token comment"># 每个格子方块的宽度和高度 16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>


<span class="token keyword">def</span> <span class="token function">message_click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> offest_x<span class="token operator">+</span>px<span class="token operator">*</span>bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> offest_y<span class="token operator">+</span>py<span class="token operator">*</span>bh <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    message_click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>


<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">15</span><span class="token punctuation">:</span>
            message_click_mine_area<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
</code></pre>
    <p>
     体验一下：
    </p>
    <p>
     <img alt="录制_2021_08_09_00_41_06_195" src="https://i-blog.csdnimg.cn/blog_migrate/dc3c4ff2ca277cf9b92b2119d14a48d9.gif"/>
    </p>
    <h2>
     <a id="049_2127">
     </a>
     能超越初级的0.49秒的世界记录吗？
    </h2>
    <p>
     实际上按照专业扫雷选手的说法，初级扫雷并不对时间设置世界记录，关于扫雷的世界记录有且仅有十项，参考：
    </p>
    <blockquote>
     <ul>
      <li>
       初级3bv/s:12.04 鞠泽恩（中国）
      </li>
      <li>
       NF初级3bv/s:8.53 鞠泽恩（中国）
      </li>
      <li>
       中级3bv/s:7.445 鞠泽恩（中国）
      </li>
      <li>
       NF中级3bv/s:6.33 郭蔚嘉（中国）
      </li>
      <li>
       高级3bv/s:6.06 鞠泽恩（中国）
      </li>
      <li>
       NF高级3bv/s:4.93 郭蔚嘉（中国）
      </li>
      <li>
       中级time:6.96s 鞠泽恩（中国）
      </li>
      <li>
       NF中级time:7.03s Kamil Muranski（波兰）
      </li>
      <li>
       高级time:28.70s 鞠泽恩（中国）
      </li>
      <li>
       NF高级time:31.17s鞠泽恩（中国）
      </li>
     </ul>
     <p>
      作者：MsPVZ.ZSW
      <br/>
      链接：https://zhuanlan.zhihu.com/p/27151972
     </p>
    </blockquote>
    <p>
     要突破3bv/s的世界记录对于程序而言过于简单，因为人肯定不会比程序点的快。对于0.49秒这个所谓的世界记录，我们也只需要多运行几遍就可以达到了。
    </p>
    <p>
     不过win98版本的扫雷，不支持1秒以内的时间统计，所以首先我们需要更换为扫雷网提供的扫雷进行操作。效果：
    </p>
    <p>
     <img alt="录制_2021_08_09_18_38_11_832" src="https://i-blog.csdnimg.cn/blog_migrate/4c296f6ee2ee3d2e7c1a131307f7a80b.gif"/>
    </p>
    <p>
     对于扫雷网提供的扫雷游戏，雷盘的像素点偏移有些变化，下面按照同样的思路计算出特征码后编写如下代码，能同时适配两种扫雷程序。
    </p>
    <p>
     同时为了速度更快我们不再程序去操作标旗而是自行变量记录一下：
    </p>
    <pre><code class="prism language-python"><span class="token triple-quoted-string string">"""
小小明的代码
CSDN主页：https://blog.csdn.net/as604049322
"""</span>
__author__ <span class="token operator">=</span> <span class="token string">'小小明'</span>
__time__ <span class="token operator">=</span> <span class="token string">'2021/8/8'</span>

<span class="token keyword">import</span> functools
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
<span class="token keyword">from</span> concurrent <span class="token keyword">import</span> futures

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> win32api
<span class="token keyword">import</span> win32com<span class="token punctuation">.</span>client <span class="token keyword">as</span> win32
<span class="token keyword">import</span> win32con
<span class="token keyword">import</span> win32gui
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageGrab

<span class="token comment"># 每个方块16*16</span>
bw<span class="token punctuation">,</span> bh <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span>
<span class="token comment"># 剩余雷数图像特征码</span>
code2num <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token number">247</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">187</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">207</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">:</span> <span class="token number">9</span>
<span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">get_img_matchs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    雷区图像特征码
    数字1-8表示周围有几个雷
     0 表示已经点开是空白的格子
    -1 表示还没有点开的格子
    -2 表示红旗所在格子
    -3 表示踩到雷了已经失败
    """</span>
    values <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span>
    <span class="token punctuation">]</span>
    rgb_signs_0 <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'281d9cc0'</span><span class="token punctuation">,</span> <span class="token string">'414b83c0'</span><span class="token punctuation">,</span> <span class="token string">'3e4c86c0'</span><span class="token punctuation">,</span> <span class="token string">'380f8cc0'</span><span class="token punctuation">,</span>
        <span class="token string">'46267ec0'</span><span class="token punctuation">,</span> <span class="token string">'485a7cc0'</span><span class="token punctuation">,</span> <span class="token string">'2c0098c0'</span><span class="token punctuation">,</span> <span class="token string">'4c8078c0'</span><span class="token punctuation">,</span> <span class="token string">'c4c0'</span><span class="token punctuation">,</span>
        <span class="token string">'198092c019ff'</span><span class="token punctuation">,</span> <span class="token string">'1600114c19806bc019ff'</span><span class="token punctuation">,</span>
        <span class="token string">'4d0073c004ff'</span><span class="token punctuation">,</span> <span class="token string">'4d00734c04ff'</span><span class="token punctuation">,</span> <span class="token string">'34002e4c61c001ff'</span>
    <span class="token punctuation">]</span>
    rgb_signs_1 <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'281d9cc0'</span><span class="token punctuation">,</span> <span class="token string">'414b83c0'</span><span class="token punctuation">,</span> <span class="token string">'3e4c86c0'</span><span class="token punctuation">,</span> <span class="token string">'380f8cc0'</span><span class="token punctuation">,</span>
        <span class="token string">'46267ec0'</span><span class="token punctuation">,</span> <span class="token string">'485a7cc0'</span><span class="token punctuation">,</span> <span class="token string">'2c0098c0'</span><span class="token punctuation">,</span> <span class="token string">'4c8078c0'</span><span class="token punctuation">,</span> <span class="token string">'c4c0'</span><span class="token punctuation">,</span>
        <span class="token string">'278091c00cff'</span><span class="token punctuation">,</span> <span class="token string">'1600114c27806ac00cff'</span><span class="token punctuation">,</span>
        <span class="token string">'4d0073c004ff'</span><span class="token punctuation">,</span> <span class="token string">'4d00734c04ff'</span><span class="token punctuation">,</span> <span class="token string">'4d00734c04ff'</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"扫雷"</span><span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>rgb_signs_0<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"Arbiter"</span><span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>rgb_signs_1<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


img_matchs <span class="token operator">=</span> get_img_matchs<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_hwnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"先搜索普通扫雷，再搜索扫雷网的扫雷"</span>
    <span class="token keyword">global</span> name
    names <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"扫雷"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">"扫雷"</span><span class="token punctuation">,</span> <span class="token string">"扫雷"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Arbiter"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">"TMain"</span><span class="token punctuation">,</span> <span class="token string">"Minesweeper Arbiter "</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> n<span class="token punctuation">,</span> <span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span> <span class="token keyword">in</span> names<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        hwnd <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>FindWindow<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> title_name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> hwnd<span class="token punctuation">:</span>
            name <span class="token operator">=</span> n
            <span class="token keyword">return</span> hwnd


<span class="token keyword">def</span> <span class="token function">get_board_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    offests <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"扫雷"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Arbiter"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    o1<span class="token punctuation">,</span> o2<span class="token punctuation">,</span> o3<span class="token punctuation">,</span> o4 <span class="token operator">=</span> offests<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
    <span class="token comment"># 横向有w个方块</span>
    l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> o1<span class="token punctuation">,</span> top <span class="token operator">+</span> o2<span class="token punctuation">,</span> right <span class="token operator">+</span> o3<span class="token punctuation">,</span> bottom <span class="token operator">+</span> o4<span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l<span class="token punctuation">)</span> <span class="token operator">//</span> bw
    <span class="token comment"># 纵向有h个方块</span>
    h <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">//</span> bh
    <span class="token keyword">return</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_pixel_code</span><span class="token punctuation">(</span>pixels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    key_points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
        pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        pixels<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixels<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">76</span>
    code <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>key_points<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"int8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"str"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> code


<span class="token keyword">def</span> <span class="token function">get_mine_num</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> full_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom <span class="token operator">=</span> win32gui<span class="token punctuation">.</span>GetWindowRect<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
    num_img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">62</span><span class="token punctuation">,</span> left <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">+</span> <span class="token number">39</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">62</span> <span class="token operator">+</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mine_num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        num_i <span class="token operator">=</span> num_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">13</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">13</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
        code <span class="token operator">=</span> get_pixel_code<span class="token punctuation">(</span>num_i<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        mine_num <span class="token operator">=</span> mine_num <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> code2num<span class="token punctuation">[</span>code<span class="token punctuation">]</span>
    <span class="token keyword">return</span> mine_num


<span class="token keyword">def</span> <span class="token function">colors2signature</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> colors <span class="token keyword">for</span> b <span class="token keyword">in</span> c<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">update_board</span><span class="token punctuation">(</span>full_img<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> full_img <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        full_img <span class="token operator">=</span> ImageGrab<span class="token punctuation">.</span>grab<span class="token punctuation">(</span><span class="token punctuation">)</span>
    size<span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> full_img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
    ys<span class="token punctuation">,</span> xs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token operator">~</span>mine_know<span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>xs<span class="token punctuation">,</span> ys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        block_split <span class="token operator">=</span> x <span class="token operator">*</span> bw <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">*</span> bh <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bw <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> bh <span class="token operator">-</span> <span class="token number">1</span>
        img_block <span class="token operator">=</span> img<span class="token punctuation">.</span>crop<span class="token punctuation">(</span>block_split<span class="token punctuation">)</span>
        colors <span class="token operator">=</span> img_block<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getcolors<span class="token punctuation">(</span><span class="token punctuation">)</span>
        signature <span class="token operator">=</span> colors2signature<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>
        board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> img_match<span class="token punctuation">[</span>signature<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">activateWindow</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># SetForegroundWindow调用有一些限制，我们可以再调用之前输入一个键盘事件</span>
    shell <span class="token operator">=</span> win32<span class="token punctuation">.</span>Dispatch<span class="token punctuation">(</span><span class="token string">"WScript.Shell"</span><span class="token punctuation">)</span>
    shell<span class="token punctuation">.</span>SendKeys<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">)</span>
    win32gui<span class="token punctuation">.</span>SetForegroundWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">new_board</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    board <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"int8"</span><span class="token punctuation">)</span>
    board<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> board


<span class="token keyword">def</span> <span class="token function">click</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> is_left_click<span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_LEFTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        win32api<span class="token punctuation">.</span>SetCursorPos<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTDOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        win32api<span class="token punctuation">.</span>mouse_event<span class="token punctuation">(</span>
            win32con<span class="token punctuation">.</span>MOUSEEVENTF_RIGHTUP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">click_mine_area</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> is_left_click<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> l <span class="token operator">+</span> px <span class="token operator">*</span> bw <span class="token operator">+</span> bw <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> t <span class="token operator">+</span> py <span class="token operator">*</span> bh <span class="token operator">+</span> <span class="token operator">+</span> bh <span class="token operator">//</span> <span class="token number">2</span>
    click<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> is_left_click<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标周围4*4-9*9的边界范围"</span>
    x1<span class="token punctuation">,</span> x2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2


<span class="token keyword">def</span> <span class="token function">getItemNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围没有点开和已确定有雷的格子的数量"</span>
    <span class="token comment"># -1 表示还没有点开的格子</span>
    <span class="token comment"># -2 表示红旗所在格子</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    count <span class="token operator">=</span> Counter<span class="token punctuation">(</span>board<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> count<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> count<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">getUnknownPointList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围还没有点开的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


<span class="token keyword">def</span> <span class="token function">getOpenNum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子的数量"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            num <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num


<span class="token keyword">def</span> <span class="token function">srhAdjBlock</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"搜索与数字位置相邻的未打开块，,使用flags标记已经访问过的位置"</span>
    stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">]</span>
    block <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> stack<span class="token punctuation">:</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> block_flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        block_flag<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        block<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> block_flag<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token keyword">or</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> block


<span class="token keyword">def</span> <span class="token function">getOpenNumList</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取指定坐标点周围有雷数标志的格子坐标列表"</span>
    x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> get_bound<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> py <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> px <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> px <span class="token operator">==</span> x <span class="token keyword">and</span> py <span class="token operator">==</span> y<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">if</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> px<span class="token punctuation">,</span> py


<span class="token keyword">def</span> <span class="token function">update_block</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据随机算法的基础规则更新board周边块"</span>
    result<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> getOpenNumList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 实际雷数 小于 标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&lt;</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token comment"># 实际雷数 大于 未点开的格子数量+标记雷数目</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">&gt;</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        unknownPoints <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
        <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token keyword">for</span> px2<span class="token punctuation">,</span> py2 <span class="token keyword">in</span> unknownPoints<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px2<span class="token punctuation">,</span> py2<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 9表示临时无雷标记</span>
                board<span class="token punctuation">[</span>py2<span class="token punctuation">,</span> px2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">9</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>


<span class="token keyword">def</span> <span class="token function">updateNm2schemeCnt</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"根据搜索得到的方案更新 nm2schemeCnt"</span>
    nm <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>mine_flag<span class="token punctuation">)</span>
    <span class="token keyword">if</span> nm <span class="token keyword">not</span> <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>  <span class="token comment"># 新增一种方案</span>
        nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> mine_flag<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 更新</span>
        v <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
        v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> mine_flag


<span class="token keyword">def</span> <span class="token function">srhScheme</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param block: 连通块中的格子列表
    :param mine_flag: 是否有雷标记列表
    :param k: 从位置k开始搜索所有可行方案，结果存储于 nm2schemeCnt
    :param nm2schemeCnt: nm:(t,lstcellCnt)，
    代表这个联通块中,假设有nm颗雷的情况下共有t种方案，
    lstcellCnt表示各个格子中共有其中几种方案有雷
    :return:
    """</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 两种可能：有雷、无雷</span>
        <span class="token comment"># 9作为作为临时无雷标记，-2作为临时有雷标记</span>
        <span class="token keyword">for</span> m<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token comment"># m和n 对应了无雷和有雷两种情况下的标记</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> m
            board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> n
            <span class="token comment"># 根据基础规则更新周围点的标记，返回更新格子列表和成功标记</span>
            <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                    updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token comment"># 恢复</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
                board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token comment"># 恢复</span>
        board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 有雷</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mine_flag<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 无雷</span>
        <span class="token comment"># 根据规则1判断并更新周边块board标记，返回更新格子列表和成功标记</span>
        <span class="token keyword">if</span> update_block<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>  <span class="token comment"># 得到一个方案</span>
                updateNm2schemeCnt<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        <span class="token comment"># 恢复</span>
        <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">calDP</span><span class="token punctuation">(</span>lk<span class="token punctuation">,</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"考虑剩余雷数的可能方案数计算"</span>
    ndp <span class="token operator">=</span> <span class="token number">0</span>
    k <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    nm2schemeCnt <span class="token operator">=</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> nm <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>nm<span class="token punctuation">]</span>
            ndp <span class="token operator">=</span> cnt
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> k1 <span class="token keyword">in</span> nm2schemeCnt<span class="token punctuation">:</span>
            lk1 <span class="token operator">=</span> lk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            n1 <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk1<span class="token punctuation">,</span> nm <span class="token operator">-</span> k1<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            cnt<span class="token punctuation">,</span> cnt_list <span class="token operator">=</span> nm2schemeCnt<span class="token punctuation">[</span>k1<span class="token punctuation">]</span>
            ndp <span class="token operator">+=</span> n1 <span class="token operator">*</span> cnt
    <span class="token keyword">return</span> ndp


<span class="token keyword">class</span> <span class="token class-name">TimeOut</span><span class="token punctuation">:</span>
    __executor <span class="token operator">=</span> futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>seconds <span class="token operator">=</span> seconds

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
            future <span class="token operator">=</span> TimeOut<span class="token punctuation">.</span>__executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
            <span class="token keyword">return</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span>timeout<span class="token operator">=</span>self<span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>

        <span class="token keyword">return</span> wrapper


<span class="token decorator annotation punctuation">@TimeOut</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getCLKPoints</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">"获取节点列表"</span>
    block_flag<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># 联通块列表</span>
    block_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 孤立位置列表</span>
    single_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> block_flag<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">if</span> getOpenNum<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>srhAdjBlock<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            single_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span>

    nm2schemeCnt_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    nmin <span class="token operator">=</span> <span class="token number">0</span>
    nmax <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> block <span class="token keyword">in</span> block_list<span class="token punctuation">:</span>
        <span class="token comment"># 搜索联通块k的可行方案</span>
        <span class="token comment"># 当前连通块中，每个可能的总雷数对应的方案数和每个格子在其中几种方案下有雷</span>
        nm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        mine_flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int16'</span><span class="token punctuation">)</span>
        srhScheme<span class="token punctuation">(</span>block<span class="token punctuation">,</span> mine_flag<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nm2schemeCnt<span class="token punctuation">)</span>
        nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
        nmin <span class="token operator">+=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>
        nmax <span class="token operator">+=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>nm2schemeCnt<span class="token punctuation">)</span>

    <span class="token comment"># 如果非联通块中包含的雷数大于0，考虑剩余雷数对概率影响</span>
    <span class="token keyword">if</span> single_list<span class="token punctuation">:</span>
        block_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
        rnm2schemeCnt <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment"># 剩余格子概率计算</span>
        n2 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>single_list<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nmin<span class="token punctuation">,</span> nmax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            n1 <span class="token operator">=</span> mine_num <span class="token operator">-</span> i
            mine_flag <span class="token operator">=</span> <span class="token punctuation">[</span>n1 <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">]</span>
            rnm2schemeCnt<span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>n2<span class="token punctuation">,</span> mine_flag<span class="token punctuation">]</span>
        nm2schemeCnt_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rnm2schemeCnt<span class="token punctuation">)</span>

    pboard <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"uint8"</span><span class="token punctuation">)</span>
    <span class="token comment"># 基准有雷概率百分比</span>
    nb <span class="token operator">=</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    pboard<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>mine_num <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> nb<span class="token punctuation">)</span>

    <span class="token comment"># 计算概率</span>
    <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        lk <span class="token operator">=</span> <span class="token punctuation">[</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nm2schemeCnt_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">if</span> t <span class="token operator">!=</span> k<span class="token punctuation">]</span>
        <span class="token comment"># 考虑剩余雷数的可能方案数计算</span>
        NBcnt <span class="token operator">=</span> <span class="token number">0</span>
        block <span class="token operator">=</span> block_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        Ncnt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        <span class="token keyword">for</span> nm<span class="token punctuation">,</span> <span class="token punctuation">(</span>cnt<span class="token punctuation">,</span> cnt_list<span class="token punctuation">)</span> <span class="token keyword">in</span> nm2schemeCnt_list<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lk<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                ndp <span class="token operator">=</span> calDP<span class="token punctuation">(</span>lk<span class="token punctuation">,</span> mine_num <span class="token operator">-</span> nm<span class="token punctuation">,</span> nm2schemeCnt_list<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                ndp <span class="token operator">=</span> <span class="token number">1</span>
            NBcnt <span class="token operator">+=</span> cnt <span class="token operator">*</span> ndp
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> cnt_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> ndp
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Ncnt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> block<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Ncnt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> NBcnt<span class="token punctuation">)</span>

    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">:</span>
            <span class="token comment"># 有雷概率为100说明必定有雷，插旗</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> pboard<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 有雷概率为0说明必定没有雷，点开</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">getFiveMapNum</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"获取指定坐标点5*5地图内还没有点开格子的数量"</span>
        <span class="token comment"># -1 表示还没有点开的格子</span>
        <span class="token comment"># 获取指定坐标周围4*4-9*9的边界范围</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> p
        x1<span class="token punctuation">,</span> x2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> w <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        y1<span class="token punctuation">,</span> y2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>board<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># 计算最小比例列表</span>
        pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>pboard <span class="token operator">==</span> pboard<span class="token punctuation">[</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            <span class="token comment"># 超过10个以上这样的点则随机选一个</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 否则取周围未点开格子最少的格子</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> key<span class="token operator">=</span>getFiveMapNum<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> res
        res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res


<span class="token keyword">def</span> <span class="token function">base_op</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 筛选出所有未确定的数字位置 坐标</span>
    pys<span class="token punctuation">,</span> pxs <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> board<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>board <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span>visited<span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pxs<span class="token punctuation">,</span> pys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        boom_number <span class="token operator">=</span> board<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span>
        <span class="token comment"># 统计当前点周围 4*4-9*9 范围各类点的数量</span>
        unknownNum<span class="token punctuation">,</span> redNum <span class="token operator">=</span> getItemNum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> unknownNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 周围没有未点过的点可以直接忽略</span>
            visited<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">continue</span>
        <span class="token comment"># 获取周围的点的位置</span>
        points <span class="token operator">=</span> getUnknownPointList<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> boom_number <span class="token operator">==</span> unknownNum <span class="token operator">+</span> redNum<span class="token punctuation">:</span>
            <span class="token comment"># 如果当前点周围雷数=未点+插旗，说明所有未点位置都是雷，可以全部插旗</span>
            visited<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> points<span class="token punctuation">:</span>
                res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> boom_number <span class="token operator">==</span> redNum<span class="token punctuation">:</span>
            <span class="token comment"># 如果当前点周围雷数=插旗，说明所有未点位置都没有雷，可以全部点开</span>
            visited<span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">for</span> px<span class="token punctuation">,</span> py <span class="token keyword">in</span> points<span class="token punctuation">:</span>
                res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res


name <span class="token operator">=</span> <span class="token string">""</span>
hwnd <span class="token operator">=</span> get_hwnd<span class="token punctuation">(</span><span class="token punctuation">)</span>
img_match <span class="token operator">=</span> img_matchs<span class="token punctuation">[</span>name<span class="token punctuation">]</span>

activateWindow<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token comment"># 获取雷盘大小和位置</span>
<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> rect <span class="token operator">=</span> get_board_size<span class="token punctuation">(</span><span class="token punctuation">)</span>
mine_num <span class="token operator">=</span> get_mine_num<span class="token punctuation">(</span>hwnd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"宽：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">,高：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">,雷数：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>mine_num<span class="token punctuation">}</span></span><span class="token string">，雷盘位置：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>rect<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
board <span class="token operator">=</span> new_board<span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token comment"># 已经确定是雷的位置</span>
mine_know <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
update_board<span class="token punctuation">(</span><span class="token punctuation">)</span>
l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b <span class="token operator">=</span> rect

<span class="token comment"># 标记周围已经完全确定的数字位置</span>
visited <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
<span class="token comment"># 标记已经访问过的连通块</span>
block_flag <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>board<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> base_op<span class="token punctuation">(</span><span class="token punctuation">)</span>
    nb <span class="token operator">=</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> nb <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment"># py, px = random.choice(list(zip(*np.where(board == -1))))</span>
        <span class="token comment"># res.add((px, py, True))</span>
        tmp <span class="token operator">=</span> board<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> getCLKPoints<span class="token punctuation">(</span>board<span class="token punctuation">)</span>
        <span class="token keyword">except</span> futures<span class="token punctuation">.</span>_base<span class="token punctuation">.</span>TimeoutError<span class="token punctuation">:</span>
            board <span class="token operator">=</span> tmp
            py<span class="token punctuation">,</span> px <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            res<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> left <span class="token keyword">in</span> res<span class="token punctuation">:</span>
        <span class="token keyword">if</span> left<span class="token punctuation">:</span>
            click_mine_area<span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            board<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
            mine_know<span class="token punctuation">[</span>py<span class="token punctuation">,</span> px<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    nb <span class="token operator">=</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> nb <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"顺利！！！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>board <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"踩到雷了，游戏结束！"</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token comment"># 操作完毕后，更新最新的雷盘数据</span>
    update_board<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     运气好，一次性产生了一次更快的0.37秒的记录：
    </p>
    <p>
     <img alt="录制_2021_08_09_19_01_27_219" src="https://i-blog.csdnimg.cn/blog_migrate/a94d0dab23a81cb7b4ae5a5258e8667f.gif"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f61733630343034393332322f:61727469636c652f64657461696c732f313139353235303236" class_="artid" style="display:none">
 </p>
</div>


