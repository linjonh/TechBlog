---
layout: post
title: "Ubuntu-18.04-升级-Python3以Python3.8为例"
date: 2023-07-04 10:06:29 +0800
description: "Ubuntu 18.04 默认的Python3版本为Python3.6，我们想将其升级为Python"
keywords: "ubuntu18.04 python3.8"
categories: ["未分类"]
tags: ["运维", "Ubuntu", "Linux"]
artid: "131528884"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=131528884
  alt: "Ubuntu-18.04-升级-Python3以Python3.8为例"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Ubuntu 18.04 升级 Python3；以Python3.8为例
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     需求
    </h3>
    <p>
     Ubuntu 18.04 默认的Python3版本为Python3.6，我们想将其升级为Python3.8.
    </p>
    <h3>
     <a id="_3">
     </a>
     ⚠️警告
    </h3>
    <p>
     Python3升级后会
     <strong>
      破坏原先Ubuntu系统上的某些Python3依赖
     </strong>
     ，升级前请
     <strong>
      务必考虑清楚
     </strong>
    </p>
    <ul>
     <li>
      您的需求能否通过
      <strong>
       Virtualenv / Conda
      </strong>
      这类
      <strong>
       虚拟环境
      </strong>
      解决？
     </li>
     <li>
      您是否一定要
      <strong>
       全局安装
      </strong>
      新版本的Python3？是否可以
      <strong>
       从源码构建Python3
      </strong>
      且指定非全局的安装路径？
     </li>
    </ul>
    <h3>
     <a id="_8">
     </a>
     达成的效果
    </h3>
    <ul>
     <li>
      <p>
       以所有普通用户或root用户，在
       <strong>
        终端或脚本
       </strong>
       中运行python3时，会运行python3.8解释器
      </p>
     </li>
     <li>
      <p>
       以所有普通用户或root用户，在
       <strong>
        终端或脚本
       </strong>
       中运行pip或pip3时，会运行pip3.8包管理器
      </p>
     </li>
     <li>
      <p>
       升级
       <strong>
        只会影响
       </strong>
       系统中的python3、pip3与pip命令。
      </p>
     </li>
     <li>
      <p>
       升级
       <strong>
        不会影响
       </strong>
       到系统中的python命令与python2命令，也不会影响pip2命令。
      </p>
     </li>
    </ul>
    <h3>
     <a id="_16">
     </a>
     升级步骤
    </h3>
    <h4>
     <a id="Apt_18">
     </a>
     允许使用更多Apt官方源
    </h4>
    <p>
     某些定制化的Ubuntu18.04系统中，只允许用户（使用Apt）安装来自main仓库的软件包。
     <br/>
     但是Python3.8位于universe仓库，我们需要将其添加至Apt源。
    </p>
    <p>
     安装add-apt-repository工具，这是一个将新仓库添加进Apt源的工具
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> software-properties-common
</code></pre>
    <p>
     将universe仓库添加进Apt源
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> add-apt-repository universe
<span class="token function">sudo</span> <span class="token function">apt</span> update
</code></pre>
    <p>
     源更新完毕后，我们就可以通过apt来安装Python3.8了。
    </p>
    <h4>
     <a id="Python38_36">
     </a>
     安装Python3.8与相关库、头文件
    </h4>
    <p>
     安装Python3.8解释器
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3.8
</code></pre>
    <p>
     安装相关开发库与头文件
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libpython3.8-dev
</code></pre>
    <h4>
     <a id="Python38Python3_48">
     </a>
     将Python3.8设置为默认Python3解释器
    </h4>
    <p>
     参考：
     <a href="https://unix.stackexchange.com/a/410851" rel="nofollow">
      https://unix.stackexchange.com/a/410851
     </a>
    </p>
    <p>
     将刚刚安装的Python3.8解释器添加到系统Python3解释器的备选替代中
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> update-alternatives <span class="token parameter variable">--install</span> /usr/bin/python3 python3 /usr/bin/python3.8 <span class="token number">1</span>
</code></pre>
    <p>
     将系统原装的Python3.6解释器添加到系统Python3解释器的备选替代中
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> update-alternatives <span class="token parameter variable">--install</span> /usr/bin/python3 python3 /usr/bin/python3.6 <span class="token number">2</span>
</code></pre>
    <p>
     展示系统Python3解释器所有可选的版本
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> update-alternatives <span class="token parameter variable">--config</span> python3
</code></pre>
    <p>
     输入数字后回车，将系统默认的Python3解释器设置为你需要的Python3.8版本。
    </p>
    <ul>
     <li>
      执行
      <code>
       python3 --version
      </code>
      命令，此时应当输出Python3.8的版本信息。
     </li>
     <li>
      执行
      <code>
       sudo python3 --version
      </code>
      命令，此时应当输出Python3.8的版本信息。
     </li>
    </ul>
    <p>
     重启后测试一下
     <code>
      sudo apt install
     </code>
     命令是否正常工作。
    </p>
    <h4>
     <a id="Pip38_75">
     </a>
     安装Pip3.8包管理器
    </h4>
    <p>
     目前笔者没有找到包含python3.8-pip的Apt源。
     <br/>
     <strong>
      Python Packaging Authority
     </strong>
     （pypa）组织提供了安装Pip的离线脚本，用户将脚本下载后，可以在本地运行脚本安装Pip。
    </p>
    <p>
     切换到root用户，我们希望进行系统级别安装
    </p>
    <pre><code class="prism language-bash"><span class="token function">su</span> <span class="token parameter variable">-l</span>
</code></pre>
    <p>
     下载pip安装脚本，安装Pip3.8包管理器
    </p>
    <pre><code class="prism language-bash"><span class="token function">curl</span> https://bootstrap.pypa.io/get-pip.py <span class="token parameter variable">-o</span> get-pip.py
python3.8 get-pip.py
</code></pre>
    <p>
     安装完毕后切换回普通用户
    </p>
    <ul>
     <li>
      执行
      <code>
       pip3 --version
      </code>
      命令，此时应当输出适用于Python3.8的包管理器信息。
     </li>
     <li>
      执行
      <code>
       sudo pip3 --version
      </code>
      命令，此时应当输出适用于Python3.8的包管理器信息。
     </li>
    </ul>
    <h3>
     <a id="_96">
     </a>
     问题解决
    </h3>
    <h4>
     <a id="netplan__97">
     </a>
     netplan 工具执行失败
    </h4>
    <p>
     netplan是Ubuntu上的网络管理前端，依赖于Python3解释器。我们升级Python3解释器后，在执行
     <code>
      netplan
     </code>
     命令后可能会出现如下错误
    </p>
    <blockquote>
     <p>
      Traceback (most recent call last): File “/usr/sbin/netplan”, line
      <br/>
      23, in
      <br/>
      netplan.main() File “/usr/share/netplan/netplan/cli/core.py”, line 42, in main
      <br/>
      self.parse_args() File “/usr/share/netplan/netplan/cli/core.py”, line 35, in parse_args
      <br/>
      import netplan.cli.commands File “/usr/share/netplan/netplan/cli/commands/
      <strong>
       init
      </strong>
      .py”, line 18, in
      <br/>
      <br/>
      from netplan.cli.commands.apply import NetplanApply File “/usr/share/netplan/netplan/cli/commands/apply.py”, line 29, in
      <br/>
      <br/>
      import netifaces ModuleNotFoundError: No module named ‘netifaces’
     </p>
    </blockquote>
    <p>
     错误原因：找不到属于Python3.8的netifaces模块。
    </p>
    <pre><code class="prism language-bash"><span class="token function">su</span> <span class="token parameter variable">-l</span>
pip3 <span class="token function">install</span> --ignore-installed netifaces pyyaml
<span class="token builtin class-name">exit</span>
</code></pre>
    <h4>
     <a id="gnometerminal__116">
     </a>
     gnome-terminal 图形终端模拟器打开失败
    </h4>
    <p>
     在图形界面点击终端图标，报错信息：
    </p>
    <blockquote>
     <p>
      Failed to execute default Terminal Emulator. Input/output error.
     </p>
    </blockquote>
    <p>
     用开启X11转发的SSH终端单独运行
     <code>
      gnome-terminal
     </code>
     命令，报错信息：
    </p>
    <blockquote>
     <p>
      ImportError: cannot import name ‘_gi’ from partially initialized module ‘gi’ (most likely due to a circular import)
     </p>
    </blockquote>
    <p>
     错误原因：找不到属于Python3.8的gi模块。
     <br/>
     解决方法：https://stackoverflow.com/a/60352723/15283141
    </p>
    <pre><code class="prism language-bash"><span class="token function">su</span> <span class="token parameter variable">-l</span>
<span class="token function">apt</span> <span class="token function">install</span> pkg-config libcairo2-dev libgirepository1.0-dev
pip3.8 <span class="token function">install</span> --ignore-installed PyGObject
<span class="token builtin class-name">exit</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34313937333737342f:61727469636c652f64657461696c732f313331353238383834" class_="artid" style="display:none">
 </p>
</div>
