---
layout: post
title: "性能测试游戏Jank卡顿及卡顿率"
date: 2025-02-22 11:26:28 +0800
description: "文章目录一、FrameTime1 FrameTime 的定义2 FrameTime和卡顿的关联二、F"
keywords: "游戏jank"
categories: ['Unity']
tags: ['游戏', '性能', '卡顿', '优化', 'Junk']
artid: "107691813"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=107691813
    alt: "性能测试游戏Jank卡顿及卡顿率"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     性能测试：游戏Jank卡顿及卡顿率
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <a href="#FrameTime_2" rel="nofollow">
            一、FrameTime
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1_FrameTime__3" rel="nofollow">
              1 FrameTime 的定义
             </a>
            </li>
            <li>
             <a href="#2_FrameTime_5" rel="nofollow">
              2 FrameTime和卡顿的关联
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#FPS_14" rel="nofollow">
            二、FPS
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1_FPS_15" rel="nofollow">
              1 FPS的定义
             </a>
            </li>
            <li>
             <a href="#2_FPS_24" rel="nofollow">
              2 FPS帧率与卡顿的关系
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#21_iOS_26" rel="nofollow">
                2.1 iOS端
               </a>
              </li>
              <li>
               <a href="#22_Android_38" rel="nofollow">
                2.2 Android端
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
          <li>
           <a href="#_43" rel="nofollow">
            三、流畅度
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1_48" rel="nofollow">
              1、视觉惯性
             </a>
            </li>
            <li>
             <a href="#2_50" rel="nofollow">
              2、电影帧
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#PerfDogJank_54" rel="nofollow">
            四、PerfDog-Jank
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1_PerfDog_Jank__55" rel="nofollow">
              1 PerfDog Jank 计算思路
             </a>
            </li>
            <li>
             <a href="#2_PerfDog_Jank_64" rel="nofollow">
              2 PerfDog Jank计算方法
             </a>
            </li>
           </ul>
          </li>
          <li>
           <a href="#PerfDogStutter_86" rel="nofollow">
            五、PerfDog-Stutter(卡顿率)
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#1_PerfDog_Stutter__87" rel="nofollow">
              1 PerfDog Stutter 定义
             </a>
            </li>
            <li>
             <a href="#2_PerfDog_Stutter_90" rel="nofollow">
              2 PerfDog Stutter计算思路：
             </a>
            </li>
            <li>
             <a href="#3_APPJank_96" rel="nofollow">
              3 APP和游戏到底需不需要关注Jank卡顿及卡顿率
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h4>
     <a id="FrameTime_2">
     </a>
     一、FrameTime
    </h4>
    <h5>
     <a id="1_FrameTime__3">
     </a>
     1 FrameTime 的定义
    </h5>
    <p>
     两帧画面间隔耗时(也可简单认为单帧渲染耗时)。
    </p>
    <h5>
     <a id="2_FrameTime_5">
     </a>
     2 FrameTime和卡顿的关联
    </h5>
    <p>
     对于FrameTime和卡顿是否有关联？请看下图的案例图示：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4c8d3977569ca2b7bee4d1837b573bb2.png">
      <br/>
      从图中可看出画面中B帧在
      <code>
       GPU
      </code>
      渲染耗时(帧生成时间)大于显示器刷新间隔,占用两次显示器刷新耗时。也就是说有一次画面没刷新。
      <mark>
       当出现多次没有画面刷新(也就是说画面没变化)，则可能是一次卡顿
      </mark>
      。
     </img>
    </p>
    <p>
     <strong>
      从这里就得出结论
     </strong>
     ：玩家用户真正看到的是屏幕新画面刷新间隔时间，而不是
     <code>
      eglSwapbuffers-GPU
     </code>
     渲染完成(并未有提交屏幕显示)间隔时间。所以
     <mark>
      后面所提到
      <code>
       Frametime
      </code>
      统统指的是屏幕
      <code>
       Display-Frametime
      </code>
     </mark>
     。
    </p>
    <p>
     <strong>
      PerfDog工具优点：
     </strong>
     <code>
      PerfDog
     </code>
     统计的
     <code>
      FPS
     </code>
     和
     <code>
      Frametime
     </code>
     都是用户看到的屏幕Display新画面真实刷新
     <code>
      FPS
     </code>
     和帧耗时。所以大家可以直接通过
     <code>
      Frametime
     </code>
     来判断测试过程中是否出现卡顿。
    </p>
    <h4>
     <a id="FPS_14">
     </a>
     二、FPS
    </h4>
    <h5>
     <a id="1_FPS_15">
     </a>
     1 FPS的定义
    </h5>
    <p>
     <strong>
      FPS：
     </strong>
     帧率（1秒内平均画面刷新次数）。
     <br/>
     <strong>
      平均帧率：
     </strong>
     传统常说的
     <code>
      FPS
     </code>
     ，1秒内平均画面刷新次数。
     <br/>
     <strong>
      瞬时帧率：
     </strong>
     单帧耗时
     <code>
      FrameTime
     </code>
     算出来实时FPS，每一帧画面刷新耗时换算出的实时帧率。
    </p>
    <p>
     画面渲染流程图如下，每一帧
     <code>
      FrameTime
     </code>
     。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/da0d8595df6339d50895766255686b3c.png">
      <br/>
      <code>
       PerfDog
      </code>
      统计帧率及
      <code>
       FrameTime
      </code>
      如下图：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0c8ba5f54056dfe632b5c2a1f1ae9483.png"/>
     </img>
    </p>
    <h5>
     <a id="2_FPS_24">
     </a>
     2 FPS帧率与卡顿的关系
    </h5>
    <p>
     FPS帧率与卡顿是否有关系？我们分为
     <code>
      Andriod
     </code>
     和
     <code>
      iOS
     </code>
     两个场景去进一步了解：
    </p>
    <h6>
     <a id="21_iOS_26">
     </a>
     2.1 iOS端
    </h6>
    <p>
     苹果
     <code>
      WDDC
     </code>
     18年开发者大会
     <br/>
     ① FramePacing
     <br/>
     比如下面两个游戏画面,左边的试图以60帧运行,但实际只能达到40帧;右边的则持续稳定在30帧运行:
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a9bbccd6f20bd96cc9791ab64408da47.png">
      <br/>
      上图左边帧率高,反而看起来有一卡一顿的现象,这就是
      <code>
       Micro Stuttering
      </code>
      (微型口吃)导致的,左边
      <code>
       FrameTime
      </code>
      如下图：
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c714fdbd2fb30006195748dba41c884f.png">
       <br/>
       通过FrameTime可以看出，左边高帧率FPS=40帧率中出现一次
       <code>
        FrameTim&gt;=117ms
       </code>
       ，理论平均
       <code>
        FrameTime=25ms
       </code>
       。所以非均匀渲染，虽然帧率高达40，但依然觉得非常卡。
       <br/>
       右边低帧率30帧运行
       <code>
        FrameTime
       </code>
       如下图：
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/232b50147ce80425d795be27446094a7.png">
        <br/>
        从上面
        <code>
         FrameTime
        </code>
        可以看出，帧率
        <code>
         FPS=30
        </code>
        ，
        <code>
         FrameTime
        </code>
        均匀为
        <code>
         33ms
        </code>
        ，画面会非常平滑。
        <br/>
        <mark>
         总结：帧率高，未必流畅。
        </mark>
       </img>
      </img>
     </img>
    </p>
    <h6>
     <a id="22_Android_38">
     </a>
     2.2 Android端
    </h6>
    <p>
     测试系统版本：Android4.4
     <br/>
     ① 流畅度机制-黄油计划(Jank)
     <br/>
     Google Jank 计算思路：考虑视觉惯性，以硬件vsync时间间隔，连续1次vsync没有新画面刷新，则认为是一次卡顿，也就是说下一次vsync时间点没有新画面刷新，则认为是一次Jank。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/86127417c53bdae9e17e8196b93cd8ef.png"/>
    </p>
    <h4>
     <a id="_43">
     </a>
     三、流畅度
    </h4>
    <p>
     流畅度与卡顿的关联可以用以下的流程图来大致展示：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/93a2b332afdd0357e9340de6169d801e.png">
      <br/>
      流畅度影响卡顿。这个可以简单的理解为视觉惯性和电影帧这两个方面：
     </img>
    </p>
    <h5>
     <a id="1_48">
     </a>
     1、视觉惯性
    </h5>
    <p>
     视觉预期帧率，用户潜意识里认为下帧也应该是当前帧率刷新比如一直60帧，用户潜意识里认为下帧也应该是60帧率。刷新一直是25帧，用户潜意识里认为下帧也应该是25帧率。但是刷新如果是60帧一下跳变为25帧，扰乱用户视觉惯性。这个时候就会出现用户体验的卡顿感。
    </p>
    <h5>
     <a id="2_50">
     </a>
     2、电影帧
    </h5>
    <p>
     电影帧率(
     <code>
      18-24
     </code>
     )，
     <mark>
      一般是24帧
     </mark>
     。电影帧单帧耗时：
     <code>
      1000ms/24≈41.67ms
     </code>
     。
     <br/>
     <mark>
      电影帧率是一个临界点。低于这个帧率，人眼基本能感觉画面不连续性，也就是感觉到了卡顿。
     </mark>
    </p>
    <h4>
     <a id="PerfDogJank_54">
     </a>
     四、PerfDog-Jank
    </h4>
    <h5>
     <a id="1_PerfDog_Jank__55">
     </a>
     1 PerfDog Jank 计算思路
    </h5>
    <p>
     考虑视觉惯性，假设以前三帧的平均帧耗时为参考，作为
     <code>
      vsync
     </code>
     时间间隔，连续两次
     <code>
      vsync
     </code>
     没有新渲染画面刷新，则认为是一次潜在卡顿，也就是说
     <mark>
      下一帧耗时大于前三帧平均帧耗时2倍，则认为一次潜在卡顿
     </mark>
     。同时单帧耗时满足大于两倍电影帧耗时
     <code>
      1000ms/24*2
     </code>
     (由于
     <mark>
      人眼低于24帧才能辨别画面不连续性
     </mark>
     )，则认为是一次真正卡顿。同时
     <mark>
      若单帧耗时大于3倍电影帧耗时，则认为是一次严重卡顿
     </mark>
     。
    </p>
    <p>
     <strong>
      注解
     </strong>
     <br/>
     为什么是两次
     <code>
      vsync
     </code>
     ？
     <code>
      GPU
     </code>
     一般是3重缓冲
     <code>
      buffer
     </code>
     ，当前帧已占用一个
     <code>
      buffer
     </code>
     ，即剩余2缓冲
     <code>
      buffer
     </code>
     ，
     <mark>
      人眼一般可容忍2帧延迟
     </mark>
     。
    </p>
    <p>
     为什么是两帧电影帧耗时？低于24帧画面，人眼就能感知到画面不连续性，电影一般都是24帧。即电影帧耗时
     <code>
      1000ms/24≈41.67ms
     </code>
     ，两帧电影帧耗时也就是
     <code>
      41.67ms*2
     </code>
     ，三帧电影帧耗时是
     <code>
      41.67ms*3
     </code>
     。
    </p>
    <h5>
     <a id="2_PerfDog_Jank_64">
     </a>
     2 PerfDog Jank计算方法
    </h5>
    <p>
     同时满足两条件，则认为是一次
     <code>
      卡顿Jank
     </code>
     <br/>
     ①
     <code>
      Display FrameTime
     </code>
     &gt;前三帧平均耗时
     <code>
      2倍
     </code>
     。
     <br/>
     ②
     <code>
      Display FrameTime
     </code>
     &gt;两帧电影帧耗时 (
     <code>
      1000ms/24*2≈83.33ms
     </code>
     )。
    </p>
    <p>
     同时满足两条件，则认为是一次
     <code>
      严重卡顿BigJank
     </code>
     <br/>
     ①
     <code>
      Display FrameTime
     </code>
     &gt;前三帧平均耗时
     <code>
      2倍
     </code>
     。
     <br/>
     ②
     <code>
      Display FrameTim
     </code>
     e &gt;三帧电影帧耗时(
     <code>
      1000ms/24*3=125ms
     </code>
     )。
    </p>
    <p>
     <strong>
      Google-Jank如图：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/be4898299ea9e884154e97fcc86e2a0a.png"/>
     <br/>
     <strong>
      PerfDog-Jank如图：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/16f9978192fb375b571a036713079c68.png"/>
     <br/>
     真实测试FrameTime计算Jank，如下图：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/984cca98019b477f6f8421ae15861bdf.png"/>
     <br/>
     PerfDog-Jank如图：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ef046f2a0c538bda93ae297f3d771b8e.png"/>
     <br/>
     <mark>
      备注：帧率低，并不是顿卡，如帧率都是只有几帧了，还有什么顿卡而言？
     </mark>
     <br/>
     目前主流游戏对比Jank如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0f39ce04d9f918addd1a488e13787924.png"/>
    </p>
    <h4>
     <a id="PerfDogStutter_86">
     </a>
     五、PerfDog-Stutter(卡顿率)
    </h4>
    <h5>
     <a id="1_PerfDog_Stutter__87">
     </a>
     1 PerfDog Stutter 定义
    </h5>
    <p>
     测试过程中，卡顿时长的占比。即
     <code>
      Stutter(卡顿率)=卡顿时长/总时长
     </code>
    </p>
    <h5>
     <a id="2_PerfDog_Stutter_90">
     </a>
     2 PerfDog Stutter计算思路：
    </h5>
    <p>
     基于
     <code>
      PerfDog Jank
     </code>
     的基础上，一次
     <code>
      Jank
     </code>
     卡顿，会有一次卡顿时间
     <code>
      Jank time
     </code>
     。测试过程中可能有多次
     <code>
      Jank
     </code>
     卡顿，即有多次卡顿时间
     <code>
      Jank time
     </code>
     。测试总时长为
     <code>
      Time
     </code>
     。
     <br/>
     <code>
      Stutter(卡顿率) = ∑Jank time / Time
     </code>
    </p>
    <p>
     <strong>
      说明：
     </strong>
     <code>
      Jank
     </code>
     为卡顿次数，
     <code>
      Stutter
     </code>
     为卡顿率，
     <code>
      Jank
     </code>
     和
     <code>
      Stutter
     </code>
     趋势有一致性，但并非完全线性，因为每次
     <code>
      Jank
     </code>
     卡顿严重性是不一样的。同时也说明了，没有
     <code>
      Jank
     </code>
     卡顿出现，自然也就卡顿率是
     <code>
      0
     </code>
     了
    </p>
    <h5>
     <a id="3_APPJank_96">
     </a>
     3 APP和游戏到底需不需要关注Jank卡顿及卡顿率
    </h5>
    <p>
     目前主流游戏对比如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1a9ddcef9ae42d0dce565636a185b19b.png"/>
     <br/>
     从前面的知识了解到
     <code>
      FrameTime
     </code>
     、
     <code>
      FPS
     </code>
     、流畅度、
     <code>
      Jank
     </code>
     和卡顿率之间的紧密联系后，就可以顺其自然得出我们的结论：
     <br/>
     <mark>
      <code>
       APP
      </code>
      和游戏到底需需要关注
      <code>
       Jank
      </code>
      卡顿及卡顿率！
     </mark>
     理由如下：
    </p>
    <p>
     <strong>
      3.1 游戏方面
     </strong>
     <br/>
     游戏流畅度是最影响用户体验的，所以需要重点关注
     <code>
      FPS
     </code>
     、
     <code>
      Jank
     </code>
     及卡顿率。
     <br/>
     <strong>
      备注：
     </strong>
     比如游戏中已预知的卡顿，如新
     <code>
      UI
     </code>
     弹出等造成卡顿，可认为是干扰，需要剔除，不应算在
     <code>
      Jank
     </code>
     ，可通过web云上，框选右键删除干扰数据。
    </p>
    <p>
     <strong>
      3.2 APP方面
     </strong>
     <br/>
     <code>
      APP
     </code>
     也需要关注
     <code>
      FPS
     </code>
     、
     <code>
      Jank
     </code>
     及卡顿率。只是需要区分使用场景，如：
     <br/>
     1 静态页面窗口
     <br/>
     只需关注
     <code>
      FPS
     </code>
     ，理论
     <code>
      FPS
     </code>
     应该为
     <code>
      0
     </code>
     ，否则，说明有冗余刷新，容易引起手机发热及耗电。
    </p>
    <p>
     2 有滚动动画页面窗口
     <br/>
     只需关注
     <code>
      FPS
     </code>
     ，
     <code>
      FPS
     </code>
     处于合适值即可，无需高频刷新。
    </p>
    <p>
     3 快速滑动页面窗口。
     <br/>
     需要关注
     <code>
      FPS
     </code>
     、
     <code>
      Jank
     </code>
     及卡顿率。手机交互灵敏度就是来源于此，
     <code>
      Android
     </code>
     系统才出黄油计划
     <code>
      Jank
     </code>
     。一般滑动状态下，帧率越高越好，
     <code>
      Jank
     </code>
     越小越好。
    </p>
    <p>
     4 播放视频页面窗口。
     <br/>
     需要关注
     <code>
      FPS
     </code>
     、
     <code>
      Jank
     </code>
     及卡顿率，视频卡顿直接影响用户。视频一般帧率
     <code>
      18-24帧
     </code>
     ，
     <code>
      Jank=0
     </code>
     。比如微信播放视频、视频播放器等。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f6c696e78696e66612f:61727469636c652f64657461696c732f313037363931383133" class_="artid" style="display:none">
 </p>
</div>


