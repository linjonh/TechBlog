---
layout: post
title: "使用STM32的硬件SPI及软件模拟SPI的方式驱动MAX7219点阵"
date: 2022-10-16 21:36:16 +0800
description: "开发板使用STM32F103ZET6主控，可使用其自带的硬件SPI或者使用软件模拟SPI的方式驱动M"
keywords: "stm32 max7219"
categories: ['未分类']
tags: ['嵌入式硬件', '单片机', 'Stm', 'C']
artid: "127352759"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=127352759
  alt: "使用STM32的硬件SPI及软件模拟SPI的方式驱动MAX7219点阵"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用STM32的硬件SPI及软件模拟SPI的方式驱动MAX7219点阵
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      使用STM32的硬件SPI及软件模拟SPI的方式驱动MAX7219点阵
     </h4>
     <ul>
      <li>
       <a href="#max7219c_3" rel="nofollow">
        一、max7219.c。
       </a>
      </li>
      <li>
       <a href="#max7219h_156" rel="nofollow">
        二、max7219.h。
       </a>
      </li>
      <li>
       <a href="#mainc_184" rel="nofollow">
        三、main.c
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <p>
     开发板使用STM32F103ZET6主控，可使用其自带的硬件SPI或者使用软件模拟SPI的方式驱动MAX7219点阵，显示其他字符可在
     <code>
      code_disp1
     </code>
     中修改字节定义。
    </p>
    <h2>
     <a id="max7219c_3">
     </a>
     一、max7219.c。
    </h2>
    <p>
     在模拟SPI时，函数
     <code>
      Write_Max7219_byte()
     </code>
     中，对
     <code>
      Max7219_pinDIN
     </code>
     的定义不可写成
     <code>
      Max7219_pinDIN = data &amp; 0x80;
     </code>
     实测无效（暂时不知道原因，时钟太快数据处理不过来？在51单片机中可以正常使用），上电点阵无显示或者为全亮状态。使用逻辑分析仪抓取分析，
     <code>
      Max7219_pinDIN
     </code>
     一直是低电平状态，导致MAX7219无数据写入。
    </p>
    <pre><code class="prism language-javascript">#include <span class="token string">"max7219.h"</span>
#include <span class="token string">"delay.h"</span>

u8 code_disp1<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//0</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//1</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x7E</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x7E</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x7E</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//2</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//3</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token number">0xFE</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//4</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//5</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//6</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//7</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//8</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//9</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x14</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//A</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//B</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//C</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//D</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//E</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//F</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//G</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">,</span><span class="token number">0x44</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//H</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x7C</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//I</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//J</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//K</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x7C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//L</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0xC3</span><span class="token punctuation">,</span><span class="token number">0xA5</span><span class="token punctuation">,</span><span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0x81</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//M</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x62</span><span class="token punctuation">,</span><span class="token number">0x52</span><span class="token punctuation">,</span><span class="token number">0x4A</span><span class="token punctuation">,</span><span class="token number">0x46</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//N</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//O</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//P</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x1C</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x26</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x1D</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//Q</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x21</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//R</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x1E</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x3C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//S</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x3E</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//T</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x1C</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//U</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//V</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0x2A</span><span class="token punctuation">,</span><span class="token number">0x1C</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//W</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x81</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">0x24</span><span class="token punctuation">,</span><span class="token number">0x42</span><span class="token punctuation">,</span><span class="token number">0x81</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//X</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x41</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x14</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//Y</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//Z</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0x49</span><span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//中</span>
<span class="token punctuation">{<!-- --></span><span class="token number">0xFE</span><span class="token punctuation">,</span><span class="token number">0xBA</span><span class="token punctuation">,</span><span class="token number">0x92</span><span class="token punctuation">,</span><span class="token number">0xBA</span><span class="token punctuation">,</span><span class="token number">0x92</span><span class="token punctuation">,</span><span class="token number">0x9A</span><span class="token punctuation">,</span><span class="token number">0xBA</span><span class="token punctuation">,</span><span class="token number">0xFE</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//国</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

#<span class="token keyword">if</span> <span class="token constant">SPI_IS_HARDWARE</span> <span class="token comment">//判断 SPI 方式</span>

<span class="token keyword">void</span> <span class="token function">Max7219_GPIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//硬件 SPI</span>
<span class="token punctuation">{<!-- --></span>
SPI_InitTypeDef SPI1_InitStructure<span class="token punctuation">;</span>
GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
<span class="token comment">//配置 SPI1 管脚</span>
<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token operator">|</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span> <span class="token constant">ENABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_SPI1<span class="token punctuation">,</span><span class="token constant">ENABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin<span class="token operator">=</span>Max7219_pinCS_GPIO<span class="token punctuation">;</span><span class="token comment">//CS/LOAD</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed<span class="token operator">=</span>GPIO_Speed_50MHz<span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode<span class="token operator">=</span>GPIO_Mode_Out_PP<span class="token punctuation">;</span>
<span class="token function">GPIO_Init</span><span class="token punctuation">(</span><span class="token constant">GPIOA</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin<span class="token operator">=</span>Max7219_pinCLK_GPIO<span class="token operator">|</span><span class="token constant">SPI_MISO_GPIO</span><span class="token operator">|</span>Max7219_pinDIN_GPIO<span class="token punctuation">;</span><span class="token comment">//CLK MISO MOSI </span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed<span class="token operator">=</span>GPIO_Speed_50MHz<span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode<span class="token operator">=</span>GPIO_Mode_AF_PP<span class="token punctuation">;</span>
<span class="token function">GPIO_Init</span><span class="token punctuation">(</span><span class="token constant">GPIOA</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span>SPI_Direction<span class="token operator">=</span>SPI_Direction_2Lines_FullDuplex<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span>SPI_BaudRatePrescaler<span class="token operator">=</span>SPI_BaudRatePrescaler_64<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span>SPI_DataSize<span class="token operator">=</span>SPI_DataSize_8b<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span>SPI_Mode<span class="token operator">=</span>SPI_Mode_Master<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span>SPI_FirstBit<span class="token operator">=</span>SPI_FirstBit_MSB<span class="token punctuation">;</span> <span class="token comment">//高位在先</span>
SPI1_InitStructure<span class="token punctuation">.</span><span class="token constant">SPI_CPOL</span> <span class="token operator">=</span> SPI_CPOL_High<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span><span class="token constant">SPI_CPHA</span> <span class="token operator">=</span> SPI_CPHA_2Edge<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span><span class="token constant">SPI_NSS</span> <span class="token operator">=</span> SPI_NSS_Soft<span class="token punctuation">;</span>
SPI1_InitStructure<span class="token punctuation">.</span>SPI_CRCPolynomial <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token function">SPI_I2S_DeInit</span><span class="token punctuation">(</span><span class="token constant">SPI1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SPI_Init</span><span class="token punctuation">(</span><span class="token constant">SPI1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>SPI1_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SPI_Cmd</span><span class="token punctuation">(</span><span class="token constant">SPI1</span><span class="token punctuation">,</span> <span class="token constant">ENABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token comment">//功能：向 MAX7219 内部寄存器写入数据</span>
<span class="token comment">//参数：addr、dat</span>
<span class="token keyword">void</span> <span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token parameter">u8 addr<span class="token punctuation">,</span>u8 dat</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Max7219_pinCS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">SPI_I2S_SendData</span><span class="token punctuation">(</span><span class="token constant">SPI1</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入地址</span>
<span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//必须，点阵不显示时可以延长此延时调试</span>
<span class="token function">SPI_I2S_SendData</span><span class="token punctuation">(</span><span class="token constant">SPI1</span><span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入数据</span>
<span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//必须，点阵不显示时可以延长此延时调试</span>
Max7219_pinCS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#<span class="token keyword">else</span>

<span class="token keyword">void</span> <span class="token function">Max7219_GPIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token comment">//软件模拟 SPI</span>
<span class="token punctuation">{<!-- --></span>
GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span><span class="token constant">ENABLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_Out_PP<span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> Max7219_pinCS_GPIO <span class="token operator">|</span> Max7219_pinDIN_GPIO <span class="token operator">|</span> Max7219_pinCLK_GPIO<span class="token punctuation">;</span>
GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>
<span class="token function">GPIO_Init</span><span class="token punctuation">(</span><span class="token constant">GPIOA</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//功能：向 MAX7219 写入字节</span>
<span class="token comment">//入口参数：data</span>
<span class="token keyword">void</span> <span class="token function">Write_Max7219_byte</span><span class="token punctuation">(</span><span class="token parameter">u8 data</span><span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>
u8 i<span class="token punctuation">;</span>  
 Max7219_pinCS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Max7219_pinCLK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//写成 Max7219_pinDIN = data &amp; 0x80;实测无效，Max7219_pinDIN 一直是低电平</span>
<span class="token punctuation">{<!-- --></span>
Max7219_pinDIN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{<!-- --></span>
Max7219_pinDIN <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
data <span class="token operator">=</span> data<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">;</span>
Max7219_pinCLK <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//功能：向 MAX7219 内部寄存器写入数据</span>
<span class="token comment">//参数：addr、dat</span>
<span class="token keyword">void</span> <span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token parameter">u8 addr<span class="token punctuation">,</span>u8 dat</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Max7219_pinCS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">Write_Max7219_byte</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入地址</span>
<span class="token comment">//delay_us(10);//模拟 SPI 时可以去除</span>
<span class="token function">Write_Max7219_byte</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入数据</span>
<span class="token comment">//delay_us(10);</span>
Max7219_pinCS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
#endif

<span class="token keyword">void</span> <span class="token function">Init_MAX7219</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//译码方式：无</span>
<span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//亮度 </span>
<span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token number">0x0b</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//扫描界限；8 个数码管显示</span>
<span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//掉电模式：0，普通模式：1</span>
<span class="token function">Write_Max7219</span><span class="token punctuation">(</span><span class="token number">0x0f</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示测试：1；测试结束，正常显示：0</span>
<span class="token punctuation">}</span>
</code></pre>
<h2>
<a id="max7219h_156">
</a>
二、max7219.h。
</h2>
<p>
根据实际需求修改函数，修改定义
<code>
SPI_IS_HARDWARE
</code>
，确定使用硬件 SPI 或者软件模拟 SPI。本 max7219 库文件中，使用的软、硬件 SPI 引脚为同一引脚，所以在不改变引脚的情况下，可定义
<code>
SPI_IS_HARDWARE
</code>
自主选择 SPI 方式。
</p>
<pre><code class="prism language-javascript">#ifndef **MAX7219_H
#define **MAX7219_H

#include <span class="token string">"stm32f10x.h"</span>
#include <span class="token string">"sys.h"</span>

#define <span class="token constant">SPI_IS_HARDWARE</span> <span class="token number">1</span> <span class="token comment">//1：硬件 SPI；0：软件模拟 SPI</span>

#define Max7219_pinDIN_GPIO GPIO_Pin_7
#define Max7219_pinCS_GPIO GPIO_Pin_3
#define Max7219_pinCLK_GPIO GPIO_Pin_5
#define <span class="token constant">SPI_MISO_GPIO</span> GPIO_Pin_6<span class="token comment">//未使用到</span>

#define Max7219_pinDIN <span class="token function">PAout</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
#define Max7219_pinCS <span class="token function">PAout</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
#define Max7219_pinCLK <span class="token function">PAout</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">void</span> <span class="token function">Max7219_GPIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Write_Max7219_byte</span><span class="token punctuation">(</span>u8 data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Write_Max7219</span><span class="token punctuation">(</span>u8 addr<span class="token punctuation">,</span>u8 dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Init_MAX7219</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

#endif
</code></pre>
<h2>
<a id="mainc_184">
</a>
三、main.c
</h2>
<p>
主函数是对
<code>
code_disp1
</code>
数组中的字符循环显示，在实际使用当中，如果显示字符变动不频繁可将显示函数写在 while（1）之前，特别是有多个点阵级联情况下。否则会在 while 里循环刷新，级联状况下点阵会有重影（上一级的残影）。
<br/>
另外在电源突然断开再重新上电情况下，点阵屏不显示，需要手动按下单片机复位按键方可正常显示，测试后在 max7219 初始化和 SPI 初始化之前增加延时可解决，具体延时时长可自行调试。本人使用的是国产 GC7219 驱动芯片（购买时图片上标的是 MAX7219。。。），也有可能是芯片原因，MAX7219 没有试验过，后续有机会验证。
</p>
<pre><code class="prism language-javascript">#include <span class="token string">"stm32f10x.h"</span>
#include <span class="token string">"sys.h"</span>
#include <span class="token string">"delay.h"</span>
#include <span class="token string">"max7219.h"</span>

extern u8 code_disp1<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

int <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
u8 i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
<span class="token function">delay_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只能解决短暂掉电后上电点阵不显示问题，否则需要手动按复位</span>
<span class="token function">Max7219_GPIO_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Init_MAX7219</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Max7219_pinCS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">38</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token function">Write_Max7219</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>code_disp1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363935373834362f:61727469636c652f64657461696c732f313237333532373539" class_="artid" style="display:none">
 </p>
</div>
