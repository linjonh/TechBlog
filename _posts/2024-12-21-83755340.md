---
layout: post
title: "DB2数据库备份和恢复"
date: 2024-12-21 22:17:11 +0800
description: "数据库备份(离线)：C:\\Documents and Settings\\quanlun&gt;db2"
keywords: "sql2542n"
categories: ['数据库']
tags: ['无标签']
artid: "83755340"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=83755340
    alt: "DB2数据库备份和恢复"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     DB2数据库备份和恢复
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     数据库备份(离线)：
     <br/>
     C:\Documents and Settings\quanlun&gt;db2 backup db sample to 'E:\bk\test'
     <br/>
     备份成功。此备份映像的时间戳记是：20101207095857
    </p>
    <p>
     C:\Documents and Settings\quanlun&gt;db2 drop db sample
     <br/>
     DB20000I  DROP DATABASE 命令成功完成。
     <br/>
     数据库恢复：
     <br/>
     C:\Documents and Settings\quanlun&gt;db2 restore db sample from 'E:\bk\test' taken at 20101207095857 without rolling forward
     <br/>
     DB20000I  RESTORE DATABASE 命令成功完成。
     <br/>
     注意：taken at 20101207095857 当中的时间戳应当是：
     <br/>
     C:\Documents and Settings\quanlun&gt;db2 backup db sample to 'E:\bk\test'
    </p>
    <p>
     备份成功。此备份映像的时间戳记是：20101207095857
     <br/>
     当中的时间戳值，否则恢复会抛出：
     <br/>
     SQL2542N  根据所提供的源数据库别名 "SAMPLE" 和时间戳记
     <br/>
     "20101207095908"，找不到与数据库映像文件相匹配的文件。
    </p>
    <p>
     注：
     <br/>
     数据库的恢复分为：版本恢复和前滚恢复。
     <br/>
     要使用前滚恢复方法，必须已建立了数据库的备份，并且已将日志归档。
     <br/>
     此时数据库将被复原到创建离线备份映像时的状态。
     <br/>
     如果没有对复原数据库操作指定without rolling forward选项，则该数据库在复原操作结束时处于
     <br/>
     前滚暂挂状态。此时可进行前滚恢复。
    </p>
    <p>
     <br/>
     表空间级别的备份/恢复操作要求数据库处于归档日志和启用增量备份模式下。
     <br/>
     首先打开一下支持在线备份的数据库配置参数：
     <br/>
     db2 update db cfg for sample using userexit on 启用用户出口
     <br/>
     db2 update db cfg for sample using logretain on 启用归档日志
     <br/>
     db2 update db cfg for sample using trackmod on 启用增量备份功能
     <br/>
     由此得知：
     <br/>
     表空间备份和恢复只能够使用在线。
    </p>
    <p>
     例如：
     <br/>
     C:\Documents and Settings\quanlun&gt;db2 backup db sample tablespace(syscatspace,userspace1) to 'E:\bk\
     <br/>
     test'
     <br/>
     SQL2421N  因为未启用前滚恢复，所以不允许表空间级备份。
    </p>
    <p>
     注：
     <br/>
     在开启了支持在线备份的数据库配置参数：
     <br/>
     db2 update db cfg for sample using userexit on 启用用户出口
     <br/>
     db2 update db cfg for sample using logretain on 启用归档日志
     <br/>
     db2 update db cfg for sample using trackmod on 启用增量备份功能
     <br/>
     之后数据库处于backup pending状态，要求做数据库的离线全备份。
    </p>
    <p>
     C:\Documents and Settings\quanlun&gt;db2 backup db sample to 'E:\bk\test'
    </p>
    <p>
     备份成功。此备份映像的时间戳记是：20101207103724
     <br/>
     而后在做在线备份：
     <br/>
     C:\Documents and Settings\quanlun&gt;db2 backup db sample online to 'E:\bk\test'
    </p>
    <p>
     备份成功。此备份映像的时间戳记是：20101207103847
    </p>
    <p>
     基于联机全量备份进行恢复
     <br/>
     db2 restore db sample from $BAKPATH taken at 20101116145227 logtarget $OVERFLOWLOGPATH
     <br/>
     db2 rollforward db sample to end of logs and stop
     <br/>
     备注：时间点可以指定为备份时间点之后的任意时间点
    </p>
    <p>
     <br/>
     db2 restore db sample from 'E:\bk\test' taken at 20101207133115 without rolling forward
    </p>
    <p>
     <br/>
     db2 list history backup all for sample     //列出备份情况
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6d305f3337363034383636:2f61727469636c652f64657461696c732f3833373535333430" class_="artid" style="display:none">
 </p>
</div>


