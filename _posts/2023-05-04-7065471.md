---
layout: post
title: "几个步骤来删除SQL-Server数据库用户"
date: 2023-05-04 16:19:49 +0800
description: "数据库的安全是大多数数据库管理者的重大问题之一。数据库管理者经常恢复或备份数据库，这是一个很常见的场"
keywords: "the database principal owns a database role and cannot be dropped."
categories: ['未分类']
tags: ['脚本', '数据库', '任务', 'Sql', 'Sql', 'Server', 'Database']
artid: "7065471"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=7065471
  alt: "几个步骤来删除SQL-Server数据库用户"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     几个步骤来删除SQL Server数据库用户
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      数据库的安全是大多数数据库管理者的重大问题之一。
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      数据库管理者
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      经常恢复或备份数据库，这是一个很常见的场景，但事实是，成功地恢复你的数据库的新版本后，你要删除当前用户。
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      也许你以为只是扩大用户节点和删除的欲望用户，在这个意义上说，你是有点正确。
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      但是，如果你面对这样的错误：
     </span>
    </p>
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
    </p>
    <pre><code class="language-sql">Msg 15421, Level 16, State 1, Line 1
The database principal owns a database role and cannot be dropped.</code></pre>
    <br/>
    这个时候你会怎么做?
    <p>
    </p>
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
    </p>
    <p style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     Microsoft SQL Server提供了很多相当多的方式来维护数据库的安全。 这篇文章是不是微软SQL服务器的安全。
    </p>
    <p style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     在这篇文章中，我将试图解释如何解决好以下几个问题：
    </p>
    <ol style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     <li style="font-size:10pt">
      数据库主体拥有数据库的作用，不能被丢弃。
     </li>
     <li style="font-size:10pt">
      数据库主体拥有一个模式，不能删除。
     </li>
    </ol>
    解决方案
    <br/>
    <br/>
    <br/>
    我尝试分为两节，节;我们将讨论，找出其中存在的用户和部分乙角色的列表，我们将讨论如何解决它。
    <br/>
    <br/>
    <br/>
    第 一
    <br/>
    在本节中，我们的首要目标是要找出我们的目标数据库中现有的角色列表。 为此，我们用一个简单的Transact - SQL的SQL Server的SYS.DATABASE_PRINCIPALS SYS.DATABASE_PRINCIPALS表。 下面列出了一个示例SQL脚本和所需的步骤（S）：
    <br/>
    <br/>
    <br/>
    打开SQL Server Management Studio中，作为一个管理员用户登录。
    <br/>
    选择数据库，设置用户名和获取数据库角色和用户详细的执行以下Transact - SQL
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
    </p>
    <h5 style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     示例SQL脚本
    </h5>
    <p>
    </p>
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     </span>
    </p>
    <pre><code class="language-sql">SELECT     DBPRINCIPAL_1.NAME AS ROLE, DBPRINCIPAL_1.NAME AS OWNER
FROM         SYS.DATABASE_PRINCIPALS AS DBPRINCIPAL_1 INNER JOIN
                 SYS.DATABASE_PRINCIPALS AS DBPRINCIPAL_2 
		    ON DBPRINCIPAL_1.PRINCIPAL_ID = DBPRINCIPAL_2.OWNING_PRINCIPAL_ID
WHERE     (DBPRINCIPAL_1.NAME = 'User Name To Remove')  </code></pre>
    <br/>
    <code style="color:rgb(153,0,0); font-family:'Courier New',Courier,mono; font-size:11pt">
     在SYS.DATABASE_PRINCIPALS
    </code>
    <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     “表可以发现在
    </span>
    <a href="http://translate.googleusercontent.com/translate_c?hl=zh-CN&amp;ie=UTF8&amp;prev=_t&amp;rurl=translate.google.com.hk&amp;sl=en&amp;tl=zh-CN&amp;u=http://msdn.microsoft.com/en-us/library/ms187328.aspx&amp;usg=ALkJrhjrCok9bJNEPsQ0MR6fLUJQBEiVgQ" rel="nofollow" style="text-decoration:none; color:purple; font-family:Verdana,Arial,sans-serif; font-size:13px" title="MSDN">
     这个环节
    </a>
    <br/>
    <p>
    </p>
    <p>
     <br/>
    </p>
    <p>
     第二:
    </p>
    <p>
    </p>
    <p style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     我认为这不是一个非常复杂的任务，让我们开始的，您的SQL Server Management Studio中是开放的，你作为一个管理员用户，即“SA”登录。
    </p>
    <p style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     从第一个我们已经得到的清单，现在的任务是清除所需的用户。 要做到这一点，我们需要按照下面列出的步骤（S）：
    </p>
    <ol style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     <li style="font-size:10pt">
      现在展开“数据库”对象资源管理器的节点。
      <ol>
       <li style="font-size:10pt">
        选择目标数据库&gt;&gt;---&gt;安全&gt;&gt;--&gt;角色&gt;&gt;--&gt;数据库角色。
       </li>
       <li style="font-size:10pt">
        现在双击上面的SQL命令的输出中列出的条目。
       </li>
       <li style="font-size:10pt">
        改变“所有者”的一些临时用户名。
       </li>
       <li style="font-size:10pt">
        如果你要删除的用户名出现在对话框中，选择并删除它从那里也。
        <br/>
        （所有的角色，在上面的SQL查询。）
       </li>
      </ol>
     </li>
     <li style="font-size:10pt">
      导航到数据库&gt;&gt;--&gt; &gt;&gt;--&gt;目标数据库的安全&gt;&gt;--&gt;架构。
      <ol>
       <li style="font-size:10pt">
        双击打开“的db_owner”和改变架构的所有者为dbo。
       </li>
      </ol>
     </li>
     <li style="font-size:10pt">
      现在去：数据库&gt;&gt;--&gt;目标数据库&gt;&gt;--&gt;安全&gt;&gt;--&gt;用户。
     </li>
     <li style="font-size:10pt">
      右键单击要删除的用户名，点击“删除”，然后在新出现的对话框中单击“确定”。
     </li>
    </ol>
    <p style="font-family:Verdana,Arial,sans-serif; font-size:13px">
     <strong>
      注
     </strong>
     ：在完成上述步骤（S）- B节第4步除外后，您也可以尝试在
     <code style="color:rgb(153,0,0); font-family:'Courier New',Courier,mono; font-size:11pt">
      sp_dropuser
     </code>
     过程sp_dropuser。
    </p>
    <br/>
    <p>
     例子:
    </p>
    <p>
    </p>
    <pre><code class="language-sql">EXEC sp_dropuser'用户名' </code></pre>
    <br/>
    原文
    <a href="http://www.codeproject.com/KB/database/DropDBUser.aspx" rel="nofollow">
     http://www.codeproject.com/KB/database/DropDBUser.aspx
    </a>
    <p>
    </p>
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-family:Verdana,Arial,sans-serif; font-size:13px">
      <br/>
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f71713238333836383931:302f61727469636c652f64657461696c732f37303635343731" class_="artid" style="display:none">
 </p>
</div>
