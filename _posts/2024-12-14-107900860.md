---
layout: post
title: "AT命令使ESP8266对接腾讯云"
date: 2024-12-14 21:06:39 +0800
description: "文章目录0 准备工作0 准备工作1 注册了腾讯云2 使用MQTT.fx测试了云平台3 已经给你的ES"
keywords: "xxsesp2.71"
categories: ['物联网']
tags: ['物联网']
artid: "107900860"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=107900860
    alt: "AT命令使ESP8266对接腾讯云"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     AT命令使ESP8266对接腾讯云
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#0__2" rel="nofollow">
        0 准备工作
       </a>
      </li>
      <li>
       <a href="#1__13" rel="nofollow">
        1 腾讯云操作
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#11__14" rel="nofollow">
          1.1 创建产品
         </a>
        </li>
        <li>
         <a href="#12__16" rel="nofollow">
          1.2 创建设备
         </a>
        </li>
        <li>
         <a href="#13_MQTTfx_20" rel="nofollow">
          1.3 使用MQTT.fx进行测试
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#2_ESP8266_30" rel="nofollow">
        2 ESP8266模块操作
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#21__32" rel="nofollow">
          2.1 测试模块
         </a>
        </li>
        <li>
         <a href="#22__43" rel="nofollow">
          2.2 连接路由器
         </a>
        </li>
        <li>
         <a href="#23__57" rel="nofollow">
          2.3 设置平台信息
         </a>
        </li>
        <li>
         <a href="#24__62" rel="nofollow">
          2.4 配置连接服务器参数
         </a>
        </li>
        <li>
         <a href="#25__71" rel="nofollow">
          2.5 发布消息
         </a>
        </li>
        <li>
         <a href="#26__87" rel="nofollow">
          2.6 订阅消息
         </a>
        </li>
        <li>
         <a href="#27__97" rel="nofollow">
          2.7 取消订阅
         </a>
        </li>
        <li>
         <a href="#28__102" rel="nofollow">
          2.8 查看客户端连接状态
         </a>
        </li>
        <li>
         <a href="#29__106" rel="nofollow">
          2.9 断开腾讯云连接
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="0__2">
     </a>
     0 准备工作
    </h2>
    <ul>
     <li>
      1 注册了腾讯云
     </li>
     <li>
      2 使用MQTT.fx测试了云平台（腾讯云比阿里云方便，几乎所有东西都已经给你生成好了，直接复制到MQTT.fx就行了，不用像阿里云需要自己去生成）
     </li>
     <li>
      3 已经给你的ESP8266模块烧录了支持MQTT的固件，腾讯云和阿里云都有提供相应的固件。
     </li>
     <li>
      4 打开安信可官方的串口调试工具（官网上有下载，其他串口调试工具也可以）
     </li>
    </ul>
    <p>
     下面给出固件下载网址
     <br/>
     <a href="https://docs.ai-thinker.com/_media/esp8266/aithinker_qcloud_at.rar" rel="nofollow">
      https://docs.ai-thinker.com/_media/esp8266/aithinker_qcloud_at.rar
     </a>
    </p>
    <h2>
     <a id="1__13">
     </a>
     1 腾讯云操作
    </h2>
    <h3>
     <a id="11__14">
     </a>
     1.1 创建产品
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e06e01e09b2eae3ca02ec5783fe10316.png"/>
    </p>
    <h3>
     <a id="12__16">
     </a>
     1.2 创建设备
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b282fef14a4098dfe94745fda14ea24b.png"/>
    </p>
    <h3>
     <a id="13_MQTTfx_20">
     </a>
     1.3 使用MQTT.fx进行测试
    </h3>
    <ul>
     <li>
      将设备密钥复制到MQTT.FX中即可。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1ece8b094de9bc4b603017dccadecf19.png"/>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/edc9da61810284280f187511600ed2e5.png">
      <br/>
      有几点说明一下：
      <br/>
      <strong>
       Profile Name
      </strong>
      用户自定义名称
      <br/>
      <strong>
       Broker Address
      </strong>
      ：PRODUCT_ID.iotcloud.tencentdevices.com
      <br/>
      <strong>
       Client ID
      </strong>
      ：MQTT 协议字段，按照物联网通信约束填入：产品 ID + 设备名，如："TXXXXDS8Gdev001 "，TXXXXDS8G 是产品 ID，dev001 是设备名称。
     </img>
    </p>
    <h2>
     <a id="2_ESP8266_30">
     </a>
     2 ESP8266模块操作
    </h2>
    <h3>
     <a id="21__32">
     </a>
     2.1 测试模块
    </h3>
    <ul>
     <li>
      使用以下的几条命令测试模块。
     </li>
    </ul>
    <pre><code class="prism language-c">AT	<span class="token comment">//测试是否启动</span>
AT<span class="token operator">+</span>GMR	<span class="token comment">//查看版本信息</span>
AT<span class="token operator">+</span>CIFSR	<span class="token comment">//查询连接信息</span>
AT<span class="token operator">+</span>CWMODE<span class="token operator">?</span>	<span class="token comment">//查询当前模式</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/adcfcef2e1f423ea267a9772cc8d8b5f.png"/>
    </p>
    <h3>
     <a id="22__43">
     </a>
     2.2 连接路由器
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>CWMODE<span class="token operator">=</span><span class="token number">1</span>  <span class="token comment">//设置为STA模式</span>
AT<span class="token operator">+</span>CWJAP<span class="token operator">=</span><span class="token string">"xxs"</span><span class="token punctuation">,</span><span class="token string">"123456789"</span> <span class="token comment">//输入路由ssid和密码</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dbcbf32f52ee2a0c6c1874db8442af8b.png"/>
    </p>
    <ul>
     <li>
      连接完毕后可以使用下面的命令进行网络测试
     </li>
    </ul>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>PING<span class="token operator">=</span><span class="token string">"baidu.com"</span>
</code></pre>
    <h3>
     <a id="23__57">
     </a>
     2.3 设置平台信息
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCDEVINFOSET<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"产品ID"</span><span class="token punctuation">,</span><span class="token string">"ESP8266_1"</span><span class="token punctuation">,</span><span class="token string">"设备密钥"</span><span class="token comment">//输入平台信息</span>
</code></pre>
    <h3>
     <a id="24__62">
     </a>
     2.4 配置连接服务器参数
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTCONN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span>
</code></pre>
    <ul>
     <li>
      然后我们就可以看到腾讯云上设备上线了。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5d6f93f0de3cfea6c2cc5239ce7b74f2.png"/>
     </li>
    </ul>
    <h3>
     <a id="25__71">
     </a>
     2.5 发布消息
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2d65eafb6b98a78412d1051450c026e2.png"/>
    </p>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTPUB<span class="token operator">=</span><span class="token string">"产品ID/设备名称/event"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"hello"</span><span class="token comment">//填入要发布的消息</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b562c06934bad070d9689a17f8ef1b76.png"/>
    </p>
    <ul>
     <li>
      然后我们就可以在日志里看到了。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/247e66ed4698759a39297647f04a291f.png"/>
     </li>
     <li>
      想发送长消息，如下命令
     </li>
    </ul>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTPUB<span class="token operator">=</span><span class="token string">"产品ID/ESP8266_1/event"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2048</span> <span class="token comment">//发送长消息（长度最大2048字节）</span>
</code></pre>
    <h3>
     <a id="26__87">
     </a>
     2.6 订阅消息
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTSUB<span class="token operator">=</span><span class="token string">"产品ID/ESP8266_1/control"</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token comment">//填入订阅的主题</span>
</code></pre>
    <ul>
     <li>
      然后我们在云平台上在线调试
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/65ea4b5cea2b1e55eaa511ec23bd9a94.png"/>
     </li>
     <li>
      发送后，我们看到esp8266收到了
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/046c5658be96aba725784a9871564eb6.png"/>
    </p>
    <h3>
     <a id="27__97">
     </a>
     2.7 取消订阅
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTUNSUB<span class="token operator">=</span><span class="token string">"产品id/ESP8266_1/control"</span> <span class="token comment">//取消订阅主题</span>
</code></pre>
    <h3>
     <a id="28__102">
     </a>
     2.8 查看客户端连接状态
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTSTATE<span class="token operator">?</span> <span class="token comment">//客户端连接状态</span>
</code></pre>
    <h3>
     <a id="29__106">
     </a>
     2.9 断开腾讯云连接
    </h3>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>TCMQTTDISCONN <span class="token comment">//断开服务器连接</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/787426c1c3c64ccd00c3bec757113a97.png"/>
    </p>
    <p>
     当然，这篇文章只是使腾讯云和ESP8266通信上，接下来一篇，我们将创建物模型。然后对接。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363032373530352f:61727469636c652f64657461696c732f313037393030383630" class_="artid" style="display:none">
 </p>
</div>


