---
layout: post
title: "STM32使用硬件IIC读取SHTC3温湿度传感器-显示在OLED屏上"
date: 2025-01-22 09:57:33 +0800
description: "STM32使用硬件I2C读取SHTC3温湿度传感器的数据并显示在0.96寸OLED屏上。_stm32"
keywords: "stm32olediic显示文字温湿度"
categories: ['单片机嵌入式']
tags: ['嵌入式硬件', '单片机', 'Stm', 'C', 'Arm']
artid: "127688867"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=127688867
    alt: "STM32使用硬件IIC读取SHTC3温湿度传感器-显示在OLED屏上"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     STM32使用硬件IIC读取SHTC3温湿度传感器 显示在OLED屏上
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     STM32使用硬件I2C读取SHTC3温湿度传感器的数据并显示在0.96寸OLED屏上。
    </p>
    <p>
     我用的是STM32F103C8T6，程序用的是ST标准库写的。
    </p>
    <h3>
     <a id="_4">
     </a>
     实现效果图
    </h3>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/7482d62d68411a2bd195713c89dc4460.jpeg">
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/eae7fa71af2cdb685333c03ef927659d.gif"/>
     </img>
    </p>
    <h3>
     <a id="I2C_9">
     </a>
     I2C协议简介
    </h3>
    <p>
     I2C 通讯协议(Inter－Integrated Circuit)是由 Phiilps 公司开发的，由于它引脚少，硬件实现简单，可扩展性强，不需要 USART、CAN 等通讯协议的外部收发设备（那些电平转化芯片），现在被广泛地使用在系统内多个集成电路(IC)间的通讯。
    </p>
    <p>
     I2C只有一跟数据总线 SDA(Serial Data Line)，串行数据总线，只能一位一位的发送数据，属于串行通信，采用半双工通信
    </p>
    <p>
     半双工通信：可以实现双向的通信，但不能在两个方向上同时进行，必须轮流交替进行，其实也可以理解成一种可以切换方向的单工通信，同一时刻必须只能一个方向传输，只需一根数据线.
     <br/>
     对于I2C通讯协议把它分为物理层和协议层物理层规定通讯系统中具有机械、电子功能部分的特性（硬件部分），确保原始数据在物理媒体的传输。协议层主要规定通讯逻辑，统一收发双方的数据打包、解包标准（软件层面）。
    </p>
    <h3>
     <a id="I2C_18">
     </a>
     I2C物理层
    </h3>
    <p>
     <strong>
      I2C 通讯设备之间的常用连接方式
     </strong>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/087281f3a274cb9ac574bf0193782af8.png"/>
    </p>
    <p>
     (1) 它是一个支持多设备的总线。“总线”指多个设备共用的信号线。在一个 I2C 通讯总线中，可连接多个 I2C 通讯设备，支持多个通讯主机及多个通讯从机。
    </p>
    <p>
     (2) 一个 I2C 总线只使用两条总线线路，一条双向串行数据线SDA（Serial Data Line ），一条串行时钟线SCL（Serial Data Line ）。数据线即用来表示数据，时钟线用于数据收发同步
    </p>
    <p>
     (3) 总线通过上拉电阻接到电源。
     <strong>
      当 I2C 设备空闲时会输出高阻态
     </strong>
     ，而当所有设备都空闲，都输出高阻态时，
     <strong>
      由上拉电阻把总线拉成高电平
     </strong>
     。
    </p>
    <p>
     I2C通信时单片机GPIO口必须设置为开漏输出，否则可能会造成短路。
    </p>
    <p>
     关于更多STM32的I2C相关信息和使用方法可以看这篇文章：
     <a href="https://url.zeruns.tech/JC0Ah" rel="nofollow">
      https://url.zeruns.tech/JC0Ah
     </a>
    </p>
    <p>
     我这里就不详细讲解了。
    </p>
    <h3>
     <a id="SHTC3_36">
     </a>
     SHTC3温湿度传感器
    </h3>
    <p>
     SHTC3数据手册下载地址：
     <a href="https://url.zeruns.tech/WpLDy" rel="nofollow">
      https://url.zeruns.tech/WpLDy
     </a>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/72dfc951230b505a337337abd7200d5e.png"/>
    </p>
    <p>
     浏览数据手册可以得到一个大概信息，SHTC3是一个可以检测温度和湿度的传感器，
     <br/>
     温度范围：-40℃~125℃
     <br/>
     湿度范围：0%~100%
     <br/>
     工作电压：1.6v~3.6v
     <br/>
     通讯方式：i2c
     <br/>
     时钟频率：三种模式分别是 0 ~ 100kHz 0 ~ 400kHz 0 ~ 1000kHz
    </p>
    <p>
     找到如下几个关键信息
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/ca3890477beb73b795d9f0e651f7ea0f.png"/>
    </p>
    <h4>
     <a id="_53">
     </a>
     温湿度设备地址和读写命令
    </h4>
    <p>
     在实际的使用过程中，SHTC3的设备地址需要与读写数据/命令方向位组成一个字节同时发送，字节的最低位为读写数据/命令方向位，高7位是SHTC3的设备地址。
    </p>
    <p>
     如果要通过I2C写数据或命令给SHTC3，在I2C起始信号之后，需要发送“1110 0000”，即0xE0给SHTC3，除了通过高7位“1110 000”的设备地址寻址还通过最低位“0”通知SHTC3接下来是写数据或命令操作。
    </p>
    <p>
     如果要通过I2C读取SHTC3中的数据，在I2C起始信号之后，需要发送“1110 0001”，即0xE1给SHTC3，除了通过高7位“1110 000”的设备地址寻址还通过最低位“1”通知SHTC3接下来是读取数据的操作。
     <br/>
     简单来说就是，0xE0表示写数据，0xE1表示读数据。不过使用STM32硬件I2C时只需要输入0xE0就行，最低位标准库会处理的。
    </p>
    <h4>
     <a id="_62">
     </a>
     读取温湿度数据
    </h4>
    <p>
     <img alt="=" src="https://i-blog.csdnimg.cn/blog_migrate/b3c1a27461939b7a3a472fbfff5e3ca7.png"/>
    </p>
    <p>
     可知，不同的命令，除了获取的数据顺序不一样，还有一个Clock Stretching Enable 和 Disable的区别。
    </p>
    <p>
     Clock Stretching是时钟拉伸的意思。如果使用Clock Stretching Enable命令的话，那么发送完测量命令之后，在SHTC3测量温度湿度数据的过程中，SHTC3会拉低I2C的时钟线SCL，通过这样来禁止主机发送命令给SHTC3，只有当SHTC3完成温度湿度数据测量时，SHTC3才会释放时钟线SCL。
    </p>
    <p>
     如果使用Clock Stretching Disable命令的话，在SHTC3测量数据的过程中，SHTC3并不会拉低I2C的时钟线SCL，只是如果主机在SHTC3测量数据的过程中发送命令或数据的时候，SHTC3是不会响应主机的，主机可以通过SHTC3是否有响应信号来判断SHTC3是否完成数据的测量。
    </p>
    <p>
     从数据手册可知，一个测量周期包概括四个步骤：
    </p>
    <ol>
     <li>
      发送唤醒命令。
     </li>
     <li>
      发送测量命令
     </li>
     <li>
      读取测量完成之后的数据。
     </li>
     <li>
      发送休眠命令。
     </li>
    </ol>
    <p>
     以上唤醒命令和休眠命令在数据手册中查询。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4dd373a1421f6c895c613d4c926f99cd.png"/>
    </p>
    <p>
     总结如下：
    </p>
    <ol>
     <li>
      唤醒SHTC3：先发送写入指令（0xE0），再发送唤醒指令高位（0x35）,再发送唤醒指令低位（0x17）。
     </li>
     <li>
      等待唤醒：数据手册上写的最大唤醒时间是240us，等待的时间大于这个就行了。
     </li>
     <li>
      发送采集指令：先发送写入指令（0xE0），再发送采集指令的高位和低位。采集指令有多个，根据需要自行选择。
     </li>
     <li>
      接收数据：发送读取指令（0xE1），连续接收6个字节数据。如果采集的指令是先存温度，那么这6个字节的第1-2个字节就是温度数值，第3个字节是温度校验。第4-5个字节是湿度数值，第6个字节是湿度校验。如果采集的指令是先存湿度，则前3个字节和后3个字节相反。
     </li>
     <li>
      进入睡眠：发送写入指令，再发送睡眠指令进入睡眠。
     </li>
    </ol>
    <h4>
     <a id="_91">
     </a>
     数据的计算
    </h4>
    <p>
     由shtc3数据手册可知
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/8d3a117f995194b46231c79e71d83184.png"/>
    </p>
    <p>
     例如：采集到的湿度数值是0x6501，换算成十进制是25857。
     <br/>
     则：湿度 = 100 * 25857 / 65536 = 39.45 （单位：%）
     <br/>
     采集到的温度数值是0x6600，换算成十进制是26112。
     <br/>
     则：温度 = -45 + 175 * 26112 / 65536 = 24.72 （单位：℃）
    </p>
    <h3>
     <a id="_102">
     </a>
     需要用的元件
    </h3>
    <p>
     STM32最小系统板：
     <a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DUTjDSiXdv7EcQipKwQzePOeEDrYVVa64juWlisr3dOdyINtkUhsv0G%2F5Li6yrMLzSYZjLtJ5crNwhoUbHqff68jZ7535vk8bNdRZtVGuqUX9cmhLhcbMmqktrAX%2B3B0wgvUNyyJS1KL3%2BWMkG3VUswz6PFeWrdXKBR%2BfhpAlqN0Nijc7qy1tWXgUQmPrY5Yy&amp;scm=null&amp;pvid=null&amp;app_pvid=59590_33.43.249.224_859_1667479238995&amp;ptl=floorId%3A17741&amp;originalFloorId%3A17741&amp;app_pvid%3A59590_33.43.249.224_859_1667479238995&amp;union_lens=lensId%3APUB%401667479239%40212bf9e0_0a8e_1843d81f96b_5743%4002QYUm1IXiT827H21FWmWfR" rel="nofollow">
      https://s.click.taobao.com/bqMwZRu
     </a>
     <br/>
     SHTC3模块：
     <a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DE62whUhHFvQcQipKwQzePOeEDrYVVa64juWlisr3dOdyINtkUhsv0G%2F5Li6yrMLzn7AyY1XWk1twhoUbHqff68jZ7535vk8bNdRZtVGuqUX9cmhLhcbMmqktrAX%2B3B0wgvUNyyJS1KL3%2BWMkG3VUszOC0je%2BFrZx%2FSvVSbsaY5KlHgHjuxtTVPlFKucaLppB&amp;scm=null&amp;pvid=null&amp;app_pvid=59590_33.7.21.27_863_1667479296737&amp;ptl=floorId%3A17741&amp;originalFloorId%3A17741&amp;app_pvid%3A59590_33.7.21.27_863_1667479296737&amp;union_lens=lensId%3APUB%401667479296%402107151b_09a2_1843d82db0e_a7b6%40022GXHkZt7gTK2SlDoVFIT9C" rel="nofollow">
      https://s.click.taobao.com/WxACJRu
     </a>
     <br/>
     OLED模块：
     <a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DShC0OYycM5EcQipKwQzePOeEDrYVVa64juWlisr3dOdyINtkUhsv0G%2F5Li6yrMLz9ByeIBZYeKxwhoUbHqff68jZ7535vk8bNdRZtVGuqUX9cmhLhcbMmqktrAX%2B3B0wgvUNyyJS1KL3%2BWMkG3VUs6o%2FQzBeLPrUwnqtpvx36vhxbMKNudoqKcYMXU3NNCg%2F&amp;scm=null&amp;pvid=null&amp;app_pvid=59590_33.44.188.180_870_1667479380859&amp;ptl=floorId%3A17741&amp;originalFloorId%3A17741&amp;app_pvid%3A59590_33.44.188.180_870_1667479380859&amp;union_lens=lensId%3APUB%401667479380%40212cbcb4_0ac2_1843d84239b_23b3%40022xK11G1bEygZLlriWllkQa" rel="nofollow">
      https://s.click.taobao.com/aNlvZRu
     </a>
     <br/>
     杜邦线：
     <a href="https://s.click.taobao.com/t?e=m%3D2%26s%3D1xq53LZql%2FQcQipKwQzePOeEDrYVVa64juWlisr3dOdyINtkUhsv0G%2F5Li6yrMLzBdzZorqN0KFwhoUbHqff68jZ7535vk8bNdRZtVGuqUX9cmhLhcbMmqktrAX%2B3B0wgvUNyyJS1KL3%2BWMkG3VUs6o%2FQzBeLPrUypxCHWKuuLheHX9UXer8ynEqY%2Bakgpmw&amp;scm=null&amp;pvid=null&amp;app_pvid=59590_33.6.253.17_872_1667479420442&amp;ptl=floorId%3A17741&amp;originalFloorId%3A17741&amp;app_pvid%3A59590_33.6.253.17_872_1667479420442&amp;union_lens=lensId%3APUB%401667479420%402106fd11_0c06_1843d84be38_8256%400245soKiEU0fExMOxTG6tOaG" rel="nofollow">
      https://s.click.taobao.com/xAkAJRu
     </a>
     <br/>
     面包板：
     <a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DVjyGoXUVY7AcQipKwQzePOeEDrYVVa64juWlisr3dOdyINtkUhsv0G%2F5Li6yrMLzJgcT6S%2F%2BS%2FZwhoUbHqff68jZ7535vk8bNdRZtVGuqUX9cmhLhcbMmqktrAX%2B3B0wgvUNyyJS1KL3%2BWMkG3VUs6o%2FQzBeLPrUlVAd73Mv%2FUpy69IEKxg%2F3JPXYvbCwWqRomfkDJRs%2BhU%3D&amp;scm=null&amp;pvid=null&amp;app_pvid=59590_33.42.176.165_900_1667479524894&amp;ptl=floorId%3A17741&amp;originalFloorId%3A17741&amp;app_pvid%3A59590_33.42.176.165_900_1667479524894&amp;union_lens=lensId%3APUB%401667479524%40212ab0a5_09bc_1843d865641_3299%4002FUGbrEOW3lC3spkpKfLvF" rel="nofollow">
      https://s.click.taobao.com/ShJAJRu
     </a>
     <br/>
     ST-LINK V2：
     <a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DoWOOdkA2xEYcQipKwQzePOeEDrYVVa64Dne87AjQPk9yINtkUhsv0G%2F5Li6yrMLzLtEBlWvgMl5whoUbHqff68jZ7535vk8bNdRZtVGuqUX9cmhLhcbMmqktrAX%2B3B0wgvUNyyJS1KL3%2BWMkG3VUs7E0cXfLBSzzMocVbYVY6Hb3REQwOMImQTpQVc%2F15fHLxg5p7bh%2BFbQ%3D&amp;scm=null&amp;pvid=null&amp;app_pvid=59590_33.43.254.46_907_1667479645405&amp;ptl=floorId%3A17741&amp;originalFloorId%3A17741&amp;app_pvid%3A59590_33.43.254.46_907_1667479645405&amp;union_lens=lensId%3APUB%401667479645%40212bfe2e_0a1c_1843d882cfe_74a0%40024361D6D2trXCTrp78Daojo" rel="nofollow">
      https://s.click.taobao.com/C8ftZRu
     </a>
    </p>
    <h3>
     <a id="_111">
     </a>
     程序
    </h3>
    <p>
     <strong>
      这里就放出main.c、shtc3.c和oled.c这三个主要的代码，其他的请下载下面链接的压缩包。
     </strong>
    </p>
    <p>
     完整工程文件：
     <a href="https://url.zeruns.tech/EXCvo" rel="nofollow">
      https://url.zeruns.tech/EXCvo
     </a>
    </p>
    <p>
     SHTC3和OLED模块的SCL接PB6，SDA接PB7。
    </p>
    <p>
     使用VSCode代替Keil实现STM32和51单片机的开发：
     <a href="https://blog.zeruns.tech/archives/690.html" rel="nofollow">
      https://blog.zeruns.tech/archives/690.html
     </a>
    </p>
    <p>
     <strong>
      main.c
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span>                  <span class="token comment">// Device header</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"OLED.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IWDG.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SHTC3.h"</span></span>

<span class="token class-name">uint16_t</span> <span class="token function">numlen</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">IWDG_Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//初始化看门狗</span>
	<span class="token function">OLED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//初始化OLED屏</span>
	<span class="token function">SHTC3_I2C_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//初始化SHTC3</span>
	
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"T:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"H:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"err_count:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">uint32_t</span> a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token class-name">uint16_t</span> err_count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		a<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token operator">==</span><span class="token number">999999999</span><span class="token punctuation">)</span>a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token keyword">float</span> Temp<span class="token punctuation">,</span>Hum<span class="token punctuation">;</span>			<span class="token comment">//声明变量存放温湿度数据</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ReadSHTC3</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Hum<span class="token punctuation">,</span><span class="token operator">&amp;</span>Temp<span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">//读取温湿度数据</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Temp<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">char</span> String<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">"%.2fC"</span><span class="token punctuation">,</span> Temp<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//格式化字符串输出到字符串变量</span>
				<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示温度</span>
				<span class="token comment">/*
				OLED_ShowNum(1,3, (uint8_t)Temp, numlen((uint8_t)Temp));//显示温度整数部分
				OLED_ShowChar(1, 3+numlen((uint8_t)Temp), '.');			//显示小数点
				OLED_ShowNum(1,3+numlen((uint8_t)Temp)+1, (uint8_t)(Temp*100)%100, 2);	//显示温度小数部分
				OLED_ShowChar(1, 3+numlen((uint8_t)Temp)+1+2, 'C');		//显示符号
				*/</span>

				<span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">"%.2f%%"</span><span class="token punctuation">,</span> Hum<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//格式化字符串输出到字符串变量</span>
				<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示湿度</span>
				<span class="token comment">/*
				OLED_ShowNum(2,3, (uint8_t)Hum, numlen((uint8_t)Hum));	//显示湿度整数部分
				OLED_ShowChar(2, 3+numlen((uint8_t)Hum), '.');			//显示小数点
				OLED_ShowNum(2,3+numlen((uint8_t)Hum)+1, (uint8_t)(Hum*100)%100, 2);	//显示湿度小数部分
				OLED_ShowChar(2, 3+numlen((uint8_t)Hum)+1+2, '%');			//显示符号
				*/</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">char</span> String<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">"-%.2fC"</span><span class="token punctuation">,</span> Temp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//格式化字符串输出到字符串变量</span>
				<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示温度</span>
				<span class="token comment">/*
				OLED_ShowChar(1, 3, '-');			//显示负号
				OLED_ShowNum(1,3+1, (uint8_t)Temp, numlen((uint8_t)Temp));	//显示温度整数部分
				OLED_ShowChar(1, 3+1+numlen((uint8_t)Temp), '.');			//显示小数点
				OLED_ShowNum(1,3+1+numlen((uint8_t)Temp)+1, (uint8_t)(Temp*100)%100, 2);	//显示温度小数部分
				OLED_ShowChar(1, 3+1+numlen((uint8_t)Temp)+1+2, 'C');		//显示符号
				*/</span>

				<span class="token function">sprintf</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> <span class="token string">"%.2f%%"</span><span class="token punctuation">,</span> Hum<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//格式化字符串输出到字符串变量</span>
				<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示湿度</span>
				<span class="token comment">/*
				OLED_ShowNum(2,3, (uint8_t)Hum, numlen((uint8_t)Hum));	//显示湿度整数部分
				OLED_ShowChar(2, 3+numlen((uint8_t)Hum), '.');			//显示小数点
				OLED_ShowNum(2,3+numlen((uint8_t)Hum)+1, (uint8_t)(Hum*100)%100, 2);	//显示湿度小数部分
				OLED_ShowChar(2, 3+numlen((uint8_t)Hum)+1+2, '%');			//显示符号
				*/</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			err_count<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span> err_count<span class="token punctuation">,</span> <span class="token function">numlen</span><span class="token punctuation">(</span>err_count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//显示错误次数计数</span>
		<span class="token punctuation">}</span>
	<span class="token comment">/*
	https://blog.zeruns.tech
	*/</span>

		<span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//延时100毫秒</span>

		<span class="token function">IWDG_FeedDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//喂狗（看门狗，超过1秒没有执行喂狗则自动复位）</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  计算整数长度
  * @param  num 要计算长度的整数
  * @retval 长度值
  */</span>
<span class="token class-name">uint16_t</span> <span class="token function">numlen</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> num<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">uint16_t</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// 初始长度为0</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> num <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">++</span>len<span class="token punctuation">)</span>    <span class="token comment">// 判断num是否大于0，否则长度+1</span>
        num <span class="token operator">/=</span> <span class="token number">10</span><span class="token punctuation">;</span>	         <span class="token comment">// 使用除法进行运算，直到num小于1</span>
    <span class="token keyword">return</span> len<span class="token punctuation">;</span>              <span class="token comment">// 返回长度的值</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      SHTC3.c
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>

<span class="token comment">/*SHTC3地址*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SHTC3_ADDRESS</span> <span class="token expression"><span class="token number">0xE0</span></span></span>

<span class="token comment">/*设置使用哪一个I2C*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">I2Cx</span> <span class="token expression">I2C1</span></span>

<span class="token comment">/*
https://blog.zeruns.tech
*/</span>

<span class="token comment">/**
  * @brief  CRC校验，CRC多项式为：x^8+x^5+x^4+1，即0x31
  * @param  DAT 要校验的数据
  * @retval 校验码
  */</span>
<span class="token class-name">uint8_t</span> <span class="token function">SHTC3_CRC_CAL</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> DAT<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">,</span>t<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>
	<span class="token class-name">uint8_t</span> CRC_BYTE<span class="token punctuation">;</span>

	CRC_BYTE <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
	temp <span class="token operator">=</span> <span class="token punctuation">(</span>DAT<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		CRC_BYTE <span class="token operator">^=</span> temp<span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>i <span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>CRC_BYTE <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				CRC_BYTE <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				CRC_BYTE <span class="token operator">^=</span> <span class="token number">0x31</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				CRC_BYTE <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span><span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			temp <span class="token operator">=</span> DAT <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> CRC_BYTE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*发送起始信号*/</span>
<span class="token keyword">void</span> <span class="token function">SHTC3_I2C_START</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">I2C_GetFlagStatus</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> I2C_FLAG_BUSY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等待总线空闲</span>
	<span class="token function">I2C_GenerateSTART</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送起始信号</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>I2C_EVENT_MASTER_MODE_SELECT<span class="token punctuation">)</span><span class="token operator">==</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测EV5事件</span>
<span class="token punctuation">}</span>

<span class="token comment">/*发送停止信号*/</span>
<span class="token keyword">void</span> <span class="token function">SHTC3_I2C_STOP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">I2C_GenerateSTOP</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送停止信号</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  发送两个字节数据
  * @param  MSB 高8位
  * @param  LSB 低8位
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">SHTC3_WriteByte</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> MSB<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> LSB<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">SHTC3_I2C_START</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//发送起始信号</span>
	
	<span class="token function">I2C_Send7bitAddress</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> SHTC3_ADDRESS<span class="token punctuation">,</span> I2C_Direction_Transmitter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//发送设备写地址</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>I2C_EVENT_MASTER_TRANSMITTER_MODE_SELECTED<span class="token punctuation">)</span><span class="token operator">==</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//检测EV6事件</span>

    <span class="token function">I2C_SendData</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> MSB<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送高8位数据</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> I2C_EVENT_MASTER_BYTE_TRANSMITTED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测EV8事件</span>
   
	<span class="token function">I2C_SendData</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> LSB<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送低8位数据</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> I2C_EVENT_MASTER_BYTE_TRANSMITTED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测EV8事件</span>
	
	<span class="token function">I2C_GenerateSTOP</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送停止信号</span>
	
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  读取数据
  * @retval 读取到的字节数据
  */</span>
<span class="token class-name">uint8_t</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>I2C_EVENT_MASTER_BYTE_RECEIVED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测EV7事件</span>
	<span class="token keyword">return</span> <span class="token function">I2C_ReceiveData</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取数据并返回</span>
<span class="token punctuation">}</span>

<span class="token comment">/*软件复位SHTC3*/</span>
<span class="token keyword">void</span> <span class="token function">SHTC3_SoftReset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>                    
<span class="token punctuation">{<!-- --></span>
    <span class="token function">SHTC3_WriteByte</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x5D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//重置SHTC3</span>
<span class="token punctuation">}</span>

<span class="token comment">/*引脚初始化*/</span>
<span class="token keyword">void</span> <span class="token function">SHTC3_I2C_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_I2C1<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//使能I2C1时钟</span>
	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使能GPIOB时钟</span>
 
	<span class="token comment">/*STM32F103芯片的硬件I2C1: PB6 -- SCL; PB7 -- SDA */</span>
	GPIO_InitTypeDef  GPIO_InitStructure<span class="token punctuation">;</span>               <span class="token comment">//定义结构体配置GPIO</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span>  GPIO_Pin_6 <span class="token operator">|</span> GPIO_Pin_7<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>   
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_AF_OD<span class="token punctuation">;</span>		<span class="token comment">//设置输出模式为开漏输出，需接上拉电阻</span>
	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//初始化GPIO</span>
	
	<span class="token function">I2C_DeInit</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//将外设I2C寄存器重设为缺省值</span>
	I2C_InitTypeDef  I2C_InitStructure<span class="token punctuation">;</span>                 <span class="token comment">//定义结构体配置I2C</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_Mode <span class="token operator">=</span> I2C_Mode_I2C<span class="token punctuation">;</span>			<span class="token comment">//工作模式</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_DutyCycle <span class="token operator">=</span> I2C_DutyCycle_2<span class="token punctuation">;</span>	<span class="token comment">//时钟占空比，Tlow/Thigh = 2</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_OwnAddress1 <span class="token operator">=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>	<span class="token comment">//主机的I2C地址,用不到则随便写，无影响</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_Ack <span class="token operator">=</span> I2C_Ack_Enable<span class="token punctuation">;</span>	<span class="token comment">//使能应答位</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_AcknowledgedAddress <span class="token operator">=</span> I2C_AcknowledgedAddress_7bit<span class="token punctuation">;</span><span class="token comment">//设置地址长度7位</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_ClockSpeed <span class="token operator">=</span> <span class="token number">400000</span><span class="token punctuation">;</span>	<span class="token comment">//I2C传输速度，400K，根据自己所用芯片手册查看支持的速度。	</span>
	<span class="token function">I2C_Init</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>I2C_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//初始化I2C</span>

	<span class="token function">I2C_Cmd</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//启用I2C</span>

	<span class="token function">SHTC3_WriteByte</span><span class="token punctuation">(</span><span class="token number">0X35</span><span class="token punctuation">,</span><span class="token number">0X17</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//唤醒SHTC3</span>
	
	<span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  读取SHTC3数据
  * @param  *Hum 湿度
  * @param  *Temp 温度
  * @retval 1 - 读取成功；0 - 读取失败
  */</span>
<span class="token class-name">uint8_t</span> <span class="token function">ReadSHTC3</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">*</span>Hum<span class="token punctuation">,</span><span class="token keyword">float</span> <span class="token operator">*</span>Temp<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">uint16_t</span> HumData<span class="token punctuation">,</span>TempData<span class="token punctuation">,</span>HumCRC<span class="token punctuation">,</span>TempCRC<span class="token punctuation">;</span><span class="token comment">//声明变量存放读取的数据</span>
    
    <span class="token comment">/*SHTC3_WriteByte(0X35,0X17);//唤醒SHTC3
	
	Delay_us(300);*/</span>
    
    <span class="token function">SHTC3_WriteByte</span><span class="token punctuation">(</span><span class="token number">0X5C</span><span class="token punctuation">,</span><span class="token number">0X24</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送指令，先读取湿度数据，时钟拉伸（测量数据期间拉低SCL时钟线，占用总线）</span>
	
    <span class="token function">SHTC3_I2C_START</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送起始信号</span>
    
	<span class="token function">I2C_Send7bitAddress</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>SHTC3_ADDRESS<span class="token punctuation">,</span>I2C_Direction_Receiver<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送设备读地址</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>I2C_EVENT_MASTER_RECEIVER_MODE_SELECTED <span class="token punctuation">)</span><span class="token operator">==</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//检测EV6事件</span>
	
    HumData <span class="token operator">=</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取湿度高8位数据</span>
    HumData<span class="token operator">=</span>HumData<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>         <span class="token comment">//左移8位</span>
	HumData <span class="token operator">|=</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取湿度低8位数据</span>
    HumCRC <span class="token operator">=</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取湿度CRC校验数据</span>

    TempData <span class="token operator">=</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取温度高8位数据</span>
    TempData<span class="token operator">=</span>TempData<span class="token operator">&lt;&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>       <span class="token comment">//左移8位</span>
	TempData <span class="token operator">|=</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取温度低8位数据</span>
    TempCRC <span class="token operator">=</span> <span class="token function">SHTC3_ReadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取温度CRC校验数据</span>

    <span class="token function">SHTC3_I2C_STOP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//发送停止信号</span>
		
	<span class="token comment">//SHTC3_WriteByte(0XB0,0X98);//发送休眠指令</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">SHTC3_CRC_CAL</span><span class="token punctuation">(</span>HumData<span class="token punctuation">)</span><span class="token operator">==</span>HumCRC <span class="token operator">&amp;&amp;</span> <span class="token function">SHTC3_CRC_CAL</span><span class="token punctuation">(</span>TempData<span class="token punctuation">)</span><span class="token operator">==</span>TempCRC <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">//对接收到数据进行CRC校验</span>
       <span class="token operator">*</span>Hum <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>HumData<span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">65536</span><span class="token punctuation">;</span>        <span class="token comment">//将接收的16位二进制数据转换为10进制湿度数据</span>
       <span class="token operator">*</span>Temp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>TempData<span class="token operator">*</span><span class="token number">175</span><span class="token operator">/</span><span class="token number">65536</span><span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">;</span>   <span class="token comment">//将接收的16位二进制数据转换为10进制温度数据</span>
       <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      OLED.c
     </strong>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"OLED_Font.h"</span></span>

<span class="token comment">/*OLED屏地址*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OLED_ADDRESS</span> <span class="token expression"><span class="token number">0x78</span></span></span>

<span class="token comment">/*设置哪一个使用I2C*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">I2Cx</span> <span class="token expression">I2C1</span></span>

<span class="token comment">/*
https://blog.zeruns.tech
*/</span>

<span class="token comment">/*引脚初始化*/</span>
<span class="token keyword">void</span> <span class="token function">OLED_I2C_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_I2C1<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//使能I2C1时钟</span>
	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOB<span class="token punctuation">,</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使能GPIOB时钟</span>
 
	<span class="token comment">/*STM32F103芯片的硬件I2C: PB6 -- SCL; PB7 -- SDA */</span>
	GPIO_InitTypeDef  GPIO_InitStructure<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span>  GPIO_Pin_6 <span class="token operator">|</span> GPIO_Pin_7<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_AF_OD<span class="token punctuation">;</span>		<span class="token comment">//设置输出模式为开漏输出，需接上拉电阻</span>
	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">I2C_DeInit</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//将外设I2C寄存器重设为缺省值</span>
	I2C_InitTypeDef  I2C_InitStructure<span class="token punctuation">;</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_Mode <span class="token operator">=</span> I2C_Mode_I2C<span class="token punctuation">;</span>			<span class="token comment">//工作模式</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_DutyCycle <span class="token operator">=</span> I2C_DutyCycle_2<span class="token punctuation">;</span>	<span class="token comment">//时钟占空比，Tlow/Thigh = 2</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_OwnAddress1 <span class="token operator">=</span> <span class="token number">0x30</span><span class="token punctuation">;</span>	<span class="token comment">//主机的I2C地址,用不到则随便写，无影响</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_Ack <span class="token operator">=</span> I2C_Ack_Enable<span class="token punctuation">;</span>	<span class="token comment">//使能应答位</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_AcknowledgedAddress <span class="token operator">=</span> I2C_AcknowledgedAddress_7bit<span class="token punctuation">;</span><span class="token comment">//设置地址长度7位</span>
	I2C_InitStructure<span class="token punctuation">.</span>I2C_ClockSpeed <span class="token operator">=</span> <span class="token number">400000</span><span class="token punctuation">;</span>	<span class="token comment">//I2C传输速度，400K，根据自己所用芯片手册查看支持的速度。	</span>
	<span class="token function">I2C_Init</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>I2C_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">I2C_Cmd</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">I2C_WriteByte</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> addr<span class="token punctuation">,</span><span class="token class-name">uint8_t</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">I2C_GetFlagStatus</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> I2C_FLAG_BUSY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//发送起始信号</span>
	<span class="token function">I2C_GenerateSTART</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//检测EV5事件</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>I2C_EVENT_MASTER_MODE_SELECT<span class="token punctuation">)</span><span class="token operator">==</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//发送设备写地址</span>
	<span class="token function">I2C_Send7bitAddress</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> OLED_ADDRESS<span class="token punctuation">,</span> I2C_Direction_Transmitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//检测EV6事件</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span>I2C_EVENT_MASTER_TRANSMITTER_MODE_SELECTED<span class="token punctuation">)</span><span class="token operator">==</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//发送要操作设备内部的地址</span>
	<span class="token function">I2C_SendData</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//检测EV8_2事件</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> I2C_EVENT_MASTER_BYTE_TRANSMITTED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">I2C_SendData</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送数据</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">I2C_CheckEvent</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> I2C_EVENT_MASTER_BYTE_TRANSMITTED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//发送停止信号</span>
	<span class="token function">I2C_GenerateSTOP</span><span class="token punctuation">(</span>I2Cx<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">/**
  * @brief  OLED写命令
  * @param  Command 要写入的命令
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Command<span class="token punctuation">)</span><span class="token comment">//写命令</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">I2C_WriteByte</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">,</span> Command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">/**
  * @brief  OLED写数据
  * @param  Data 要写入的数据
  * @retval 无
*/</span>
<span class="token keyword">void</span> <span class="token function">OLED_WriteData</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">)</span><span class="token comment">//写数据</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">I2C_WriteByte</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">,</span> Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED设置光标位置
  * @param  Y 以左上角为原点，向下方向的坐标，范围：0~7
  * @param  X 以左上角为原点，向右方向的坐标，范围：0~127
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_SetCursor</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> X<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xB0</span> <span class="token operator">|</span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//设置Y位置</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x10</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X <span class="token operator">&amp;</span> <span class="token number">0xF0</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置X位置低4位</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x00</span> <span class="token operator">|</span> <span class="token punctuation">(</span>X <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//设置X位置高4位</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED清屏
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_Clear</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_SetCursor</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">OLED_WriteData</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED部分清屏
  * @param  Line 行位置，范围：1~4
  * @param  start 列开始位置，范围：1~16
  * @param  end 列开始位置，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_Clear_Part</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> start<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> end<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">,</span>Column<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>Column <span class="token operator">=</span> start<span class="token punctuation">;</span> Column <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> Column<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_SetCursor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Line <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Column <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置光标位置在上半部分</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">OLED_WriteData</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//显示上半部分内容</span>
		<span class="token punctuation">}</span>
		<span class="token function">OLED_SetCursor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Line <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Column <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置光标位置在下半部分</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">OLED_WriteData</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//显示下半部分内容</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED显示一个字符
  * @param  Line 行位置，范围：1~4
  * @param  Column 列位置，范围：1~16
  * @param  Char 要显示的一个字符，范围：ASCII可见字符
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Column<span class="token punctuation">,</span> <span class="token keyword">char</span> Char<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>      	
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>
	<span class="token function">OLED_SetCursor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Line <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Column <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置光标位置在上半部分</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_WriteData</span><span class="token punctuation">(</span>OLED_F8x16<span class="token punctuation">[</span>Char <span class="token operator">-</span> <span class="token char">' '</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//显示上半部分内容</span>
	<span class="token punctuation">}</span>
	<span class="token function">OLED_SetCursor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Line <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>Column <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置光标位置在下半部分</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_WriteData</span><span class="token punctuation">(</span>OLED_F8x16<span class="token punctuation">[</span>Char <span class="token operator">-</span> <span class="token char">' '</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//显示下半部分内容</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED显示字符串
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  String 要显示的字符串，范围：ASCII可见字符
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Column<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> String<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column <span class="token operator">+</span> i<span class="token punctuation">,</span> String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED次方函数
  * @retval 返回值等于X的Y次方
  */</span>
<span class="token class-name">uint32_t</span> <span class="token function">OLED_Pow</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> X<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> Y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint32_t</span> Result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>Y<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Result <span class="token operator">*=</span> X<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED显示数字（十进制，正数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~4294967295
  * @param  Length 要显示数字的长度，范围：1~10
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Column<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> Number<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>							
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column <span class="token operator">+</span> i<span class="token punctuation">,</span> Number <span class="token operator">/</span> <span class="token function">OLED_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> Length <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED显示数字（十进制，带符号数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：-2147483648~2147483647
  * @param  Length 要显示数字的长度，范围：1~10
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_ShowSignedNum</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Column<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> Number<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>
	<span class="token class-name">uint32_t</span> Number1<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>Number <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> <span class="token char">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1 <span class="token operator">=</span> Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> <span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1 <span class="token operator">=</span> <span class="token operator">-</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>							
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Number1 <span class="token operator">/</span> <span class="token function">OLED_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> Length <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED显示数字（十六进制，正数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~0xFFFFFFFF
  * @param  Length 要显示数字的长度，范围：1~8
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_ShowHexNum</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Column<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> Number<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">,</span> SingleNumber<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>							
	<span class="token punctuation">{<!-- --></span>
		SingleNumber <span class="token operator">=</span> Number <span class="token operator">/</span> <span class="token function">OLED_Pow</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> Length <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>SingleNumber <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column <span class="token operator">+</span> i<span class="token punctuation">,</span> SingleNumber <span class="token operator">+</span> <span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column <span class="token operator">+</span> i<span class="token punctuation">,</span> SingleNumber <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED显示数字（二进制，正数）
  * @param  Line 起始行位置，范围：1~4
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111
  * @param  Length 要显示数字的长度，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_ShowBinNum</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> Line<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Column<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> Number<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>							
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowChar</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span> Column <span class="token operator">+</span> i<span class="token punctuation">,</span> Number <span class="token operator">/</span> <span class="token function">OLED_Pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Length <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  OLED初始化
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">OLED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint32_t</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
	
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>			<span class="token comment">//上电延时</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">OLED_I2C_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//端口初始化</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xAE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//关闭显示</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xD5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置显示时钟分频比/振荡器频率</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xA8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置多路复用率</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x3F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xD3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置显示偏移</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置显示开始行</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xA1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置左右方向，0xA1正常 0xA0左右反置</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xC8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置上下方向，0xC8正常 0xC0上下反置</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xDA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置COM引脚硬件配置</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x81</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置对比度控制</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xCF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xD9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置预充电周期</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xF1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xDB</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置VCOMH取消选择级别</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xA4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置整个显示打开/关闭</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xA6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置正常/倒转显示</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x8D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置充电泵</span>
	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">OLED_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0xAF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//开启显示</span>
		
	<span class="token function">OLED_Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//OLED清屏</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     部分内容参考以下两篇文章：
    </p>
    <p>
     <a href="https://url.zeruns.tech/8BKyj" rel="nofollow">
      https://blog.csdn.net/mj475002864/article/details/114027993
     </a>
    </p>
    <p>
     <a href="https://url.zeruns.tech/59sdP" rel="nofollow">
      https://blog.csdn.net/k666499436/article/details/124686559
     </a>
    </p>
    <h3>
     <a id="_756">
     </a>
     推荐阅读
    </h3>
    <ul>
     <li>
      <strong>
       高性价比和便宜的VPS/云服务器推荐:
      </strong>
      <a href="https://www.awsl9527.cn/archives/41.html" rel="nofollow">
       https://www.awsl9527.cn/archives/41.html
      </a>
     </li>
     <li>
      使用NPS搭建内网穿透服务器，带Web面板：
      <a href="https://www.awsl9527.cn/archives/748.html" rel="nofollow">
       https://www.awsl9527.cn/archives/748.html
      </a>
     </li>
     <li>
      Linux搭建网站教程，建站教程：
      <a href="https://www.awsl9527.cn/archives/1094.html" rel="nofollow">
       https://www.awsl9527.cn/archives/1094.html
      </a>
     </li>
     <li>
      我的世界服务器搭建教程：
      <a href="https://www.awsl9527.cn/archives/tag/minecraft" rel="nofollow">
       https://www.awsl9527.cn/archives/tag/minecraft
      </a>
     </li>
     <li>
      基于STM32和HC-SR04模块实现超声波测距功能：
      <a href="https://blog.zeruns.tech/archives/680.html" rel="nofollow">
       https://blog.zeruns.tech/archives/680.html
      </a>
     </li>
     <li>
      ESP8266开发环境搭建及项目演示：
      <a href="https://blog.zeruns.tech/archives/526.html" rel="nofollow">
       https://blog.zeruns.tech/archives/526.html
      </a>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031323531333436332f:61727469636c652f64657461696c732f313237363838383637" class_="artid" style="display:none">
 </p>
</div>


