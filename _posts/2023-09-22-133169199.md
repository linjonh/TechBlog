---
layout: post
title: "Java-POI-读取-大数据量的Excel-实操"
date: 2023-09-22 14:28:52 +0800
description: "Java 读取大数据量的excel 的实现方案_poi读取大数据量excel"
keywords: "poi读取大数据量excel"
categories: ['Java']
tags: ['文件读写', '大数据量', 'Poi', 'Java', 'Excel']
artid: "133169199"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=133169199
    alt: "Java-POI-读取-大数据量的Excel-实操"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Java POI 读取 大数据量的Excel 实操
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Java_POI__10Wexcel_0">
     </a>
     Java POI 读取 大数据量（超过10W行）的excel的操作
    </h2>
    <h3>
     <a id="0_1">
     </a>
     0.问题抛出
    </h3>
    <pre><code>在使用poi 进行excel文件读取操作的时候，
如果文件包含的数据量很大，比如包含了10万行的数据，
那么在使用  【Workbook workbook2 = WorkbookFactory.create(inputStrem);】 
这种形式读取的时候就会发现异常的慢，甚至是内存都要溢出了还是没有读取出来。
问题原因就是，上述的方式 是一下子将文件全部加载进入内存中，自然需要消耗许多的内存资源和时间。
为了解决上述问题，特记录如下方式。
下面的方式思路就是 ： 批量的去加载数据，降低内存的消耗，从而实现程序的流畅运行。
</code></pre>
    <h3>
     <a id="1_11">
     </a>
     1.说明
    </h3>
    <pre><code>1.本文记录了Java在读取包含大数据量的excel的时候的操作，
2.此处的大数据量指的是excle中包含了较多的行数，比如包含了10万行的数据；
3.本文记录的方式只适用于【读取】excel的内容；
4.本文记录的方式只适用于【.xlsx】为后缀的excel文件。
</code></pre>
    <h3>
     <a id="2_18">
     </a>
     2.引入依赖
    </h3>
    <pre><code class="prism language-xml">
        <span class="token comment">&lt;!-- excel工具 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi-ooxml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- 读取大量excel数据时使用到的两个 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.monitorjbl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xlsx-streamer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>xml-apis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>xml-apis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre>
    <h3>
     <a id="3_41">
     </a>
     3.案例代码
    </h3>
    <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">importExcelData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// 指定文件的路径</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"aa.xlsx"</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建输入流对象</span>
        <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 【核心操作】 ： 使用下面的方式来获取 Workbook 对象</span>
        <span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">StreamingReader</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bufferSize</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span> <span class="token comment">// 设置缓存的大小</span>
                <span class="token punctuation">.</span><span class="token function">rowCacheSize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 缓存行的数量，也就是每次读取多少行到内存中，而不是一下子全都加载进内存</span>
                <span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>fileInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置要打开的文件</span>
        <span class="token class-name">Sheet</span> sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span><span class="token function">getSheetAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//遍历所有的行进行文件的读取</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Row</span> row <span class="token operator">:</span> sheet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 遍历每一行的数据</span>
          <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Cell</span> cell <span class="token operator">:</span> row<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          		 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token function">getStringCellValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          		 
          		 <span class="token comment">// 此时已经读取到了 某一行的某一列的数据</span>
          		 <span class="token comment">// 在这里就可以填充自己具体的业务逻辑了</span>
          		 
          	
		  <span class="token punctuation">}</span>
		   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="4_72">
     </a>
     4.运行即可
    </h3>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33393530353234352f:61727469636c652f64657461696c732f313333313639313939" class_="artid" style="display:none">
 </p>
</div>


