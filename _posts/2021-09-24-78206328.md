---
layout: post
title: "Android单元测试与模拟测试详解"
date: 2021-09-24 20:13:46 +0800
description: "测试与基本规范为什么需要测试?为了稳定性，更加易于维护，集成一些工具，规范开发规范，使得代码更加稳定"
keywords: "android 单元测试 模拟"
categories: ['未分类']
tags: ['无标签']
artid: "78206328"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78206328
    alt: "Android单元测试与模拟测试详解"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android单元测试与模拟测试详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div id="cnblogs_post_body" style="margin-bottom:20px; word-break:break-word; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:13px">
     <h3 style="margin:10px 0px; font-size:21px; line-height:1.5">
      测试与基本规范
     </h3>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       为什么需要测试?
      </span>
     </p>
     <ul style="margin-left:30px; padding-left:0px">
      <li style="list-style-type:disc">
       为了稳定性，能够明确的了解是否正确的完成开发。
      </li>
      <li style="list-style-type:disc">
       更加易于维护，能够在修改代码后保证功能不被破坏。
      </li>
      <li style="list-style-type:disc">
       集成一些工具，规范开发规范，使得代码更加稳定( 如通过 phabricator differential 发diff时提交需要执行的单元测试，在开发流程上就可以保证远端代码的稳定性)。
      </li>
     </ul>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       2. 测什么?
      </span>
     </p>
     <ul style="margin-left:30px; padding-left:0px">
      <li style="list-style-type:disc">
       一般单元测试:
       <ul style="margin-left:30px; padding-left:0px">
        <li style="list-style-type:disc">
         列出想要测试覆盖的异常情况，进行验证。
        </li>
        <li style="list-style-type:disc">
         性能测试。
        </li>
       </ul>
      </li>
      <li style="list-style-type:disc">
       模拟测试: 根据需求，测试用户真正在使用过程中，界面的反馈与显示以及一些依赖系统架构的组件的应用测试。
      </li>
     </ul>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       3. 需要注意
      </span>
     </p>
     <ul style="margin-left:30px; padding-left:0px">
      <li style="list-style-type:disc">
       考虑可读性，对于方法名使用表达能力强的方法名，对于测试范式可以考虑使用一种规范, 如 RSpec-style。方法名可以采用一种格式，如:
       <code>
        [测试的方法]_[测试的条件]_[符合预期的结果]
       </code>
       。
      </li>
      <li style="list-style-type:disc">
       不要使用逻辑流关键字(If/else、for、do/while、switch/case)，在一个测试方法中，如果需要有这些，拆分到单独的每个测试方法里。
      </li>
      <li style="list-style-type:disc">
       测试真正需要测试的内容，需要覆盖的情况，一般情况只考虑验证输出（如某操作后，显示什么，值是什么）。
      </li>
      <li style="list-style-type:disc">
       考虑耗时，Android Studio默认会输出耗时。
      </li>
      <li style="list-style-type:disc">
       不需要考虑测试
       <code>
        private
       </code>
       的方法，将
       <code>
        private
       </code>
       方法当做黑盒内部组件，测试对其引用的
       <code>
        public
       </code>
       方法即可；不考虑测试琐碎的代码，如
       <code>
        getter
       </code>
       或者
       <code>
        setter
       </code>
       。
      </li>
      <li style="list-style-type:disc">
       每个单元测试方法，应没有先后顺序；尽可能的解耦对于不同的测试方法，不应该存在Test A与Test B存在时序性的情况。
      </li>
     </ul>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       4. 创建测试
      </span>
     </p>
     <ul style="margin-left:30px; padding-left:0px">
      <li style="list-style-type:disc">
       选择对应的类
      </li>
      <li style="list-style-type:disc">
       将光标停留在类名上
      </li>
      <li style="list-style-type:disc">
       按下
       <code>
        ALT + ENTER
       </code>
      </li>
      <li style="list-style-type:disc">
       在弹出的弹窗中选择
       <code>
        Create Test
       </code>
      </li>
     </ul>
     <p style="margin:10px auto">
      <code>
       ​
      </code>
     </p>
     <h3 style="margin:10px 0px; font-size:21px; line-height:1.5">
      Android Studio中的单元测试与模拟测试
     </h3>
     <p style="margin:10px auto">
      control + shift + R (Android Studio 默认执行单元测试快捷键)。
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       1. 本地单元测试
      </span>
     </p>
     <p style="margin:10px auto">
      直接在开发机上面进行运行测试。
      <br/>
      在没有依赖或者仅仅只需要简单的Android库依赖的情况下，有限考虑使用该类单元测试。
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-java">./gradlew check</code></pre>
     <p style="margin:10px auto">
      (1)代码存储
     </p>
     <p style="margin:10px auto">
      如果是对应不同的flavor或者是build type，直接在test后面加上对应后缀(如对应名为
      <code>
       myFlavor
      </code>
      的单元测试代码，应该放在
      <code>
       src/testMyFlavor/java
      </code>
      下面)。
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-java">src/test/java</code></pre>
     <h5 style="font-size:14px; margin:10px 0px">
      (2)Google官方推荐引用
     </h5>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8">dependencies {
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> Required -- JUnit 4 framework，用于单元测试，google官方推荐</span>
    testCompile 'junit:junit:4.12'
    <span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> Optional -- Mockito framework，用于模拟架构，google官方推荐
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span>  <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1546.html</u></span>
    testCompile 'org.mockito:mockito-core:1.10.19'<span style="line-height:1.8">
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      (3)JUnit
     </p>
     <h6 style="margin:10px 0px; padding:0px; font-size:12px">
      Annotation
     </h6>
     <table class="datatable" style="border:1px solid silver; border-collapse:collapse; word-break:break-word">
      <thead>
       <tr>
        <th style="border:1px solid silver; border-collapse:collapse; padding:3px">
         Annotation
        </th>
        <th style="border:1px solid silver; border-collapse:collapse; padding:3px">
         描述
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @Test public void method()
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         定义所在方法为
         <code>
          单元测试方法
         </code>
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @Test (expected = Exception.class)
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         如果所在方法没有抛出
         <code>
          Annotation
         </code>
         中的
         <code>
          Exception.class
         </code>
         -&gt;失败
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @Test(timeout=100)
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         如果方法耗时超过
         <code>
          100
         </code>
         毫秒-&gt;失败
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @Test(expected=Exception.class)
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         如果方法抛了Exception.class类型的异常-&gt;通过
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @Before public void method()
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         这个方法在每个测试之前执行，用于准备测试环境(如: 初始化类，读输入流等)
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @After public void method()
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         这个方法在每个测试之后执行，用于清理测试环境数据
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          BeforeClass public static void method()
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         这个方法在所有测试开始之前执行一次，用于做一些耗时的初始化工作(如: 连接数据库)
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          AfterClass public static void method()
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         这个方法在所有测试结束之后执行一次，用于清理数据(如: 断开数据连接)
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @Ignore
         </code>
         或者
         <code>
          @Ignore("Why disabled")
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         忽略当前测试方法，一般用于测试方法还没有准备好，或者太耗时之类的
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          @FixMethodOrder(MethodSorters.NAME_ASCENDING) public class TestClass{}
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         使得该测试方法中的所有测试都按照方法中的字母顺序测试
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          Assume.assumeFalse(boolean condition)
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         如果满足
         <code>
          condition
         </code>
         ，就不执行对应方法
        </td>
       </tr>
      </tbody>
     </table>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       2. 模拟测试
      </span>
     </p>
     <p style="margin:10px auto">
      需要运行在Android设备或者虚拟机上的测试。
     </p>
     <p style="margin:10px auto">
      主要用于测试: 单元(Android SDK层引用关系的相关的单元测试)、UI、应用组件集成测试(Service、Content Provider等)。
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-java">./gradlew connectedAndroidTest</code></pre>
     <p style="margin:10px auto">
      (1)代码存储:
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-java">src/androidTest/java</code></pre>
     <p style="margin:10px auto">
      (2)Google官方推荐引用
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8">dependencies {
    androidTestCompile </span>'com.android.support:support-annotations:23.0.1'<span style="line-height:1.8">
    androidTestCompile </span>'com.android.support.test:runner:0.4.1'<span style="line-height:1.8">
    androidTestCompile </span>'com.android.support.test:rules:0.4.1'
    <span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> Optional -- Hamcrest library</span>
    androidTestCompile 'org.hamcrest:hamcrest-library:1.3'
    <span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> Optional -- UI testing with Espresso
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span>  <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1546.html</u></span>
    androidTestCompile 'com.android.support.test.espresso:espresso-core:2.2.1'
    <span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> Optional -- UI testing with UI Automator</span>
    androidTestCompile 'com.android.support.test.uiautomator:uiautomator-v18:2.1.1'<span style="line-height:1.8">
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      (3)常见的UI测试
     </p>
     <p style="margin:10px auto">
      需要模拟Android系统环境。
     </p>
     <h6 style="margin:10px 0px; padding:0px; font-size:12px">
      主要三点:
     </h6>
     <ol style="padding-left:40px">
      <li style="list-style-type:decimal">
       UI加载好后展示的信息是否正确。
      </li>
      <li style="list-style-type:decimal">
       在用户某个操作后UI信息是否展示正确。
      </li>
      <li style="list-style-type:decimal">
       展示正确的页面供用户操作。
      </li>
     </ol>
     <p style="margin:10px auto">
      (4)Espresso
     </p>
     <p style="margin:10px auto">
      谷歌官方提供用于UI交互测试
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> android.support.test.espresso.Espresso.onView;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> android.support.test.espresso.action.ViewActions.click;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> android.support.test.espresso.assertion.ViewAssertions.matches;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> android.support.test.espresso.matcher.ViewMatchers.isDisplayed;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> android.support.test.espresso.matcher.ViewMatchers.withId;

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于Id为R.id.my_view的View: 触发点击，检测是否显示</span>
<span style="line-height:1.8">onView(withId(R.id.my_view)).perform(click())               
                            .check(matches(isDisplayed()));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于文本打头是"ABC"的View: 检测是否没有Enable</span>
onView(withText(startsWith("ABC"<span style="line-height:1.8">))).check(matches(not(isEnabled()));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 按返回键</span>
<span style="line-height:1.8">pressBack();
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于Id为R.id.button的View: 检测内容是否是"Start new activity"
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1537.html</u></span>
onView(withId(R.id.button)).check(matches(withText(("Start new activity"<span style="line-height:1.8">))));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于Id为R.id.viewId的View: 检测内容是否不包含"YYZZ"</span>
onView(withId(R.id.viewId)).check(matches(withText(not(containsString("YYZZ"<span style="line-height:1.8">)))));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于Id为R.id.inputField的View: 输入"NewText"，然后关闭软键盘</span>
onView(withId(R.id.inputField)).perform(typeText("NewText"<span style="line-height:1.8">), closeSoftKeyboard());
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于Id为R.id.inputField的View: 清除内容</span>
onView(withId(R.id.inputField)).perform(clearText());</pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <h6 style="margin:10px 0px; padding:0px; font-size:12px">
      启动一个打开
      <code>
       Activity
      </code>
      的
      <code>
       Intent
      </code>
     </h6>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'>@RunWith(AndroidJUnit4.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">)
</span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8"> SecondActivityTest {
    @Rule
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> ActivityTestRule&lt;SecondActivity&gt; rule =
            <span style="line-height:1.8; color:rgb(0,0,255)">new</span> ActivityTestRule(SecondActivity.<span style="line-height:1.8; color:rgb(0,0,255)">class</span>, <span style="line-height:1.8; color:rgb(0,0,255)">true</span><span style="line-height:1.8">,
                                  </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 这个参数为false，不让SecondActivity自动启动
                                  </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 如果为true，将会在所有@Before之前启动，在最后一个@After之后关闭</span>
                                  <span style="line-height:1.8; color:rgb(0,0,255)">false</span><span style="line-height:1.8">);
    @Test
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> demonstrateIntentPrep() {
        Intent intent </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span><span style="line-height:1.8"> Intent();
        intent.putExtra(</span>"EXTRA", "Test"<span style="line-height:1.8">);
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 启动SecondActivity并传入intent</span>
<span style="line-height:1.8">        rule.launchActivity(intent);
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 对于Id为R.id.display的View: 检测内容是否是"Text"
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1532.html</u></span>
        onView(withId(R.id.display)).check(matches(withText("Test"<span style="line-height:1.8">)));
    }
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      (5)异步交互
     </p>
     <p style="margin:10px auto">
      建议关闭设备中”设置-&gt;开发者选项中”的动画，因为这些动画可能会是的Espresso在检测异步任务的时候产生混淆: 窗口动画缩放(Window animation scale)、过渡动画缩放(Transition animation scale)、动画程序时长缩放(Animator duration scale)。
     </p>
     <p style="margin:10px auto">
      针对
      <code>
       AsyncTask
      </code>
      ，在测试的时候，如触发点击事件以后抛了一个
      <code>
       AsyncTask
      </code>
      任务，在测试的时候直接
      <code>
       onView(withId(R.id.update)).perform(click())
      </code>
      ，然后直接进行检测，此时的检测就是在
      <code>
       AsyncTask#onPostExecute
      </code>
      之后。
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 通过实现IdlingResource，block住当非空闲的时候，当空闲时进行检测，非空闲的这段时间处理异步事情</span>
<span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">class</span> IntentServiceIdlingResource <span style="line-height:1.8; color:rgb(0,0,255)">implements</span><span style="line-height:1.8"> IdlingResource {
    ResourceCallback resourceCallback;
    </span><span style="line-height:1.8; color:rgb(0,0,255)">private</span><span style="line-height:1.8"> Context context;

    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> IntentServiceIdlingResource(Context context) { <span style="line-height:1.8; color:rgb(0,0,255)">this</span>.context =<span style="line-height:1.8"> context; }

    @Override </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> String getName() { <span style="line-height:1.8; color:rgb(0,0,255)">return</span> IntentServiceIdlingResource.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">.getName(); }

    @Override </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span> registerIdleTransitionCallback( ResourceCallback resourceCallback) { <span style="line-height:1.8; color:rgb(0,0,255)">this</span>.resourceCallback =<span style="line-height:1.8"> resourceCallback; }

    @Override </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">boolean</span><span style="line-height:1.8"> isIdleNow() {
      </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 是否是空闲
      </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 如果IntentService 没有在运行，就说明异步任务结束，IntentService特质就是启动以后处理完Intent中的事务，理解关闭自己
      </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1531.html</u></span>
        <span style="line-height:1.8; color:rgb(0,0,255)">boolean</span> idle = !<span style="line-height:1.8">isIntentServiceRunning();
        </span><span style="line-height:1.8; color:rgb(0,0,255)">if</span> (idle &amp;&amp; resourceCallback != <span style="line-height:1.8; color:rgb(0,0,255)">null</span><span style="line-height:1.8">) {
          </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 回调告知异步任务结束</span>
<span style="line-height:1.8">            resourceCallback.onTransitionToIdle();
        }
        </span><span style="line-height:1.8; color:rgb(0,0,255)">return</span><span style="line-height:1.8"> idle;
    }

    </span><span style="line-height:1.8; color:rgb(0,0,255)">private</span> <span style="line-height:1.8; color:rgb(0,0,255)">boolean</span><span style="line-height:1.8"> isIntentServiceRunning() {
        ActivityManager manager </span>=<span style="line-height:1.8"> (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> Get all running services</span>
        List&lt;ActivityManager.RunningServiceInfo&gt; runningServices =<span style="line-height:1.8"> manager.getRunningServices(Integer.MAX_VALUE);
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> check if our is running</span>
        <span style="line-height:1.8; color:rgb(0,0,255)">for</span><span style="line-height:1.8"> (ActivityManager.RunningServiceInfo info : runningServices) {
            </span><span style="line-height:1.8; color:rgb(0,0,255)">if</span> (MyIntentService.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">.getName().equals(info.service.getClassName())) {
                </span><span style="line-height:1.8; color:rgb(0,0,255)">return</span> <span style="line-height:1.8; color:rgb(0,0,255)">true</span><span style="line-height:1.8">;
            }
        }
        </span><span style="line-height:1.8; color:rgb(0,0,255)">return</span> <span style="line-height:1.8; color:rgb(0,0,255)">false</span><span style="line-height:1.8">;
    }
}

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 使用IntentServiceIdlingResource来测试，MyIntentService服务启动结束这个异步事务，之后的结果。</span>
@RunWith(AndroidJUnit4.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">)
</span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8"> IntegrationTest {

    @Rule
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> ActivityTestRule rule = <span style="line-height:1.8; color:rgb(0,0,255)">new</span> ActivityTestRule(MainActivity.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);
    IntentServiceIdlingResource idlingResource;

    @Before
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> before() {
        Instrumentation instrumentation </span>=<span style="line-height:1.8"> InstrumentationRegistry.getInstrumentation();
        Context ctx </span>=<span style="line-height:1.8"> instrumentation.getTargetContext();
        idlingResource </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span><span style="line-height:1.8"> IntentServiceIdlingResource(ctx);
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 注册这个异步监听</span>
<span style="line-height:1.8">        Espresso.registerIdlingResources(idlingResource);

    }
    @After
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> after() {
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 取消注册这个异步监听</span>
<span style="line-height:1.8">        Espresso.unregisterIdlingResources(idlingResource);

    }

    @Test
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> runSequence() {
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> MainActivity中点击R.id.action_settings这个View的时候，会启动MyIntentService</span>
<span style="line-height:1.8">        onView(withId(R.id.action_settings)).perform(click());
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 这时候IntentServiceIdlingResource#isIdleNow会返回false，因为MyIntentService服务启动了
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 这个情况下，这里会block住.............
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 直到IntentServiceIdlingResource#isIdleNow返回true，并且回调了IntentServiceIdlingResource#onTransitionToIdle
        </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 这个情况下，继续执行，这时我们就可以测试异步结束以后的情况了。</span>
        onView(withText("Broadcast"<span style="line-height:1.8">)).check(matches(notNullValue()));
    }
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <h6 style="margin:10px 0px; padding:0px; font-size:12px">
      (6)自定义匹配器
     </h6>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 定义</span>
<span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span> Matcher&lt;View&gt;<span style="line-height:1.8"> withItemHint(String itemHintText) {
  checkArgument(</span>!(itemHintText.equals(<span style="line-height:1.8; color:rgb(0,0,255)">null</span><span style="line-height:1.8">)));
  </span><span style="line-height:1.8; color:rgb(0,0,255)">return</span><span style="line-height:1.8"> withItemHint(is(itemHintText));
}

</span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span> Matcher&lt;View&gt; withItemHint(<span style="line-height:1.8; color:rgb(0,0,255)">final</span> Matcher&lt;String&gt;<span style="line-height:1.8"> matcherText) {
  checkNotNull(matcherText);
  </span><span style="line-height:1.8; color:rgb(0,0,255)">return</span> <span style="line-height:1.8; color:rgb(0,0,255)">new</span> BoundedMatcher&lt;View, EditText&gt;(EditText.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">) {

    @Override
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> describeTo(Description description) {
      description.appendText(</span>"with item hint: " +<span style="line-height:1.8"> matcherText);
    }

    @Override
    </span><span style="line-height:1.8; color:rgb(0,0,255)">protected</span> <span style="line-height:1.8; color:rgb(0,0,255)">boolean</span><span style="line-height:1.8"> matchesSafely(EditText editTextField) {
      </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 取出hint，然后比对下是否相同
      </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1524.html</u></span>
      <span style="line-height:1.8; color:rgb(0,0,255)">return</span><span style="line-height:1.8"> matcherText.matches(editTextField.getHint().toString());
    }
  };
}

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 使用</span>
onView(withItemHint("test")).check(matches(isDisplayed()));</pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <h3 style="margin:10px 0px; font-size:21px; line-height:1.5">
      拓展工具
     </h3>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       1. AssertJ Android
      </span>
     </p>
     <p style="margin:10px auto">
      square/assertj-android
      <br/>
      极大的提高可读性。
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span> org.assertj.core.api.Assertions.*<span style="line-height:1.8">;

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: view是GONE的</span>
<span style="line-height:1.8">assertThat(view).isGone();

MyClass test </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span> MyClass("Frodo"<span style="line-height:1.8">);
MyClass test1 </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span> MyClass("Sauron"<span style="line-height:1.8">);
MyClass test2 </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span> MyClass("Jacks"<span style="line-height:1.8">);

List</span>&lt;MyClass&gt; testList = <span style="line-height:1.8; color:rgb(0,0,255)">new</span> ArrayList&lt;&gt;<span style="line-height:1.8">();
testList.add(test);
testList.add(test1);

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: test.getName()等于"Frodo"</span>
assertThat(test.getName()).isEqualTo("Frodo"<span style="line-height:1.8">);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: test不等于test1并且在testList中
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1519.html</u></span>
<span style="line-height:1.8">assertThat(test).isNotEqualTo(test1)
                 .isIn(testList);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: test.getName()的字符串，是由"Fro"打头，以"do"结尾，忽略大小写会等于"frodo"</span>
assertThat(test.getName()).startsWith("Fro"<span style="line-height:1.8">)
                            .endsWith(</span>"do"<span style="line-height:1.8">)
                            .isEqualToIgnoringCase(</span>"frodo"<span style="line-height:1.8">);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: testList有2个数据，包含test，test1，不包含test2</span>
assertThat(list).hasSize(2<span style="line-height:1.8">)
                .contains(test, test1)
                .doesNotContain(test2);

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: 提取testList队列中所有数据中的成员变量名为name的变量，并且包含name为"Frodo"与"Sauron"
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)">      并且不包含name为"Jacks"</span>
assertThat(testList).extracting("name"<span style="line-height:1.8">)
                    .contains(</span>"Frodo", "Sauron"<span style="line-height:1.8">)
                    .doesNotContain(</span>"Jacks");</pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       2. Hamcrest
      </span>
     </p>
     <p style="margin:10px auto">
      JavaHamcrest
      <br/>
      通过已有的通配方法，快速的对代码条件进行测试
      <br/>
      <code>
       org.hamcrest:hamcrest-junit:(version)
      </code>
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> org.hamcrest.MatcherAssert.assertThat;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> org.hamcrest.Matchers.is;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> org.hamcrest.Matchers.equalTo;

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: a等于b</span>
<span style="line-height:1.8">assertThat(a, equalTo(b));
assertThat(a, is(equalTo(b)));
assertThat(a, is(b));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: a不等于b</span>
<span style="line-height:1.8">assertThat(actual, is(not(equalTo(b))));

List</span>&lt;Integer&gt; list = Arrays.asList(5, 2, 4<span style="line-height:1.8">);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: list有3个数据</span>
assertThat(list, hasSize(3<span style="line-height:1.8">));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: list中有5,2,4，并且顺序也一致</span>
assertThat(list, contains(5, 2, 4<span style="line-height:1.8">));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: list中包含5,2,4</span>
assertThat(list, containsInAnyOrder(2, 4, 5<span style="line-height:1.8">));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: list中的每一个数据都大于1
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1507.html</u></span>
assertThat(list, everyItem(greaterThan(1<span style="line-height:1.8">)));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: fellowship中包含有成员变量"race"，并且其值不是ORC</span>
assertThat(fellowship, everyItem(hasProperty("race"<span style="line-height:1.8">, is(not((ORC))))));
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: object1中与object2相同的成员变量都是相同的值</span>
<span style="line-height:1.8">assertThat(object1, samePropertyValuesAs(object2));

Integer[] ints </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span> Integer[] { 7, 5, 12, 16<span style="line-height:1.8"> };
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 断言: 数组中包含7,5,12,16</span>
assertThat(ints, arrayContaining(7, 5, 12, 16));</pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <h6 style="margin:10px 0px; padding:0px; font-size:12px">
      (1)几个主要的匹配器:
     </h6>
     <table class="dataintable" style="border:1px solid silver; border-collapse:collapse; word-break:break-word">
      <thead>
       <tr>
        <th style="border:1px solid silver; border-collapse:collapse; padding:3px">
         Mather
        </th>
        <th style="border:1px solid silver; border-collapse:collapse; padding:3px">
         描述
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          allOf
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         所有都匹配
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          anyOf
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         任意一个匹配
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          not
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         不是
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          equalTo
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         对象等于
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          is
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         是
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          hasToString
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         包含
         <code>
          toString
         </code>
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          instanceOf
         </code>
         ,
         <code>
          isCompatibleType
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         类的类型是否匹配
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          notNullValue
         </code>
         ,
         <code>
          nullValue
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         测试null
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          sameInstance
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         相同实例
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          hasEntry
         </code>
         ,
         <code>
          hasKey
         </code>
         ,
         <code>
          hasValue
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         测试
         <code>
          Map
         </code>
         中的
         <code>
          Entry
         </code>
         、
         <code>
          Key
         </code>
         、
         <code>
          Value
         </code>
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          hasItem
         </code>
         ,
         <code>
          hasItems
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         测试集合(
         <code>
          collection
         </code>
         )中包含元素
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          hasItemInArray
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         测试数组中包含元素
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          closeTo
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         测试浮点数是否接近指定值
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          greaterThan
         </code>
         ,
         <code>
          greaterThanOrEqualTo
         </code>
         ,
         <code>
          lessThan
         </code>
         ,
         <code>
          lessThanOrEqualTo
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         数据对比
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          equalToIgnoringCase
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         忽略大小写字符串对比
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          equalToIgnoringWhiteSpace
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         忽略空格字符串对比
        </td>
       </tr>
       <tr>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         <code>
          containsString
         </code>
         ,
         <code>
          endsWith
         </code>
         ,
         <code>
          startsWith
         </code>
         ,
         <code>
          isEmptyString
         </code>
         ,
         <code>
          isEmptyOrNullString
         </code>
        </td>
        <td style="border:1px solid silver; border-collapse:collapse; padding:3px">
         字符串匹配
        </td>
       </tr>
      </tbody>
     </table>
     <p style="margin:10px auto">
      (2)自定义匹配器
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 自定义</span>
<span style="line-height:1.8; color:rgb(0,0,255)">import</span><span style="line-height:1.8"> org.hamcrest.Description;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span><span style="line-height:1.8"> org.hamcrest.TypeSafeMatcher;

</span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">class</span> RegexMatcher <span style="line-height:1.8; color:rgb(0,0,255)">extends</span> TypeSafeMatcher&lt;String&gt;<span style="line-height:1.8"> {
    </span><span style="line-height:1.8; color:rgb(0,0,255)">private</span> <span style="line-height:1.8; color:rgb(0,0,255)">final</span><span style="line-height:1.8"> String regex;

    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> RegexMatcher(<span style="line-height:1.8; color:rgb(0,0,255)">final</span> String regex) { <span style="line-height:1.8; color:rgb(0,0,255)">this</span>.regex =<span style="line-height:1.8"> regex; }
    @Override
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span> describeTo(<span style="line-height:1.8; color:rgb(0,0,255)">final</span> Description description) { description.appendText("matches regular expression=`" + regex + "`"<span style="line-height:1.8">); }

    @Override
    </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">boolean</span> matchesSafely(<span style="line-height:1.8; color:rgb(0,0,255)">final</span> String string) { <span style="line-height:1.8; color:rgb(0,0,255)">return</span><span style="line-height:1.8"> string.matches(regex); }

    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 上层调用的入口</span>
    <span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span> RegexMatcher matchesRegex(<span style="line-height:1.8; color:rgb(0,0,255)">final</span><span style="line-height:1.8"> String regex) {
        </span><span style="line-height:1.8; color:rgb(0,0,255)">return</span> <span style="line-height:1.8; color:rgb(0,0,255)">new</span><span style="line-height:1.8"> RegexMatcher(regex);
    }
}

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 使用</span>
String s = "aaabbbaaa"<span style="line-height:1.8">;
assertThat(s, RegexMatcher.matchesRegex(</span>"a*b*a"));</pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       3. Mockito
      </span>
     </p>
     <p style="margin:10px auto">
      Mockito
      <br/>
      Mock对象，控制其返回值，监控其方法的调用。
      <br/>
      <code>
       org.mockito:mockito-all:(version)
      </code>
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> import如相关类</span>
<span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> org.mockito.Mockito.mock;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> org.mockito.Mockito.verify;

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 创建一个Mock的对象</span>
 MyClass test = mock(MyClass.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 当调用test.getUniqueId()的时候返回43</span>
when(test.getUniqueId()).thenReturn(43<span style="line-height:1.8">);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 当调用test.compareTo()传入任意的Int值都返回43</span>
when(test.compareTo(anyInt())).thenReturn(43<span style="line-height:1.8">);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 当调用test.compareTo()传入的是Target.class类型对象时返回43</span>
when(test.compareTo(isA(Target.<span style="line-height:1.8; color:rgb(0,0,255)">class</span>))).thenReturn(43<span style="line-height:1.8">);
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 当调用test.close()的时候，抛IOException异常</span>
doThrow(<span style="line-height:1.8; color:rgb(0,0,255)">new</span><span style="line-height:1.8"> IOException()).when(test).close();
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 当调用test.execute()的时候，什么都不做</span>
<span style="line-height:1.8">doNothing().when(test).execute();

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否调用了两次test.getUniqueId()
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1503.html</u></span>
verify(test, times(2<span style="line-height:1.8">)).getUniqueId();
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否没有调用过test.getUniqueId()</span>
<span style="line-height:1.8">verify(test, never()).getUniqueId();
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否至少调用过两次test.getUniqueId()</span>
verify(test, atLeast(2<span style="line-height:1.8">)).getUniqueId();
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否最多调用过三次test.getUniqueId()</span>
verify(test, atMost(3<span style="line-height:1.8">)).getUniqueId();
</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否这样调用过:test.query("test string")</span>
verify(test).query("test string"<span style="line-height:1.8">);

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 通过Mockito.spy() 封装List对象并返回将其mock的spy对象</span>
List list = <span style="line-height:1.8; color:rgb(0,0,255)">new</span><span style="line-height:1.8"> LinkedList();
List spy </span>=<span style="line-height:1.8"> spy(list);

</span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 指定spy.get(0)返回"foo"</span>
doReturn("foo").when(spy).get(0<span style="line-height:1.8">);

assertEquals(</span>"foo", spy.get(0));</pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
      对访问方法时，传入参数进行快照
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,0,255)">import</span><span style="line-height:1.8"> org.mockito.ArgumentCaptor;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span><span style="line-height:1.8"> org.mockito.Captor;
</span><span style="line-height:1.8; color:rgb(0,0,255)">import</span> <span style="line-height:1.8; color:rgb(0,0,255)">static</span><span style="line-height:1.8"> org.junit.Assert.assertEquals;

@Captor
</span><span style="line-height:1.8; color:rgb(0,0,255)">private</span> ArgumentCaptor&lt;Integer&gt;<span style="line-height:1.8"> captor;

@Test
</span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> testCapture(){
  MyClass test </span>= mock(MyClass.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);

  test.compareTo(</span>3, 4<span style="line-height:1.8">);
  verify(test).compareTo(captor.capture(), eq(</span>4<span style="line-height:1.8">));

  assertEquals(</span>3, (<span style="line-height:1.8; color:rgb(0,0,255)">int</span><span style="line-height:1.8">)captor.getValue());

  </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 需要特别注意，如果是可变数组(vargars)参数，如方法 test.doSomething(String... params)
  </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 此时是使用ArgumentCaptor&lt;String&gt;，而非ArgumentCaptor&lt;String[]&gt;</span>
  ArgumentCaptor&lt;String&gt; varArgs = ArgumentCaptor.forClass(String.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);
  test.doSomething(</span>"param-1", "param-2"<span style="line-height:1.8">);
  verify(test).doSomething(varArgs.capture());

  </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 这里直接使用getAllValues()而非getValue()，来获取可变数组参数的所有传入参数</span>
  assertThat(varArgs.getAllValues()).contains("param-1", "param-2"<span style="line-height:1.8">);
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
      (1)对于静态的方法的Mock:
     </p>
     <p style="margin:10px auto">
      可以使用 PowerMock:
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-javascript">org.powermock:powermock-api-mockito:(version) &amp; org.powermock:powermock-module-junit4:(version)(For PowerMockRunner.class)</code></pre>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'>@RunWith(PowerMockRunner.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">)
@PrepareForTest({StaticClass1.</span><span style="line-height:1.8; color:rgb(0,0,255)">class</span>, StaticClass2.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">})
</span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8"> MyTest {

  @Test
  </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> testSomething() {
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> mock完静态类以后，默认所有的方法都不做任何事情</span>
    mockStatic(StaticClass1.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);
    when(StaticClass1.getStaticMethod()).andReturn(</span>"anything"<span style="line-height:1.8">);

    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否StaticClass1.getStaticMethod()这个方法被调用了一次</span>
    verifyStatic(time(1<span style="line-height:1.8">));
    StaticClass1.getStaticMethod();

    when(StaticClass1.getStaticMethod()).andReturn(</span>"what ever"<span style="line-height:1.8">);

    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 验证是否StaticClass2.getStaticMethod()这个方法被至少调用了一次</span>
<span style="line-height:1.8">    verifyStatic(atLeastOnce());
    StaticClass2.getStaticMethod();

    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 通过任何参数创建File的实力，都直接返回fileInstance对象</span>
    whenNew(File.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">).withAnyArguments().thenReturn(fileInstance);
  }
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
      或者是封装为非静态，然后用Mockito:
     </p>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8"> FooWraper{
  </span><span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> someMethod() {
    Foo.someStaticMethod();
  }
}</span></pre>
     </div>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       4. Robolectric
      </span>
     </p>
     <p style="margin:10px auto">
      <a href="http://robolectric.org/" rel="external noopener noreferrer" style="color:navy; text-decoration:none" target="_blank">
       Robolectric
      </a>
      <br/>
      让模拟测试直接在开发机上完成，而不需要在Android系统上。所有需要使用到系统架构库的，如(
      <code>
       Handler
      </code>
      、
      <code>
       HandlerThread
      </code>
      )都需要使用Robolectric，或者进行模拟测试。
     </p>
     <p style="margin:10px auto">
      主要是解决模拟测试中耗时的缺陷，模拟测试需要安装以及跑在Android系统上，也就是需要在Android虚拟机或者设备上面，所以十分的耗时。基本上每次来来回回都需要几分钟时间。针对这类问题，业界其实已经有了一个现成的解决方案: Pivotal实验室推出的
      <a href="http://robolectric.org/" rel="external noopener noreferrer" style="color:navy; text-decoration:none" target="_blank">
       Robolectric
      </a>
      。通过使用Robolectrict模拟Android系统核心库的
      <code>
       Shadow Classes
      </code>
      的方式，我们可以像写本地测试一样写这类测试，并且直接运行在工作环境的JVM上，十分方便。
     </p>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       5. Robotium
      </span>
     </p>
     <p style="margin:10px auto">
      <a href="https://github.com/robotiumtech/robotium" rel="external noopener noreferrer" style="color:navy; text-decoration:none" target="_blank">
       RobotiumTech/robotium
      </a>
      <br/>
      (Integration Tests)模拟用户操作，事件流测试。
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-java">@RunWith(RobolectricTestRunner.class)
@Config(constants = BuildConfig.class)
public class MyActivityTest{<!-- --></code></pre>
     <div class="cnblogs_code" style='background-color:rgb(245,245,245); border:1px solid rgb(204,204,204); padding:5px; overflow:auto; margin:5px 0px; font-family:"Courier New"!important; font-size:12px!important'>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
      <pre style='margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word; font-family:"Courier New"!important'><span style="line-height:1.8">@Test
  </span><span style="line-height:1.8; color:rgb(0,0,255)">public</span> <span style="line-height:1.8; color:rgb(0,0,255)">void</span><span style="line-height:1.8"> doSomethingTests(){
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 获取Application对象</span>
    Application application =<span style="line-height:1.8"> RuntimeEnvironment.application;

    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 启动WelcomeActivity</span>
    WelcomeActivity activity = Robolectric.setupActivity(WelcomeActivity.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 触发activity中Id为R.id.login的View的click事件
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span> <span style="line-height:1.8; color:rgb(0,128,0)"><u>http://www.manongjc.com/article/1502.html</u></span>
<span style="line-height:1.8">    activity.findViewById(R.id.login).performClick();

    Intent expectedIntent </span>= <span style="line-height:1.8; color:rgb(0,0,255)">new</span> Intent(activity, LoginActivity.<span style="line-height:1.8; color:rgb(0,0,255)">class</span><span style="line-height:1.8">);
    </span><span style="line-height:1.8; color:rgb(0,128,0)">//</span><span style="line-height:1.8; color:rgb(0,128,0)"> 在activity之后，启动的Activity是否是LoginActivity</span>
<span style="line-height:1.8">    assertThat(shadowOf(activity).getNextStartedActivity()).isEqualTo(expectedIntent);
  }
}</span></pre>
      <div class="cnblogs_code_toolbar" style="margin-top:5px">
       <span class="cnblogs_code_copy" style="line-height:1.8; padding-right:5px">
        <a style="color:navy; border:none!important" target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif" style="max-width:900px; border:none!important"/>
        </a>
       </span>
      </div>
     </div>
     <p style="margin:10px auto">
      通过模拟用户的操作的行为事件流进行测试，这类测试无法避免需要在虚拟机或者设备上面运行的。是一些用户操作流程与视觉显示强相关的很好的选择。
     </p>
     <p style="margin:10px auto">
     </p>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       6. Test Butler
      </span>
     </p>
     <p style="margin:10px auto">
      <a href="https://github.com/linkedin/test-butler" rel="external noopener noreferrer" style="color:navy; text-decoration:none" target="_blank">
       linkedin/test-butler
      </a>
      <br/>
      避免设备/模拟器系统或者环境的错误，导致测试的失败。
     </p>
     <p style="margin:10px auto">
      通常我们在进行UI测试的时候，会遇到由于模拟器或者设备的错误，如系统的crash、ANR、或是未预期的Wifi、CPU罢工，或者是锁屏，这些外再环境因素导致测试不过。Test-Butler引入就是避免这些环境因素导致UI测试不过。
     </p>
     <p style="margin:10px auto">
      该库被
      <a href="https://www.youtube.com/watch?v=aHcmsK9jfGU" rel="external noopener noreferrer" style="color:navy; text-decoration:none" target="_blank">
       谷歌官方推荐过
      </a>
      ，并且收到谷歌工程师的Review。
     </p>
     <p style="margin:10px auto">
     </p>
     <h3 style="margin:10px 0px; font-size:21px; line-height:1.5">
      拓展思路
     </h3>
     <p style="margin:10px auto">
      <span style="line-height:19.5px">
       1. Android Robots
      </span>
     </p>
     <pre style="margin-top:0px; margin-bottom:0px; white-space:pre-wrap; word-wrap:break-word"><code class="language-java">Instrumentation Testing Robots – Jake Wharton</code></pre>
     <p style="margin:10px auto">
      假如我们需要测试: 发送 $42 到 “foo@bar.com”，然后验证是否成功。
     </p>
     <h6 style="margin:10px 0px; padding:0px; font-size:12px">
      (1)通常的做法
     </h6>
     <p style="margin:10px auto; text-align:center">
      <img alt="Android单元测试与模拟测试详解" src="https://i-blog.csdnimg.cn/blog_migrate/0c52a32103b37dbcc32364304c79b6f8.png" style="border:0px; max-width:900px" title="Android单元测试与模拟测试详解"/>
     </p>
     <p style="margin:10px auto; text-align:center">
      <img alt="Android单元测试与模拟测试详解" src="https://i-blog.csdnimg.cn/blog_migrate/ae7bc8c7f5daa4231629a5b6634fc36b.png" style="border:0px; max-width:900px" title="Android单元测试与模拟测试详解"/>
     </p>
     <p style="margin:10px auto">
      (2)Robot思想
     </p>
     <p style="margin:10px auto">
      在写真正的UI测试的时候，只需要关注要测试什么，而不需要关注需要怎么测试，换句话说就是让测试逻辑与View或Presenter解耦，而与数据产生关系。
     </p>
     <p style="margin:10px auto">
      首先通过封装一个Robot去处理How的部分:
     </p>
     <p style="margin:10px auto">
      <img alt="Android单元测试与模拟测试详解" src="https://i-blog.csdnimg.cn/blog_migrate/4ce3c98bc7e2823461ba5849cd55066f.png" style="border:0px; max-width:900px" title="Android单元测试与模拟测试详解"/>
     </p>
     <p style="margin:10px auto; text-align:center">
     </p>
     <p style="margin:10px auto">
      然后在写测试的时候，只关注需要测试什么:
     </p>
     <p style="margin:10px auto; text-align:center">
      <img alt="Android单元测试与模拟测试详解" src="https://i-blog.csdnimg.cn/blog_migrate/05ee9ee0c6f654ab28ea11fece33dcec.png" style="border:0px; max-width:900px" title="Android单元测试与模拟测试详解"/>
     </p>
     <p style="margin:10px auto">
      最终的思想原理
     </p>
     <p style="margin:10px auto; text-align:center">
      <img alt="Android单元测试与模拟测试详解" src="https://i-blog.csdnimg.cn/blog_migrate/a95f7b67281f90686e92c531c2701a5a.png" style="border:0px; max-width:900px" title="Android单元测试与模拟测试详解"/>
     </p>
     <p style="margin:10px auto; text-align:center">
      <br/>
     </p>
     <p style="margin:10px auto; text-align:center">
      <br/>
     </p>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f7869616f6d656e677a695f3136:2f61727469636c652f64657461696c732f3738323036333238" class_="artid" style="display:none">
 </p>
</div>


