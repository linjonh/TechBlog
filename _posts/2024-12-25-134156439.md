---
layout: post
title: "内存性能测试工具使用"
date: 2024-12-25 16:06:06 +0800
description: "这篇文章介绍了两个IT技术测试工具：bw_mem用于测量内存带宽，支持指定并行度、预热时间和重复次数"
keywords: "内存读写测试"
categories: ['未分类']
tags: ['Linux']
artid: "134156439"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=134156439
  alt: "内存性能测试工具使用"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     内存性能测试工具使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     bw_mem介绍
    </p>
    <p>
     bw_mem是lmbench套件中的一个子测试工具，用于测试内存带宽，可以对内存RAM进行指定容量读写测试
     <br/>
     参数说明:
     <br/>
     -P ：指定并行度（默认为1），即同时进行读写操作的线程数。
     <br/>
     -W ：指定预热时间（默认为2秒），即测试前先进行一段时间的数据填充以缓存命中率达到稳定状态，避免影响测试结果。
     <br/>
     -N ：指定重复次数（默认为10次），即每个块大小和并行度组合下测试多少轮。
     <br/>
     size：每个块的大小，单位为字节。
     <br/>
     what：表示要测试的类型，包括：
     <br/>
     rd: 顺序读取
     <br/>
     wr: 顺序写入
     <br/>
     rdwr: 读写交替进行
     <br/>
     cp: 单线程复制操作
     <br/>
     fwr: 随机写入
     <br/>
     frd: 随机读取
     <br/>
     fcp: 随机复制操作
     <br/>
     bzero: 填充0操作
     <br/>
     bcopy: 内存拷贝操作
     <br/>
     例如，如果想要测试10M块大小、随机读取、并行度为4、预热时间为3秒、重复10次的情况，则运行以下命令：
     <br/>
     bw_mem -P 4 -W 3 -N 10 16M frd
    </p>
    <p>
     测试内容：
     <br/>
     测试cpu0~cpu7每个cpu从内存的读写带宽
    </p>
    <p>
     测试方法：
    </p>
    <p>
     用cpu0举例，其他cpu核方法一致，测试cpu0对内存的读写速度
    </p>
    <ol>
     <li>
      拔掉其他7个cpu核，只保留cpu0在线
     </li>
     <li>
      echo &gt; 0 /sys/devices/system/cpu/cpu(n)/online，n取值1~7，分别执行拔核动作，需要执行七次该命令
     </li>
     <li>
      cat /sys/devices/system/cpu/cpu(n)/online 分别读取各个cpu online节点的值，如果是0表示拔核成功
     </li>
     <li>
      cat sys/devices/system/cpu/online 查看哪个cpu在线
      <br/>
      测试举例：
      <br/>
      把bw_mem push 到系统data目录，修改bw_mem的执行权限
      <br/>
      chmod 777 bw_mem
     </li>
    </ol>
    <p>
     lat_mem_rd
    </p>
    <p>
     lat_mem_rd介绍
     <br/>
     lat_mem_rd用于内存读取的延迟测试
     <br/>
     运行以下命令来测试内存读取延迟：
     <br/>
     ./lat_mem_rd -P 1 -t -N 10 1M 16
     <br/>
     参数说明：
    </p>
    <ul>
     <li>
      <code>
       -P 1
      </code>
      ：使用一个进程 进行测试。
     </li>
     <li>
      ` -t：随机访问模式，若无此选项为顺序访问。
     </li>
     <li>
      <code>
       -N 10
      </code>
      ：进行 10 次测试并输出平均值。
      <br/>
      1M：访问的最大数据块，单位M
      <br/>
      16：访问的步长大小，单位Byte（如果不写默认是64）
      <br/>
      测试结果
      <br/>
      stride=16
      <br/>
      0.00049 1.584
      <br/>
      0.00098 1.583
      <br/>
      0.00195 1.593
      <br/>
      0.00293 1.593
      <br/>
      0.00391 1.597
      <br/>
      0.00586 1.598
      <br/>
      0.00781 1.600
      <br/>
      0.01172 1.600
      <br/>
      0.01562 1.602
      <br/>
      0.02344 1.602
      <br/>
      0.03125 1.628
      <br/>
      0.04688 2.230
      <br/>
      0.06250 2.207
      <br/>
      0.09375 2.205
      <br/>
      0.12500 2.204
      <br/>
      0.18750 2.237
      <br/>
      0.25000 2.278
      <br/>
      0.37500 2.326
      <br/>
      0.50000 2.351
      <br/>
      0.75000 2.345
      <br/>
      1.00000 2.349
      <br/>
      执行结果的左侧为数据块大小，单位为兆M；右侧为在该数据块大小时测得的延时，延时单位是纳秒ns
     </li>
    </ul>
    <p>
     测试内容：
     <br/>
     我们需要分别测试cpu0~cpu7每个cpu从内存的读数据延时，数据块1M，测试步长分别为16,64,128
    </p>
    <p>
     把lat_mem_rd push 到系统data目录，修改bw_mem的执行权限
     <br/>
     chmod 777 lat_mem_rd
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34323737393032342f:61727469636c652f64657461696c732f313334313536343339" class_="artid" style="display:none">
 </p>
</div>
