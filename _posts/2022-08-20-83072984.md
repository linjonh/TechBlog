---
layout: post
title: "JAVARuntime-调用Python脚本可传参"
date: 2022-08-20 09:36:31 +0800
description: "使用场景：在java中通过runtime调用python脚本1.python脚本中连接Oracle数"
keywords: "runtime.getruntime()调用python传参"
categories: ['未分类']
tags: ['环境变量', 'Runtime', 'Python', 'Java', 'Java', 'Cx']
artid: "83072984"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=83072984
  alt: "JAVARuntime-调用Python脚本可传参"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [JAVA]Runtime 调用Python脚本(可传参)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     使用场景：在java中通过runtime调用python脚本
    </p>
    <h3>
     1.python脚本中连接Oracle数据库查询数据后输出文件，脚本头内容如下
    </h3>
    <blockquote>
     <pre><code class="language-html hljs">#!/usr/bin/python3
#encoding=utf-8
import os
from pypinyin import pinyin,lazy_pinyin
import cx_Oracle as oracle
import sys
import pypinyin
import datetime
import redis
import argparse

os.environ["ORACLE_HOME"] = '/Users/apple/Library/Oracle/instantclient_12_2'
os.environ["DYLD_LIBRARY_PATH"] = '/Users/apple/Library/Oracle/instantclient_12_2'
os.environ["LD_LIBRARY_PATH"] = '/Users/apple/Library/Oracle/instantclient_12_2'
os.environ["NLS_LANG"] = 'SIMPLIFIED CHINESE_CHINA.UTF8' #定义脚本说明文案
parser = argparse.ArgumentParser(description='-updateuser:操作用户名') #定义脚本入参
parser.add_argument('-uu', type=str,default=None)</code></pre>
</blockquote>
<p>
脚本下面的内容都是查询数据库，然后将查询结果输出为文件，就略过了。再补充一下 main 方法的内容
</p>
<blockquote>
<pre><code class="language-html hljs">if **name** == '**main**':
args = parser.parse_args()
print(args.uu)
cc = ChineseConvertPinYin()
cc.execute(args.uu)</code></pre>
</blockquote>
<h3>
2.Java 中通过 Runtime 调用执行 python
</h3>
<blockquote>
<p>
//设置 java 执行进程的环境变量(临时的)
</p>
<p>
String[]
<strong>
envp
</strong>
=
<strong>
new
</strong>
String[]{"LD_LIBRARY_PATH=/Users/apple/Library/Oracle/instantclient_12_2","LANG=UTF-8"};
</p>
<p>
//exec 方法 第一个参数是执行的命令，第二个参数为环境变量数据（环境变量设置方式：NAME=VALUE）
</p>
<p>
Process
<strong>
pr
</strong>
=Runtime.
<em>
getRuntime
</em>
().exec("python3 /Work/pythonWork/pinyin/ChineseConvertPinYin.py -uu wzj",envp);
</p>
<p>
System.
<strong>
<em>
out
</em>
</strong>
.println(pr.waitFor());//返回 0 表示执行成功，返回 1 表示执行失败（PS：网上看到有数如果执行多条命令的时候，这个 waitFor 必不可少，本次没有实际用途，暂未深入研究）
</p>
<p>
//获取输出流，即：python 脚本中的 print 或 shell 的 echo
</p>
<p>
BufferedReader
<strong>
in
</strong>
=
<strong>
new
</strong>
BufferedReader(
<strong>
new
</strong>
InputStreamReader(pr.getInputStream()));
</p>
<p>
String
<strong>
line
</strong>
=
<strong>
null
</strong>
;
</p>
<p>
<strong>
while
</strong>
((line = in.readLine()) !=
<strong>
null
</strong>
){
<!-- -->
</p>
<p>
System.
<strong>
<em>
out
</em>
</strong>
.println(line);//输出每一行打印或 echo
</p>
<p>
}
</p>
<p>
//获取异常输出流
</p>
<p>
BufferedReader
<strong>
ine
</strong>
=
<strong>
new
</strong>
BufferedReader(
<strong>
new
</strong>
InputStreamReader(pr.getErrorStream()));
</p>
<p>
String
<strong>
linee
</strong>
=
<strong>
null
</strong>
;
</p>
<p>
<strong>
while
</strong>
((linee = ine.readLine()) !=
<strong>
null
</strong>
){
<!-- -->
</p>
<p>
System.
<strong>
<em>
out
</em>
</strong>
.println(linee);
</p>
<p>
}
</p>
</blockquote>
<h3> 3.总结
</h3>
<p>
过程中遇到过两个问题：
</p>
<p>
1.Python 调用 Oracle 连接驱动的问题，使用 pip 安装 cx_Oracle 后，总是报错，大致内容如下：
</p>
<blockquote>
<p>
cx_Oracle.DatabaseError: DPI-1047: 64-bit Oracle Client library cannot be loaded: "dlopen(libclntsh.dylib, 1): image not found". See https://oracle.github.io/odpi/doc/installation.html#macos for help
</p>
</blockquote>
<p>
解决方式：安装 oracle 连接驱动，此处参考
<a href="http://jashawn.iteye.com/blog/1654441" rel="nofollow">
http://jashawn.iteye.com/blog/1654441
</a>
</p>
<p>
2.Java Runtime 执行的时候，Python 脚本中的临时环境变量未生效（此处有待后续研究），遂在 java 进程中设置独立环境变量，代码如下：
</p>
<blockquote>
<p>
String[]
<strong>
envp
</strong>
=
<strong>
new
</strong>
String[]{"LD_LIBRARY_PATH=/Users/apple/Library/Oracle/instantclient_12_2","LANG=UTF-8"};
</p>
</blockquote>
<p> 3.补充一下，linux or mac 下安装 oracle 驱动包以及环境变量配置(以下代码来源网络)
</p>
<p>
3.1 下载所需要的驱动包
</p>
<blockquote>
<p>
wget https://github.com/bumpx/oracle-instantclient/raw/master/instantclient-basic-linux.x64-11.2.0.4.0.zip -O /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip &amp;&amp; \
 </p>
<p>
wget https://github.com/bumpx/oracle-instantclient/raw/master/instantclient-sdk-linux.x64-11.2.0.4.0.zip -O /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip
</p>
</blockquote>
<p>
3.2 解压到指定目录
</p>
<blockquote>
<p>
unzip /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip -d /usr/local/ &amp;&amp; \
 </p>
<p>
unzip /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip -d /usr/local/
</p>
</blockquote>
<p>
3.3 建立软连
</p>
<blockquote>
<p>
ln -s /usr/local/instantclient_11_2 /usr/local/instantclient &amp;&amp; \
 </p>
<p>
ln -s /usr/local/instantclient/libclntsh.so.11.1 /usr/local/instantclient/libclntsh.so
</p>
</blockquote>
<p>
3.4 配置环境变量
</p>
<blockquote>
<p>
echo "LD_LIBRARY_PATH=/usr/local/instantclient:$LD_LIBRARY_PATH" &gt;&gt; .bash_profile
     </p>
     <p>
      echo "PATH=$PATH:/usr/local/instantclient" &gt;&gt; .bash_profile
</p>
<p>
echo "export LD_LIBRARY_PATH PATH" &gt;&gt; .bash_profile
</p>
</blockquote>
<p>
3.5 使环境变量生效
</p>
<blockquote>
<p>
source .bash_profile
</p>
</blockquote>

   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303131373731303137:2f61727469636c652f64657461696c732f3833303732393834" class_="artid" style="display:none">
 </p>
</div>
