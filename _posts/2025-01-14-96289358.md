---
layout: post
title: "Qt中使用vlc-qt处理音视频"
date: 2025-01-14 16:19:49 +0800
description: "Qt中使用vlc-qt处理音视频需要下载vlc-qt或者自己编译（linux配置vlc-qt）。播放"
keywords: "qtitvq"
categories: ['Qt']
tags: ['Qt']
artid: "96289358"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=96289358
    alt: "Qt中使用vlc-qt处理音视频"
render_with_liquid: false
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Qt中使用vlc-qt处理音视频
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Qt中使用vlc-qt处理音视频需要下载vlc-qt或者自己编译
     <a href="https://blog.csdn.net/m0_38133212/article/details/96288174">
      （linux配置vlc-qt）
     </a>
     。播放本地视频或者连接网络摄像头感觉都挺流畅，画面质量很不错。此外看到vlc-qt可以实现一个窗口内多个控件显示视频的功能，非常厉害（这个我没有试过，不知道效果如何）。
     <br/>
     （那几天用opencv读视频和QtAV，vlc-qt我都尝试过，感觉vlc-qt性能最佳，并且非常容易使用）。
    </p>
    <p>
     效果如下，这里我是获取视频，抽帧之后转RGB图，在上面画了一个绿框：
     <br/>
     这个代码我放到了github，可以了解一下。
     <br/>
     <a href="https://github.com/Whu-wxy/Qt-VLC-Demo">
      https://github.com/Whu-wxy/Qt-VLC-Demo
     </a>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a29fe51fd7c657dc21ca9e988e8fdc94.png"/>
    </p>
    <p>
     这两天用了一点点vlc-qt，简要记录一下：
    </p>
    <p>
     处理视频时需要的几个类：
     <br/>
     VlcInstance，VlcMedia（连接视频），VlcMediaPlayer（控制播放）
     <br/>
     VlcVideoStream（视频抽帧）
     <br/>
     VlcWidgetVideo（显示视频的控件）
     <br/>
     帮助文档（写的比较简略）：
     <a href="https://vlc-qt.tano.si/reference/" rel="nofollow">
      https://vlc-qt.tano.si/reference/
     </a>
     <br/>
     vlc-qt github源码：
     <a href="https://github.com/vlc-qt/vlc-qt">
      https://github.com/vlc-qt/vlc-qt
     </a>
    </p>
    <p>
     <strong>
      视频抽帧：
     </strong>
     <br/>
     从VlcVideoStream派生一个类，比如ZNDKVideoStream，实现virtual void frameUpdated()，但是发现控件VlcWidgetVideo上就不显示了，我理解的是图片被VlcVideoStream截获，因此不能在VlcWidgetVideo显示。获得的图是YUV格式的，需要转换为RGB才可以方便自定义的图片处理。
    </p>
    <p>
     这里找到一段YUV转cv::Mat的代码，得到Mat图片后我们进一步可以转为RGB。
     <a href="https://github.com/vlc-qt/vlc-qt/issues/230">
      https://github.com/vlc-qt/vlc-qt/issues/230
     </a>
     。网上有些资料说用公式转换的效果不好，还有说可以用OpenGL转，以后有空可以尝试，这样就可以完全不依赖于opencv了。
    </p>
    <pre><code>void ZNDKVideoStream::frameUpdated()
{
//获得帧
    std::shared_ptr&lt;const VlcYUVVideoFrame&gt; pFrame = std::dynamic_pointer_cast&lt;const VlcYUVVideoFrame&gt;(renderFrame());

    if (!pFrame) {
        return; //LCOV_EXCL_LINE
    }

//YUV图转Mat，再转QImage
    int rows = pFrame-&gt;height + pFrame-&gt;height / 2;
    int cols = pFrame-&gt;width;
    int matType = CV_8UC1 ;

    cv::Mat myuv(rows,cols,matType,(void*)pFrame-&gt;frameBuffer.data());
    cv::Mat mrgb(pFrame-&gt;height, pFrame-&gt;width, CV_8UC3);
    cv::cvtColor(myuv, mrgb, CV_YUV2RGB_I420);
    QImage img((const unsigned char *)(mrgb.data), mrgb.cols, mrgb.rows, mrgb.cols * 3, QImage::Format_RGB888);
    img.rgbSwapped();
｝
</code></pre>
    <p>
     在这里图片可以选择用信号发出去：
    </p>
    <pre><code>emit sendImage(img);
</code></pre>
    <p>
     <strong>
      视频缓存：
     </strong>
     <br/>
     <a href="https://github.com/vlc-qt/vlc-qt/issues/201">
      https://github.com/vlc-qt/vlc-qt/issues/201
     </a>
     <br/>
     设置（也就是VlcMedia） media-&gt;setOption(":network-caching=100")
     <br/>
     然鹅好像有点问题。
    </p>
    <p>
     <strong>
      运行时报错：
     </strong>
    </p>
    <blockquote>
     <p>
      core libvlc error: No plugins found! Check your VLC installation.
      <br/>
      VLC-Qt Error: libvlc failed to load!
     </p>
    </blockquote>
    <p>
     解决：
    </p>
    <pre><code class="prism language-python">sudo apt<span class="token operator">-</span>get install libvlc<span class="token operator">-</span>dev
sudo apt<span class="token operator">-</span>get install vlc
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6d305f3338313333323132:2f61727469636c652f64657461696c732f3936323839333538" class_="artid" style="display:none">
 </p>
</div>


