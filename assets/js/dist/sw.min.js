---
permalink: /:basename
---
/*!
 * jekyll-theme-chirpy v7.2.4 | © 2019 Cotes Chung | MIT Licensed | https://github.com/cotes2020/jekyll-theme-chirpy/
 */
!function(){"use strict";importScripts("./assets/js/data/swconf.js");const e=swconf.purge,t=swconf.interceptor;function s(e){const s=new URL(e),c=s.pathname;if(!s.protocol.startsWith("http"))return!1;for(const e of t.urlPrefixes)if(s.href.startsWith(e))return!1;for(const e of t.paths)if(c.startsWith(e))return!1;return!0}self.addEventListener("install",(t=>{e||t.waitUntil(caches.open(swconf.cacheName).then((e=>e.addAll(swconf.resources))))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>e||t!==swconf.cacheName?caches.delete(t):void 0))))))})),self.addEventListener("message",(e=>{"SKIP_WAITING"===e.data&&self.skipWaiting()}));const c="https://api.allorigins.win/raw?url=",n="https://api.allorigins.win";function r(t,c){t.respondWith(caches.match(c).then((t=>t||fetch(c).then((t=>{const n=c.url;if(e||"GET"!==c.method||!s(n))return t;let r=t.clone();return caches.open(swconf.cacheName).then((e=>{e.put(c,r)})),t})))))}self.addEventListener("fetch",(t=>{let o=t.request;if(!o.headers.has("range"))if(!o.url.includes("csdnimg.cn")&&!o.url.includes("https://www.cloudflare-terms-of-service-abuse.com/")||o.url.includes(n))o.url.includes(n)&&o.url.endsWith(".ts")?function(t,r){t.waitUntil((async()=>{const t=await caches.match(r);if(t)return t;let o=r.url.replace(n+"/","");console.log("handle ts file："+o);const a=await caches.keys();for(const t of a){const a=await caches.open(t),i=await a.keys();for(const t of i){const i=await a.match(t),l=await i.text();let d=t.url;if(d.endsWith(".m3u8")&&(console.log("macth m3u8:"+d),l.includes(o))){let a=decodeURIComponent(d);console.log("m3u8Url: "+a),a=a.replace(c,"");let i=new URL(o,a.substring(0,a.lastIndexOf("/")+1));i=c+i.href,console.log("tsUrl:"+i);const l=new Request(i,{method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:n,integrity:r.integrity});let h;console.log(l);const u=await fetch(l);if(u.redirected){const e=c+u.url;h=await fetch(e),200===h.status?console.log("重定向的response：success,"+h.url):console.log("重定向的response：failed"+h.url)}else h=u;const f=t.url;if(e||"GET"!==t.method||!s(f))return h;let m=h.clone();return(await caches.open(swconf.cacheName)).put(t,m),h}}}return fetch(r)})())}(t,o):r(t,o);else{const e=o.url,s=new Request(c+e,{method:o.method,headers:o.headers,body:o.body,mode:o.mode,credentials:o.credentials,cache:o.cache,redirect:o.redirect,referrer:n,integrity:o.integrity});r(t,s),console.log("Request Headers:",[...s.headers.entries()])}}))}();
